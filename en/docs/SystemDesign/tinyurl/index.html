<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-SystemDesign/tinyurl" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.1"><title data-rh=true>Design a URL Shortener like TinyURL | RulerChen</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:image content=https://RulerChen.github.io/RulerChen-Website/en/img/profile/profile.webp /><meta data-rh=true name=twitter:image content=https://RulerChen.github.io/RulerChen-Website/en/img/profile/profile.webp /><meta data-rh=true property=og:url content=https://RulerChen.github.io/RulerChen-Website/en/docs/SystemDesign/tinyurl/ /><meta data-rh=true property=og:locale content=en /><meta data-rh=true property=og:locale:alternate content=zh_Hant /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-default-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current /><meta data-rh=true property=og:title content="Design a URL Shortener like TinyURL | RulerChen"/><meta data-rh=true name=description content="Design a URL Shortener like TinyURL"/><meta data-rh=true property=og:description content="Design a URL Shortener like TinyURL"/><meta data-rh=true name=keywords content="URL Shortener,System Design"/><link data-rh=true rel=icon href=/RulerChen-Website/en/img/profile/profile.webp /><link data-rh=true rel=canonical href=https://RulerChen.github.io/RulerChen-Website/en/docs/SystemDesign/tinyurl/ /><link data-rh=true rel=alternate href=https://RulerChen.github.io/RulerChen-Website/docs/SystemDesign/tinyurl/ hreflang=zh-Hant /><link data-rh=true rel=alternate href=https://RulerChen.github.io/RulerChen-Website/en/docs/SystemDesign/tinyurl/ hreflang=en /><link data-rh=true rel=alternate href=https://RulerChen.github.io/RulerChen-Website/docs/SystemDesign/tinyurl/ hreflang=x-default /><link data-rh=true rel=preconnect href=https://GSV9DQB5UM-dsn.algolia.net crossorigin=anonymous /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://RulerChen.github.io/RulerChen-Website/en/docs/SystemDesign/","name":"System Design","position":1},{"@type":"ListItem","item":"https://RulerChen.github.io/RulerChen-Website/en/docs/SystemDesign/tinyurl","name":"Design a URL Shortener like TinyURL","position":2}]}</script><link rel=alternate type=application/rss+xml href=/RulerChen-Website/en/blog/rss.xml title="RulerChen's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/RulerChen-Website/en/blog/atom.xml title="RulerChen's Blog Atom Feed"><link rel=alternate type=application/json href=/RulerChen-Website/en/blog/feed.json title="RulerChen's Blog JSON Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-8BEHDPLQMG"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-8BEHDPLQMG",{anonymize_ip:!0})</script><link rel=search type=application/opensearchdescription+xml title=RulerChen href=/RulerChen-Website/en/opensearch.xml><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin=anonymous><link rel=preconnect href=https://fonts.googleapis.com crossorigin=anonymous><link rel=preconnect href=https://fonts.gstatic.com crossorigin=anonymous><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css type=text/css integrity=sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM crossorigin=anonymous><link rel=stylesheet href=/RulerChen-Website/en/assets/css/styles.84519aae.css /><script src=/RulerChen-Website/en/assets/js/runtime~main.7db3a728.js defer></script><script src=/RulerChen-Website/en/assets/js/main.6bc552ab.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t;document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/RulerChen-Website/en/img/profile/profile.webp /><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/RulerChen-Website/en/><div class=navbar__logo><img src=/RulerChen-Website/en/img/profile/profile.webp alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"/><img src=/RulerChen-Website/en/img/profile/profile.webp alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"/></div><b class="navbar__title text--truncate">RulerChen</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/RulerChen-Website/en/docs/intro/>Notes</a><a class="navbar__item navbar__link" href=/RulerChen-Website/en/blog/>Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_nlXk><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>English</a><ul class=dropdown__menu><li><a href=/RulerChen-Website/docs/SystemDesign/tinyurl/ target=_self rel="noopener noreferrer" class=dropdown__link lang=zh-Hant>繁體中文</a><li><a href=/RulerChen-Website/en/docs/SystemDesign/tinyurl/ target=_self rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=en>English</a></ul></div><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts=Meta+k><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 24 24" aria-hidden=true><circle cx=11 cy=11 r=8 stroke=currentColor fill=none stroke-width=1.4 /><path d="m21 21-4.3-4.3" stroke=currentColor fill=none stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/RulerChen-Website/en/docs/intro/><span title=Roadmap class=linkLabel_WmDU>Roadmap</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/RulerChen-Website/en/docs/CMU15-213/><span title="CMU 15-213" class=categoryLinkLabel_W154>CMU 15-213</span></a><button aria-label="Expand sidebar category 'CMU 15-213'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/RulerChen-Website/en/docs/CMU15-445/><span title="CMU 15-445" class=categoryLinkLabel_W154>CMU 15-445</span></a><button aria-label="Expand sidebar category 'CMU 15-445'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/RulerChen-Website/en/docs/Security/><span title=Security class=categoryLinkLabel_W154>Security</span></a><button aria-label="Expand sidebar category 'Security'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href=/RulerChen-Website/en/docs/SystemDesign/><span title="System Design" class=categoryLinkLabel_W154>System Design</span></a><button aria-label="Collapse sidebar category 'System Design'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/RulerChen-Website/en/docs/SystemDesign/tinyurl/><span title="Design a URL Shortener like TinyURL" class=linkLabel_WmDU>Design a URL Shortener like TinyURL</span></a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/RulerChen-Website/en/docs/Other/shell/><span title=Other class=categoryLinkLabel_W154>Other</span></a></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_z5aJ"><div class=docItemContainer_c0TR><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/RulerChen-Website/en/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/RulerChen-Website/en/docs/SystemDesign/><span>System Design</span></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Design a URL Shortener like TinyURL</span></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Design a URL Shortener like TinyURL</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id=background>Background<a href=#background class=hash-link aria-label="Direct link to Background" title="Direct link to Background" translate=no>​</a></h2>
<p><a href=https://tinyurl.com/ target=_blank rel="noopener noreferrer">TinyURL</a> 是一個網址縮短服務，使用者可以輸入一個長網址並得到一個短網址，當其他使用者訪問這個短網址時，會被重定向到原始的長網址。</p>
<p>舉例來說，使用者可以將 <code>https://www.example.com/some/very/long/url</code> 丟給 TinyURL，TinyURL 會回傳一個短網址 <code>https://tinyurl.com/abc123</code>，當其他人訪問這個短網址時，會被重定向到 <code>https://www.example.com/some/very/long/url</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=requirements>Requirements<a href=#requirements class=hash-link aria-label="Direct link to Requirements" title="Direct link to Requirements" translate=no>​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=functional-requirements>Functional Requirements<a href=#functional-requirements class=hash-link aria-label="Direct link to Functional Requirements" title="Direct link to Functional Requirements" translate=no>​</a></h3>
<ul>
<li>使用者可以提交一個長網址並獲得一個對應的短網址</li>
<li>使用者可以通過短網址來被重定向到原始的長網址</li>
<li>短網址預設會在 3 年後過期</li>
<li><del>使用者可以自行設定過期時間</del></li>
<li><del>使用者可以刪除短網址</del></li>
<li><del>使用者可以自訂短網址的別名</del></li>
<li><del>可以提供統計資訊，如點擊次數或是使用者的地理位置分布</del></li>
</ul>
<p>本文將專注於短網址的核心功能，也就是生成短網址並進行重定向，其他的功能則不在本文的討論範圍內。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=non-functional-requirements>Non-Functional Requirements<a href=#non-functional-requirements class=hash-link aria-label="Direct link to Non-Functional Requirements" title="Direct link to Non-Functional Requirements" translate=no>​</a></h3>
<ul>
<li>重定向需要確保低延遲 (&lt; 100ms)</li>
<li>高可用性 (可用性 > 一致性)</li>
<li>可擴展性，可以處理 100M DAU</li>
<li>保證短網址的唯一性，不會有一個短網址對應到多個長網址</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=back-of-the-envelope-estimation>Back of the Envelope Estimation<a href=#back-of-the-envelope-estimation class=hash-link aria-label="Direct link to Back of the Envelope Estimation" title="Direct link to Back of the Envelope Estimation" translate=no>​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=assumptions>Assumptions<a href=#assumptions class=hash-link aria-label="Direct link to Assumptions" title="Direct link to Assumptions" translate=no>​</a></h3>
<ul>
<li>100M DAU</li>
<li>每日產生 5M 個短網址</li>
<li>讀寫比例 100:1</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=qps>QPS<a href=#qps class=hash-link aria-label="Direct link to QPS" title="Direct link to QPS" translate=no>​</a></h3>
<ul>
<li>每秒平均寫入請求數: 5M / 86400 ≈ 58 (writes/sec)</li>
<li>每秒平均讀取請求數: 58 * 100 = 5800 (reads/sec)</li>
<li>高峰期流量假設為平均的 5 倍: 29000 (reads/sec), 290 (writes/sec)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=storage>Storage<a href=#storage class=hash-link aria-label="Direct link to Storage" title="Direct link to Storage" translate=no>​</a></h3>
<p>首先對每個欄位的大小進行估算 :</p>
<ul>
<li>長網址: 150 bytes</li>
<li>短網址: 20 bytes</li>
<li>使用者 ID: 16 bytes</li>
<li>創建時間戳: 8 bytes</li>
<li>過期時間戳: 8 bytes</li>
<li>索引和其他開銷: 100 bytes</li>
</ul>
<p>從上述估算可得每條紀錄約 300 bytes。</p>
<ul>
<li>每日產生的短網址數量: 5M</li>
<li>每日儲存空間需求: 5M * 300B = 1.5GB</li>
<li>3 年的儲存空間需求: 1.5GB * 365 * 3 = 1.6TB</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=bandwidth>Bandwidth<a href=#bandwidth class=hash-link aria-label="Direct link to Bandwidth" title="Direct link to Bandwidth" translate=no>​</a></h3>
<p>兩隻 API 的請求大小差距不大，假設每次請求輸入輸出大小均為 500 bytes (包含 HTTP headers) :</p>
<ul>
<li>Ingress: (58 + 5800) * 500 bytes * 8 (bits/byte) / 1000000 (Mbps) ≈ 23 Mbps</li>
<li>Egress: 同上 ≈ 23 Mbps</li>
</ul>
<p>即使是在高峰期 (115 Mbps)，這樣的頻寬需求對於現代的雲端服務來說並不是瓶頸。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=memory>Memory<a href=#memory class=hash-link aria-label="Direct link to Memory" title="Direct link to Memory" translate=no>​</a></h3>
<p>使用 in-memory 的資料庫快取最熱門的 10% 短網址，並假設每個短網址的資料大小約 200 bytes (short_url -> long_url) :</p>
<ul>
<li>需要快取的短網址數量: 5M * 365 * 3 * 10% = 547.5M</li>
<li>需要的記憶體大小: 547.5M * 200B = 109.5GB</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=schema-design>Schema Design<a href=#schema-design class=hash-link aria-label="Direct link to Schema Design" title="Direct link to Schema Design" translate=no>​</a></h2>
<ul>
<li>
<p>url_table</p>
<ul>
<li>short_url</li>
<li>long_url</li>
<li>user_id</li>
<li>created_at</li>
<li>expiry_date</li>
</ul>
</li>
<li>
<p>user_table (not included in this design)</p>
<ul>
<li>user_id</li>
<li>email</li>
<li>created_at</li>
<li>...</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=api-design>API Design<a href=#api-design class=hash-link aria-label="Direct link to API Design" title="Direct link to API Design" translate=no>​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=create-short-url>Create Short URL<a href=#create-short-url class=hash-link aria-label="Direct link to Create Short URL" title="Direct link to Create Short URL" translate=no>​</a></h3>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-http codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">POST /api/urls</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    "long_url": "https://www.example.com/some/very/long/url",</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    "custom_alias": "optional-custom-alias",</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    "expiry_date": "optional-expiry-date"</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">}</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Response: HTTP 200 OK</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    "short_url": "https://tinyurl.com/abc123"</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">}</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=redirect-to-long-url>Redirect to Long URL<a href=#redirect-to-long-url class=hash-link aria-label="Direct link to Redirect to Long URL" title="Direct link to Redirect to Long URL" translate=no>​</a></h3>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-http codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">GET /{short_url}</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Response: HTTP 301 Moved Permanently</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Location: https://www.example.com/some/very/long/url</span><br/></span></code></pre></div></div>
<p>這裡的 HTTP status code 有兩種選擇 :</p>
<ul>
<li>301 Moved Permanently: 表示這個重定向是永久性的，瀏覽器跟搜尋引擎都會將這個短網址記錄下來</li>
<li>302 Found: 表示這個重定向是臨時性的，每次訪問短網址都會需要重新發送請求到伺服器</li>
</ul>
<p>對於短網址服務來說，乍看之下由於會有過期時間且有時候需要蒐集點擊次數等統計資訊，似乎選擇 302 是比較合理的選擇。</p>
<p>但以 TinyURL 為例，它是使用 301 搭配 <code>Cache-Control: max-age=0, must-revalidate, no-cache, no-store, private</code> 來忽略瀏覽器的快取，這樣就能夠同時達到 SEO 跟統計資訊的需求。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>info</div><div class=admonitionContent_BuS1><p>Cache-Control 的設定可以參考 <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control target=_blank rel="noopener noreferrer">MDN Web Docs</a> :<ul>
<li>max-age=N: 表示回應可以被快取 N 秒</li>
<li>must-revalidate: 表示在快取過期後，必須重新向服務器驗證資源是否有更新，需要搭配 ETag 或是 Last-Modified 使用</li>
<li>no-cache: 表示回應可以被快取，但使用前必須先向服務器驗證資源是否有更新</li>
<li>no-store: 表示回應不能被任何快取儲存</li>
<li>public / private: public 表示回應可以被任何快取 (如 CDN) 儲存，private 表示回應只能被瀏覽器的快取儲存</li>
</ul><p>TinyURL 採取的做法可能是為了讓很舊的瀏覽器也能正確忽略快取，因此使用了很多功能重複的指令，實際上應該只需要 <code>no-store</code> 就可以達到同樣的效果。</div></div>
<p>同時也有一些短網址服務使用 302 ，因此兩種做法都是可以接受的。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=high-level-design>High Level Design<a href=#high-level-design class=hash-link aria-label="Direct link to High Level Design" title="Direct link to High Level Design" translate=no>​</a></h2>
<figure class=image-modal-container><img src=/RulerChen-Website/en/img/system-design/tinyurl/image.webp alt="" width=100% class=image-modal-thumbnail style=cursor:pointer loading=lazy /><figcaption class=image-modal-caption>High Level Design</figcaption></figure>
<ul>
<li><code>API Gateway</code>: 負責處理所有進入的請求，並將請求路由到適當的服務，同時也可以處理登入驗證和速率限制</li>
<li><code>Application Server</code>: 負責處理業務邏輯，如生成短網址、查找長網址等</li>
<li><code>Database</code>: 用於儲存資料，這裡會使用關聯式資料庫 (PostgreSQL) 來儲存 URL 資料</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=user-should-be-able-to-create-a-short-url>User should be able to create a short URL<a href=#user-should-be-able-to-create-a-short-url class=hash-link aria-label="Direct link to User should be able to create a short URL" title="Direct link to User should be able to create a short URL" translate=no>​</a></h3>
<ol>
<li>使用者呼叫 <code>POST /api/urls</code> 並提交長網址</li>
<li>驗證長網址是否符合 url 格式</li>
<li>生成唯一的短網址</li>
<li>將長網址和短網址儲存到資料庫中</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=user-should-be-able-to-access-the-original-url-by-using-the-short-url>User should be able to access the original URL by using the short URL<a href=#user-should-be-able-to-access-the-original-url-by-using-the-short-url class=hash-link aria-label="Direct link to User should be able to access the original URL by using the short URL" title="Direct link to User should be able to access the original URL by using the short URL" translate=no>​</a></h3>
<ol>
<li>使用者訪問短網址並呼叫 <code>GET /{short_url}</code></li>
<li>application server 查詢資料庫以獲取對應的長網址</li>
<li>如果有找到並且沒有過期，返回 301 重定向到長網址</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=deep-dive>Deep Dive<a href=#deep-dive class=hash-link aria-label="Direct link to Deep Dive" title="Direct link to Deep Dive" translate=no>​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=how-to-generate-a-unique-short-url>How to generate a unique short URL?<a href=#how-to-generate-a-unique-short-url class=hash-link aria-label="Direct link to How to generate a unique short URL?" title="Direct link to How to generate a unique short URL?" translate=no>​</a></h3>
<p>在設計短網址的生成方法時，需要考慮以下幾點 :</p>
<ul>
<li>短網址的唯一性</li>
<li>長度盡可能短</li>
<li>生成短網址的速度要快</li>
</ul>
<p>常見的做法是先產生一個唯一的 ID，然後對這個 ID 進行編碼 (encoding) 來生成短網址。</p>
<p>對於如何產生唯一的 ID，有幾種方法 :</p>
<ul>
<li>Hash Functions</li>
<li>Counter</li>
<li>Any unique ID generation algorithm (e.g. Snowflake、UUID)</li>
<li>Random Generation</li>
</ul>
<p>而對於編碼方式，常見的選擇是 Base62 或 Base58，因為 Base64 中的 + 和 / 是特殊字符，需要做 URL encoding，會增加短網址的長度。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>info</div><div class=admonitionContent_BuS1><ul>
<li>Base64: 使用 A-Z, a-z, 0-9, +, / 共 64 個字符</li>
<li>Base62: 使用 A-Z, a-z, 0-9 共 62 個字符</li>
<li>Base58: 使用 A-Z, a-z, 1-9 (去除容易混淆的 0, O, I, l) 共 58 個字符</li>
</ul></div></div>
<p>假設使用 Base62 編碼，代表 :</p>
<ul>
<li>如果是 5 個字元的短網址，總共有 62^5 ≈ 9 億種組合，約 30 bits</li>
<li>如果是 6 個字元的短網址，總共有 62^6 ≈ 568 億種組合，約 36 bits</li>
<li>如果是 7 個字元的短網址，總共有 62^7 ≈ 3.5 兆種組合，約 42 bits</li>
</ul>
<p>每日產生 5M 個短網址，3 年下來大約是 5M * 365 * 3 = 5.5B 個短網址，因此最好使用 6-7 個字元來確保不容易碰撞。</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></span>note</div><div class=admonitionContent_BuS1><p>如果是使用 hash function 的話，就需要特別注意碰撞的機率問題。<p>假設資料庫中已經有 50 億個短網址且使用 6 個字元，現在要再生成一個新的短網址，碰撞的機率大約是 50 億 / 568 億 ≈ 9%，這個機率看起來不高，但如果每天都產生 5M 個短網址，那麼一天就會有大約 450000 個短網址會碰撞。</div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=option-1-hash-function>Option 1: Hash Function<a href=#option-1-hash-function class=hash-link aria-label="Direct link to Option 1: Hash Function" title="Direct link to Option 1: Hash Function" translate=no>​</a></h4>
<p>常見的哈希函數有 MD5、SHA256 等等，其中 MD5 會產生 128 bits 的哈希值，SHA256 則會產生 256 bits 的哈希值。</p>
<p>我們可以使用 SHA256 並加入一個密碼來生成一個無法被預測的哈希值，再將這個值進行 Base62 編碼，最後取前 7 個字符作為短網址。</p>
<p>但這樣同樣會產生問題，即使我們使用了碰撞機率極低的哈希函數，但因為我們需要截斷，所以仍然有可能會產生碰撞，並且如果使用者輸入相同的長網址，就必定會產生相同的短網址，這不是我們想要的行為。</p>
<p>要解決碰撞問題，可以採取以下幾種策略 :</p>
<ol>
<li>Unique Constraint: 在資料庫中對短網址欄位設置唯一約束，這樣當插入一個已存在的短網址時會產生錯誤，系統可以捕捉這個錯誤並重新生成短網址</li>
<li>Nonce / Salt: 在生成短網址時加入一個隨機的 nonce 或是 salt，這樣即使使用者輸入相同的長網址，也會產生不同的短網址</li>
<li>Retry: 如果產生的短網址已經存在，可以嘗試加入不同的 nonce 或是 salt 並重新生成，直到重試的次數達到上限</li>
</ol>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> hashlib</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> os</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">generate_short_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">long_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> secret_key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> nonce</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> nonce </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">is</span><span class="token plain"> </span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        nonce </span><span class="token operator">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">urandom</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token builtin" style="color:rgb(189, 147, 249)">hex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    input_data </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">long_url</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">secret_key</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">nonce</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    hash_object </span><span class="token operator">=</span><span class="token plain"> hashlib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">sha256</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">input_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">encode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    hash_hex </span><span class="token operator">=</span><span class="token plain"> hash_object</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">hexdigest</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    base62_chars </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    base62 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    num </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">hash_hex</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">16</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> num </span><span class="token operator">></span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        num</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> rem </span><span class="token operator">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">divmod</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">62</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">        base62 </span><span class="token operator">=</span><span class="token plain"> base62_chars</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">rem</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> base62</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    short_code </span><span class="token operator">=</span><span class="token plain"> base62</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> short_code</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> nonce</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">secret </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"my-secret-key"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">short_code</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> nonce </span><span class="token operator">=</span><span class="token plain"> generate_short_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"https://github.com/"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> secret</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"short_code: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">short_code</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">, nonce: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">nonce</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Output: short_code: l6H1MFB, nonce: a0039d516f604c19</span><br/></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=option-2-counter>Option 2: Counter<a href=#option-2-counter class=hash-link aria-label="Direct link to Option 2: Counter" title="Direct link to Option 2: Counter" translate=no>​</a></h4>
<p>第二種方法是使用一個全局的計數器，每次有新的長網址時，計數器就加 1，然後將這個計數器的值進行 Base62 編碼來生成短網址，這樣就可以確保生成的數字是唯一且不會碰撞的。</p>
<p>這裡的實作有幾種不同的方法 :</p>
<ul>
<li>使用 Redis 的 <code>INCR</code> 命令來實現全局計數器，這個命令是原子操作，能夠保證在高併發的情況下不會產生重複的值</li>
<li>使用機器 ID 搭配計數器，這樣每台機器都有自己的計數器，並且在生成短網址時會將機器 ID 加入到計數器的值中，這樣就能夠確保不同機器生成的短網址不會重複</li>
</ul>
<p>第一種方法的缺點是所有的 application server 都需要連接到同一個 Redis 節點來取得計數器的值，這會導致跨區域的延遲成為一個重要的問題，舉例來說，從臺灣打到美國西岸的 EC2 伺服器，網路延遲大概是 200ms 左右。</p>
<p>解決方案有幾種，一種是不要使用中心化的單一 Redis cluster，而是在不同區域都部屬節點來降低跨區延遲，另一種方式是一次性跟 redis 獲取多個值 (如 1000 個)，然後在本地使用這些值來生成短網址，這樣就能夠大幅降低跨區延遲的影響。</p>
<p>第二種做法的缺點是要思考機器 ID 的分配方式，由於本地的計數器通常會放在記憶體中，因此需要保證機器 ID 要是唯一的，需要其他方法來維護這個性質。</p>
<p>這兩種方法的優點同樣非常明顯，他們都能保證生成的短網址是不會碰撞的，所以速度相對來說會更快。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=option-3-uuid--snowflake>Option 3: UUID / Snowflake<a href=#option-3-uuid--snowflake class=hash-link aria-label="Direct link to Option 3: UUID / Snowflake" title="Direct link to Option 3: UUID / Snowflake" translate=no>​</a></h4>
<p>目前來說，比較常見的 UUID 版本大致有以下幾種 :</p>
<ul>
<li>UUIDv1: 60 bits 的時間戳 (自 1582 年以來的 100ns 數) + 48 bits 的 MAC address</li>
<li>UUIDv4: 122 bits 的隨機數</li>
<li>UUIDv7: 使用 48 bits 的時間戳 (自 1970 年以來的毫秒數) 加上 74 bits 的隨機數來生成 UUID</li>
</ul>
<p>而 Snowflake 則是 Twitter 提出的分散式 ID 生成演算法，使用 1 bit 的符號位 1 + 41 bits 的時間戳 (自某個時間點以來的毫秒數) + 10 bits 的機器 ID + 12 bits 的序列號來生成 64 bits 的整數 ID。</p>
<p>這類型的 ID 生成演算法都有一個共同的缺點是，生成的 ID 通常比較長，如果使用截斷的話就會產生各種碰撞的問題，變成不如直接使用 hash function 或是使用 random generation 來得好。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=option-4-random-generation>Option 4: Random Generation<a href=#option-4-random-generation class=hash-link aria-label="Direct link to Option 4: Random Generation" title="Direct link to Option 4: Random Generation" translate=no>​</a></h4>
<p>最後一個方法就是直接使用隨機數來生成短網址。</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-python codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> random</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> string</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">generate_short_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    characters </span><span class="token operator">=</span><span class="token plain"> string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ascii_letters </span><span class="token operator">+</span><span class="token plain"> string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">digits</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    short_url </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">''</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">random</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">choice</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">characters</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> _ </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">range</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">length</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> short_url</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">short_code </span><span class="token operator">=</span><span class="token plain"> generate_short_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">7</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">f"short_code: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string-interpolation interpolation">short_code</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token string-interpolation string" style="color:rgb(255, 121, 198)">"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Output: short_code: aZ3bX9K</span><br/></span></code></pre></div></div>
<p>這個方法的優點是簡單且不需要額外的基礎設施 (如 Redis)，缺點跟使用 hash function 類似，會有碰撞的機率問題，並且程式語言內建的隨機數生成器通常熵不夠，因此碰撞的機率可能會比預期的高。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=how-to-ensure-low-latency>How to ensure low latency?<a href=#how-to-ensure-low-latency class=hash-link aria-label="Direct link to How to ensure low latency?" title="Direct link to How to ensure low latency?" translate=no>​</a></h3>
<p>對於 read-heavy 的系統來說，有幾種常見的優化手段 :</p>
<ul>
<li>Database Indexing</li>
<li>Caching</li>
<li>CDN and Edge Servers</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=database-indexing>Database Indexing<a href=#database-indexing class=hash-link aria-label="Direct link to Database Indexing" title="Direct link to Database Indexing" translate=no>​</a></h4>
<p>由於這裡的 SQL 查詢主要是 point search (根據 short_url 查找 long_url)，在 short_url 欄位上建立索引可以大幅提升查詢速度。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> long_url </span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> url_table </span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> short_url </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'abc123'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br/></span></code></pre></div></div>
<p>以 PostgreSQL 為例，可以使用 hash index 來進一步提升查詢速度。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> idx_short_url </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> url_table </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">short_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br/></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=caching>Caching<a href=#caching class=hash-link aria-label="Direct link to Caching" title="Direct link to Caching" translate=no>​</a></h4>
<p>以前面估計的 QPS 來看 (29000 r/s, 290 w/s)，單單引入索引不足以應付這樣的讀取量。</p>
<p>由於讀寫比例高達 100:1，且資料一旦寫入後通常不會再更改，因此很適合使用 cache (如 Redis) 來快取熱門的短網址，減少對資料庫的讀取壓力。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>info</div><div class=admonitionContent_BuS1><p>對於一般的 RDBMS (PostgreSQL、MySQL) 來說，在簡單的查詢下單個資料庫節點大約能處理 1000 writes/sec 或 3000 reads/sec 左右的請求。<p>而對於像 Redis 這樣的 in-memory 資料庫，簡單的 GET / SET 操作在單個節點上可以輕鬆達到 100000 req/sec 以上的處理能力。</div></div>
<p>引入快取雖然可以提升效能，但也會帶來可用性與一致性上的挑戰。
為了提升可用性，可以使用 Redis Cluster 或其他 Redis 高可用方案。</p>
<p>而在快取的使用上則可以採用 cache aside pattern :</p>
<ul>
<li>讀取時先查快取，若快取未命中再查資料庫並將結果寫入快取</li>
<li>寫入時先更新資料庫，並採用 lazy write 的方式更新快取 (不立即更新快取，等到下一次讀取時再更新)</li>
</ul>
<p>同時因為記憶體的大小有限，可以使用 LRU 搭配 TTL 來移除較少使用或過期的資料。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cdn-and-edge-servers>CDN and Edge Servers<a href=#cdn-and-edge-servers class=hash-link aria-label="Direct link to CDN and Edge Servers" title="Direct link to CDN and Edge Servers" translate=no>​</a></h4>
<p>除了快取之外，還可以使用 CDN (Content Delivery Network) 來將熱門的查詢放在離使用者更近的邊緣節點 (Edge Servers)。</p>
<p>以短網址系統來說，我認為 CDN 的必要性不是特別大，而且會造成額外的成本，因此這部分可以視情況而定。
如果要使用 CDN 的話還需要額外考慮到快取失效的問題。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=how-to-handle-expired-data>How to handle expired data?<a href=#how-to-handle-expired-data class=hash-link aria-label="Direct link to How to handle expired data?" title="Direct link to How to handle expired data?" translate=no>​</a></h3>
<p>為了避免資料量不斷膨脹，因此我們需要定期清除過期的資料來保證資料庫的大小在可控範圍內。</p>
<p>這裡有幾種常見的做法 :</p>
<ol>
<li>將資料依據 <code>expiry_date</code> 進行 partitioning，並定期刪除整個 partition</li>
<li>使用批次工作 (batch job) 來定期刪除過期資料</li>
</ol>
<p>針對第一種方式，由於主要的查詢是針對 <code>short_url</code> 進行 point search，因此如果用 <code>expiry_date</code> 來做 partitioning，會導致查詢時需要掃描多個 partition，進而影響查詢效能。</p>
<p>因此需要使用第二種方式來定期刪除過期資料。
由於一次使用 <code>DELETE * FROM url_table WHERE expiry_date &lt; now()</code> 來刪除過期資料會對資料庫造成很大的負擔，因此可以採用懶惰刪除 (lazy deletion) 搭配批次工作 (batch job) 來定期刪除過期資料。</p>
<p>懶惰刪除的做法是當使用者訪問一個短網址時，先檢查這個短網址是否過期，如果過期就直接返回錯誤，並刪掉這筆資料。
而後台的刪除工作則可以使用行級鎖 (row-level locking) 並在低峰時段批量刪除過期資料。</p>
<p>舉例來說可以使用 <code>SKIP LOCKED</code> 來跳過已經被鎖定的資料 :</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">With</span><span class="token plain"> candidates </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> short_url</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> url_table </span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> expiry_date </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number">100</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FOR</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">UPDATE</span><span class="token plain"> SKIP LOCKED</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">DELETE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> url_table </span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> candidates </span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> url_table</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">short_url </span><span class="token operator">=</span><span class="token plain"> candidates</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">short_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br/></span></code></pre></div></div>
<p>特別注意由於有使用 cache，因此在刪除資料時也需要同時刪除快取中的資料。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=how-to-scale-up-to-support-100m-dau>How to scale up to support 100M DAU?<a href=#how-to-scale-up-to-support-100m-dau class=hash-link aria-label="Direct link to How to scale up to support 100M DAU?" title="Direct link to How to scale up to support 100M DAU?" translate=no>​</a></h3>
<p>以短網址系統來說，主要的瓶頸可能會出現在資料庫上，這裡有幾個點需要注意 :</p>
<ul>
<li>讀寫的 QPS 吞吐量是否足夠</li>
<li>內部的儲存空間是否足夠</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=readwrite-throughput>Read/Write Throughput<a href=#readwrite-throughput class=hash-link aria-label="Direct link to Read/Write Throughput" title="Direct link to Read/Write Throughput" translate=no>​</a></h4>
<p>以資料庫的寫入量來說 (290 w/s)，單一節點應該是足夠的，但讀取量 (29000 r/s) 就需要特別注意。</p>
<p>假設快取可以處理 90% 的讀取請求，那麼實際上資料庫需要處理的讀取請求大約是 2900 r/s，這對於單一資料庫節點來說壓力稍微有點大。</p>
<p>對於這樣的情況，最好的解決方法就是採用 read replica 的方式來分散讀取的負載，可以把主資料庫的內容同步到多個從資料庫節點，並且將讀取請求分散到這些從節點上。
以前面估計的值來說，可以把寫入請求都導向主節點，而讀取請求則可以分散到 2-3 個從節點上，這樣每個從節點大約只需要處理 1000 r/s 的請求。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=storage-1>Storage<a href=#storage-1 class=hash-link aria-label="Direct link to Storage" title="Direct link to Storage" translate=no>​</a></h4>
<p>以目前所需的儲存空間來說 (1.6TB/3y)，對於現代的資料庫不是特別大的問題，但問題在於這個資料量對於單一表來說非常大，進而影響到查詢效能。</p>
<p>假設系統需要保存 3 年的資料，代表資料庫需要保存 5M * 365 * 3 = 5.5B 行的資料在單一的表中，這會產生如索引過大、查詢效能下降的問題。</p>
<p>因此需要進行 partitioning 來將資料分散到多個表中，以減少單一表的大小。
以這裡的情境來說，對 short_url 做 consistent hashing 來決定資料要存放在哪一個 partition 是一個不錯的選擇，可以快速知道要去哪一張表查資料，也可以簡單的新增節點。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=final-design>Final Design<a href=#final-design class=hash-link aria-label="Direct link to Final Design" title="Direct link to Final Design" translate=no>​</a></h2>
<figure class=image-modal-container><img src=/RulerChen-Website/en/img/system-design/tinyurl/image-2.webp alt="" width=100% class=image-modal-thumbnail style=cursor:pointer loading=lazy /><figcaption class=image-modal-caption>Final Design</figcaption></figure>
<p>我認為生成短網址的方案中，選擇使用哈希函數跟計數器都是合理的選擇，前者實作較為簡單，後者則能保證不會碰撞。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=references>References<a href=#references class=hash-link aria-label="Direct link to References" title="Direct link to References" translate=no>​</a></h2>
<ul>
<li><a href=https://www.hellointerview.com/learn/system-design/problem-breakdowns/bitly target=_blank rel="noopener noreferrer">Design Bit.ly</a></li>
<li><a href=https://systemdesignschool.io/problems/url-shortener/solution#what-are-the-two-properties-we-need-for-the-ids target=_blank rel="noopener noreferrer">Design URL Shortener</a></li>
<li><a href=https://github.com/RulerChen/Grokking-Modern-System-Design-Interview/tree/main/Design%20a%20URL%20Shortening%20Service%20TinyURL target=_blank rel="noopener noreferrer">Design a URL Shortening Service TinyURL</a></li>
<li><a href=https://medium.com/@sandeep4.verma/system-design-scalable-url-shortener-service-like-tinyurl-106f30f23a82 target=_blank rel="noopener noreferrer">System Design : Scalable URL shortener service like TinyURL</a></li>
<li><a href="https://www.youtube.com/watch?v=xFeWVugaouk&list=PLjTveVh7FakLGZ36GbWAk_DMf_0xBZpGv&index=13" target=_blank rel="noopener noreferrer">Design a URL Shortener (TinyURL, Bit.ly) | Systems Design Questions 3.0 With Ex-Google SWE</a></li>
</ul></div><div style=margin-top:32px></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class=col><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/RulerChen-Website/en/docs/tags/system-design/>System Design</a></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/RulerChen/RulerChen-Website/tree/main/docs/SystemDesign/tinyurl.mdx target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>Last updated<!-- --> on <b><time datetime=2025-10-12T04:32:26.000Z itemprop=dateModified>Oct 12, 2025</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/RulerChen-Website/en/docs/SystemDesign/><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>System Design</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/RulerChen-Website/en/docs/Other/shell/><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Shell Introduction</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#background class="table-of-contents__link toc-highlight">Background</a><li><a href=#requirements class="table-of-contents__link toc-highlight">Requirements</a><ul><li><a href=#functional-requirements class="table-of-contents__link toc-highlight">Functional Requirements</a><li><a href=#non-functional-requirements class="table-of-contents__link toc-highlight">Non-Functional Requirements</a></ul><li><a href=#back-of-the-envelope-estimation class="table-of-contents__link toc-highlight">Back of the Envelope Estimation</a><ul><li><a href=#assumptions class="table-of-contents__link toc-highlight">Assumptions</a><li><a href=#qps class="table-of-contents__link toc-highlight">QPS</a><li><a href=#storage class="table-of-contents__link toc-highlight">Storage</a><li><a href=#bandwidth class="table-of-contents__link toc-highlight">Bandwidth</a><li><a href=#memory class="table-of-contents__link toc-highlight">Memory</a></ul><li><a href=#schema-design class="table-of-contents__link toc-highlight">Schema Design</a><li><a href=#api-design class="table-of-contents__link toc-highlight">API Design</a><ul><li><a href=#create-short-url class="table-of-contents__link toc-highlight">Create Short URL</a><li><a href=#redirect-to-long-url class="table-of-contents__link toc-highlight">Redirect to Long URL</a></ul><li><a href=#high-level-design class="table-of-contents__link toc-highlight">High Level Design</a><ul><li><a href=#user-should-be-able-to-create-a-short-url class="table-of-contents__link toc-highlight">User should be able to create a short URL</a><li><a href=#user-should-be-able-to-access-the-original-url-by-using-the-short-url class="table-of-contents__link toc-highlight">User should be able to access the original URL by using the short URL</a></ul><li><a href=#deep-dive class="table-of-contents__link toc-highlight">Deep Dive</a><ul><li><a href=#how-to-generate-a-unique-short-url class="table-of-contents__link toc-highlight">How to generate a unique short URL?</a><li><a href=#how-to-ensure-low-latency class="table-of-contents__link toc-highlight">How to ensure low latency?</a><li><a href=#how-to-handle-expired-data class="table-of-contents__link toc-highlight">How to handle expired data?</a><li><a href=#how-to-scale-up-to-support-100m-dau class="table-of-contents__link toc-highlight">How to scale up to support 100M DAU?</a></ul><li><a href=#final-design class="table-of-contents__link toc-highlight">Final Design</a><li><a href=#references class="table-of-contents__link toc-highlight">References</a></ul></div></div></div></div></main></div></div></div></div></body>