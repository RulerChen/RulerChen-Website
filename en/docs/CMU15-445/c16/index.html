<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-CMU15-445/c16" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.8.1"><title data-rh=true>CMU 15-445 Concurrency Control Theory</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://RulerChen.github.io/RulerChen-Website/en/img/profile.png><meta data-rh=true name=twitter:image content=https://RulerChen.github.io/RulerChen-Website/en/img/profile.png><meta data-rh=true property=og:url content=https://RulerChen.github.io/RulerChen-Website/en/docs/CMU15-445/c16/><meta data-rh=true property=og:locale content=en><meta data-rh=true property=og:locale:alternate content=zh_Hant><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Concurrency Control Theory | RulerChen"><meta data-rh=true name=description content="CMU15-445/645 Concurrency Control Theory"><meta data-rh=true property=og:description content="CMU15-445/645 Concurrency Control Theory"><meta data-rh=true name=keywords content="CMU15-445/645,Concurrency Control Theory,CMU15-445/645 筆記"><link data-rh=true rel=icon href=/RulerChen-Website/en/img/profile.png><link data-rh=true rel=canonical href=https://RulerChen.github.io/RulerChen-Website/en/docs/CMU15-445/c16/><link data-rh=true rel=alternate href=https://RulerChen.github.io/RulerChen-Website/docs/CMU15-445/c16/ hreflang=zh-Hant><link data-rh=true rel=alternate href=https://RulerChen.github.io/RulerChen-Website/en/docs/CMU15-445/c16/ hreflang=en><link data-rh=true rel=alternate href=https://RulerChen.github.io/RulerChen-Website/docs/CMU15-445/c16/ hreflang=x-default><link data-rh=true rel=preconnect href=https://GSV9DQB5UM-dsn.algolia.net crossorigin=anonymous><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://RulerChen.github.io/RulerChen-Website/en/docs/CMU15-445/","name":"CMU 15-445/645","position":1},{"@type":"ListItem","item":"https://RulerChen.github.io/RulerChen-Website/en/docs/CMU15-445/c16","name":"Concurrency Control Theory","position":2}]}</script><link rel=alternate type=application/rss+xml href=/RulerChen-Website/en/blog/rss.xml title="RulerChen RSS Feed"><link rel=alternate type=application/atom+xml href=/RulerChen-Website/en/blog/atom.xml title="RulerChen Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-8BEHDPLQMG"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-8BEHDPLQMG",{anonymize_ip:!0})</script><link rel=search type=application/opensearchdescription+xml title=RulerChen href=/RulerChen-Website/en/opensearch.xml><meta name=google-site-verification content=QrdRbPEcOsJJ_kfRVewqfwR6GjPcRf0UVgRb85I-5fc><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css type=text/css integrity=sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM crossorigin=anonymous><link rel=stylesheet href=/RulerChen-Website/en/assets/css/styles.133bfb6d.css><script src=/RulerChen-Website/en/assets/js/runtime~main.cf5ac816.js defer></script><script src=/RulerChen-Website/en/assets/js/main.06428909.js defer></script><body class=navigation-with-keyboard><svg xmlns=http://www.w3.org/2000/svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark",e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/RulerChen-Website/en/img/profile.png><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/RulerChen-Website/en/><div class=navbar__logo><img src=/RulerChen-Website/en/img/profile.png alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/RulerChen-Website/en/img/profile.png alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">RulerChen</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/RulerChen-Website/en/docs/intro/>Notes</a><a class="navbar__item navbar__link" href=/RulerChen-Website/en/blog/>Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_nlXk><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>English</a><ul class=dropdown__menu><li><a href=/RulerChen-Website/docs/CMU15-445/c16/ target=_self rel="noopener noreferrer" class=dropdown__link lang=zh-Hant>繁體中文</a><li><a href=/RulerChen-Website/en/docs/CMU15-445/c16/ target=_self rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=en>English</a></ul></div><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/RulerChen-Website/en/docs/intro/>Roadmap</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/RulerChen-Website/en/docs/CMU15-445/>CMU 15-445/645</a><button aria-label="Collapse sidebar category 'CMU 15-445/645'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c01/>Relational Model & Algebra</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c02/>Modern SQL</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c03/>Database Storage</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c05/>Storage Models & Compression</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c06/>Memory & Disk I/O Management</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c07/>Hash Tables</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c08/>Indexes & Filters</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c09/>Index Concurrency Control</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c11/>Sorting & Aggregations Algorithms</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c12/>Joins Algorithms</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c13/>Query Execution</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c15/>Query Planning & Optimization</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c16/>Concurrency Control Theory</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c17/>Two-Phase Locking Concurrency Control</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c18/>Timestamp Ordering Concurrency Control</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c19/>Multi-Version Concurrency Control</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c20/>Database Logging</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c21/>Database Recovery</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c22/>Introduction to Distributed Databases</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c23/>Distributed OLTP Database Systems</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/c24/>Distributed OLAP Database Systems</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/p0/>P0 - C++ Primer</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/p1/>P1 - Buffer Pool Manager</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/p2/>P2 - B+ Tree</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/p3/>P3 - Query Execution</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/RulerChen-Website/en/docs/CMU15-445/p4/>P4 - Concurrency Control</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/RulerChen-Website/en/docs/Security/>Security</a><button aria-label="Expand sidebar category 'Security'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_z5aJ"><div class=docItemContainer_c0TR><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/RulerChen-Website/en/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/RulerChen-Website/en/docs/CMU15-445/><span>CMU 15-445/645</span></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Concurrency Control Theory</span></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Concurrency Control Theory</h1></header>
<p>對於 DBMS 來說，除了基本的功能外，我們還有兩個問題需要解決 :</p>
<ul>
<li>如何在同時更新時避免 race condition (concurrency control)</li>
<li>當資料庫發生故障時，我們如何保證資料的完整性 (recovery)</li>
</ul>
<p>在這節中，我們會探討如何解決第一個問題，也就是 concurrency control。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=transaction>Transaction<a href=#transaction class=hash-link aria-label="Direct link to Transaction" title="Direct link to Transaction">​</a></h2>
<p>transaction 是 DBMS 中最基本的操作單位，指的是一系列操作的執行，且這些操作要麼全部執行成功，要麼全部不執行。</p>
<p>如以下的範例，假設你要從 Andy 的銀行帳戶中轉出 $100 給他的經紀人，這個交易涉及以下步驟 :</p>
<ul>
<li>確認 Andy 帳戶中是否有 $100</li>
<li>從 Andy 的帳戶中扣除 $100</li>
<li>將 $100 加到他的經紀人的帳戶</li>
</ul>
<p>這個交易要麼全部完成 (即上述三個步驟都成功執行)，要麼不會改變任何帳戶的狀態。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=the-strawman-system>The Strawman System<a href=#the-strawman-system class=hash-link aria-label="Direct link to The Strawman System" title="Direct link to The Strawman System">​</a></h3>
<p>strawman system 是一個簡單的 transaction system，它只有一個 thread 來執行所有的 transaction，因此不管在任何時刻都只能有一個 transaction 在執行。</p>
<p>這個系統的處理方式是將所有檔案都複製一份，然後對這個新的檔案進行修改，如果成功就全部覆蓋，這種方式雖然簡單但是缺點是顯而易見的，就是無法利用多核來處理獨立的 transaction。</p>
<p>為了提高效率，我們必須允許多個 transaction 同時執行，但這樣就會產生正確性的問題，如 :</p>
<ul>
<li>Temporary Inconsistency: 不可避免，不會影響正確性</li>
<li>Permanent Inconsistency: 不可接收，會影響正確性</li>
</ul>
<p>在 SQL 中，我們會使用 <code>BEGIN</code>、<code>COMMIT</code>、<code>ROLLBACK</code> 來控制 transaction 的執行。</p>
<p>為了保證資料的正確性，資料庫必須滿足 ACID 原則。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=acid---atomicity>ACID - Atomicity<a href=#acid---atomicity class=hash-link aria-label="Direct link to ACID - Atomicity" title="Direct link to ACID - Atomicity">​</a></h2>
<p>DBMS 需要保證 transaction 的原子性，即所有操作只有全部完成跟全部未完成兩種結果，如果在過程中出現錯誤，DBMS 需要回滾到原本的狀態。</p>
<p>主要有兩種策略 :</p>
<ul>
<li>Logging : 目前主流的實作方式，會記錄交易過程中的每一項變更，並同時保存在記憶體跟硬碟上</li>
<li>Shadow Paging : 將交易需要修改的頁面複製，並只在新的頁面中修改，當交易提交時才會覆蓋原本的檔案，通常在 single thread 的環境中使用</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=acid---consistency>ACID - Consistency<a href=#acid---consistency class=hash-link aria-label="Direct link to ACID - Consistency" title="Direct link to ACID - Consistency">​</a></h2>
<p>表示在資料庫中的邏輯是正確的，主要分為兩種 :</p>
<ul>
<li>Database Consistency : 遵循 integrity constraints，例如人的年齡不可能是負數，可以使用 SQL 中的 <code>CHECK</code> 或 <code>CONSTRAINT</code> 來實現</li>
<li>Transaction Consistency : 如果交易前是一致，交易後也應該是一致的</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=acid---isolation>ACID - Isolation<a href=#acid---isolation class=hash-link aria-label="Direct link to ACID - Isolation" title="Direct link to ACID - Isolation">​</a></h2>
<p>不同的 transaction 在執行過程中應該互相隔離且互不影響，就像在單獨運行一樣。但在實際情況中，由於效能問題，DBMS 需要將多個同時執行的交易交錯執行，並同時保持隔離性。</p>
<p>舉例如下，有兩個 transaction t1 和 t2</p>
<ul>
<li>t1 : A 轉給 B 100 元</li>
<li>t2 : A 和 B 獲得 6% 利息</li>
</ul>
<p><img decoding=async loading=lazy alt=Isolation src=/RulerChen-Website/en/assets/images/image-1ef80445cea31b632d58d1fef8c0230b.png width=959 height=539 class=img_ev3q></p>
<p>當這兩個 transaction 發生之後，不管順序如何，DBMS 需要確保最後兩者加起來的結果是 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mn>2000</mn><mo>×</mo><mn>1.06</mn><mo>=</mo><mn>2120</mn></mrow><annotation encoding=application/x-tex>2000 \times 1.06 = 2120</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.7278em;vertical-align:-0.0833em></span><span class=mord>2000</span><span class=mspace style=margin-right:0.2222em></span><span class=mbin>×</span><span class=mspace style=margin-right:0.2222em></span></span><span class=base><span class=strut style=height:0.6444em></span><span class=mord>1.06</span><span class=mspace style=margin-right:0.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:0.2778em></span></span><span class=base><span class=strut style=height:0.6444em></span><span class=mord>2120</span></span></span></span> 元。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=concurrency-control>Concurrency Control<a href=#concurrency-control class=hash-link aria-label="Direct link to Concurrency Control" title="Direct link to Concurrency Control">​</a></h3>
<p>concurrency control 指的是 DBMS 如何決定多個交易操作的正確順序，大致有兩種方式 :</p>
<ul>
<li>Pessimistic (悲觀) : DBMS 假設會發生衝突，可以透過鎖定資源來實現</li>
<li>Optimistic (樂觀) : DBMS 假設不會發生衝突，直到 commit 時才會檢查衝突並回滾</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=schedule>Schedule<a href=#schedule class=hash-link aria-label="Direct link to Schedule" title="Direct link to Schedule">​</a></h3>
<p>DBMS 的執行順序被稱為 execution schedule，我們希望可以盡量交錯 transaction 來最大程度的提高倂發性，這樣當某個 transaction 在等待資源 (disk IO、page fault) 或 CPU 有空閒時，就可以繼續執行其他交易。</p>
<p><img decoding=async loading=lazy alt=Schedule src=/RulerChen-Website/en/assets/images/image-1-2882741bd846380483681cb2e252c3d4.png width=961 height=535 class=img_ev3q>
<img decoding=async loading=lazy alt=Schedule src=/RulerChen-Website/en/assets/images/image-2-f67e915c04b13c3a05e1b8371ac34a40.png width=960 height=539 class=img_ev3q></p>
<p>我們需要保證 schedule 是 serial schedule 或是等價於 serial schedule (serializable schedule)，也就是說，這些交易的結果應該與某個 serial schedule 的結果相同，這樣才能保證 transaction 的正確性。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=conflict>Conflict<a href=#conflict class=hash-link aria-label="Direct link to Conflict" title="Direct link to Conflict">​</a></h3>
<p>當兩個 operation 滿足以下條件時，我們稱之為 conflict :</p>
<ul>
<li>這兩個 operation 是不同的 transaction</li>
<li>這兩個 operation 操作的資源是相同的</li>
<li>至少有一個 operation 是 write</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=read-write-conflict>Read-Write Conflict<a href=#read-write-conflict class=hash-link aria-label="Direct link to Read-Write Conflict" title="Direct link to Read-Write Conflict">​</a></h4>
<p>會導致 unrepeatable read，也就是當一個 transaction 多次讀取同一個資源時，資源的值不同。</p>
<p><img decoding=async loading=lazy alt=Conflict src=/RulerChen-Website/en/assets/images/image-3-c344b3860fdd4a9371b5b783caf3aa26.png width=957 height=539 class=img_ev3q></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=write-read-conflict>Write-Read Conflict<a href=#write-read-conflict class=hash-link aria-label="Direct link to Write-Read Conflict" title="Direct link to Write-Read Conflict">​</a></h4>
<p>會導致 dirty read，也就是當一個 transaction 讀取到另一個 transaction 還未 commit 的資源。</p>
<p><img decoding=async loading=lazy alt=Conflict src=/RulerChen-Website/en/assets/images/image-4-61756b86aa38245ea0ed259c5d9b2465.png width=960 height=540 class=img_ev3q></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=write-write-conflict>Write-Write Conflict<a href=#write-write-conflict class=hash-link aria-label="Direct link to Write-Write Conflict" title="Direct link to Write-Write Conflict">​</a></h4>
<p>會導致 lost update，也就是當兩個 transaction 同時寫入同一個資源時，後者會覆蓋前者的值。</p>
<p><img decoding=async loading=lazy alt=Conflict src=/RulerChen-Website/en/assets/images/image-5-f8231284a5d4b0a6ee54ebee5bde8128.png width=960 height=538 class=img_ev3q></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=serializability>Serializability<a href=#serializability class=hash-link aria-label="Direct link to Serializability" title="Direct link to Serializability">​</a></h3>
<p>可序列化性主要有兩種 :</p>
<ul>
<li>Conflict Serializability : 大多數 DBMS 支持</li>
<li>View Serializability : 沒有 DBMS 支持，因為很難判斷是否是 view serializable</li>
</ul>
<p><img decoding=async loading=lazy alt=Serializability src=/RulerChen-Website/en/assets/images/image-7-19bfb3920d33af41ab4ea668c3e22244.png width=963 height=539 class=img_ev3q></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=conflict-serializability>Conflict Serializability<a href=#conflict-serializability class=hash-link aria-label="Direct link to Conflict Serializability" title="Direct link to Conflict Serializability">​</a></h4>
<ul>
<li>conflict equivalent : 兩個 scheduler 在 transaction 中有相同的 action，且每一對 conflicting operations 的順序在這兩個排程中都是相同的</li>
<li>conflict serializable : 如果一個 scheduler 是 conflict equivalent 於某個 serial scheduler，則這個 scheduler 是 conflict serializable</li>
</ul>
<p>如果我們可以通過交換不同 transaction 中連續的 non-conflicting operations 來將一個 scheduler 轉換為 serial scheduler，則這個 scheduler 是 conflict serializable，但這種方式在多個 transaction 的情況下不好用。</p>
<p>我們可以構建 dependency graph 來判斷是否是 conflict serializable。在這個圖中，每個事務都是一個節點，如果事務 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>T</mi><mi>i</mi></msub></mrow><annotation encoding=application/x-tex>T_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.8333em;vertical-align:-0.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:0.13889em>T</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em><span style=top:-2.55em;margin-left:-0.1389em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em><span></span></span></span></span></span></span></span></span></span> 中的操作 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>O</mi><mi>i</mi></msub></mrow><annotation encoding=application/x-tex>O_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.8333em;vertical-align:-0.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:0.02778em>O</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em><span style=top:-2.55em;margin-left:-0.0278em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em><span></span></span></span></span></span></span></span></span></span> 與事務 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>T</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>T_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.9694em;vertical-align:-0.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:0.13889em>T</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em><span style=top:-2.55em;margin-left:-0.1389em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:0.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.2861em><span></span></span></span></span></span></span></span></span></span> 中的操作 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>O</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>O_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.9694em;vertical-align:-0.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:0.02778em>O</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em><span style=top:-2.55em;margin-left:-0.0278em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:0.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.2861em><span></span></span></span></span></span></span></span></span></span> 衝突且 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>O</mi><mi>i</mi></msub></mrow><annotation encoding=application/x-tex>O_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.8333em;vertical-align:-0.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:0.02778em>O</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em><span style=top:-2.55em;margin-left:-0.0278em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em><span></span></span></span></span></span></span></span></span></span> 在排程中先於 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>O</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>O_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.9694em;vertical-align:-0.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:0.02778em>O</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em><span style=top:-2.55em;margin-left:-0.0278em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:0.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.2861em><span></span></span></span></span></span></span></span></span></span>，則從節點 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>T</mi><mi>i</mi></msub></mrow><annotation encoding=application/x-tex>T_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.8333em;vertical-align:-0.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:0.13889em>T</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em><span style=top:-2.55em;margin-left:-0.1389em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.15em><span></span></span></span></span></span></span></span></span></span> 到 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>T</mi><mi>j</mi></msub></mrow><annotation encoding=application/x-tex>T_j</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0.9694em;vertical-align:-0.2861em></span><span class=mord><span class="mord mathnormal" style=margin-right:0.13889em>T</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:0.3117em><span style=top:-2.55em;margin-left:-0.1389em;margin-right:0.05em><span class=pstrut style=height:2.7em></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style=margin-right:0.05724em>j</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:0.2861em><span></span></span></span></span></span></span></span></span></span> 有一條有向邊，只有當這個圖是無環時，這個 scheduler 才是 conflict serializable。</p>
<p><img decoding=async loading=lazy alt="Dependency Graph" src=/RulerChen-Website/en/assets/images/image-6-366351875f180e8bb962301c09216d3a.png width=958 height=536 class=img_ev3q></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=view-serializability>View Serializability<a href=#view-serializability class=hash-link aria-label="Direct link to View Serializability" title="Direct link to View Serializability">​</a></h4>
<p>與 conflict serializability 相比，view serializability 是一種更寬鬆的標準，並允許盲寫 (blind write)。</p>
<p>它需要滿足三個條件 :</p>
<ul>
<li>Initial Read Equivalence : 每個事務讀取的值與在串行排程中讀取的值相同</li>
<li>Final Write Equivalence : 每個資料項的最終寫入操作（即最終結果）與串行排程中的相同</li>
<li>Read-Write Equivalence : 對於每個讀操作，其讀取的值必須來自與在串行排程中相同的最後一次寫操作</li>
</ul>
<p><img decoding=async loading=lazy alt="View Serializability" src=/RulerChen-Website/en/assets/images/image-8-64113a0edbecdd365686f67099f0674d.png width=958 height=538 class=img_ev3q>
<img decoding=async loading=lazy alt="View Serializability" src=/RulerChen-Website/en/assets/images/image-9-0585611ff24ba98bdd073bbfcf35bc2f.png width=958 height=537 class=img_ev3q></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=acid---durability>ACID - Durability<a href=#acid---durability class=hash-link aria-label="Direct link to ACID - Durability" title="Direct link to ACID - Durability">​</a></h2>
<p>所有已提交的資料都將永久保存，而不會因為系統崩潰而遺失。</div><div style=margin-top:32px></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class=col><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/RulerChen-Website/en/docs/tags/cmu-15-445/>CMU15-445</a></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/c16.mdx target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>Last updated<!-- --> on <b><time datetime=2025-08-02T16:13:42.000Z itemprop=dateModified>Aug 2, 2025</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/RulerChen-Website/en/docs/CMU15-445/c15/><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Query Planning & Optimization</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/RulerChen-Website/en/docs/CMU15-445/c17/><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Two-Phase Locking Concurrency Control</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#transaction class="table-of-contents__link toc-highlight">Transaction</a><ul><li><a href=#the-strawman-system class="table-of-contents__link toc-highlight">The Strawman System</a></ul><li><a href=#acid---atomicity class="table-of-contents__link toc-highlight">ACID - Atomicity</a><li><a href=#acid---consistency class="table-of-contents__link toc-highlight">ACID - Consistency</a><li><a href=#acid---isolation class="table-of-contents__link toc-highlight">ACID - Isolation</a><ul><li><a href=#concurrency-control class="table-of-contents__link toc-highlight">Concurrency Control</a><li><a href=#schedule class="table-of-contents__link toc-highlight">Schedule</a><li><a href=#conflict class="table-of-contents__link toc-highlight">Conflict</a><li><a href=#serializability class="table-of-contents__link toc-highlight">Serializability</a></ul><li><a href=#acid---durability class="table-of-contents__link toc-highlight">ACID - Durability</a></ul></div></div></div></div></main></div></div></div></div>