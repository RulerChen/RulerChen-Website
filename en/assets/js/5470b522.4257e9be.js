"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7954],{8837:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>x,frontMatter:()=>c,metadata:()=>l,toc:()=>t});const l=JSON.parse('{"id":"CMU15-445/p3","title":"P3 - Query Execution","description":"Query Execution","source":"@site/docs/CMU15-445/p3.mdx","sourceDirName":"CMU15-445","slug":"/CMU15-445/p3","permalink":"/RulerChen-Website/en/docs/CMU15-445/p3","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/p3.mdx","tags":[{"inline":true,"label":"CMU15-445","permalink":"/RulerChen-Website/en/docs/tags/cmu-15-445"},{"inline":true,"label":"CMU15-445 Projects","permalink":"/RulerChen-Website/en/docs/tags/cmu-15-445-projects"}],"version":"current","lastUpdatedAt":1758458745000,"sidebarPosition":103,"frontMatter":{"title":"P3 - Query Execution","sidebar_position":103,"description":"Query Execution","keywords":["CMU15-445/645","Query Execution","CMU15-445/645 \u7b46\u8a18"],"tags":["CMU15-445","CMU15-445 Projects"]},"sidebar":"tutorialSidebar","previous":{"title":"P2 - B+ Tree","permalink":"/RulerChen-Website/en/docs/CMU15-445/p2"},"next":{"title":"P4 - Concurrency Control","permalink":"/RulerChen-Website/en/docs/CMU15-445/p4"}}');var d=i(4848),s=i(8453);const c={title:"P3 - Query Execution",sidebar_position:"103",description:"Query Execution",keywords:["CMU15-445/645","Query Execution","CMU15-445/645 \u7b46\u8a18"],tags:["CMU15-445","CMU15-445 Projects"]},r=void 0,o={},t=[{value:"Background",id:"background",level:2},{value:"SQL Query Journey",id:"sql-query-journey",level:3},{value:"Entrypoint",id:"entrypoint",level:4},{value:"Parser",id:"parser",level:4},{value:"Binder",id:"binder",level:4},{value:"Planner",id:"planner",level:4},{value:"Optimizer",id:"optimizer",level:4},{value:"Executor",id:"executor",level:4},{value:"Storage Structure",id:"storage-structure",level:3},{value:"Task 1 - Access Method Executors",id:"task-1---access-method-executors",level:2},{value:"SeqScan",id:"seqscan",level:3},{value:"Insert",id:"insert",level:3},{value:"Update",id:"update",level:3},{value:"Delete",id:"delete",level:3},{value:"IndexScan",id:"indexscan",level:3},{value:"IndexScan Optimizer",id:"indexscan-optimizer",level:3},{value:"Task 2 - Aggregation &amp; Join Executors",id:"task-2---aggregation--join-executors",level:2},{value:"Aggregation",id:"aggregation",level:3},{value:"NestedLoopJoin",id:"nestedloopjoin",level:3},{value:"NestedIndexJoin",id:"nestedindexjoin",level:3},{value:"Task 3 - HashJoin Executor and Optimization",id:"task-3---hashjoin-executor-and-optimization",level:2},{value:"HashJoin",id:"hashjoin",level:3},{value:"HashJoin Optimizer",id:"hashjoin-optimizer",level:3},{value:"Task 4 - External Merge Sort + Limit Executors",id:"task-4---external-merge-sort--limit-executors",level:2},{value:"External Merge Sort",id:"external-merge-sort",level:3},{value:"Limit",id:"limit",level:3},{value:"Submit",id:"submit",level:2},{value:"Takeaways",id:"takeaways",level:2},{value:"References",id:"references",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components},{Head:i,ImageModal:l}=n;return i||h("Head",!0),l||h("ImageModal",!0),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(i,{children:(0,d.jsx)("title",{children:"CMU 15-445 2024Fall P3 Query Execution"})}),"\n",(0,d.jsx)(n.p,{children:"\u5728\u9019\u500b project \u4e2d\uff0c\u6211\u5011\u9700\u8981\u5be6\u73fe\u4e00\u500b query execution engine\uff0c\u7e3d\u5171\u6709 4 \u500b task :"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Access Method Executors"}),"\n",(0,d.jsx)(n.li,{children:"Aggregation & Join Executors"}),"\n",(0,d.jsx)(n.li,{children:"HashJoin Executor and Optimization"}),"\n",(0,d.jsx)(n.li,{children:"External Merge Sort + Limit Executors"}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500b project \u7684\u80cc\u666f\u77e5\u8b58\u76f8\u5c0d\u6bd4\u8f03\u8907\u96dc\uff0c\u9700\u8981\u5927\u91cf\u95b1\u8b80\u7a0b\u5f0f\u78bc\u4f86\u4e86\u89e3\u6574\u500b\u7d50\u69cb\u3002"}),"\n",(0,d.jsx)(n.p,{children:"\u6211\u6703\u4ecb\u7d39\u4e00\u4e0b\u6574\u500b SQL \u5f9e\u8f38\u5165\u5230\u57f7\u884c\u7684\u6d41\u7a0b\u4ee5\u53ca\u8cc7\u6599\u5132\u5b58\u7684\u7d50\u69cb\u4f86\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3\u3002\n\u5982\u679c\u9084\u662f\u6709\u5361\u4f4f\u7684\u8a71\uff0c\u6211\u5efa\u8b70\u53ef\u4ee5\u5148\u53bb\u770b\u4e00\u4e9b\u5df2\u7d93\u5be6\u73fe\u597d\u7684 Executor \u4f86\u4e86\u89e3\u6574\u500b\u6d41\u7a0b\u3002"}),"\n",(0,d.jsx)(n.h3,{id:"sql-query-journey",children:"SQL Query Journey"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u908a\u6703\u7528\u4e00\u500b\u7c21\u55ae\u7684 SQL \u7576\u4f5c\u7bc4\u4f8b\uff0c\u7c21\u55ae\u4ecb\u7d39\u4e00\u4e0b bustub \u4e2d SQL \u662f\u600e\u9ebc\u88ab\u57f7\u884c\u7684\u3002\n\u7bc4\u4f8b\u9019\u90e8\u5206\u6211\u662f\u7528 AI \u5e6b\u5fd9\u751f\u6210\u7684\uff0c\u4e0d\u4e00\u5b9a\u662f\u771f\u6b63\u7684\u6b04\u4f4d\u4f46\u80fd\u4e86\u89e3\u610f\u601d\u5c31\u597d :"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-sql",children:"SELECT s.id, s.name, e.course\nFROM student s\nJOIN enrollment e ON s.id = e.sid\nWHERE s.age > 18\nLIMIT 10;\n"})}),"\n",(0,d.jsx)(l,{src:"/img/cmu15-445/p3/image.webp",caption:"SQL Query Journey"}),"\n",(0,d.jsx)(n.h4,{id:"entrypoint",children:"Entrypoint"}),"\n",(0,d.jsxs)(n.p,{children:["Shell \u7684\u5165\u53e3\u9ede\u5728 ",(0,d.jsx)(n.code,{children:"src/tools/shell/shell.cpp"}),"\uff0c\u8ca0\u8cac\u5275\u5efa ",(0,d.jsx)(n.code,{children:"BustubInstance"})," \u5be6\u4f8b\u4e26\u547c\u53eb ",(0,d.jsx)(n.code,{children:"bustub->ExecuteSql()"})," \u4f86\u57f7\u884c SQL\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"BustubInstance"})," \u7684 ",(0,d.jsx)(n.code,{children:"ExecuteSql()"})," \u51fd\u6578\u662f\u57f7\u884c SQL \u7684\u4e3b\u8981\u5165\u53e3\uff0c\u5b83\u6703\u547c\u53eb ",(0,d.jsx)(n.code,{children:"ExecuteSqlTxn()"})," \u4f86\u57f7\u884c\u67e5\u8a62\uff0c\u5982\u679c\u51fa\u73fe\u932f\u8aa4\u5247\u6703\u547c\u53eb ",(0,d.jsx)(n.code,{children:"Abort()"}),"\u3002"]}),"\n",(0,d.jsx)(n.h4,{id:"parser",children:"Parser"}),"\n",(0,d.jsxs)(n.p,{children:["\u9996\u5148 query \u6703\u5148\u9032\u5165 parser\uff0cparser \u7684\u4f5c\u7528\u662f\u5c07 SQL \u89e3\u6790\u6210 AST\uff0c\u9019\u90e8\u5206 bustub \u662f\u4f7f\u7528\u7b2c\u4e09\u65b9\u7684\u5de5\u5177 ",(0,d.jsx)(n.code,{children:"libpg_query"})," \u4f86\u5b8c\u6210\u7684\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u5728 ",(0,d.jsx)(n.code,{children:"ExecuteSqlTxn()"})," \u4e2d bustub \u6703\u547c\u53eb ",(0,d.jsx)(n.code,{children:"ParseAndSave()"})," \u4f86\u5c07 SQL \u89e3\u6790\u6210 AST\uff0c\u4e26\u628a\u7d50\u679c\u5b58\u5230 ",(0,d.jsx)(n.code,{children:"statement_nodes_"})," \u4e2d\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u4ee5\u4e0a\u9762\u7684 SQL \u70ba\u4f8b\uff0c\u89e3\u6790\u5f8c\u7684 AST \u53ef\u80fd\u6703\u9577\u9019\u6a23 :"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'PGSelectStmt {\n  targetList: [\n    PGResTarget { name: "id", val: PGColumnRef { fields: ["s", "id"] } },\n    PGResTarget { name: "name", val: PGColumnRef { fields: ["s", "name"] } },\n    PGResTarget { name: "course", val: PGColumnRef { fields: ["e", "course"] } }\n  ],\n  fromClause: [\n    PGJoinExpr {\n      jointype: JOIN_INNER,\n      larg: PGRangeVar { relname: "student", alias: "s" },\n      rarg: PGRangeVar { relname: "enrollment", alias: "e" },\n      quals: PGAExpr { op: "=", lexpr: "s.id", rexpr: "e.sid" }\n    }\n  ],\n  whereClause: PGAExpr { op: ">", lexpr: "s.age", rexpr: 18 },\n  limitCount: 10\n}\n'})}),"\n",(0,d.jsx)(n.h4,{id:"binder",children:"Binder"}),"\n",(0,d.jsx)(n.p,{children:"\u63a5\u8457\u9019\u500b AST \u5c31\u6703\u4ea4\u7d66 binder\uff0cbinder \u7684\u4f5c\u7528\u662f\u900f\u904e Catalog \u5c07 AST \u4e2d\u7684\u540d\u7a31\u7d81\u5b9a\u5230\u5be6\u969b\u7684\u8cc7\u6599\u5eab\u7269\u4ef6\u4e0a\u3002"}),"\n",(0,d.jsxs)(n.p,{children:["\u5728 ",(0,d.jsx)(n.code,{children:"ExecuteSqlTxn()"})," \u4e2d\uff0c",(0,d.jsx)(n.code,{children:"BindStatement()"})," \u51fd\u6578\u6703\u8ca0\u8cac\u9019\u500b\u5de5\u4f5c\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u4ee5\u4e0a\u9762\u7684 SQL \u70ba\u4f8b\uff0c\u7d81\u5b9a\u4e4b\u5f8c\u7684 AST \u53ef\u80fd\u6703\u9577\u9019\u6a23\uff0c\u53ef\u4ee5\u770b\u5230\u5b83\u5df2\u7d93\u6709 ",(0,d.jsx)(n.code,{children:"table_oid"})," \u8ddf ",(0,d.jsx)(n.code,{children:"col_idx"})," \u4e86 :"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'SelectStatement {\n  select_list_: [\n    BoundColumnRef { col_name: "id", type: INTEGER, table_oid: 1, col_idx: 0 },\n    BoundColumnRef { col_name: "name", type: VARCHAR, table_oid: 1, col_idx: 1 },\n    BoundColumnRef { col_name: "course", type: VARCHAR, table_oid: 2, col_idx: 1 }\n  ],\n  table_: BoundJoinRef {\n    type: INNER_JOIN,\n    left: BoundBaseTableRef { \n      table: "student", \n      alias: "s", \n      oid: 1,\n      schema: [id:INTEGER, name:VARCHAR, age:INTEGER]\n    },\n    right: BoundBaseTableRef { \n      table: "enrollment", \n      alias: "e", \n      oid: 2,\n      schema: [sid:INTEGER, course:VARCHAR]\n    },\n    condition: BoundBinaryOp {\n      op_type: EQUAL,\n      left: BoundColumnRef { col_name: "id", table_oid: 1, col_idx: 0 },\n      right: BoundColumnRef { col_name: "sid", table_oid: 2, col_idx: 0 }\n    }\n  },\n  where_: BoundBinaryOp {\n    op_type: GREATER_THAN,\n    left: BoundColumnRef { col_name: "age", table_oid: 1, col_idx: 2 },\n    right: BoundConstant { value: 18, type: INTEGER }\n  },\n  limit_: BoundConstant { value: 10, type: INTEGER }\n}\n'})}),"\n",(0,d.jsx)(n.h4,{id:"planner",children:"Planner"}),"\n",(0,d.jsx)(n.p,{children:"\u7d81\u5b9a\u597d\u7269\u4ef6\u4e4b\u5f8c\u5c31\u6703\u4ea4\u7d66 planner\uff0cplanner \u7684\u4f5c\u7528\u662f\u5c07\u7d81\u5b9a\u597d\u7684 AST \u8f49\u63db\u6210\u57f7\u884c\u8a08\u5283 (PlanNode)\u3002"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Planner"})," \u7684 ",(0,d.jsx)(n.code,{children:"PlanQuery()"})," \u51fd\u6578\u6703\u5c07 ",(0,d.jsx)(n.code,{children:"Binder"})," \u8f49\u63db\u70ba ",(0,d.jsx)(n.code,{children:"PlanNode"}),"\uff0c\u9019\u662f\u4e00\u500b\u6a39\u72c0\u7d50\u69cb\uff0c\u8868\u793a SQL \u8a9e\u53e5\u7684\u57f7\u884c\u8a08\u5283\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u4ee5\u4e0a\u9762\u7684 SQL \u70ba\u4f8b\uff0c\u8f49\u63db\u5f8c\u7684\u57f7\u884c\u8a08\u5283\u53ef\u80fd\u6703\u9577\u9019\u6a23 :"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"LimitPlanNode {\n  limit_: 10,\n  child_: ProjectionPlanNode {\n    expressions_: [\n      ColumnValueExpression { col_idx: 0 }, // s.id\n      ColumnValueExpression { col_idx: 1 }, // s.name  \n      ColumnValueExpression { col_idx: 4 }  // e.course (after join)\n    ],\n    output_schema_: Schema([id:INTEGER, name:VARCHAR, course:VARCHAR]),\n    child_: FilterPlanNode {\n      predicate_: ComparisonExpression {\n        op_: GREATER_THAN,\n        left_: ColumnValueExpression { col_idx: 2 }, // s.age\n        right_: ConstantValueExpression { value: 18 }\n      },\n      child_: NestedLoopJoinPlanNode {\n        join_type_: INNER,\n        join_predicate_: ComparisonExpression {\n          op_: EQUAL,\n          left_: ColumnValueExpression { col_idx: 0 }, // s.id\n          right_: ColumnValueExpression { col_idx: 3 }  // e.sid\n        },\n        output_schema_: Schema([id:INTEGER, name:VARCHAR, age:INTEGER, sid:INTEGER, course:VARCHAR]),\n        left_child_: SeqScanPlanNode {\n          table_oid_: 1, // student table\n          output_schema_: Schema([id:INTEGER, name:VARCHAR, age:INTEGER])\n        },\n        right_child_: SeqScanPlanNode {\n          table_oid_: 2, // enrollment table\n          output_schema_: Schema([sid:INTEGER, course:VARCHAR])\n        }\n      }\n    }\n  }\n}\n"})}),"\n",(0,d.jsx)(n.h4,{id:"optimizer",children:"Optimizer"}),"\n",(0,d.jsx)(n.p,{children:"\u63a5\u8457\u5c31\u6703\u4ea4\u7d66 optimizer \u4f86\u512a\u5316\u57f7\u884c\u8a08\u5283\uff0c\u9019\u88e1 bustub \u63a1\u7528\u7684\u662f rule-based \u7684\u65b9\u5f0f\uff0c\u4e5f\u5c31\u662f\u5b83\u6703\u4e00\u689d\u4e00\u689d\u898f\u5247\u7684\u5957\u7528\u5230\u57f7\u884c\u8a08\u5283\u4e0a\u3002"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Optimizer"})," \u7684 ",(0,d.jsx)(n.code,{children:"Optimize()"})," \u51fd\u6578\u6703\u6aa2\u67e5\u9019\u4e9b\u898f\u5247\u4e26\u5957\u7528\u5230 ",(0,d.jsx)(n.code,{children:"PlanNode"})," \u4e0a\uff0c\u6bd4\u5982\u8aaa\u6211\u5011\u8981\u5be6\u4f5c\u7684 ",(0,d.jsx)(n.code,{children:"OptimizeNLJAsIndexJoin"}),"\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u4ee5\u4e0a\u9762\u7684 SQL \u70ba\u4f8b\uff0c\u512a\u5316\u5f8c\u7684\u57f7\u884c\u8a08\u5283\u53ef\u80fd\u6703\u9577\u9019\u6a23\uff0c\u6539\u6210\u4f7f\u7528 NestedIndexJoin \u4e26\u505a\u4e86 predicate pushdown :"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'LimitPlanNode {\n  limit_: 10,\n  child_: ProjectionPlanNode {\n    expressions_: [\n      ColumnValueExpression { col_idx: 0 },  // s.id\n      ColumnValueExpression { col_idx: 1 },  // s.name\n      ColumnValueExpression { col_idx: 4 }   // e.course\n    ],\n    child_: NestedIndexJoinPlanNode {        \n      outer_child_: FilterPlanNode {\n        predicate_: ComparisonExpression { op: GT, left: age, right: 18 },\n        child_: SeqScanPlanNode { table: "student" }\n      },\n      key_predicate_: ColumnValueExpression { col_idx: 0 },  // s.id\n      inner_table_oid_: 2,\n      index_oid_: 5,\n      index_name_: "enrollment_sid_idx"\n    }\n  }\n}\n'})}),"\n",(0,d.jsx)(n.h4,{id:"executor",children:"Executor"}),"\n",(0,d.jsxs)(n.p,{children:["\u6700\u5f8c\u5c31\u662f\u4ea4\u7d66 executor \u4f86\u5c07 ",(0,d.jsx)(n.code,{children:"PlanNode"})," \u8f49\u63db\u6210\u5c0d\u61c9\u7684 ",(0,d.jsx)(n.code,{children:"Executor"}),"\uff0c\u9019\u88e1 bustub \u63a1\u7528\u7684\u662f pull-based \u7684 volcano model\uff0c\u4e5f\u5c31\u662f\u6bcf\u500b ",(0,d.jsx)(n.code,{children:"Executor"})," \u90fd\u6709 ",(0,d.jsx)(n.code,{children:"Init()"})," \u8ddf ",(0,d.jsx)(n.code,{children:"Next()"})," \u5169\u500b\u65b9\u6cd5\uff0c\u4e26\u4e14\u4e0a\u5c64\u7684 ",(0,d.jsx)(n.code,{children:"Executor"})," \u6703\u4e0d\u65b7\u547c\u53eb\u4e0b\u5c64\u7684 ",(0,d.jsx)(n.code,{children:"Executor"})," \u7684 ",(0,d.jsx)(n.code,{children:"Next()"})," \u4f86\u53d6\u5f97\u8cc7\u6599\u76f4\u5230\u56de\u50b3 false \u70ba\u6b62\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["Executor \u7684\u5165\u53e3\u9ede\u5728 ",(0,d.jsx)(n.code,{children:"src/execution/executor_engine.cpp"}),"\uff0c\u5b83\u6703\u547c\u53eb ",(0,d.jsx)(n.code,{children:"ExecutorFactory::CreateExecutor()"})," \u4f86\u905e\u8ff4\u5730\u91dd\u5c0d\u4e0d\u540c\u7a2e\u985e\u7684 ",(0,d.jsx)(n.code,{children:"PlanNode"})," \u5275\u5efa\u5c0d\u61c9\u7684 ",(0,d.jsx)(n.code,{children:"Executor"}),"\u3002\n\u540c\u6642\u5b83\u4e5f\u6703\u547c\u53eb ",(0,d.jsx)(n.code,{children:"Init()"})," \u4f86\u521d\u59cb\u5316\u6574\u500b executor \u6a39\uff0c\u6700\u5f8c\u547c\u53eb ",(0,d.jsx)(n.code,{children:"PollExecutor()"})," \u4f86\u4e0d\u65b7\u7684 pull \u8cc7\u6599\u76f4\u5230\u6c92\u6709\u8cc7\u6599\u70ba\u6b62\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9664\u6b64\u4e4b\u5916\uff0c",(0,d.jsx)(n.code,{children:"ExecutorContext"})," \u4e5f\u6703\u5728\u9019\u500b\u6642\u5019\u88ab\u5275\u5efa\uff0c\u5b83\u5305\u542b\u4e86 ",(0,d.jsx)(n.code,{children:"Transaction"}),"\u3001",(0,d.jsx)(n.code,{children:"Catalog"}),"\u3001",(0,d.jsx)(n.code,{children:"BufferPoolManager"})," \u7b49\u7b49\u57f7\u884c\u6642\u9700\u8981\u7684\u7269\u4ef6\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"storage-structure",children:"Storage Structure"}),"\n",(0,d.jsx)(n.p,{children:"\u5728\u4e86\u89e3\u4e86\u6574\u500b SQL \u7684\u57f7\u884c\u6d41\u7a0b\u4e4b\u5f8c\uff0c\u6211\u5011\u9084\u9700\u8981\u4e86\u89e3\u4e00\u4e0b\u8cc7\u6599\u5eab\u4e2d\u7684\u7d50\u69cb\u4ee5\u53ca\u9019\u4e9b\u7d50\u69cb\u662f\u5982\u4f55\u88ab\u5132\u5b58\u7684\u3002"}),"\n",(0,d.jsx)(l,{src:"/img/cmu15-445/p3/storage.webp",caption:"Storage Structure"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"Catalog"})," : \u6700\u9802\u5c64\u7684\u7d50\u69cb\uff0c\u8ca0\u8cac\u7ba1\u7406\u8cc7\u6599\u8868\u8ddf\u7d22\u5f15\uff0c\u6709 ",(0,d.jsx)(n.code,{children:"CreateTable()"}),"\u3001",(0,d.jsx)(n.code,{children:"GetTable()"}),"\u3001",(0,d.jsx)(n.code,{children:"CreateIndex()"}),"\u3001",(0,d.jsx)(n.code,{children:"GetIndex()"})," \u7b49\u7b49\u65b9\u6cd5"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"TableInfo"})," : \u4ee3\u8868\u4e00\u500b\u8cc7\u6599\u8868\uff0c\u5305\u542b\u4e86 ",(0,d.jsx)(n.code,{children:"Schema"}),"\u3001",(0,d.jsx)(n.code,{children:"TableHeap"}),"\u3001",(0,d.jsx)(n.code,{children:"TableOid"}),"\u3001",(0,d.jsx)(n.code,{children:"Name"})," \u7b49\u7b49\u8cc7\u8a0a"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"IndexInfo"})," : \u4ee3\u8868\u4e00\u500b\u7d22\u5f15\uff0c\u5305\u542b\u4e86 ",(0,d.jsx)(n.code,{children:"Schema"}),"\u3001",(0,d.jsx)(n.code,{children:"Index"}),"\u3001",(0,d.jsx)(n.code,{children:"IndexOid"}),"\u3001",(0,d.jsx)(n.code,{children:"Name"})," \u7b49\u7b49\u8cc7\u8a0a"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"TableHeap"})," : \u4ee3\u8868 page \u7684\u5132\u5b58\u7d50\u69cb\uff0c\u7dad\u8b77 ",(0,d.jsx)(n.code,{children:"first_page_id_"})," \u8ddf ",(0,d.jsx)(n.code,{children:"last_page_id_"})," \u65b9\u4fbf\u63d2\u5165\u8ddf\u67e5\u8a62\u8cc7\u6599\uff0c\u540c\u6642\u63d0\u4f9b\u4e86\u5f88\u591a\u5f88\u6709\u7528\u7684\u65b9\u6cd5\uff0c\u4f8b\u5982 ",(0,d.jsx)(n.code,{children:"InsertTuple()"}),"\u3001",(0,d.jsx)(n.code,{children:"GetTuple()"}),"\u3001",(0,d.jsx)(n.code,{children:"UpdateTupleMeta()"}),"\u3001",(0,d.jsx)(n.code,{children:"UpdateTupleInPlaceWithLockAcquired()"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"TablePage"})," : \u4ee3\u8868\u4e00\u500b page\uff0c\u63a1\u7528 slotted-page \u7684\u7d50\u69cb\u4f86\u5132\u5b58 tuple"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"Tuple"})," : \u4ee3\u8868\u4e00\u7b46\u8cc7\u6599\uff0c\u5305\u542b\u4e86 ",(0,d.jsx)(n.code,{children:"RID"})," (\u7531 page id / slot num \u7d44\u6210) \u8ddf ",(0,d.jsx)(n.code,{children:"data"}),"\uff0c",(0,d.jsx)(n.code,{children:"data"})," \u88e1\u9762\u6709\u591a\u500b ",(0,d.jsx)(n.code,{children:"Value"}),"\uff0c",(0,d.jsx)(n.code,{children:"Value"})," \u53ef\u4ee5\u4ee3\u8868\u4e0d\u540c\u7684\u8cc7\u6599\u578b\u614b"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"TupleInfo"})," : \u4ee3\u8868 tuple \u5728 page \u4e2d\u7684 offset \u8ddf size \u4ee5\u53ca ",(0,d.jsx)(n.code,{children:"TupleMeta"}),"\uff0c",(0,d.jsx)(n.code,{children:"TupleMeta"})," \u5305\u542b\u4e86 ",(0,d.jsx)(n.code,{children:"is_deleted_"})," \u8ddf ",(0,d.jsx)(n.code,{children:"ts_"})," (timestamp)"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"Schema"})," : \u4ee3\u8868\u8cc7\u6599\u8868\u7684 schema\uff0c\u5305\u542b\u4e86\u591a\u500b ",(0,d.jsx)(n.code,{children:"Column"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"Column"})," : \u4ee3\u8868\u4e00\u500b\u6b04\u4f4d\uff0c\u5305\u542b\u4e86\u6b04\u4f4d\u540d\u7a31\u3001\u6b04\u4f4d\u985e\u578b\u3001\u6b04\u4f4d\u9577\u5ea6\u7b49\u7b49\u8cc7\u8a0a"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u5728 executor \u4e2d\uff0c\u5982\u679c\u6211\u5011\u8981\u8b80\u53d6\u8cc7\u6599\u8868\u7684\u8cc7\u6599\uff0c\u901a\u5e38\u6703\u8981\u901a\u904e ",(0,d.jsx)(n.code,{children:"exec_ctx_->GetCatalog()"})," \u5148\u53d6\u5f97 ",(0,d.jsx)(n.code,{children:"Catalog"}),"\uff0c\u7136\u5f8c\u518d\u7e7c\u7e8c\u5f80\u4e0b\u53d6\u5f97 ",(0,d.jsx)(n.code,{children:"TableInfo"}),"\u3001",(0,d.jsx)(n.code,{children:"TableHeap"})," \u7b49\u6211\u5011\u9700\u8981\u7684\u8cc7\u8a0a\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u6574\u9ad4\u4f86\u8aaa\u55ae\u4e00\u7684\u51fd\u6578\u5be6\u4f5c\u8d77\u4f86\u96e3\u5ea6\u61c9\u8a72\u4e0d\u662f\u592a\u9ad8\uff0c\u6240\u4ee5\u4e0b\u9762\u6211\u5c31\u7c21\u55ae\u8aaa\u660e\u4e00\u4e0b\u6d41\u7a0b\u8ddf\u4e00\u4e9b\u53ef\u80fd\u6703\u7528\u5230\u7684\u65b9\u6cd5\u5c31\u597d\u3002"}),"\n",(0,d.jsx)(n.h2,{id:"task-1---access-method-executors",children:"Task 1 - Access Method Executors"}),"\n",(0,d.jsx)(n.h3,{id:"seqscan",children:"SeqScan"}),"\n",(0,d.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"TableIterator"})," \u4f86\u6383\u63cf\uff0c\u6ce8\u610f\u8df3\u904e\u88ab\u522a\u9664\u7684\u8cc7\u6599\u8ddf WHERE \u689d\u4ef6\uff0c\u53ef\u4ee5\u7528 ",(0,d.jsx)(n.code,{children:"Evaluate()"})," \u4f86\u5224\u65b7 WHERE \u689d\u4ef6\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"insert",children:"Insert"}),"\n",(0,d.jsxs)(n.p,{children:["\u9664\u4e86 ",(0,d.jsx)(n.code,{children:"TableHeap::InsertTuple()"})," \u4e4b\u5916\uff0c\u9084\u9700\u8981\u65b0\u589e\u7d22\u5f15\uff0c\u53ef\u4ee5\u7528 ",(0,d.jsx)(n.code,{children:"InsertEntry()"})," \u4f86\u65b0\u589e\u7d22\u5f15\uff0ckey \u53ef\u4ee5\u7528 ",(0,d.jsx)(n.code,{children:"KeyFromTuple()"})," \u4f86\u53d6\u5f97\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9700\u8981\u6ce8\u610f\u8981\u6709\u4e00\u500b\u53c3\u6578\u8ca0\u8cac\u8a18\u9304\u4e4b\u524d\u6709\u6c92\u6709\u56de\u50b3\u904e\u7d50\u679c\u4e86\uff0c\u56e0\u70ba\u4e0a\u5c64\u6703\u4e0d\u65b7\u547c\u53eb ",(0,d.jsx)(n.code,{children:"Next()"}),"\uff0c\u5982\u679c\u5df2\u7d93\u56de\u50b3\u904e\u7d50\u679c\u4e86\u5c31\u8981\u56de\u50b3 false\uff0c\u5305\u62ec\u5f8c\u9762\u7684\u4e00\u4e9b executor \u4e5f\u662f\u4e00\u6a23\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"update",children:"Update"}),"\n",(0,d.jsxs)(n.p,{children:["\u5148\u628a\u820a\u7684 TupleMeta \u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"UpdateTupleMeta()"})," \u6a19\u8a18\u70ba\u522a\u9664\uff0c\u63a5\u8457\u628a index \u522a\u9664\uff0c\u7136\u5f8c\u518d\u63d2\u5165\u65b0\u7684 tuple \u4e26\u63d2\u5165\u65b0\u7684\u7d22\u5f15\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"delete",children:"Delete"}),"\n",(0,d.jsx)(n.p,{children:"\u6c92\u5565\u7279\u5225\u597d\u8aaa\u7684\uff0c\u5c31\u662f\u628a TupleMeta \u6a19\u8a18\u70ba\u522a\u9664\uff0c\u7136\u5f8c\u522a\u9664\u7d22\u5f15\u3002"}),"\n",(0,d.jsx)(n.h3,{id:"indexscan",children:"IndexScan"}),"\n",(0,d.jsxs)(n.p,{children:["\u7528 ",(0,d.jsx)(n.code,{children:"pred_keys_"})," \u5224\u65b7\u662f\u9ede\u67e5\u8a62\u9084\u662f\u7bc4\u570d\u67e5\u8a62\uff0c\u5982\u679c\u662f\u9ede\u67e5\u8a62\u5c31\u7528 ",(0,d.jsx)(n.code,{children:"ScanKey()"})," \u67e5\u8a62\u6bcf\u4e00\u500b key\uff0c\u5982\u679c\u662f\u7bc4\u570d\u67e5\u8a62\u5c31\u76f4\u63a5\u7528 B+ tree \u7684\u8fed\u4ee3\u5668\u4f86\u6383\u63cf\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"indexscan-optimizer",children:"IndexScan Optimizer"}),"\n",(0,d.jsxs)(n.p,{children:["\u9996\u5148\u8981\u5148\u905e\u8ff4\u4f86\u904d\u6b77\u6574\u500b ",(0,d.jsx)(n.code,{children:"AbstractPlanNodeRef"}),"\uff0c\u63a5\u8457\u6aa2\u67e5\u662f\u4e0d\u662f seq_scan + filter \u7684\u7d44\u5408\uff0c\u4e26\u770b\u770b\u6709\u6c92\u6709 index \u53ef\u4ee5\u7528\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u6709\u4e09\u7a2e\u60c5\u6cc1\u8981\u8655\u7406 :"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-SQL",children:"SELECT * FROM t1 WHERE v1 = 1;\nSELECT * FROM t1 WHERE 2 = v1;\nSELECT * FROM t1 WHERE v1 = 1 OR v1 = 2;\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u5c0d\u65bc\u524d\u5169\u7a2e\u60c5\u6cc1\uff0c\u6211\u5011\u9700\u8981\u6aa2\u67e5\u8b02\u8a5e\u662f\u5426\u70ba ",(0,d.jsx)(n.code,{children:"ComparisonExpression"}),"\uff0c\u4e14\u6bd4\u8f03\u985e\u578b\u70ba Equal\u3002\n\u63a5\u8457\u6aa2\u67e5\u5de6\u53f3\u5b50\u7bc0\u9ede\uff0c\u78ba\u4fdd\u4e00\u908a\u662f ",(0,d.jsx)(n.code,{children:"ColumnValueExpression"})," (\u8b8a\u6578)\uff0c\u53e6\u4e00\u908a\u662f ",(0,d.jsx)(n.code,{children:"ConstantValueExpression"}),"(\u5e38\u6578)\u3002\n\u518d\u4f86\u6aa2\u67e5 ",(0,d.jsx)(n.code,{children:"ColumnValueExpression"})," \u7684 ",(0,d.jsx)(n.code,{children:"col_idx"})," \u662f\u5426\u8207\u67d0\u500b\u53ef\u7528\u7d22\u5f15\u7684\u7b2c\u4e00\u500b\u9375\u503c\u6b04\u4f4d\u76f8\u7b26\u3002\n\u6700\u5f8c\u6aa2\u67e5 ",(0,d.jsx)(n.code,{children:"GetTupleIdx() == 0"}),"\uff0c\u9019\u500b\u6aa2\u67e5\u78ba\u4fdd\u4e86\u9019\u500b\u6b04\u4f4d\u5c6c\u65bc\u7576\u524d\u6b63\u5728\u6383\u63cf\u7684\u9019\u5f35\u8868\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u5c0d\u65bc\u7b2c\u4e09\u7a2e\u60c5\u6cc1\uff0c\u6211\u5011\u9700\u8981\u905e\u8ff4\u5730\u5206\u6790\u3002\n\u5982\u679c\u8868\u9054\u5f0f\u662f\u4e00\u500b ",(0,d.jsx)(n.code,{children:"LogicExpression"})," \u4e14\u908f\u8f2f\u985e\u578b\u662f ",(0,d.jsx)(n.code,{children:"LogicType::Or"}),"\uff0c\u90a3\u9ebc\u6211\u5011\u5c31\u905e\u8ff4\u5730\u5c0d\u5176\u5de6\u53f3\u5b50\u8868\u9054\u5f0f\u61c9\u7528\u524d\u5169\u7a2e\u60c5\u6cc1\u7684\u5224\u65b7\u908f\u8f2f\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"task-2---aggregation--join-executors",children:"Task 2 - Aggregation & Join Executors"}),"\n",(0,d.jsx)(n.h3,{id:"aggregation",children:"Aggregation"}),"\n",(0,d.jsxs)(n.p,{children:["\u9996\u5148\u8981\u5b8c\u6210 ",(0,d.jsx)(n.code,{children:"CombineAggregateValues"})," \u4e2d\u5e7e\u7a2e\u51fd\u6578\u7684\u5be6\u4f5c\uff0c\u9019\u90e8\u5206\u6bd4\u8f03\u7c21\u55ae\uff0c\u4e3b\u8981\u662f\u8981\u6ce8\u610f ",(0,d.jsx)(n.code,{children:"NULL"})," \u7684\u8655\u7406\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u500b executor \u662f\u4e00\u500b pipeline breaker\uff0c\u6240\u4ee5\u5728 ",(0,d.jsx)(n.code,{children:"Init()"})," \u7684\u6642\u5019\u5c31\u8981\u628a\u6240\u6709\u8cc7\u6599\u90fd\u8b80\u9032\u4f86\u4e26\u8a08\u7b97\u597d\u7d50\u679c\uff0c\u53ef\u4ee5\u5229\u7528 ",(0,d.jsx)(n.code,{children:"MakeAggregateKey"}),"\u3001",(0,d.jsx)(n.code,{children:"MakeAggregateValue"})," \u4e26\u4e1f\u5230 ",(0,d.jsx)(n.code,{children:"InsertCombine()"})," \u4f86\u505a\u3002\n\u6700\u5f8c\u8f38\u51fa\u7684\u6642\u5019\u8981\u628a ",(0,d.jsx)(n.code,{children:"AggregateKey"})," \u8ddf ",(0,d.jsx)(n.code,{children:"AggregateValue"})," \u7684\u689d\u4ef6\u4e5f\u4e00\u8d77\u8f38\u51fa\u65b9\u4fbf\u4e0a\u9762\u7684 ",(0,d.jsx)(n.code,{children:"Projection"})," \u4f7f\u7528\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9700\u8981\u7279\u5225\u8655\u7406 empty input \u7684\u60c5\u6cc1\uff0c\u53ef\u4ee5\u547c\u53eb ",(0,d.jsx)(n.code,{children:"GenerateInitialAggregateValue()"})," \u4f86\u7522\u751f\u521d\u59cb\u503c\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"nestedloopjoin",children:"NestedLoopJoin"}),"\n",(0,d.jsxs)(n.p,{children:["\u9700\u8981\u8655\u7406 INNER JOIN \u8ddf LEFT JOIN \u5169\u7a2e\u60c5\u6cc1\u3002\n\u9019\u88e1\u6211\u7684\u505a\u6cd5\u662f\u5148\u8b80\u5de6\u908a\u7684\u4e00\u500b tuple\uff0c\u7136\u5f8c\u91cd\u65b0 ",(0,d.jsx)(n.code,{children:"Init()"})," \u53f3\u908a\u7684 executor\uff0c\u63a5\u8457\u4e0d\u65b7\u547c\u53eb\u53f3\u908a\u7684 ",(0,d.jsx)(n.code,{children:"Next()"})," \u4e26\u7528 ",(0,d.jsx)(n.code,{children:"EvaluateJoin"})," \u4f86\u5224\u65b7\u6709\u6c92\u6709\u7b26\u5408\u689d\u4ef6\uff0c\u5982\u679c\u6709\u5c31\u628a\u5169\u500b tuple \u5408\u4f75\u8d77\u4f86\u4e26\u56de\u50b3\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u5982\u679c\u662f ",(0,d.jsx)(n.code,{children:"LEFT JOIN"})," \u7684\u8a71\uff0c\u7576\u53f3\u908a\u7684 executor \u6383\u63cf\u5b8c\u4e4b\u5f8c\u9084\u6c92\u6709\u627e\u5230\u7b26\u5408\u689d\u4ef6\u7684 tuple\uff0c\u5c31\u8981\u56de\u50b3\u5de6\u908a\u7684 tuple \u4e26\u628a\u53f3\u908a\u7684\u6b04\u4f4d\u8a2d\u70ba ",(0,d.jsx)(n.code,{children:"NULL"}),"\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"ValueFactory::GetNullValueByType()"})," \u4f86\u7522\u751f ",(0,d.jsx)(n.code,{children:"NULL"}),"\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"nestedindexjoin",children:"NestedIndexJoin"}),"\n",(0,d.jsxs)(n.p,{children:["\u6574\u9ad4\u908f\u8f2f\u8ddf ",(0,d.jsx)(n.code,{children:"NestedLoopJoin"})," \u5dee\u4e0d\u591a\uff0c\u5dee\u5225\u5728\u65bc\u53f3\u908a\u7684 executor \u662f\u4e00\u500b ",(0,d.jsx)(n.code,{children:"IndexScan"}),"\uff0c\u6240\u4ee5\u6bcf\u6b21\u8b80\u5de6\u908a\u7684 tuple \u4e4b\u5f8c\u8981\u7528 ",(0,d.jsx)(n.code,{children:"KeyPredicate"})," \u4f86\u751f\u6210 probe key\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"task-3---hashjoin-executor-and-optimization",children:"Task 3 - HashJoin Executor and Optimization"}),"\n",(0,d.jsx)(n.h3,{id:"hashjoin",children:"HashJoin"}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u500b task \u8981\u505a\u7684\u4e8b\u60c5\u9084\u883b\u591a\u7684\uff0c\u9664\u4e86 ",(0,d.jsx)(n.code,{children:"Init()"})," \u8ddf ",(0,d.jsx)(n.code,{children:"Next()"})," \u4e4b\u5916\uff0c\u9084\u8981\u5be6\u4f5c\u91dd\u5c0d ",(0,d.jsx)(n.code,{children:"std::vector<Value>"})," \u7684 hash \u65b9\u6cd5\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u6211\u5be6\u4f5c\u4e86\u4e00\u500b ",(0,d.jsx)(n.code,{children:"JoinKey"})," \u7684 class \u4f86\u4ee3\u8868 join key\uff0c\u4e26\u4e14\u5be6\u4f5c\u4e86 ",(0,d.jsx)(n.code,{children:"operator=="})," \u8ddf ",(0,d.jsx)(n.code,{children:"std::hash"})," \u4f86\u8b93\u5b83\u53ef\u4ee5\u88ab hash\uff0c\u9019\u90e8\u5206\u53ef\u4ee5\u5927\u81f4\u53c3\u8003 ",(0,d.jsx)(n.code,{children:"AggregationPlanNode"})," \u7684\u5be6\u4f5c\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u5728 ",(0,d.jsx)(n.code,{children:"Init()"})," \u7684\u6642\u5019\u53ef\u4ee5\u5148\u628a\u4e00\u908a\u7684\u8cc7\u6599\u90fd\u8b80\u9032\u4f86\u4e26\u5efa\u7acb hash table\uff0c\u6211\u7684\u5132\u5b58\u65b9\u5f0f\u662f ",(0,d.jsx)(n.code,{children:"std::unordered_map<JoinKey, std::vector<Tuple>>"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u5728 ",(0,d.jsx)(n.code,{children:"Next()"})," \u7684\u6642\u5019\u5c31\u4e0d\u65b7\u8b80\u53e6\u4e00\u908a\u7684\u8cc7\u6599\uff0c\u7136\u5f8c\u7528 join key \u53bb hash table \u88e1\u9762\u627e\u6709\u6c92\u6709\u7b26\u5408\u7684 tuple\uff0c\u5982\u679c\u6709\u5c31\u628a\u5169\u500b tuple \u5408\u4f75\u8d77\u4f86\u4e26\u56de\u50b3\uff0c\u9700\u8981\u7279\u5225\u8655\u7406\u4e00\u5c0d\u591a\u7684\u60c5\u6cc1\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"hashjoin-optimizer",children:"HashJoin Optimizer"}),"\n",(0,d.jsx)(n.p,{children:"\u6709\u5169\u7a2e\u60c5\u6cc1\u53ef\u4ee5\u512a\u5316\u6210 HashJoin :"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-SQL",children:"SELECT * FROM t1 JOIN t2 ON t1.v1 = t2.v1;\nSELECT * FROM t1 JOIN t2 ON t1.v1 = t2.v1 AND t1.v2 = t2.v2;\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u9996\u5148\uff0c\u8ddf\u5176\u4ed6 optimizer \u4e00\u6a23\u9700\u8981\u5148\u628a\u6a39\u905e\u8ff4\u5230\u5e95\u5728\u958b\u59cb\u3002"}),"\n",(0,d.jsxs)(n.p,{children:["\u5c0d\u65bc\u7b2c\u4e00\u7a2e\u60c5\u6cc1\u4f86\u8aaa\uff0c\u9700\u8981\u6aa2\u67e5\u6383\u63cf\u65b9\u6cd5\u662f\u4e0d\u662f ",(0,d.jsx)(n.code,{children:"NestedLoopJoin"})," \u4e14\u662f\u900f\u904e ",(0,d.jsx)(n.code,{children:"ComparisonType::Equal"})," \u8ddf ",(0,d.jsx)(n.code,{children:"ColumnValueExpression"})," \u4f86 join \u7684\uff0c\u63a5\u8457\u518d\u78ba\u5b9a\u4ed6\u5011\u662f\u4e0d\u662f\u4f86\u81ea\u4e0d\u540c\u7684 table\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u5c0d\u65bc\u7b2c\u4e8c\u7a2e\u60c5\u6cc1\u4f86\u8aaa\uff0c\u9084\u9700\u8981\u8003\u616e AND \u7684\u60c5\u6cc1\uff0c\u53ef\u4ee5\u7528\u905e\u8ff4\u7684\u65b9\u5f0f\u4f86\u6aa2\u67e5 ",(0,d.jsx)(n.code,{children:"LogicExpression"})," \u662f\u4e0d\u662f ",(0,d.jsx)(n.code,{children:"LogicType::And"}),"\uff0c\u7136\u5f8c\u6aa2\u67e5\u5de6\u53f3\u5b50\u7bc0\u9ede\u7b26\u4e0d\u7b26\u5408\u7b2c\u4e00\u7a2e\u60c5\u6cc1\u7684\u689d\u4ef6\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"task-4---external-merge-sort--limit-executors",children:"Task 4 - External Merge Sort + Limit Executors"}),"\n",(0,d.jsx)(n.h3,{id:"external-merge-sort",children:"External Merge Sort"}),"\n",(0,d.jsxs)(n.p,{children:["\u9996\u5148\u8981\u5be6\u4f5c ",(0,d.jsx)(n.code,{children:"TupleComparator::operator()"})," \u4f86\u6bd4\u8f03\u5169\u500b tuple \u7684\u5927\u5c0f\uff0c\u9019\u90e8\u5206\u53ef\u4ee5\u7528 ",(0,d.jsx)(n.code,{children:"Value"})," \u88e1\u9762\u7684 ",(0,d.jsx)(n.code,{children:"CompareEquals()"}),"\u3001",(0,d.jsx)(n.code,{children:"CompareLessThan()"})," \u4f86\u6bd4\u8f03\u5927\u5c0f\uff0c\u8981\u5340\u5206 ",(0,d.jsx)(n.code,{children:"ASC"})," (",(0,d.jsx)(n.code,{children:"DEFAULT"}),") \u8ddf ",(0,d.jsx)(n.code,{children:"DESC"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u63a5\u8457\u5be6\u4f5c ",(0,d.jsx)(n.code,{children:"GenerateSortKey()"})," \u4f86\u7522\u751f\u6392\u5e8f\u7684 key\uff0c\u53ef\u4ee5\u7528 ",(0,d.jsx)(n.code,{children:"MakeKeyFromTuple()"})," \u4f86\u7522\u751f\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u7136\u5f8c\u9700\u8981\u5be6\u4f5c ",(0,d.jsx)(n.code,{children:"SortPage"})," \u8ddf ",(0,d.jsx)(n.code,{children:"MergeSortRun"})," \u4f86\u4ee3\u8868\u786c\u789f\u4e0a\u7684 page \u4ee5\u53ca\u4e00\u500b\u908f\u8f2f\u4e0a\u7684 run\uff0c\u53ef\u4ee5\u81ea\u884c\u4f9d\u64da\u9700\u6c42\u5beb\u4e00\u4e9b helper function\u3002\n\u5728\u6211\u81ea\u5df1\u7684\u5be6\u4f5c\u4e2d\uff0c",(0,d.jsx)(n.code,{children:"SortPage"})," \u6703\u5305\u542b\u4e00\u500b\u6210\u54e1 ",(0,d.jsx)(n.code,{children:"char data_[BUSTUB_PAGE_SIZE]"}),"\uff0c\u9019\u500b\u6210\u54e1\u7684\u524d 4 \u500b byte \u6703\u7528\u4f86\u8a18\u9304\u9019\u500b page \u88e1\u9762\u6709\u591a\u5c11\u500b tuple\uff0c\u5269\u4e0b\u7684\u7a7a\u9593\u5c31\u7528\u4f86\u653e tuple \u7684\u8cc7\u6599\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u908a\u6709\u5169\u500b\u554f\u984c\u8981\u6ce8\u610f\uff0c\u7b2c\u4e00\u500b\u662f\u8981\u5728 ",(0,d.jsx)(n.code,{children:"MergeSortRun"})," \u4e2d\u7684 ",(0,d.jsx)(n.code,{children:"Iterator"})," \u4fdd\u7559\u4e0a\u4e00\u6b21\u8b80\u53d6\u7684 ",(0,d.jsx)(n.code,{children:"ReadPageGuard"}),"\uff0c\u4e0d\u7136\u6e2c\u8a66\u5f88\u5bb9\u6613\u8d85\u6642\u3002\n\u7b2c\u4e8c\u500b\u662f\u5982\u679c\u9047\u5230\u4e86 ",(0,d.jsx)(n.code,{children:"test incurred 0 times of disk deletion, which is too low"})," \u7684\u932f\u8aa4\u8a0a\u606f\uff0c\u4ee3\u8868\u6709\u53ef\u80fd\u5728 project 1 \u7684\u6642\u5019\u5c31\u6c92\u6709\u6b63\u78ba\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"disk_scheduler_->DeallocatePage()"})," \u5c0e\u81f4\u5b83\u6293\u4e0d\u5230 page \u7684\u522a\u9664\u6b21\u6578\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u6700\u5f8c\u5c31\u662f\u5be6\u4f5c\u771f\u6b63\u7684 ",(0,d.jsx)(n.code,{children:"ExternalMergeSortExecutor"})," \u4e86\uff0c\u9019\u88e1\u6211\u5be6\u4f5c\u4e86 4 \u500b helper function \u4f86\u5206\u5225\u8655\u7406\u4e0d\u540c\u7684\u968e\u6bb5 :"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"CreateInitialRuns()"})," : \u5f9e child executor \u62c9 tuple\uff0c\u7d44\u6210 ",(0,d.jsx)(n.code,{children:"<sort_key, tuple>"})," \u7684 pair\uff0c\u6eff\u4e00\u500b page \u7684\u5927\u5c0f\u5c31\u547c\u53eb ",(0,d.jsx)(n.code,{children:"FlushRunToDisk()"})," \u4f86\u628a\u9019\u4e9b tuple \u6392\u5e8f\u4e26\u5beb\u5230\u786c\u789f\u4e0a"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"FlushRunToDisk()"})," : \u628a\u4e00\u500b run \u7684 tuple \u6392\u5e8f\u4e26\u5beb\u5230\u786c\u789f\u4e0a\uff0c\u9019\u88e1\u53ef\u4ee5\u7528 ",(0,d.jsx)(n.code,{children:"std::sort()"})," \u4f86\u6392\u5e8f\uff0c\u4e26\u5beb\u5165\u5230 ",(0,d.jsx)(n.code,{children:"SortPage"})," \u4e2d\u6700\u5f8c\u628a page_id \u8a18\u9304\u8d77\u4f86\u4e26\u585e\u56de\u786c\u789f\u4e2d"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"MergeRuns()"})," : \u6bcf\u6b21\u53d6\u51fa\u5169\u500b page \u4e26\u547c\u53eb ",(0,d.jsx)(n.code,{children:"MergeTwoRuns()"})," \u4f86\u5408\u4f75\u6210\u4e00\u500b\u65b0\u7684 run\uff0c\u6700\u5f8c\u56de\u50b3\u65b0\u7684 run \u7684 page_id"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"MergeTwoRuns()"})," : \u904b\u7528\u5169\u500b iterator \u4f86\u5c07\u5169\u500b ",(0,d.jsx)(n.code,{children:"MergeSortRun"})," \u5408\u4f75\u6210\u4e00\u500b\u65b0\u7684 ",(0,d.jsx)(n.code,{children:"MergeSortRun"})]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u540c\u6642\u9019\u500b executor \u4e5f\u662f\u4e00\u500b pipeline breaker\uff0c\u6240\u4ee5\u5728 ",(0,d.jsx)(n.code,{children:"Init()"})," \u7684\u6642\u5019\u5c31\u8981\u628a\u6240\u6709\u8cc7\u6599\u90fd\u8b80\u9032\u4f86\u4e26\u6392\u5e8f\u597d\uff0c\u6700\u5f8c\u5728 ",(0,d.jsx)(n.code,{children:"Next()"})," \u7684\u6642\u5019\u53ea\u9700\u8981\u4e0d\u65b7\u5730\u5f9e\u6392\u5e8f\u597d\u7684 run \u4e2d\u8b80\u53d6 tuple \u4e26\u56de\u50b3\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"limit",children:"Limit"}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u61c9\u8a72\u662f\u6700\u7c21\u55ae\u7684 executor\uff0c\u53ea\u9700\u8981\u5728 ",(0,d.jsx)(n.code,{children:"Next()"})," \u7684\u6642\u5019\u8a08\u6578\uff0c\u7576\u8d85\u904e limit \u7684\u6578\u91cf\u5c31\u56de\u50b3 false\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"submit",children:"Submit"}),"\n",(0,d.jsxs)(n.p,{children:["\u5982\u679c\u8981\u57f7\u884c SQL\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u6307\u4ee4\u6216\u662f\u5230",(0,d.jsx)(n.a,{href:"https://15445.courses.cs.cmu.edu/fall2024/bustub/",children:"\u9019\u500b\u7db2\u7ad9"}),"\u4e0a\u57f7\u884c :"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"make -j$(nproc) shell && ./bin/bustub-shell\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u6e2c\u8a66\u7684\u65b9\u5f0f\u6709\u9ede\u9ebb\u7169\uff0c\u8981\u81ea\u5df1\u4e00\u500b\u4e00\u500b\u8a66 :"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"make -j$(nproc) sqllogictest && \\\n./bin/bustub-sqllogictest ../test/sql/p3.05-index-scan-btree.slt --verbose\n"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"make format && make check-format && make check-lint && make check-clang-tidy-p3\n"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"make submit-p3\n"})}),"\n",(0,d.jsx)(n.h2,{id:"takeaways",children:"Takeaways"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500b project \u505a\u8d77\u4f86\u5176\u5be6\u883b\u7121\u804a\u7684\uff0c\u56e0\u70ba\u5927\u90e8\u5206\u90fd\u662f\u7167\u8457\u898f\u683c\u4e00\u6b65\u4e00\u6b65\u5be6\u4f5c\u5c31\u597d\uff0c\u6c92\u6709\u4ec0\u9ebc\u7279\u5225\u7684\u6280\u5de7\uff0c\u4e0d\u904e\u56e0\u70ba\u8981\u770b\u7684\u6771\u897f\u4e0d\u5c11\uff0c\u6240\u4ee5\u9084\u662f\u82b1\u4e86\u6211\u883b\u591a\u6642\u9593\u7684\u3002"}),"\n",(0,d.jsx)(n.p,{children:"\u5c0d\u65bc\u60f3\u8981\u5feb\u901f\u901a\u95dc\u7684\u4eba\u4f86\u8aaa\u6211\u89ba\u5f97 AI \u5728\u9019\u500b project \u4e0a\u9762\u61c9\u8a72\u53ef\u4ee5\u5e6b\u52a9\u5f88\u5927\uff0c\u4f46\u8981\u6ce8\u610f\u4e00\u5b9a\u8981\u80fd\u7406\u89e3 AI \u5e6b\u4f60\u5beb\u7684\u6771\u897f\uff0c\u56e0\u70ba\u4e0b\u4e00\u500b project \u6703\u9700\u8981\u5728\u9019\u500b project \u7684\u57fa\u790e\u4e0a\u7e7c\u7e8c\u5be6\u4f5c\u3002"}),"\n",(0,d.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/5843407385",children:"CMU Fall 2024 15-445 P3[\u5f85\u4f18\u5316]&PaperNotes"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/587566135",children:"\u505a\u4e2a\u6570\u636e\u5e93\uff1a2022 CMU15-445 Project3 Query Execution"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/570917775",children:"BusTub \u517b\u6210\u8bb0\uff1a\u4ece\u8bfe\u7a0b\u9879\u76ee\u5230 SQL \u6570\u636e\u5e93"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/593909820",children:"CMU 15445-2022 P3 Query Optimize"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://juejin.cn/post/7527199538878939146",children:"CMU15445-2024fall-project3 \u8e29\u5751\u7ecf\u5386"})}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}function h(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>r});var l=i(6540);const d={},s=l.createContext(d);function c(e){const n=l.useContext(s);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:c(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);