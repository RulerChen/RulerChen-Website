"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["8169"],{4837:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>a,default:()=>u,toc:()=>d,metadata:()=>s,assets:()=>c,contentTitle:()=>l});var s=JSON.parse('{"id":"CMU15-445/p4","title":"P4 - Concurrency Control","description":"Concurrency Control","source":"@site/docs/CMU15-445/p4.mdx","sourceDirName":"CMU15-445","slug":"/CMU15-445/p4","permalink":"/RulerChen-Website/en/docs/CMU15-445/p4","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/p4.mdx","tags":[{"inline":true,"label":"CMU15-445","permalink":"/RulerChen-Website/en/docs/tags/cmu-15-445"},{"inline":true,"label":"CMU15-445 Projects","permalink":"/RulerChen-Website/en/docs/tags/cmu-15-445-projects"}],"version":"current","lastUpdatedAt":1758458745000,"sidebarPosition":104,"frontMatter":{"title":"P4 - Concurrency Control","sidebar_position":104,"description":"Concurrency Control","keywords":["CMU15-445/645","Concurrency Control","CMU15-445/645 \u7B46\u8A18"],"tags":["CMU15-445","CMU15-445 Projects"]},"sidebar":"tutorialSidebar","previous":{"title":"P3 - Query Execution","permalink":"/RulerChen-Website/en/docs/CMU15-445/p3"},"next":{"title":"Security","permalink":"/RulerChen-Website/en/docs/Security/"}}'),i=t(5893),r=t(65);let a={title:"P4 - Concurrency Control",sidebar_position:"104",description:"Concurrency Control",keywords:["CMU15-445/645","Concurrency Control","CMU15-445/645 \u7B46\u8A18"],tags:["CMU15-445","CMU15-445 Projects"]},l=void 0,c={},d=[{value:"Background",id:"background",level:2},{value:"Task 1 - Timestamps",id:"task-1---timestamps",level:2},{value:"Task 1.1 Timestamp Allocation",id:"task-11-timestamp-allocation",level:3},{value:"Task 1.2 Watermark",id:"task-12-watermark",level:3},{value:"Task 2 - Storage Format and Sequential Scan",id:"task-2---storage-format-and-sequential-scan",level:2},{value:"Task 2.1 - Tuple Reconstruction",id:"task-21---tuple-reconstruction",level:3},{value:"Task 2.2 - Sequential Scan (Tuple Retrieval)",id:"task-22---sequential-scan-tuple-retrieval",level:3},{value:"Task 3 - MVCC Executors",id:"task-3---mvcc-executors",level:2},{value:"Task 3.1 - Insert Executor",id:"task-31---insert-executor",level:3},{value:"Task 3.2 - Commit",id:"task-32---commit",level:3},{value:"Task 3.3 - Generate Undo Log",id:"task-33---generate-undo-log",level:3},{value:"Task 3.4 - Update &amp; Delete Executor",id:"task-34---update--delete-executor",level:3},{value:"Task 3.5 - Stop-the-world Garbage Collection",id:"task-35---stop-the-world-garbage-collection",level:3},{value:"Task 4 - Primary Key Index",id:"task-4---primary-key-index",level:2},{value:"Task 4.1 - Index Insert",id:"task-41---index-insert",level:3},{value:"Task 4.2 - Index Scan, Delete, &amp; Update",id:"task-42---index-scan-delete--update",level:3},{value:"Task 4.3 - Primary Key Updates",id:"task-43---primary-key-updates",level:3},{value:"Bonus 1 - Abort",id:"bonus-1---abort",level:2},{value:"Bonus 2 - Serializable Verification",id:"bonus-2---serializable-verification",level:2},{value:"Submit",id:"submit",level:2},{value:"Takeaways",id:"takeaways",level:2},{value:"References",id:"references",level:2}];function o(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components},{Head:t,ImageModal:s}=n;return t||h("Head",!0),s||h("ImageModal",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t,{children:(0,i.jsx)("title",{children:"CMU 15-445 2024Fall P4 Concurrency Control"})}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u9019\u500B project \u4E2D\uFF0C\u6211\u5011\u9700\u8981\u5BE6\u73FE transaction \u8DDF MVCC\uFF0C\u7E3D\u5171\u6709 4 \u500B task \u8DDF 2 \u500B bonus :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Timestamps"}),"\n",(0,i.jsx)(n.li,{children:"Storage Format and Sequential Scan"}),"\n",(0,i.jsx)(n.li,{children:"MVCC Executors"}),"\n",(0,i.jsx)(n.li,{children:"Primary Key Index"}),"\n",(0,i.jsx)(n.li,{children:"Abort"}),"\n",(0,i.jsx)(n.li,{children:"Serializable Verification"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u958B\u59CB\u5BE6\u4F5C\u4E4B\u524D\uFF0C\u6211\u5011\u9700\u8981\u5148\u4E86\u89E3\u4E00\u4E9B\u8DDF transaction \u6709\u95DC\u7684 class\u3002"}),"\n",(0,i.jsx)(s,{src:"/img/cmu15-445/p4/transaction.webp",caption:"Transaction Class"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"TransactionManager"})," \u662F\u5168\u5C40\u7684\u4EA4\u6613\u7BA1\u7406\u5668\uFF0C\u8CA0\u8CAC\u5982\u958B\u59CB\u4EA4\u6613\u3001\u63D0\u4EA4\u4EA4\u6613\u3001\u56DE\u6EFE\u4EA4\u6613\u7B49\u529F\u80FD\uFF0C\u4E5F\u8CA0\u8CAC\u7BA1\u7406 id \u7684\u5206\u914D\u8DDF\u56DE\u6536\uFF0C\u4E26\u4E14\u6709\u4E00\u500B ",(0,i.jsx)(n.code,{children:"txn_map_"})," \u6210\u54E1\uFF0C\u7528\u65BC\u5132\u5B58 ",(0,i.jsx)(n.code,{children:"txn_id"})," \u8207 ",(0,i.jsx)(n.code,{children:"Transaction"})," \u7684\u6620\u5C04\u95DC\u4FC2\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Transaction"})," \u985E\u5225\u4EE3\u8868\u4E00\u500B\u4EA4\u6613\uFF0C\u5305\u542B\u4EA4\u6613\u7684\u72C0\u614B (RUNNING\u3001TAINTED\u3001COMMITTED\u3001ABORTED)\u3001\u9694\u96E2\u7D1A\u5225 (SI & Serializable)\u3001\u958B\u59CB\u6642\u9593\u6233 (read_ts)\u3001\u7D50\u675F\u6642\u9593\u6233 (commit_ts) \u7B49\u8CC7\u8A0A\u3002\n\u6BCF\u500B\u4EA4\u6613\u5728\u958B\u59CB\u6642\u6703\u88AB\u5206\u914D\u4E00\u500B\u552F\u4E00\u7684 ",(0,i.jsx)(n.code,{children:"txn_id"}),"\uFF0C\u4E26\u4E14\u6703\u6709 ",(0,i.jsx)(n.code,{children:"write_set_"})," \u8DDF ",(0,i.jsx)(n.code,{children:"scan_predicates_"})," \u6210\u54E1\uFF0C\u5206\u5225\u7528\u65BC\u8A18\u9304\u8A72\u4EA4\u6613\u6240\u505A\u7684\u5BEB\u5165\u64CD\u4F5C\u4EE5\u53CA\u6383\u63CF\u64CD\u4F5C\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u9664\u6B64\u4E4B\u5916\uFF0C",(0,i.jsx)(n.code,{children:"Transaction"})," \u9084\u6703\u7D00\u9304\u5B83\u7684\u6BCF\u4E00\u689D ",(0,i.jsx)(n.code,{children:"UndoLog"}),"\uFF0C\u9019\u500B log \u7528\u65BC\u67E5\u770B\u820A\u7248\u672C\u7684 tuple\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"UndoLog"})," \u5305\u542B\u4E86\u4EE5\u4E0B\u7684\u8CC7\u8A0A (\u975E\u5E38\u91CD\u8981\uFF0C\u662F\u6574\u500B project \u7684\u6838\u5FC3) :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"is_deleted_"})," : ",(0,i.jsx)(n.code,{children:"bool"}),"\uFF0C\u7528\u65BC\u6A19\u8A18\u524D\u4E00\u500B\u7248\u672C\u7684 tuple \u662F\u5426\u88AB\u522A\u9664\u3002\u5982\u679C\u64CD\u4F5C\u662F INSERT\uFF0C",(0,i.jsx)(n.code,{children:"is_deleted_"})," \u5C31\u6703\u662F true\uFF0C\u8868\u793A\u4E0A\u4E00\u500B\u7248\u672C\u4E0D\u5B58\u5728"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"modified_fields_"})," : ",(0,i.jsx)(n.code,{children:"vector<bool>"}),"\uFF0C\u7528\u65BC\u6A19\u8A18\u54EA\u4E9B\u6B04\u4F4D\u88AB\u4FEE\u6539\u904E\u3002\u5047\u5982\u6709 3 \u500B\u6B04\u4F4D\uFF0C",(0,i.jsx)(n.code,{children:"modified_fields_"})," \u53EF\u80FD\u6703\u662F ",(0,i.jsx)(n.code,{children:"[true, false, true]"}),"\uFF0C\u8868\u793A\u7B2C 0 \u8DDF\u7B2C 2 \u500B\u6B04\u4F4D\u88AB\u4FEE\u6539\u904E"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"tuple_"})," : ",(0,i.jsx)(n.code,{children:"Tuple"}),"\uFF0C\u7D00\u9304\u4E0A\u4E00\u500B\u7248\u672C\u7684 tuple\uFF0C\u5167\u5BB9\u6703\u4F9D\u64DA ",(0,i.jsx)(n.code,{children:"modified_fields_"})," \u4F86\u6C7A\u5B9A\u6709\u54EA\u4E9B\u6B04\u4F4D\u3002\u5047\u5982 ",(0,i.jsx)(n.code,{children:"modified_fields_"})," \u662F ",(0,i.jsx)(n.code,{children:"[true, false, true]"}),"\uFF0C\u90A3 ",(0,i.jsx)(n.code,{children:"tuple_"})," \u53EA\u6703\u5305\u542B\u7B2C 0 \u8DDF\u7B2C 2 \u500B\u6B04\u4F4D\u7684\u503C"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ts_"})," : ",(0,i.jsx)(n.code,{children:"timestamp_t"}),"\uFF0C\u5275\u5EFA\u9019\u500B log \u7684 transaction \u7684 commit timestamp"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"prev_version_"})," : ",(0,i.jsx)(n.code,{children:"UndoLink"}),"\uFF0C\u6307\u5411\u524D\u4E00\u500B\u7248\u672C\u7684 ",(0,i.jsx)(n.code,{children:"UndoLog"}),"\u3002",(0,i.jsx)(n.code,{children:"UndoLink"})," \u5305\u542B\u4E86 ",(0,i.jsx)(n.code,{children:"prev_txn_"})," (",(0,i.jsx)(n.code,{children:"txn_id"}),") \u8DDF ",(0,i.jsx)(n.code,{children:"prev_log_idx_"}),"\uFF0C\u8868\u793A\u9019\u500B log \u7684\u4E0A\u4E00\u7248\u662F\u7531\u90A3\u500B transaction \u7684\u7B2C\u5E7E\u689D ",(0,i.jsx)(n.code,{children:"UndoLog"})," \u6240\u5275\u5EFA\u7684"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"task-1---timestamps",children:"Task 1 - Timestamps"}),"\n",(0,i.jsx)(n.h3,{id:"task-11-timestamp-allocation",children:"Task 1.1 Timestamp Allocation"}),"\n",(0,i.jsx)(n.h3,{id:"task-12-watermark",children:"Task 1.2 Watermark"}),"\n",(0,i.jsx)(n.h2,{id:"task-2---storage-format-and-sequential-scan",children:"Task 2 - Storage Format and Sequential Scan"}),"\n",(0,i.jsx)(n.h3,{id:"task-21---tuple-reconstruction",children:"Task 2.1 - Tuple Reconstruction"}),"\n",(0,i.jsx)(n.h3,{id:"task-22---sequential-scan-tuple-retrieval",children:"Task 2.2 - Sequential Scan (Tuple Retrieval)"}),"\n",(0,i.jsx)(n.h2,{id:"task-3---mvcc-executors",children:"Task 3 - MVCC Executors"}),"\n",(0,i.jsx)(n.h3,{id:"task-31---insert-executor",children:"Task 3.1 - Insert Executor"}),"\n",(0,i.jsx)(n.h3,{id:"task-32---commit",children:"Task 3.2 - Commit"}),"\n",(0,i.jsx)(n.h3,{id:"task-33---generate-undo-log",children:"Task 3.3 - Generate Undo Log"}),"\n",(0,i.jsx)(n.h3,{id:"task-34---update--delete-executor",children:"Task 3.4 - Update & Delete Executor"}),"\n",(0,i.jsx)(n.h3,{id:"task-35---stop-the-world-garbage-collection",children:"Task 3.5 - Stop-the-world Garbage Collection"}),"\n",(0,i.jsx)(n.h2,{id:"task-4---primary-key-index",children:"Task 4 - Primary Key Index"}),"\n",(0,i.jsx)(n.h3,{id:"task-41---index-insert",children:"Task 4.1 - Index Insert"}),"\n",(0,i.jsx)(n.h3,{id:"task-42---index-scan-delete--update",children:"Task 4.2 - Index Scan, Delete, & Update"}),"\n",(0,i.jsx)(n.h3,{id:"task-43---primary-key-updates",children:"Task 4.3 - Primary Key Updates"}),"\n",(0,i.jsx)(n.h2,{id:"bonus-1---abort",children:"Bonus 1 - Abort"}),"\n",(0,i.jsx)(n.h2,{id:"bonus-2---serializable-verification",children:"Bonus 2 - Serializable Verification"}),"\n",(0,i.jsx)(n.h2,{id:"submit",children:"Submit"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"make txn_timestamp_test -j$(nproc) && ./test/txn_timestamp_test\n\nmake txn_scan_test -j$(nproc) && ./test/txn_scan_test\n\nmake txn_executor_test -j$(nproc) && ./test/txn_executor_test\n\nmake txn_index_test -j$(nproc) && ./test/txn_index_test\n\nmake txn_index_concurrent_test -j$(nproc) && ./test/txn_index_concurrent_test\n\nmake txn_abort_serializable_test -j$(nproc) && ./test/txn_abort_serializable_test\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"make format && make check-format && make check-lint && make check-clang-tidy-p4\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"make submit-p4\n"})}),"\n",(0,i.jsx)(n.h2,{id:"takeaways",children:"Takeaways"}),"\n",(0,i.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/10666804837",children:"CMU Fall 2024 15-445 MVCC & SI & P4[\u5F85\u5B8C]"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://4ever-xxxl.github.io/cmu-15445-project-4/",children:"CMU 15445 Project4"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/1932549868683007217",children:"CMU15445-2024fall-project4\u8E29\u5751\u7ECF\u5386"})}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}function h(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},65:function(e,n,t){t.d(n,{Z:()=>l,a:()=>a});var s=t(7294);let i={},r=s.createContext(i);function a(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);