"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1326],{4388:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>x,frontMatter:()=>i,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"CMU15-445/p4","title":"P4 - Concurrency Control","description":"Concurrency Control","source":"@site/docs/CMU15-445/p4.mdx","sourceDirName":"CMU15-445","slug":"/CMU15-445/p4","permalink":"/RulerChen-Website/en/docs/CMU15-445/p4","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/p4.mdx","tags":[{"inline":true,"label":"CMU15-445","permalink":"/RulerChen-Website/en/docs/tags/cmu-15-445"},{"inline":true,"label":"CMU15-445 Projects","permalink":"/RulerChen-Website/en/docs/tags/cmu-15-445-projects"}],"version":"current","lastUpdatedAt":1758608125000,"sidebarPosition":104,"frontMatter":{"title":"P4 - Concurrency Control","sidebar_position":104,"description":"Concurrency Control","keywords":["CMU15-445/645","Concurrency Control","CMU15-445/645 \u7b46\u8a18"],"tags":["CMU15-445","CMU15-445 Projects"]},"sidebar":"tutorialSidebar","previous":{"title":"P3 - Query Execution","permalink":"/RulerChen-Website/en/docs/CMU15-445/p3"},"next":{"title":"Security","permalink":"/RulerChen-Website/en/docs/Security/"}}');var d=s(4848),c=s(8453);const i={title:"P4 - Concurrency Control",sidebar_position:"104",description:"Concurrency Control",keywords:["CMU15-445/645","Concurrency Control","CMU15-445/645 \u7b46\u8a18"],tags:["CMU15-445","CMU15-445 Projects"]},r=void 0,l={},a=[{value:"Background",id:"background",level:2},{value:"Task 1 - Timestamps",id:"task-1---timestamps",level:2},{value:"Task 1.1 Timestamp Allocation",id:"task-11-timestamp-allocation",level:3},{value:"Task 1.2 Watermark",id:"task-12-watermark",level:3},{value:"Task 2 - Storage Format and Sequential Scan",id:"task-2---storage-format-and-sequential-scan",level:2},{value:"Task 2.1 - Tuple Reconstruction",id:"task-21---tuple-reconstruction",level:3},{value:"Task 2.2 - Sequential Scan (Tuple Retrieval)",id:"task-22---sequential-scan-tuple-retrieval",level:3},{value:"Task 3 - MVCC Executors",id:"task-3---mvcc-executors",level:2},{value:"Task 3.1 - Insert Executor",id:"task-31---insert-executor",level:3},{value:"Task 3.2 - Commit",id:"task-32---commit",level:3},{value:"Task 3.3 - Generate Undo Log",id:"task-33---generate-undo-log",level:3},{value:"Task 3.4 - Update &amp; Delete Executor",id:"task-34---update--delete-executor",level:3},{value:"Task 3.5 - Stop-the-world Garbage Collection",id:"task-35---stop-the-world-garbage-collection",level:3},{value:"Task 4 - Primary Key Index",id:"task-4---primary-key-index",level:2},{value:"Task 4.1 - Index Insert",id:"task-41---index-insert",level:3},{value:"Task 4.2 - Index Scan, Delete, &amp; Update",id:"task-42---index-scan-delete--update",level:3},{value:"Task 4.3 - Primary Key Updates",id:"task-43---primary-key-updates",level:3},{value:"Bonus 1 - Abort",id:"bonus-1---abort",level:2},{value:"Bonus 2 - Serializable Verification",id:"bonus-2---serializable-verification",level:2},{value:"Submit",id:"submit",level:2},{value:"Takeaways",id:"takeaways",level:2},{value:"References",id:"references",level:2}];function o(e){const n={a:"a",annotation:"annotation",code:"code",h2:"h2",h3:"h3",li:"li",math:"math",mi:"mi",mo:"mo",mrow:"mrow",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,c.R)(),...e.components},{Head:s,ImageModal:t}=n;return s||h("Head",!0),t||h("ImageModal",!0),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s,{children:(0,d.jsx)("title",{children:"CMU 15-445 2024Fall P4 Concurrency Control"})}),"\n",(0,d.jsx)(n.p,{children:"\u5728\u9019\u500b project \u4e2d\uff0c\u6211\u5011\u9700\u8981\u5be6\u73fe transaction \u8ddf MVCC\uff0c\u7e3d\u5171\u6709 4 \u500b task \u8ddf 2 \u500b bonus :"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Timestamps"}),"\n",(0,d.jsx)(n.li,{children:"Storage Format and Sequential Scan"}),"\n",(0,d.jsx)(n.li,{children:"MVCC Executors"}),"\n",(0,d.jsx)(n.li,{children:"Primary Key Index"}),"\n",(0,d.jsx)(n.li,{children:"Abort"}),"\n",(0,d.jsx)(n.li,{children:"Serializable Verification"}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,d.jsx)(n.p,{children:"\u5728\u958b\u59cb\u5be6\u4f5c\u4e4b\u524d\uff0c\u6211\u5011\u9700\u8981\u5148\u4e86\u89e3\u4e00\u4e9b\u8ddf\u9019\u500b project \u6709\u95dc\u7684 class\uff0c\u4e3b\u8981\u662f\u95dc\u65bc transaction \u8ddf MVCC \u7684\u90e8\u5206\u3002"}),"\n",(0,d.jsx)(t,{src:"/img/cmu15-445/p4/transaction.webp",caption:"Transaction Class"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"TransactionManager"})," \u662f\u5168\u5c40\u7684\u4ea4\u6613\u7ba1\u7406\u5668\uff0c\u8ca0\u8cac\u5982\u958b\u59cb\u4ea4\u6613\u3001\u63d0\u4ea4\u4ea4\u6613\u3001\u56de\u6efe\u4ea4\u6613\u7b49\u529f\u80fd\uff0c\u4e5f\u8ca0\u8cac\u7ba1\u7406 id \u7684\u5206\u914d\u8ddf\u56de\u6536\u3002\n\u88e1\u9762\u4e3b\u8981\u6703\u7528\u5230\u7684\u6210\u54e1\u5305\u542b\u4e86 ",(0,d.jsx)(n.code,{children:"txn_map_"}),"\u3001",(0,d.jsx)(n.code,{children:"version_info_"}),"\u3001",(0,d.jsx)(n.code,{children:"watermark_"})," \u7b49\u7b49\u3002\n",(0,d.jsx)(n.code,{children:"txn_map_"})," \u7528\u65bc\u8a18\u9304\u6240\u6709\u7684\u4ea4\u6613\uff0c",(0,d.jsx)(n.code,{children:"version_info_"})," \u7528\u65bc\u8a18\u9304\u6bcf\u500b tuple \u7684\u7248\u672c\u8cc7\u8a0a\uff0c",(0,d.jsx)(n.code,{children:"watermark_"})," \u7528\u65bc\u8a18\u9304\u76ee\u524d\u6240\u6709\u6d3b\u8e8d\u4ea4\u6613\u4e2d\u6700\u5c0f\u7684 ",(0,d.jsx)(n.code,{children:"read_ts"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Transaction"})," \u985e\u5225\u4ee3\u8868\u4e00\u500b\u4ea4\u6613\uff0c\u5305\u542b\u4ea4\u6613\u7684\u72c0\u614b (RUNNING\u3001TAINTED\u3001COMMITTED\u3001ABORTED)\u3001\u9694\u96e2\u7d1a\u5225 (SI & Serializable)\u3001\u958b\u59cb\u6642\u9593\u6233 (read_ts)\u3001\u7d50\u675f\u6642\u9593\u6233 (commit_ts) \u7b49\u8cc7\u8a0a\u3002\n\u6bcf\u500b\u4ea4\u6613\u5728\u958b\u59cb\u6642\u6703\u88ab\u5206\u914d\u4e00\u500b\u552f\u4e00\u7684 ",(0,d.jsx)(n.code,{children:"txn_id"}),"\uff0c\u4e26\u4e14\u6703\u6709 ",(0,d.jsx)(n.code,{children:"write_set_"})," \u8ddf ",(0,d.jsx)(n.code,{children:"scan_predicates_"})," \u6210\u54e1\uff0c\u5206\u5225\u7528\u65bc\u8a18\u9304\u8a72\u4ea4\u6613\u6240\u505a\u7684\u5beb\u5165\u64cd\u4f5c\u4ee5\u53ca\u6383\u63cf\u64cd\u4f5c\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9664\u6b64\u4e4b\u5916\uff0c",(0,d.jsx)(n.code,{children:"Transaction"})," \u9084\u6703\u7d00\u9304\u5b83\u7684\u6bcf\u4e00\u689d ",(0,d.jsx)(n.code,{children:"UndoLog"}),"\uff0c\u9019\u500b log \u7528\u65bc\u67e5\u770b\u820a\u7248\u672c\u7684 tuple\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"UndoLog"})," \u5305\u542b\u4e86\u4ee5\u4e0b\u7684\u8cc7\u8a0a (",(0,d.jsx)(n.strong,{children:"\u975e\u5e38\u91cd\u8981"}),") :"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"is_deleted_"})," : ",(0,d.jsx)(n.code,{children:"bool"}),"\uff0c\u7528\u65bc\u6a19\u8a18\u524d\u4e00\u500b\u7248\u672c\u7684 tuple \u662f\u5426\u88ab\u522a\u9664\u3002\u5982\u679c\u64cd\u4f5c\u662f INSERT\uff0c",(0,d.jsx)(n.code,{children:"is_deleted_"})," \u5c31\u6703\u662f true\uff0c\u8868\u793a\u4e0a\u4e00\u500b\u7248\u672c\u4e0d\u5b58\u5728"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"modified_fields_"})," : ",(0,d.jsx)(n.code,{children:"vector<bool>"}),"\uff0c\u7528\u65bc\u6a19\u8a18\u54ea\u4e9b\u6b04\u4f4d\u88ab\u4fee\u6539\u904e\u3002\u5047\u5982\u6709 3 \u500b\u6b04\u4f4d\uff0c",(0,d.jsx)(n.code,{children:"modified_fields_"})," \u53ef\u80fd\u6703\u662f ",(0,d.jsx)(n.code,{children:"[true, false, true]"}),"\uff0c\u8868\u793a\u7b2c 0 \u8ddf\u7b2c 2 \u500b\u6b04\u4f4d\u88ab\u4fee\u6539\u904e"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"tuple_"})," : ",(0,d.jsx)(n.code,{children:"Tuple"}),"\uff0c\u7d00\u9304\u4e0a\u4e00\u500b\u7248\u672c\u7684 tuple\uff0c\u5167\u5bb9\u6703\u4f9d\u64da ",(0,d.jsx)(n.code,{children:"modified_fields_"})," \u4f86\u6c7a\u5b9a\u6709\u54ea\u4e9b\u6b04\u4f4d\u3002\u5047\u5982 ",(0,d.jsx)(n.code,{children:"modified_fields_"})," \u662f ",(0,d.jsx)(n.code,{children:"[true, false, true]"}),"\uff0c\u90a3 ",(0,d.jsx)(n.code,{children:"tuple_"})," \u53ea\u6703\u5305\u542b\u7b2c 0 \u8ddf\u7b2c 2 \u500b\u6b04\u4f4d\u7684\u503c"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"ts_"})," : ",(0,d.jsx)(n.code,{children:"timestamp_t"}),"\uff0c\u5275\u5efa\u9019\u500b log \u7684 transaction \u7684 commit timestamp"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"prev_version_"})," : ",(0,d.jsx)(n.code,{children:"UndoLink"}),"\uff0c\u6307\u5411\u524d\u4e00\u500b\u7248\u672c\u7684 ",(0,d.jsx)(n.code,{children:"UndoLog"}),"\u3002",(0,d.jsx)(n.code,{children:"UndoLink"})," \u5305\u542b\u4e86 ",(0,d.jsx)(n.code,{children:"prev_txn_"})," (",(0,d.jsx)(n.code,{children:"txn_id"}),") \u8ddf ",(0,d.jsx)(n.code,{children:"prev_log_idx_"}),"\uff0c\u8868\u793a\u9019\u500b log \u7684\u4e0a\u4e00\u7248\u662f\u7531\u90a3\u500b transaction \u7684\u7b2c\u5e7e\u689d ",(0,d.jsx)(n.code,{children:"UndoLog"})," \u6240\u5275\u5efa\u7684"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"task-1---timestamps",children:"Task 1 - Timestamps"}),"\n",(0,d.jsx)(n.h3,{id:"task-11-timestamp-allocation",children:"Task 1.1 Timestamp Allocation"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500b task \u4e3b\u8981\u662f\u8981\u7406\u89e3 timestamp \u7684\u5206\u914d\u65b9\u5f0f\u3002"}),"\n",(0,d.jsxs)(n.p,{children:["\u6bcf\u4e00\u500b\u4ea4\u6613\u90fd\u6709\u5169\u500b timestamp\uff0c",(0,d.jsx)(n.code,{children:"read_ts"})," \u8ddf ",(0,d.jsx)(n.code,{children:"commit_ts"}),"\u3002\n\u5728\u4ea4\u6613\u958b\u59cb\u6642\uff0c\u6703\u5206\u914d\u4e00\u500b ",(0,d.jsx)(n.code,{children:"read_ts"}),"\uff0c\u9019\u500b timestamp \u662f\u76ee\u524d\u5df2\u63d0\u4ea4\u7684\u6700\u5927 timestamp\u3002\n\u5728\u4ea4\u6613\u63d0\u4ea4\u6642\uff0c\u6703\u5206\u914d\u4e00\u500b ",(0,d.jsx)(n.code,{children:"commit_ts"}),"\uff0c\u9019\u500b timestamp \u662f\u76ee\u524d\u5df2\u63d0\u4ea4\u7684\u6700\u5927 timestamp \u52a0\u4e00\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u4e5f\u5c31\u662f\u8aaa\uff0c\u5982\u679c\u4e00\u500b\u4ea4\u6613\u7684 ",(0,d.jsx)(n.code,{children:"read_ts"})," \u662f 5\uff0c\u90a3\u9ebc\u5b83\u53ea\u80fd\u770b\u5230 ",(0,d.jsx)(n.code,{children:"commit_ts"})," \u5c0f\u65bc\u7b49\u65bc 5 \u7684\u7248\u672c\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u6211\u5011\u8981\u505a\u7684\u4e8b\u60c5\u5c31\u662f\u628a\u9019\u4e9b\u908f\u8f2f\u52a0\u5230 ",(0,d.jsx)(n.code,{children:"TransactionManager::Begin"})," \u8ddf ",(0,d.jsx)(n.code,{children:"TransactionManager::Commit"})," \u88e1\u9762\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"task-12-watermark",children:"Task 1.2 Watermark"}),"\n",(0,d.jsxs)(n.p,{children:["Watermark \u4e3b\u8981\u662f\u7528\u4f86\u8ffd\u8e64\u6240\u6709\u9084\u6c92 Abort \u6216 Commit \u7684\u4ea4\u6613\u4e2d\uff0c\u6700\u5c0f\u7684 ",(0,d.jsx)(n.code,{children:"read_ts"}),"\uff0c\u5982\u679c\u6c92\u6709\u4efb\u4f55\u4ea4\u6613\u5728\u57f7\u884c\uff0cwatermark \u5c31\u6703\u662f ",(0,d.jsx)(n.code,{children:"commit_ts"}),"\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500b class \u4e3b\u8981\u662f\u8a2d\u8a08\u7528\u4f86\u5e6b\u52a9 task 3.5 \u7684 garbage collection\uff0c\u7576\u6211\u5011\u8981\u56de\u6536\u820a\u7248\u672c\u6642\uff0cwatermark \u53ef\u4ee5\u544a\u8a34\u6211\u5011\u90a3\u4e9b\u7248\u672c\u5df2\u7d93\u4e0d\u6703\u518d\u88ab\u4efb\u4f55\u4ea4\u6613\u4f7f\u7528\u4e86\u3002"}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u88e1\u6211\u4f7f\u7528\u4e86\u6700\u7c21\u55ae\u7684 ",(0,d.jsxs)(n.span,{className:"katex",children:[(0,d.jsx)(n.span,{className:"katex-mathml",children:(0,d.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,d.jsxs)(n.semantics,{children:[(0,d.jsxs)(n.mrow,{children:[(0,d.jsx)(n.mi,{children:"O"}),(0,d.jsx)(n.mo,{stretchy:"false",children:"("}),(0,d.jsx)(n.mi,{children:"l"}),(0,d.jsx)(n.mi,{children:"o"}),(0,d.jsx)(n.mi,{children:"g"}),(0,d.jsx)(n.mo,{stretchy:"false",children:"("}),(0,d.jsx)(n.mi,{children:"n"}),(0,d.jsx)(n.mo,{stretchy:"false",children:")"}),(0,d.jsx)(n.mo,{stretchy:"false",children:")"})]}),(0,d.jsx)(n.annotation,{encoding:"application/x-tex",children:"O(log(n))"})]})})}),(0,d.jsx)(n.span,{className:"katex-html","aria-hidden":"true",children:(0,d.jsxs)(n.span,{className:"base",children:[(0,d.jsx)(n.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,d.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"O"}),(0,d.jsx)(n.span,{className:"mopen",children:"("}),(0,d.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,d.jsx)(n.span,{className:"mord mathnormal",children:"o"}),(0,d.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"}),(0,d.jsx)(n.span,{className:"mopen",children:"("}),(0,d.jsx)(n.span,{className:"mord mathnormal",children:"n"}),(0,d.jsx)(n.span,{className:"mclose",children:"))"})]})})]})," \u7684\u65b9\u6cd5\u4f86\u5be6\u4f5c\uff0c\u5c31\u662f\u628a\u5132\u5b58\u7684\u65b9\u5f0f\u6539\u6210 ",(0,d.jsx)(n.code,{children:"std::map"}),"\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"task-2---storage-format-and-sequential-scan",children:"Task 2 - Storage Format and Sequential Scan"}),"\n",(0,d.jsx)(n.h3,{id:"task-21---tuple-reconstruction",children:"Task 2.1 - Tuple Reconstruction"}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u500b task \u7684\u76ee\u6a19\u662f\u5be6\u4f5c ",(0,d.jsx)(n.code,{children:"ReconstructTuple"}),"\u3002\n\u9019\u500b\u51fd\u6578\u662f\u6839\u64da tuple \u73fe\u5728\u7684\u60c5\u6cc1\u8ddf ",(0,d.jsx)(n.code,{children:"UndoLog"})," \u4f86\u9084\u539f\u51fa\u4ea4\u6613\u958b\u59cb\u6642\u7684 tuple\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u6211\u8a8d\u70ba\u9700\u8981\u6ce8\u610f\u7684\u662f ",(0,d.jsx)(n.code,{children:"UndoLog"})," \u7684\u9806\u5e8f\u662f\u5f9e\u65b0\u5230\u820a\uff0c\u4ee5\u53ca ",(0,d.jsx)(n.code,{children:"is_deleted_"})," \u4ee3\u8868\u7684\u662f\u4e0a\u4e00\u500b\u7248\u672c\u7684 tuple \u662f\u5426\u88ab\u522a\u9664\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u88e1\u6211\u7684\u5be6\u4f5c\u9806\u5e8f\u5982\u4e0b :"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\u6aa2\u67e5 ",(0,d.jsx)(n.code,{children:"undo_logs"})," \u662f\u5426\u70ba\u7a7a\uff0c\u5982\u679c\u662f\u7a7a\u7684\u4e14\u6c92\u6709\u88ab\u522a\u9664\uff0c\u76f4\u63a5\u56de\u50b3\u7576\u524d\u7684 tuple"]}),"\n",(0,d.jsxs)(n.li,{children:["\u627e\u5230\u6700\u5f8c\u4e00\u500b ",(0,d.jsx)(n.code,{children:"is_deleted_"})," \u70ba true \u7684 log\uff0c\u9019\u4ee3\u8868\u5f9e index 0 \u5230\u9019\u500b log \u7684 tuple \u90fd\u6c92\u6709\u7528\uff0c\u5982\u679c\u9019\u662f\u6700\u5f8c\u4e00\u500b log\uff0c\u4ee3\u8868\u9019\u500b tuple \u662f\u88ab\u522a\u9664\u7684\uff0c\u76f4\u63a5\u56de\u50b3 ",(0,d.jsx)(n.code,{children:"std::nullopt"})]}),"\n",(0,d.jsxs)(n.li,{children:["\u5f9e\u4e0b\u4e00\u500b log \u958b\u59cb\uff0c\u4f9d\u5e8f\u628a ",(0,d.jsx)(n.code,{children:"modified_fields_"})," \u70ba true \u7684\u6b04\u4f4d\u5f9e ",(0,d.jsx)(n.code,{children:"undo_logs"})," \u8907\u88fd\u5230 ",(0,d.jsx)(n.code,{children:"tuple"})," \u4e0a"]}),"\n",(0,d.jsxs)(n.li,{children:["\u5982\u679c\u9084\u662f\u9019\u500b\u6b04\u4f4d\u5fa9\u539f\u5230\u6700\u5f8c\u90fd\u6c92\u6709\u503c\uff0c\u76f4\u63a5\u586b ",(0,d.jsx)(n.code,{children:"base_tuple"})," \u4e0a\u7684\u503c (\u9019\u4ee3\u8868\u4e2d\u9593\u90fd\u6c92\u6709 ",(0,d.jsx)(n.code,{children:"is_deleted_"})," \u70ba true \u4e5f\u6c92\u6709\u88ab\u4fee\u6539\u904e)"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"task-22---sequential-scan-tuple-retrieval",children:"Task 2.2 - Sequential Scan (Tuple Retrieval)"}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u500b task \u662f\u8981\u642d\u914d ",(0,d.jsx)(n.code,{children:"ReconstructTuple"})," \u4f86\u5be6\u4f5c ",(0,d.jsx)(n.code,{children:"CollectUndoLogs"})," \u4e26\u4e14\u628a project 3 \u88e1\u9762\u7684 ",(0,d.jsx)(n.code,{children:"SeqScanExecutor"})," \u6539\u6210\u652f\u63f4 MVCC\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u908a\u9700\u8981\u5148\u7406\u89e3\u4e00\u4e0b bustub \u7684 timestamp \u5206\u914d\u65b9\u5f0f\u3002\ntimestamp \u5206\u70ba\u5169\u7a2e\uff0c\u4e00\u7a2e\u662f commit \u904e\u5f8c\u7684 timestamp (",(0,d.jsx)(n.code,{children:"ts < TXN_START_ID"}),")\uff0c\u53e6\u4e00\u7a2e\u662f\u9084\u6c92 commit \u7684 timestamp (",(0,d.jsx)(n.code,{children:"ts >= TXN_START_ID"}),")\uff0c\u9084\u6c92 commit \u7684\u53ef\u4ee5\u7528 ",(0,d.jsx)(n.code,{children:"GetTransactionTempTs()"})," \u4f86\u53d6\u5f97\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"CollectUndoLogs"})," \u7684\u5be6\u4f5c\u908f\u8f2f\u5f88\u7c21\u55ae\uff0c\u5c31\u662f\u5f9e\u6700\u65b0\u7684 ",(0,d.jsx)(n.code,{children:"UndoLog"})," \u958b\u59cb\u5f80\u524d\u627e\uff0c\u76f4\u5230\u8490\u96c6\u597d\u6240\u6709\u8981\u56de\u6efe\u7684 log \u5373\u53ef\u3002\n\u53ef\u898b\u6027\u5224\u65b7\u908f\u8f2f\u9664\u4e86\u8981 ",(0,d.jsx)(n.code,{children:"GetReadTs() >= ts"})," \u4e4b\u5916\uff0c\u9084\u8981\u8003\u616e\u5230\u662f\u4e0d\u662f\u81ea\u5df1\u4fee\u6539\u904e\u7684 ",(0,d.jsx)(n.code,{children:"GetTransactionTempTs() == ts"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u63a5\u8457\u56de\u5230 ",(0,d.jsx)(n.code,{children:"SeqScanExecutor"}),"\uff0c\u9019\u908a\u7684\u5be6\u4f5c\u908f\u8f2f\u4e5f\u6bd4\u8f03\u7c21\u55ae\uff0c\u5c31\u662f\u628a ",(0,d.jsx)(n.code,{children:"CollectUndoLogs"})," \u8ddf ",(0,d.jsx)(n.code,{children:"ReconstructTuple"})," \u4e32\u8d77\u4f86\u5373\u53ef\uff0c\u62ff metadata \u7684\u65b9\u6cd5\u53ef\u4ee5\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"GetTupleAndUndoLink()"}),"\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"task-3---mvcc-executors",children:"Task 3 - MVCC Executors"}),"\n",(0,d.jsx)(n.h3,{id:"task-31---insert-executor",children:"Task 3.1 - Insert Executor"}),"\n",(0,d.jsxs)(n.p,{children:["\u4e00\u6a23\u662f\u4fee\u6539 project 3 \u88e1\u9762\u7684 ",(0,d.jsx)(n.code,{children:"InsertExecutor"}),"\uff0c\u4e3b\u8981\u4fee\u6539\u7684\u5730\u65b9\u5c31\u662f timestamp \u8ddf\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"AppendWriteSet()"})," \u4f86\u628a\u6709\u4fee\u6539\u7684 RID \u52a0\u5165\u5230 ",(0,d.jsx)(n.code,{children:"write_set_"})," \u88e1\u9762\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u7531\u65bc insert \u662f\u63d2\u5165\u5230\u65b0\u7684 RID\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u751f\u6210 ",(0,d.jsx)(n.code,{children:"UndoLog"}),"\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"task-32---commit",children:"Task 3.2 - Commit"}),"\n",(0,d.jsxs)(n.p,{children:["\u8ddf\u8457\u4f5c\u696d\u8aaa\u660e\u505a\u5c31\u597d\uff0c\u4e3b\u8981\u5c31\u662f\u5728 ",(0,d.jsx)(n.code,{children:"Commit"})," \u88e1\u9762\u904d\u6b77 ",(0,d.jsx)(n.code,{children:"write_set_"}),"\uff0c\u7136\u5f8c\u66f4\u65b0 timestamp\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9664\u6b64\u4e4b\u5916\u8aaa\u660e\u88e1\u9762\u9084\u6709\u8aaa\u53ef\u4ee5\u81ea\u5df1\u5be6\u73fe\u4e00\u500b ",(0,d.jsx)(n.code,{children:"TxnMgrDbg"}),"\uff0c\u6211\u500b\u4eba\u89ba\u5f97\u9019\u500b\u6771\u897f\u9084\u883b\u6709\u7528\u7684\uff0c\u4f46\u5beb\u8d77\u4f86\u4e5f\u662f\u5f88\u9ebb\u7169\uff0c\u6240\u4ee5\u6211\u76f4\u63a5\u4e1f\u7d66 AI \u4e86..."]}),"\n",(0,d.jsx)(n.h3,{id:"task-33---generate-undo-log",children:"Task 3.3 - Generate Undo Log"}),"\n",(0,d.jsxs)(n.p,{children:["\u5be6\u4f5c ",(0,d.jsx)(n.code,{children:"GenerateNewUndoLog"})," \u8ddf ",(0,d.jsx)(n.code,{children:"GenerateUpdatedUndoLog"}),"\uff0c\u9019\u5169\u500b\u51fd\u6578\u5167\u5bb9\u4e0d\u8907\u96dc\uff0c\u53ef\u4ee5\u5206\u6210 insert\u3001 delete\u3001 update \u4e09\u7a2e\u60c5\u6cc1\u4f86\u8655\u7406\u3002"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Insert : \u50b3\u5165\u7684 ",(0,d.jsx)(n.code,{children:"base_tuple"})," \u662f\u7a7a\u7684\uff0c\u56de\u50b3\u4e00\u500b ",(0,d.jsx)(n.code,{children:"is_deleted_=true"})," \u7684 ",(0,d.jsx)(n.code,{children:"UndoLog"})]}),"\n",(0,d.jsxs)(n.li,{children:["Delete : \u50b3\u5165\u7684 ",(0,d.jsx)(n.code,{children:"target_tuple"})," \u662f\u7a7a\u7684\uff0c\u56de\u50b3 ",(0,d.jsx)(n.code,{children:"is_deleted_=false"})," \u4e26\u4e14\u9700\u8981\u4fee\u6539 ",(0,d.jsx)(n.code,{children:"modified_fields_"})," \u8ddf ",(0,d.jsx)(n.code,{children:"tuple_"})]}),"\n",(0,d.jsxs)(n.li,{children:["Update : \u56de\u50b3 ",(0,d.jsx)(n.code,{children:"is_deleted_=false"}),"\uff0c\u4e26\u8ddf\u64da ",(0,d.jsx)(n.code,{children:"target_tuple"})," \u8ddf ",(0,d.jsx)(n.code,{children:"base_tuple"})," \u4f86\u6c7a\u5b9a ",(0,d.jsx)(n.code,{children:"modified_fields_"})," \u8ddf ",(0,d.jsx)(n.code,{children:"tuple_"})]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u5176\u4ed6\u7684\u90e8\u5206\u5c31\u7167\u8457\u4f5c\u696d\u8aaa\u660e\u505a\u5c31\u597d\uff0c\u4e3b\u8981\u5c31\u662f\u8981\u628a tuple \u62fc\u8d77\u4f86\u6709\u9ede\u9ebb\u7169\u3002"}),"\n",(0,d.jsx)(n.h3,{id:"task-34---update--delete-executor",children:"Task 3.4 - Update & Delete Executor"}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u88e1\u4e00\u6a23\u662f\u4fee\u6539 project 3 \u88e1\u9762\u7684 ",(0,d.jsx)(n.code,{children:"UpdateExecutor"})," \u8ddf ",(0,d.jsx)(n.code,{children:"DeleteExecutor"}),"\uff0c\u4e3b\u8981\u5c31\u662f\u4f7f\u7528 task 3.3 \u88e1\u9762\u7684 ",(0,d.jsx)(n.code,{children:"GenerateUpdatedUndoLog"})," \u8ddf ",(0,d.jsx)(n.code,{children:"GenerateNewUndoLog"})," \u4f86\u751f\u6210\u8ddf\u4fee\u6539 ",(0,d.jsx)(n.code,{children:"UndoLog"}),"\uff0c\u4e26\u4e14\u628a\u6709\u4fee\u6539\u7684 RID \u52a0\u5165\u5230 ",(0,d.jsx)(n.code,{children:"write_set_"})," \u88e1\u9762\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u90e8\u5206\u90fd\u9084\u5148\u4e0d\u7528\u7406\u6709\u95dc index \u7684\u90e8\u5206\uff0c\u4f46\u9700\u8981\u6aa2\u67e5 WW \u885d\u7a81\u3002\n\u6709\u5169\u7a2e\u60c5\u6cc1\uff0c\u7b2c\u4e00\u7a2e\u662f ",(0,d.jsx)(n.code,{children:"meta.ts_ > TXN_START_ID && meta.ts_ != txn->GetTransactionTempTs()"}),"\uff0c\u9019\u4ee3\u8868\u9019\u500b tuple \u5df2\u7d93\u88ab\u5176\u4ed6\u672a\u63d0\u4ea4\u7684\u4ea4\u6613\u4fee\u6539\u904e\u4e86\u3002\n\u7b2c\u4e8c\u7a2e\u662f ",(0,d.jsx)(n.code,{children:"meta.ts_ < TXN_START_ID && meta.ts_ > txn->GetReadTs()"}),"\uff0c\u9019\u4ee3\u8868\u9019\u500b tuple \u5df2\u7d93\u88ab\u5176\u4ed6\u5df2\u63d0\u4ea4\u4e14\u66f4\u665a\u7684\u4ea4\u6613\u4fee\u6539\u904e\u4e86\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"task-35---stop-the-world-garbage-collection",children:"Task 3.5 - Stop-the-world Garbage Collection"}),"\n",(0,d.jsx)(n.p,{children:"\u70ba\u4e86\u964d\u4f4e\u4f75\u767c\u7684\u8907\u96dc\u5ea6\uff0cbustub \u63a1\u7528\u7684\u662f stop-the-world \u7684\u5783\u573e\u56de\u6536\u6a5f\u5236\uff0c\u53ea\u6703\u5728\u6240\u6709\u4ea4\u6613\u90fd\u7d50\u675f\u5f8c\u624d\u6703\u9032\u884c\u5783\u573e\u56de\u6536\u3002"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500b task \u6703\u7d50\u5408\u6211\u5011\u5728 task 1.2 \u5be6\u4f5c\u7684 watermark\uff0c\u9019\u88e1\u6211\u81ea\u5df1\u5206\u6210\u4e09\u500b\u6b65\u9a5f :"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u904d\u6b77 ",(0,d.jsx)(n.code,{children:"txn_map_"})," \u8ddf ",(0,d.jsx)(n.code,{children:"write_set_"}),"\uff0c\u628a\u5df2\u7d93 commit \u6216 abort \u7684\u4ea4\u6613\u4e2d\u6709\u4fee\u6539\u904e\u7684 RID \u5168\u90e8\u8490\u96c6\u8d77\u4f86\uff0c\u5efa\u7acb\u4e00\u500b ",(0,d.jsx)(n.code,{children:"unordered_map<txn_id_t, unordered_map<table_oid_t, unordered_set<RID>>>"})," \u7684\u6620\u5c04"]}),"\n",(0,d.jsxs)(n.li,{children:["\u7d00\u9304\u4e0d\u80fd\u88ab\u522a\u9664\u7684 txn (",(0,d.jsx)(n.code,{children:"unordered_set"}),")\uff0c\u6aa2\u67e5 ",(0,d.jsx)(n.code,{children:"watermark <= meta.ts_"}),"\uff0c\u5982\u679c\u662f\u7684\u8a71\u5c31\u628a\u9019\u500b txn \u52a0\u5165\u5230\u4e0d\u53ef\u522a\u9664\u7684\u96c6\u5408\u88e1\u9762\uff0c\u63a5\u8457\u518d\u904d\u6b77\u9019\u500b RID \u7684 ",(0,d.jsx)(n.code,{children:"UndoLog"})," \u627e\u51fa ",(0,d.jsx)(n.code,{children:"watermark <= undo_log->ts_"})," \u7684\u4e5f\u52a0\u5165\u4e0d\u53ef\u522a\u9664\u7684\u96c6\u5408"]}),"\n",(0,d.jsxs)(n.li,{children:["\u6700\u5f8c\u904d\u6b77 ",(0,d.jsx)(n.code,{children:"txn_map_"}),"\uff0c\u5982\u679c\u662f COMMITTED \u6216 ABORTED \u7136\u5f8c\u53c8\u4e0d\u5728\u4e0d\u53ef\u522a\u9664\u7684 txn \u88e1\u9762\uff0c\u5c31\u53ef\u4ee5\u628a\u9019\u500b txn \u522a\u6389"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"task-4---primary-key-index",children:"Task 4 - Primary Key Index"}),"\n",(0,d.jsx)(n.h3,{id:"task-41---index-insert",children:"Task 4.1 - Index Insert"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500b task \u4e3b\u8981\u76ee\u6a19\u662f\u8b93 Insert \u64cd\u4f5c\u53ef\u4ee5\u5728\u4f75\u767c\u74b0\u5883\u4e0b\u6b63\u78ba\u7684\u8655\u7406\u4e3b\u9375\u7684\u885d\u7a81\u3002"}),"\n",(0,d.jsxs)(n.p,{children:["\u53ef\u4ee5\u5148\u900f\u904e ",(0,d.jsx)(n.code,{children:"index_info->index_->GetMetadata()->IsPrimaryKey()"})," \u62ff\u5230 primary key index \u7684\u8cc7\u8a0a\uff0c\u63a5\u8457\u5728\u8b80\u8cc7\u6599\u7684\u6642\u5019\u5148\u6aa2\u67e5\u9019\u500b key \u662f\u4e0d\u662f\u5df2\u7d93\u5b58\u5728\u4e86\uff0c\u5982\u679c\u5b58\u5728\u5c31\u628a\u72c0\u614b\u6539\u6210 TAINTED \u4e26\u62cb\u932f\u5373\u53ef\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u90a3\u5c31\u5e36\u8457\u81e8\u6642\u7684 timestamp \u76f4\u63a5\u63d2\u5165\uff0c\u4e26\u4e14\u547c\u53eb ",(0,d.jsx)(n.code,{children:"InsertEntry()"})," \u4f86\u63d2\u5165 index\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u4e5f\u8981\u6ce8\u610f\u8655\u7406 ",(0,d.jsx)(n.code,{children:"InsertEntry()"})," \u56de\u50b3 false \u7684\u60c5\u6cc1\uff0c\u9019\u4ee3\u8868\u6709\u5176\u4ed6\u4ea4\u6613\u5df2\u7d93\u63d2\u5165\u4e86\u76f8\u540c\u7684 key\uff0c\u8655\u7406\u65b9\u5f0f\u8ddf\u524d\u9762\u4e00\u6a23\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"task-42---index-scan-delete--update",children:"Task 4.2 - Index Scan, Delete, & Update"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500b task \u4e3b\u8981\u662f\u8b93\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u80fd\u652f\u6301 MVCC (\u5305\u62ec Index Scan\u3001Delete\u3001Update\u3001Insert)\u3002"}),"\n",(0,d.jsx)(n.p,{children:"\u70ba\u4e86\u8b93\u7d22\u5f15\u53ef\u4ee5\u652f\u63f4\u904e\u53bb\u7684\u8cc7\u6599\uff0cbustub \u898f\u5b9a\u7d22\u5f15\u4e00\u65e6\u88ab\u5275\u5efa\u5c31\u6c38\u9060\u4e0d\u6703\u88ab\u7269\u7406\u522a\u9664\uff0c\u6240\u4ee5\u9019\u500b task \u9700\u8981\u4fee\u6539\u6240\u6709\u7684 executors\u3002"}),"\n",(0,d.jsxs)(n.p,{children:["\u9996\u5148\uff0c\u5728 project 3 \u4e2d\u7684 ",(0,d.jsx)(n.code,{children:"DeleteExecutor"})," \u9700\u8981\u628a ",(0,d.jsx)(n.code,{children:"TupleMeta"})," \u7684 ",(0,d.jsx)(n.code,{children:"is_deleted_"})," \u6539\u6210 true\uff0c\u4e26\u4e14\u8981\u628a\u7d22\u5f15\u4e5f\u522a\u6389\u3002\n\u800c\u73fe\u5728\u9700\u8981\u628a\u522a\u9664\u7d22\u5f15\u7684\u90a3\u90e8\u5206\u5b8c\u5168\u79fb\u9664\uff0c\u53ea\u9700\u8981\u628a ",(0,d.jsx)(n.code,{children:"TupleMeta"})," \u7684 ",(0,d.jsx)(n.code,{children:"is_deleted_"})," \u6539\u6210 true \u5373\u53ef\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u63a5\u8457\u662f INSERT \u7684\u90e8\u5206\uff0c\u5728 task 4.1 \u4e2d\u6211\u5011\u6709\u63d0\u5230\u8981\u5148\u6aa2\u67e5\u4e3b\u9375\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u5b58\u5728\u5c31\u8981\u628a\u72c0\u614b\u6539\u6210 TAINTED \u4e26\u62cb\u932f\u3002\n\u800c\u73fe\u5728\u9700\u8981\u6539\u6210\u5982\u679c\u9019\u500b\u9375\u5b58\u5728\u4e14\u6c92\u6709\u88ab\u522a\u9664 (",(0,d.jsx)(n.code,{children:"meta.is_deleted_ == false"}),")\uff0c\u624d\u628a\u72c0\u614b\u6539\u6210 TAINTED \u4e26\u62cb\u932f\uff0c\u5982\u679c\u9019\u500b\u9375\u5b58\u5728\u4f46\u88ab\u522a\u9664 (",(0,d.jsx)(n.code,{children:"meta.is_deleted_ == true"}),")\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5 reuse \u9019\u500b RID\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["Index scan \u7684\u90e8\u5206\u53ef\u4ee5\u53c3\u8003 task 2.2 \u7684 ",(0,d.jsx)(n.code,{children:"SeqScanExecutor"})," \u4f86\u5be6\u4f5c\uff0c\u5dee\u5225\u5728\u65bc\u8981\u5148\u5f9e index \u88e1\u9762\u53d6\u5f97 RID\uff0c\u4e5f\u662f\u4e00\u6a23\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"CollectUndoLogs"})," \u8ddf ",(0,d.jsx)(n.code,{children:"ReconstructTuple"})," \u4f86\u9084\u539f tuple\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9664\u4e86\u4e0a\u9762\u9019\u5e7e\u500b executors \u4e4b\u5916\uff0c\u6211\u5011\u9084\u9700\u8981\u5be6\u4f5c ",(0,d.jsx)(n.code,{children:"UpdateTupleAndUndoLink()"})," \u88e1\u9762\u7684 check \u51fd\u6578\u4f86\u907f\u514d race condition \u7684\u60c5\u6cc1\u3002\n\u7531\u65bc\u5728\u57f7\u884c ",(0,d.jsx)(n.code,{children:"UpdateTupleAndUndoLink()"})," \u4e4b\u524d\uff0c\u6211\u5011\u61c9\u8a72\u5df2\u7d93\u6aa2\u67e5\u904e WW \u885d\u7a81\u4e86 (by task 3.4)\uff0c\u6240\u4ee5\u9019\u88e1\u53ea\u8981\u6aa2\u67e5 ",(0,d.jsx)(n.code,{children:"meta.ts_ == ts"})," \u5373\u53ef\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"task-43---primary-key-updates",children:"Task 4.3 - Primary Key Updates"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500b task \u4e3b\u8981\u662f\u8981\u8655\u7406 UPDATE \u64cd\u4f5c\uff0c\u91dd\u5c0d primary key \u88ab\u4fee\u6539\u7684\u60c5\u6cc1\u3002"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u88e1\u7684\u908f\u8f2f\u5176\u5be6\u883b\u591a\u7684\uff0c\u4f46\u662f\u7e3d\u9ad4\u4f86\u8aaa\u53ef\u4ee5\u62c6\u6210\u4e00\u6b21\u522a\u9664\u8ddf\u4e00\u6b21\u63d2\u5165\u4f86\u8655\u7406\uff0c\u5177\u9ad4\u5be6\u4f5c\u8ddf task 4.2 \u7684 INSERT \u8ddf DELETE \u5dee\u4e0d\u591a\u3002"}),"\n",(0,d.jsx)(n.h2,{id:"bonus-1---abort",children:"Bonus 1 - Abort"}),"\n",(0,d.jsx)(n.p,{children:"\u7531\u65bc\u5982\u679c\u4ea4\u6613\u5931\u6557\u7684\u8a71\uff0c\u5c31\u6c92\u6709\u5176\u4ed6\u4ea4\u6613\u53ef\u4ee5\u7e7c\u7e8c\u4fee\u6539\u9019\u500b tuple \u4e86\uff0c\u6240\u4ee5\u6211\u5011\u53ea\u9700\u8981\u95dc\u5fc3\u88ab\u4fee\u6539\u904e\u5f8c\u7684 tuple \u6700\u5f8c\u4e00\u6b21\u7684\u72c0\u614b\u5373\u53ef\u3002"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u88e1\u6211\u9078\u64c7\u7684\u662f Implementation #2 \u7684\u505a\u6cd5\uff0c\u6709\u4e09\u7a2e\u60c5\u6cc1 :"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u5982\u679c\u6c92\u6709 ",(0,d.jsx)(n.code,{children:"UndoLink"}),"\uff0c\u4ee3\u8868\u9019\u500b tuple \u662f\u88ab insert \u7684\uff0c\u76f4\u63a5\u63d2\u5165 ",(0,d.jsx)(n.code,{children:"TupleMeta{0, true}"})," \u5373\u53ef"]}),"\n",(0,d.jsxs)(n.li,{children:["\u5982\u679c\u6709 ",(0,d.jsx)(n.code,{children:"UndoLink"}),"\uff0c\u4ee3\u8868\u9019\u500b tuple \u662f\u88ab update \u6216 delete \u7684","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u5982\u679c ",(0,d.jsx)(n.code,{children:"ReconstructTuple"})," \u56de\u50b3\u7a7a\u7684 optional\uff0c\u4ee3\u8868\u9019\u500b tuple \u662f\u88ab delete \u7684\uff0c\u66f4\u65b0\u70ba ",(0,d.jsx)(n.code,{children:"TupleMeta{undo_log.ts_, true}"})," \u5373\u53ef"]}),"\n",(0,d.jsxs)(n.li,{children:["\u5982\u679c ",(0,d.jsx)(n.code,{children:"ReconstructTuple"})," \u56de\u50b3\u6709\u503c\uff0c\u4ee3\u8868\u9019\u500b tuple \u662f\u88ab update \u7684\uff0c\u66f4\u65b0\u70ba ",(0,d.jsx)(n.code,{children:"TupleMeta{undo_log.ts_, false}"})," \u5373\u53ef"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"bonus-2---serializable-verification",children:"Bonus 2 - Serializable Verification"}),"\n",(0,d.jsxs)(n.p,{children:["\u70ba\u4e86\u5be6\u73fe\u53ef\u5e8f\u5217\u5316\uff0c\u6211\u5011\u9700\u8981\u5728 index scan \u8ddf seq scan \u7684\u6642\u5019\u628a predicate \u52a0\u5165\u5230 ",(0,d.jsx)(n.code,{children:"scan_predicates_"})," \u88e1\u9762\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u5be6\u73fe\u7684\u908f\u8f2f\u5982\u4e0b :"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"\u8df3\u904e\u53ea\u8b80\u4ea4\u6613"}),"\n",(0,d.jsx)(n.li,{children:"\u6536\u96c6\u885d\u7a81\u4ea4\u6613 (commit_ts > \u672c txn \u7684 read_ts)"}),"\n",(0,d.jsxs)(n.li,{children:["\u5c0d\u6bcf\u500b\u885d\u7a81\u4ea4\u6613\u7684\u6bcf\u500b table \u7684\u5beb\u96c6\u5408\u505a\u6aa2\u67e5\uff0c\u4e26\u770b\u770b\u5b83\u662f\u5426\u6709\u8ddf\u7576\u524d\u4ea4\u6613\u6383\u63cf\u904e\u7684 predicate \u6709\u4ea4\u96c6 (\u540c\u4e00\u500b ",(0,d.jsx)(n.code,{children:"table_oid_t"}),")"]}),"\n",(0,d.jsxs)(n.li,{children:["\u5c0d\u885d\u7a81\u4ea4\u6613\u4fee\u6539\u7684\u6bcf\u500b RID\uff0c\u53d6\u5f97\u5230 read_ts \u6642\u7684\u6240\u6709 ",(0,d.jsx)(n.code,{children:"UndoLog"})]}),"\n",(0,d.jsxs)(n.li,{children:["\u63a5\u8457\u5c31\u53ef\u4ee5\u5617\u8a66\u5c0d\u9019\u500b RID \u4e0d\u65b7\u7528 ",(0,d.jsx)(n.code,{children:"ReconstructTuple"})," \u4f86\u9084\u539f tuple \u4e26\u6e2c\u8a66\u662f\u5426\u5728 predicate \u7684\u7bc4\u570d\u5167"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"submit",children:"Submit"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"make txn_timestamp_test -j$(nproc) && ./test/txn_timestamp_test\n\nmake txn_scan_test -j$(nproc) && ./test/txn_scan_test\n\nmake txn_executor_test -j$(nproc) && ./test/txn_executor_test\n\nmake txn_index_test -j$(nproc) && ./test/txn_index_test\n\nmake txn_index_concurrent_test -j$(nproc) && ./test/txn_index_concurrent_test\n\nmake txn_abort_serializable_test -j$(nproc) && ./test/txn_abort_serializable_test\n"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"make format && make check-format && make check-lint && make check-clang-tidy-p4\n"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"make submit-p4\n"})}),"\n",(0,d.jsx)(n.h2,{id:"takeaways",children:"Takeaways"}),"\n",(0,d.jsx)(n.p,{children:"\u7d42\u65bc\u5beb\u5b8c\u5168\u90e8\u7684\u7b46\u8a18\u5566~ \u7051\u82b1 \ud83c\udf89"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500b project \u662f\u6211\u82b1\u6700\u4e45\u6642\u9593\u7684\u4e00\u500b\uff0c\u6211\u89ba\u5f97\u4e3b\u8981\u539f\u56e0\u662f\u5f88\u96e3\u627e\u5230 bug \u5728\u54ea\uff0c\u5373\u4f7f\u73fe\u5728\u4ea4\u5230 gradescope \u53ef\u4ee5\u5168\u904e\u6211\u4f9d\u7136\u89ba\u5f97\u6211\u7684\u5f88\u591a\u5be6\u73fe\u7406\u8ad6\u4e0a\u61c9\u8a72\u8981\u6709\u554f\u984c\u624d\u5c0d\uff0c\u4f46\u53cd\u6b63\u6e2c\u8cc7\u770b\u4e0d\u5230\u6211\u4e5f\u7576\u770b\u4e0d\u5230\u597d\u4e86 \ud83e\udee3"}),"\n",(0,d.jsx)(n.p,{children:"\u7e3d\u9ad4\u4f86\u8aaa\u9019\u6b21\u7684 project \u5c31\u662f\u4e00\u500b\u4e0d\u65b7\u91cd\u69cb\u7684\u904e\u7a0b\uff0c\u9664\u4e86\u8981\u56de\u61b6 project #3 \u7684\u5167\u5bb9\u4e4b\u5916\uff0c\u751a\u81f3\u5728\u540c\u4e00\u500b task \u88e1\u9762\u4e5f\u6703\u4e0d\u65b7\u7684\u91cd\u69cb\uff0c\u50cf\u662f task 4 \u5c31\u662f\u4e0d\u65b7\u7684\u91cd\u6539\u53c8\u91cd\u6539\uff0c\u771f\u7684\u662f\u6709\u4e00\u9ede\u7169\u3002\n\u4e0d\u904e\u9019\u6b21\u7684\u5be6\u4f5c\u4f9d\u7136\u8b93\u6211\u5c0d MVCC \u7684\u6574\u9ad4\u6982\u5ff5\u6709\u6bd4\u8f03\u597d\u7684\u7406\u89e3\uff0c\u6536\u7a6b\u9084\u7b97\u662f\u6eff\u5927\u7684\u3002"}),"\n",(0,d.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/10666804837",children:"CMU Fall 2024 15-445 MVCC & SI & P4[\u5f85\u5b8c]"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://4ever-xxxl.github.io/cmu-15445-project-4/",children:"CMU 15445 Project4"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/1932549868683007217",children:"CMU15445-2024fall-project4\u8e29\u5751\u7ecf\u5386"})}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(o,{...e})}):o(e)}function h(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>r});var t=s(6540);const d={},c=t.createContext(d);function i(e){const n=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:i(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);