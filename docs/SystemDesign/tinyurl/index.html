<!doctype html><html lang=zh-Hant dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-SystemDesign/tinyurl" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.1"><title data-rh=true>Design a URL Shortener like TinyURL | RulerChen</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:image content=https://RulerChen.github.io/RulerChen-Website/img/profile/profile.webp /><meta data-rh=true name=twitter:image content=https://RulerChen.github.io/RulerChen-Website/img/profile/profile.webp /><meta data-rh=true property=og:url content=https://RulerChen.github.io/RulerChen-Website/docs/SystemDesign/tinyurl/ /><meta data-rh=true property=og:locale content=zh_Hant /><meta data-rh=true property=og:locale:alternate content=en /><meta data-rh=true name=docusaurus_locale content=zh-Hant /><meta data-rh=true name=docsearch:language content=zh-Hant /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-default-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current /><meta data-rh=true property=og:title content="Design a URL Shortener like TinyURL | RulerChen"/><meta data-rh=true name=description content="Design a URL Shortener like TinyURL"/><meta data-rh=true property=og:description content="Design a URL Shortener like TinyURL"/><meta data-rh=true name=keywords content="URL Shortener,System Design"/><link data-rh=true rel=icon href=/RulerChen-Website/img/profile/profile.webp /><link data-rh=true rel=canonical href=https://RulerChen.github.io/RulerChen-Website/docs/SystemDesign/tinyurl/ /><link data-rh=true rel=alternate href=https://RulerChen.github.io/RulerChen-Website/docs/SystemDesign/tinyurl/ hreflang=zh-Hant /><link data-rh=true rel=alternate href=https://RulerChen.github.io/RulerChen-Website/en/docs/SystemDesign/tinyurl/ hreflang=en /><link data-rh=true rel=alternate href=https://RulerChen.github.io/RulerChen-Website/docs/SystemDesign/tinyurl/ hreflang=x-default /><link data-rh=true rel=preconnect href=https://GSV9DQB5UM-dsn.algolia.net crossorigin=anonymous /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://RulerChen.github.io/RulerChen-Website/docs/SystemDesign/","name":"System Design","position":1},{"@type":"ListItem","item":"https://RulerChen.github.io/RulerChen-Website/docs/SystemDesign/tinyurl","name":"Design a URL Shortener like TinyURL","position":2}]}</script><link rel=alternate type=application/rss+xml href=/RulerChen-Website/blog/rss.xml title="RulerChen's Blog RSS Feed"><link rel=alternate type=application/atom+xml href=/RulerChen-Website/blog/atom.xml title="RulerChen's Blog Atom Feed"><link rel=alternate type=application/json href=/RulerChen-Website/blog/feed.json title="RulerChen's Blog JSON Feed"><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-8BEHDPLQMG"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-8BEHDPLQMG",{anonymize_ip:!0})</script><link rel=search type=application/opensearchdescription+xml title=RulerChen href=/RulerChen-Website/opensearch.xml><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin=anonymous><link rel=preconnect href=https://fonts.googleapis.com crossorigin=anonymous><link rel=preconnect href=https://fonts.gstatic.com crossorigin=anonymous><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css type=text/css integrity=sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM crossorigin=anonymous><link rel=stylesheet href=/RulerChen-Website/assets/css/styles.b41c6ab6.css /><script src=/RulerChen-Website/assets/js/runtime~main.539febb5.js defer></script><script src=/RulerChen-Website/assets/js/main.abf4f37e.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t;document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/RulerChen-Website/img/profile/profile.webp /><div role=region aria-label=跳至主要内容><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>跳至主要内容</a></div><nav aria-label=主導航 class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label=切換導覽列 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/RulerChen-Website/><div class=navbar__logo><img src=/RulerChen-Website/img/profile/profile.webp alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"/><img src=/RulerChen-Website/img/profile/profile.webp alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"/></div><b class="navbar__title text--truncate">RulerChen</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/RulerChen-Website/docs/intro/>Notes</a><a class="navbar__item navbar__link" href=/RulerChen-Website/blog/>Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_nlXk><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>繁體中文</a><ul class=dropdown__menu><li><a href=/RulerChen-Website/docs/SystemDesign/tinyurl/ target=_self rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=zh-Hant>繁體中文</a><li><a href=/RulerChen-Website/en/docs/SystemDesign/tinyurl/ target=_self rel="noopener noreferrer" class=dropdown__link lang=en>English</a></ul></div><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="搜尋 (Meta+k)" aria-keyshortcuts=Meta+k><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 24 24" aria-hidden=true><circle cx=11 cy=11 r=8 stroke=currentColor fill=none stroke-width=1.4 /><path d="m21 21-4.3-4.3" stroke=currentColor fill=none stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>搜尋</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label=回到頂部 class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label=文件側邊欄 class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/RulerChen-Website/docs/intro/><span title=Introduction class=linkLabel_WmDU>Introduction</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/RulerChen-Website/docs/CMU15-213/><span title="CMU 15-213" class=categoryLinkLabel_W154>CMU 15-213</span></a><button aria-label="展開側邊欄分類 'CMU 15-213'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/RulerChen-Website/docs/CMU15-445/><span title="CMU 15-445" class=categoryLinkLabel_W154>CMU 15-445</span></a><button aria-label="展開側邊欄分類 'CMU 15-445'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist" href=/RulerChen-Website/docs/Security/><span title=Security class=categoryLinkLabel_W154>Security</span></a><button aria-label="展開側邊欄分類 'Security'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href=/RulerChen-Website/docs/SystemDesign/><span title="System Design" class=categoryLinkLabel_W154>System Design</span></a><button aria-label="收起側邊欄分類 'System Design'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/RulerChen-Website/docs/SystemDesign/tinyurl/><span title="Design a URL Shortener like TinyURL" class=linkLabel_WmDU>Design a URL Shortener like TinyURL</span></a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/RulerChen-Website/docs/Other/shell/><span title=Other class=categoryLinkLabel_W154>Other</span></a></div></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_z5aJ"><div class=docItemContainer_c0TR><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=頁面路徑><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label=主頁面 class=breadcrumbs__link href=/RulerChen-Website/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/RulerChen-Website/docs/SystemDesign/><span>System Design</span></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Design a URL Shortener like TinyURL</span></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type=button class="clean-btn tocCollapsibleButton_TO0P">本頁導覽</button></div><div class="theme-doc-markdown markdown"><header><h1>Design a URL Shortener like TinyURL</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id=background>Background<a href=#background class=hash-link aria-label=Background的直接連結 title=Background的直接連結 translate=no>​</a></h2>
<p><a href=https://tinyurl.com/ target=_blank rel="noopener noreferrer">TinyURL</a> 是一個 URL 縮短服務，使用者可以輸入一個長網址並得到一個短網址，當訪問這個短網址時，會被重定向到原始的長網址。</p>
<p>舉例來說，當使用者想要分享網址的時候，可以將 <code>https://www.example.com/some/very/long/url</code> 丟給 TinyURL，TinyURL 會回傳一個短網址 <code>https://tinyurl.com/abc123</code>，使用者可以將這個短網址分享給其他人，當其他人訪問這個短網址時，會被重定向到 <code>https://www.example.com/some/very/long/url</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=requirements>Requirements<a href=#requirements class=hash-link aria-label=Requirements的直接連結 title=Requirements的直接連結 translate=no>​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=functional-requirements>Functional Requirements<a href=#functional-requirements class=hash-link aria-label="Functional Requirements的直接連結" title="Functional Requirements的直接連結" translate=no>​</a></h3>
<ul>
<li>使用者能夠提交一個長網址並獲得一個對應的短網址</li>
<li>使用者能夠通過短網址來被重定向到原始的長網址</li>
<li><del>使用者可以設置過期時間或是刪除短網址</del></li>
<li><del>使用者可以自訂短網址的別名</del></li>
<li><del>可以提供統計資訊，如點擊次數等</del></li>
</ul>
<p>本篇將專注於生成短網址和重定向功能。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=non-functional-requirements>Non-Functional Requirements<a href=#non-functional-requirements class=hash-link aria-label="Non-Functional Requirements的直接連結" title="Non-Functional Requirements的直接連結" translate=no>​</a></h3>
<ul>
<li>重定向需要確保低延遲 (&lt; 100ms)</li>
<li>高可用性 (availability > consistency)</li>
<li>可擴展性，可以處理 100M DAU</li>
<li>保證短網址的唯一性，不會有一個短網址對應多個長網址的情況</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=estimation>Estimation<a href=#estimation class=hash-link aria-label=Estimation的直接連結 title=Estimation的直接連結 translate=no>​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=assumptions>Assumptions<a href=#assumptions class=hash-link aria-label=Assumptions的直接連結 title=Assumptions的直接連結 translate=no>​</a></h3>
<ul>
<li>100M DAU</li>
<li>每日產生 5M 個短網址</li>
<li>讀寫比例 100:1</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=qps-estimation>QPS Estimation<a href=#qps-estimation class=hash-link aria-label="QPS Estimation的直接連結" title="QPS Estimation的直接連結" translate=no>​</a></h3>
<ul>
<li>每秒平均寫入請求數: 500M / 86400 ≈ 58 (writes/sec)</li>
<li>每秒平均讀取請求數: 58 * 100 = 5800 (reads/sec)</li>
<li>高峰期流量假設為平均的 5 倍: 29000 (reads/sec), 290 (writes/sec)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=storage-estimation>Storage Estimation<a href=#storage-estimation class=hash-link aria-label="Storage Estimation的直接連結" title="Storage Estimation的直接連結" translate=no>​</a></h3>
<p>首先對每個欄位的大小進行估算 :</p>
<ul>
<li>長網址: 150 bytes</li>
<li>短網址: 20 bytes</li>
<li>使用者 ID: 16 bytes</li>
<li>創建時間戳: 8 bytes</li>
<li>過期時間戳: 8 bytes</li>
<li>索引和其他開銷: 100 bytes</li>
</ul>
<p>從上述估算可得每條紀錄約 300 bytes。</p>
<ul>
<li>每日產生的短網址數量: 5M</li>
<li>每日存儲需求: 5M * 300B = 1.5GB</li>
<li>每年存儲需求: 1.5GB * 365 = 547.5GB</li>
</ul>
<p>可以依據資料需要保留的時間來決定總存儲需求。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=schema-design>Schema Design<a href=#schema-design class=hash-link aria-label="Schema Design的直接連結" title="Schema Design的直接連結" translate=no>​</a></h2>
<p><strong>URL Table</strong></p>
<ul>
<li>short_url</li>
<li>long_url</li>
<li>user_id</li>
<li>created_at</li>
<li>expiry_date</li>
</ul>
<p><strong>User Table</strong> (not included in this design)</p>
<ul>
<li>user_id</li>
<li>...</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=api-design>API Design<a href=#api-design class=hash-link aria-label="API Design的直接連結" title="API Design的直接連結" translate=no>​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=create-short-url>Create Short URL<a href=#create-short-url class=hash-link aria-label="Create Short URL的直接連結" title="Create Short URL的直接連結" translate=no>​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">POST /api/urls</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    "long_url": "https://www.example.com/some/very/long/url",</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    "custom_alias": "optional-custom-alias",</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    "expiry_date": "optional-expiry-date"</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">}</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Response: HTTP 200 OK</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">{</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    "short_url": "https://tinyurl.com/abc123"</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">}</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=redirect-to-long-url>Redirect to Long URL<a href=#redirect-to-long-url class=hash-link aria-label="Redirect to Long URL的直接連結" title="Redirect to Long URL的直接連結" translate=no>​</a></h3>
<div class="language-http codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-http codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">GET /{short_url}</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Response: HTTP 301 Moved Permanently</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Location: https://www.example.com/some/very/long/url</span><br/></span></code></pre></div></div>
<p>這裡的 HTTP status code 有兩種選擇 :</p>
<ul>
<li>301 Moved Permanently: 表示這個重定向是永久性的，瀏覽器跟搜尋引擎都會將這個短網址記錄下來</li>
<li>302 Found: 表示這個重定向是臨時性的，每次訪問短網址都會需要重新發送請求到伺服器</li>
</ul>
<p>對於短網址服務來說，乍看之下由於會有過期時間且有時候需要蒐集點擊次數等統計資訊，似乎選擇 302 是比較合理的選擇。</p>
<p>但以 TinyURL 來舉例，它是使用 301 搭配 <code>max-age=0, must-revalidate, no-cache, no-store, private</code> 來忽略瀏覽器的快取，這樣就能夠同時達到 SEO 跟統計資訊的需求。</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></span>備註</div><div class=admonitionContent_BuS1><p>Cache-Control 的設定可以參考 <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control target=_blank rel="noopener noreferrer">MDN Web Docs</a> :<ul>
<li>max-age=N: 表示回應可以被快取 N 秒</li>
<li>must-revalidate: 表示在快取過期後，必須重新向伺服器驗證資源是否有更新，需要搭配 ETag 或是 Last-Modified 使用</li>
<li>no-cache: 表示回應可以被快取，但在使用前必須先向伺服器驗證資源是否有更新</li>
<li>no-store: 表示回應不能被任何快取儲存</li>
<li>public / private: public 表示回應可以被任何快取 (如 CDN) 儲存，private 表示回應只能被瀏覽器的快取儲存</li>
</ul><p>TinyURL 採取的做法是為了讓很舊的瀏覽器也能正確忽略快取，因此使用了很多功能重複的指令，實際上應該只需要 <code>no-store</code> 就可以達到同樣的效果。</div></div>
<p>同時也有不少短網址服務使用 302 ，因此兩種做法都是可以接受的。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=high-level-design>High Level Design<a href=#high-level-design class=hash-link aria-label="High Level Design的直接連結" title="High Level Design的直接連結" translate=no>​</a></h2>
<figure class=image-modal-container><img src=/RulerChen-Website/img/system-design/tinyurl/image.webp alt="" width=100% class=image-modal-thumbnail style=cursor:pointer loading=lazy /><figcaption class=image-modal-caption>High Level Design</figcaption></figure>
<ul>
<li><code>API Gateway</code>: 負責處理所有進入的請求，並將請求路由到適當的服務，同時也可以處理登入驗證和速率限制</li>
<li><code>Application Server</code>: 負責處理業務邏輯，如生成短網址、查找長網址等</li>
<li><code>Database</code>: 用於儲存資料，這裡會使用關聯式資料庫 (PostgreSQL) 來儲存 URL 資料</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=user-should-be-able-to-create-a-short-url>User should be able to create a short URL<a href=#user-should-be-able-to-create-a-short-url class=hash-link aria-label="User should be able to create a short URL的直接連結" title="User should be able to create a short URL的直接連結" translate=no>​</a></h3>
<ol>
<li>使用者呼叫 POST /api/urls 並提交長網址</li>
<li>驗證長網址是否符合 url 格式</li>
<li>生成唯一的短網址</li>
<li>將長網址和短網址儲存到資料庫中</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=user-should-be-able-to-access-the-original-url-by-using-the-short-url>User should be able to access the original URL by using the short URL<a href=#user-should-be-able-to-access-the-original-url-by-using-the-short-url class=hash-link aria-label="User should be able to access the original URL by using the short URL的直接連結" title="User should be able to access the original URL by using the short URL的直接連結" translate=no>​</a></h3>
<ol>
<li>使用者訪問短網址</li>
<li>application server 查詢資料庫以獲取對應的長網址</li>
<li>如果有找到並且沒有過期，返回 301 重定向到長網址</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=deep-dive>Deep Dive<a href=#deep-dive class=hash-link aria-label="Deep Dive的直接連結" title="Deep Dive的直接連結" translate=no>​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=how-to-generate-a-unique-short-url>How to generate a unique short URL?<a href=#how-to-generate-a-unique-short-url class=hash-link aria-label="How to generate a unique short URL?的直接連結" title="How to generate a unique short URL?的直接連結" translate=no>​</a></h3>
<p>在設計短網址的生成策略時，需要考慮以下幾點 :</p>
<ul>
<li>短網址的唯一性</li>
<li>長度盡可能短</li>
<li>生成短網址的速度要快</li>
</ul>
<p>常見的做法是先產生一個唯一的 ID，然後將這個 ID 進行編碼 (encoding) 來生成短網址。</p>
<p>對於如何產生唯一的 ID，有幾種方法 :</p>
<ul>
<li>Random Function</li>
<li>Hash Function</li>
<li>Counter</li>
<li>Any unique ID generation algorithm (如 Snowflake、UUID)</li>
</ul>
<p>而對於編碼方式，通常會使用 Base64、Base62 或 Base58 編碼。</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></span>備註</div><div class=admonitionContent_BuS1><ul>
<li>Base64: 使用 A-Z, a-z, 0-9, +, / 共 64 個字符</li>
<li>Base62: 使用 A-Z, a-z, 0-9 共 62 個字符</li>
<li>Base58: 使用 A-Z, a-z, 1-9 (去除容易混淆的 0, O, I, l) 共 58 個字符</li>
</ul></div></div>
<p>常見的選擇是 Base62 或 Base58，因為 Base64 中的 + 和 / 是特殊字符，需要做 URL encoding，會增加短網址的長度。</p>
<p>假設使用 Base62 編碼，代表 :</p>
<ul>
<li>如果是 5 個字符的短網址，總共有 62^5 ≈ 9 億種組合</li>
<li>如果是 6 個字符的短網址，總共有 62^6 ≈ 568 億種組合</li>
<li>如果是 7 個字符的短網址，總共有 62^7 ≈ 3.5 兆種組合</li>
</ul>
<p>以這個系統來說，每日產生 5M 個短網址，一年大約會產生 18.25 億個短網址，因此 6 個字符的短網址應該是足夠的。</p>
<p>但如果使用 random function 或是 hash function，就需要特別注意碰撞的機率問題。
假設資料庫中已經有 10 億個短網址，然後現在要再生成一個新的短網址，碰撞的機率大約是 10 億 / 568 億 ≈ 1.8%，這個機率看起來不高，但如果每天都產生 5M 個短網址，那麼一天就會有大約 90000 個短網址會碰撞。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=solution-1-hash-function>Solution 1: Hash Function<a href=#solution-1-hash-function class=hash-link aria-label="Solution 1: Hash Function的直接連結" title="Solution 1: Hash Function的直接連結" translate=no>​</a></h4>
<p>第一種可行的方法是使用 hash function 來生成短網址，常見的 hash function 有 MD5、SHA-256 等等。
我們可以使用 HMAC-SHA256 來生成一個無法被預測的 hash 值，然後將這個 hash 值進行 Base62 編碼來生成短網址，最後取前 6 個字符作為短網址。</p>
<p>但這樣同樣會產生問題，因為 hash function 並不是完美的，仍然有可能會產生碰撞，並且如果使用者輸入相同的長網址，就必定會產生相同的短網址，這不是我們想要的行為。</p>
<p>要解決碰撞問題，可以採取以下幾種策略 :</p>
<ol>
<li>Unique Constraint: 在資料庫中對短網址欄位設置唯一約束，這樣當插入一個已存在的短網址時會產生錯誤，系統可以捕捉這個錯誤並重新生成短網址</li>
<li>Nonce / Salt: 在生成短網址時加入一個隨機的 nonce 或是 salt，這樣即使使用者輸入相同的長網址，也會產生不同的短網址</li>
<li>Retry: 如果產生的短網址已經存在，可以嘗試加入不同的 nonce 或是 salt 並重新生成，直到重試的次數達到上限</li>
</ol>
<p>同時，也可以選擇把輸入改成長網址 + timestamp，這樣就能降低碰撞的機率。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=solution-2-counter>Solution 2: Counter<a href=#solution-2-counter class=hash-link aria-label="Solution 2: Counter的直接連結" title="Solution 2: Counter的直接連結" translate=no>​</a></h4>
<p>第二種可行的方法是使用一個全局的計數器，每次有新的長網址時，計數器就加 1，然後將這個計數器的值進行 Base62 編碼來生成短網址，這樣就可以確保生成的數字是唯一且不會碰撞的。</p>
<p>Redis 提供了 <code>INCR</code> 命令，可以用來實現這個計數器，並且這個命令是原子操作，能夠保證在高併發的情況下不會產生重複的值。</p>
<p>這個做法的問題是要如何在分散式系統中確保計數器的一致性，以及生成的短網址是可預測的，可能會產生資安問題，我們會在最後討論這個問題。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=how-to-ensure-low-latency>How to ensure low latency?<a href=#how-to-ensure-low-latency class=hash-link aria-label="How to ensure low latency?的直接連結" title="How to ensure low latency?的直接連結" translate=no>​</a></h3>
<p>對於 read-heavy 的系統來說，有幾種常見的優化手段 :</p>
<ul>
<li>Database Indexing</li>
<li>Caching</li>
<li>CDN and Edge Servers</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=database-indexing>Database Indexing<a href=#database-indexing class=hash-link aria-label="Database Indexing的直接連結" title="Database Indexing的直接連結" translate=no>​</a></h4>
<p>由於這裡的 SQL 查詢主要是 point search (根據 short_url 查找 long_url)，在 short_url 欄位上建立索引可以大幅提升查詢速度。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> long_url </span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> url_table </span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> short_url </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">'abc123'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br/></span></code></pre></div></div>
<p>以 PostgreSQL 為例，甚至可以使用 hash index 而非 B-tree index 來進一步提升查詢速度。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">INDEX</span><span class="token plain"> idx_short_url </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">ON</span><span class="token plain"> url_table </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">HASH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">short_url</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br/></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=caching>Caching<a href=#caching class=hash-link aria-label=Caching的直接連結 title=Caching的直接連結 translate=no>​</a></h4>
<p>以前面估計的 QPS 來看 (29000 r/s, 290 w/s)，單單引入索引不足以應付這樣的讀取量。</p>
<p>由於讀寫比例高達 100:1，且資料一旦寫入後通常不會再更改，因此很適合使用 cache (如 Redis) 來快取熱門的短網址，減少對資料庫的讀取壓力。</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></span>備註</div><div class=admonitionContent_BuS1><p>對於一般的 RDBMS (PostgreSQL、MySQL) 來說，在簡單的查詢下單個資料庫節點大約能處理 1000 writes/sec 或 3000 reads/sec 左右的請求。<p>而對於像 Redis 這樣的 in-memory database，簡單的 GET/SET 操作在單個節點上可以輕鬆達到 100000 req/sec 以上的處理能力。</div></div>
<p>引入快取雖然可以提升效能，但也會帶來可用性與一致性上的挑戰。
為了提升可用性，可以使用 Redis Cluster 或其他 Redis 高可用方案。</p>
<p>而在快取的使用上則可以採用 cache aside pattern :</p>
<ul>
<li>讀取時先查快取，若快取未命中再查資料庫並將結果寫入快取</li>
<li>寫入時先更新資料庫，並採用 lazy write 的方式更新快取 (不立即更新快取，等到下一次讀取時再更新)</li>
</ul>
<p>同時因為記憶體的大小有限，可以使用 LRU 搭配 TTL 來移除較少使用或過期的資料。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=cdn-and-edge-servers>CDN and Edge Servers<a href=#cdn-and-edge-servers class=hash-link aria-label="CDN and Edge Servers的直接連結" title="CDN and Edge Servers的直接連結" translate=no>​</a></h4>
<p>除了快取之外，還可以使用 CDN (Content Delivery Network) 來將熱門的查詢放在離使用者更近的邊緣節點 (Edge Servers)。</p>
<p>以短網址系統來說，我認為 CDN 的必要性不是特別大，而且會造成額外的成本，因此這部分可以視情況而定。
如果要使用 CDN 的話還需要額外考慮到快取失效的問題。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=how-to-scale-up-to-support-100m-dau>How to scale up to support 100M DAU?<a href=#how-to-scale-up-to-support-100m-dau class=hash-link aria-label="How to scale up to support 100M DAU?的直接連結" title="How to scale up to support 100M DAU?的直接連結" translate=no>​</a></h3>
<p>以短網址系統來說，主要的瓶頸可能會出現在資料庫上，這裡有幾個點需要注意 :</p>
<ul>
<li>讀寫的 QPS 吞吐量是否足夠</li>
<li>儲存空間是否足夠</li>
<li>過期資料如何處理</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=readwrite-throughput>Read/Write Throughput<a href=#readwrite-throughput class=hash-link aria-label="Read/Write Throughput的直接連結" title="Read/Write Throughput的直接連結" translate=no>​</a></h4>
<p>以資料庫的寫入量來說 (290 w/s)，單一節點應該是足夠的，但讀取量 (29000 r/s) 就需要特別注意。</p>
<p>假設快取可以處理 90% 的讀取請求，那麼實際上資料庫需要處理的讀取請求大約是 2900 r/s，這對於單一資料庫節點來說壓力稍微有點大。</p>
<p>對於這樣的情況，最好的解決方法就是採用 read replica 的方式來分散讀取的負載，可以把主資料庫的內容同步到多個從資料庫節點，並且將讀取請求分散到這些從節點上。
以前面估計的值來說，可以把寫入請求都導向主節點，而讀取請求則可以分散到 2-3 個從節點上，這樣每個從節點大約只需要處理 1000 r/s 的請求。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=storage>Storage<a href=#storage class=hash-link aria-label=Storage的直接連結 title=Storage的直接連結 translate=no>​</a></h4>
<p>對於資料庫的儲存空間來說 (547.5GB/年)，即使需要保存 3-5 年的資料量對於現代的資料庫來說也不是特別大的問題，但問題在於這個資料量對於單一表來說非常大，進而影響到查詢效能。</p>
<p>假設系統需要保存 3 年的資料，代表資料庫需要保存 5M * 365 * 3 = 5.5B 行的資料在單一的表中，這會產生如索引過大、查詢效能下降的問題。</p>
<p>因此需要進行 partitioning 來將資料分散到多個表中，常見的分區方式有 range partitioning (依照時間範圍分區) 或是 hash partitioning (依照某個欄位的 hash 值分區)。
以這裡的查詢來說，對 short_url 進行 hash partitioning 是比較合適的，這樣可以確保在讀取的時候可以很輕易的知道要查詢哪一個分區。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=outdated-data-deletion>Outdated Data Deletion<a href=#outdated-data-deletion class=hash-link aria-label="Outdated Data Deletion的直接連結" title="Outdated Data Deletion的直接連結" translate=no>​</a></h4>
<p>由於目前系統中沒有刪除資料的機制，即使 <code>expiry_date</code> 已經過期，資料仍然會保留在資料庫中，這會導致資料庫的大小不斷膨脹，進而影響到查詢效能。</p>
<p>由於一次使用 <code>DELETE * FROM url_table WHERE expiry_date &lt; now()</code> 來刪除過期資料會對資料庫造成很大的負擔，因此可以採用懶惰刪除 (lazy deletion) 搭配批次工作 (batch job) 來定期刪除過期資料。</p>
<p>懶惰刪除的做法是當使用者訪問一個短網址時，先檢查這個短網址是否過期，如果過期就直接返回錯誤，並刪掉這筆資料。
而後台的批次工作則可以新增一個 <code>is_deleted</code> 欄位，然後定期將過期的資料標記為已刪除，再用專門的低優先級工作來小批次的刪除這些資料。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=final-design>Final Design<a href=#final-design class=hash-link aria-label="Final Design的直接連結" title="Final Design的直接連結" translate=no>​</a></h2>
<figure class=image-modal-container><img src=/RulerChen-Website/img/system-design/tinyurl/image-2.webp alt="" width=100% class=image-modal-thumbnail style=cursor:pointer loading=lazy /><figcaption class=image-modal-caption>Final Design</figcaption></figure>
<p>在最後的設計中，我選擇使用了 hash function 而非使用計數器來生成短網址，主要是為了降低系統的複雜度。</p>
<p>首先，對於 Redis 這樣的資料庫來說，寫入顯然不是瓶頸，它也可以提供原子化的計數器功能，但問題在於系統是分散式的，這代表所有的 application server 都需要連接到同一個 Redis 節點來取得計數器的值，這會導致跨區域的延遲成為一個重要的問題。</p>
<p>舉例來說，從臺灣打到美國西岸的 EC2 伺服器，網路延遲大概是 200ms 左右:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token function" style="color:rgb(80, 250, 123)">ping</span><span class="token plain"> ec2.us-west-2.amazonaws.com</span><br/></span></code></pre></div></div>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token plain">Pinging ec2.us-west-2.amazonaws.com [52.119.164.21] with 32 bytes of data:</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Reply from 52.119.164.21: bytes=32 time=187ms TTL=239</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Reply from 52.119.164.21: bytes=32 time=202ms TTL=239</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Reply from 52.119.164.21: bytes=32 time=214ms TTL=239</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Reply from 52.119.164.21: bytes=32 time=183ms TTL=239</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Ping statistics for 52.119.164.21:</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">Approximate round trip times in milli-seconds:</span><br/></span><span class=token-line style=color:#F8F8F2><span class="token plain">    Minimum = 183ms, Maximum = 214ms, Average = 196ms</span><br/></span></code></pre></div></div>
<p>當然這個問題也有解決方法，譬如說可以將 Redis 部屬在多個區域，並把計數器的值分散到不同的區域，或是一次性就給 application server 一大段的計數器值，但這些都會增加系統的複雜度，同時會大幅增加部屬 Redis 的成本。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=references>References<a href=#references class=hash-link aria-label=References的直接連結 title=References的直接連結 translate=no>​</a></h2>
<ul>
<li><a href=https://www.hellointerview.com/learn/system-design/problem-breakdowns/bitly target=_blank rel="noopener noreferrer">Design Bit.ly</a></li>
<li><a href=https://github.com/RulerChen/Grokking-Modern-System-Design-Interview/tree/main/Design%20a%20URL%20Shortening%20Service%20TinyURL target=_blank rel="noopener noreferrer">Design a URL Shortening Service TinyURL</a></li>
<li><a href=https://medium.com/@sandeep4.verma/system-design-scalable-url-shortener-service-like-tinyurl-106f30f23a82 target=_blank rel="noopener noreferrer">System Design : Scalable URL shortener service like TinyURL</a></li>
<li><a href="https://www.youtube.com/watch?v=xFeWVugaouk&list=PLjTveVh7FakLGZ36GbWAk_DMf_0xBZpGv&index=13" target=_blank rel="noopener noreferrer">Design a URL Shortener (TinyURL, Bit.ly) | Systems Design Questions 3.0 With Ex-Google SWE</a></li>
</ul></div><div style=margin-top:32px></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class=col><b>標籤：</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/RulerChen-Website/docs/tags/system-design/>System Design</a></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/RulerChen/RulerChen-Website/tree/main/docs/SystemDesign/tinyurl.mdx target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>編輯此頁</a></div><div class="col lastUpdated_JAkA"><span class=theme-last-updated>最後<!-- -->於 <b><time datetime=2025-10-10T02:56:51.000Z itemprop=dateModified>2025年10月10日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label=文件選項卡><a class="pagination-nav__link pagination-nav__link--prev" href=/RulerChen-Website/docs/SystemDesign/><div class=pagination-nav__sublabel>上一頁</div><div class=pagination-nav__label>System Design</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/RulerChen-Website/docs/Other/shell/><div class=pagination-nav__sublabel>下一頁</div><div class=pagination-nav__label>Shell Introduction</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#background class="table-of-contents__link toc-highlight">Background</a><li><a href=#requirements class="table-of-contents__link toc-highlight">Requirements</a><ul><li><a href=#functional-requirements class="table-of-contents__link toc-highlight">Functional Requirements</a><li><a href=#non-functional-requirements class="table-of-contents__link toc-highlight">Non-Functional Requirements</a></ul><li><a href=#estimation class="table-of-contents__link toc-highlight">Estimation</a><ul><li><a href=#assumptions class="table-of-contents__link toc-highlight">Assumptions</a><li><a href=#qps-estimation class="table-of-contents__link toc-highlight">QPS Estimation</a><li><a href=#storage-estimation class="table-of-contents__link toc-highlight">Storage Estimation</a></ul><li><a href=#schema-design class="table-of-contents__link toc-highlight">Schema Design</a><li><a href=#api-design class="table-of-contents__link toc-highlight">API Design</a><ul><li><a href=#create-short-url class="table-of-contents__link toc-highlight">Create Short URL</a><li><a href=#redirect-to-long-url class="table-of-contents__link toc-highlight">Redirect to Long URL</a></ul><li><a href=#high-level-design class="table-of-contents__link toc-highlight">High Level Design</a><ul><li><a href=#user-should-be-able-to-create-a-short-url class="table-of-contents__link toc-highlight">User should be able to create a short URL</a><li><a href=#user-should-be-able-to-access-the-original-url-by-using-the-short-url class="table-of-contents__link toc-highlight">User should be able to access the original URL by using the short URL</a></ul><li><a href=#deep-dive class="table-of-contents__link toc-highlight">Deep Dive</a><ul><li><a href=#how-to-generate-a-unique-short-url class="table-of-contents__link toc-highlight">How to generate a unique short URL?</a><li><a href=#how-to-ensure-low-latency class="table-of-contents__link toc-highlight">How to ensure low latency?</a><li><a href=#how-to-scale-up-to-support-100m-dau class="table-of-contents__link toc-highlight">How to scale up to support 100M DAU?</a></ul><li><a href=#final-design class="table-of-contents__link toc-highlight">Final Design</a><li><a href=#references class="table-of-contents__link toc-highlight">References</a></ul></div></div></div></div></main></div></div></div></div></body>