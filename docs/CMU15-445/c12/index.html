<!doctype html>
<html lang="zh-Hant" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-CMU15-445/c12" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">CMU 15-445/645 筆記 Query Execution</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://RulerChen.github.io/RulerChen-Website/img/profile.png"><meta data-rh="true" name="twitter:image" content="https://RulerChen.github.io/RulerChen-Website/img/profile.png"><meta data-rh="true" property="og:url" content="https://RulerChen.github.io/RulerChen-Website/docs/CMU15-445/c12/"><meta data-rh="true" property="og:locale" content="zh_Hant"><meta data-rh="true" name="docusaurus_locale" content="zh-Hant"><meta data-rh="true" name="docsearch:language" content="zh-Hant"><meta data-rh="true" name="google-site-verification" content="QrdRbPEcOsJJ_kfRVewqfwR6GjPcRf0UVgRb85I-5fc"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Query Execution | RulerChen"><meta data-rh="true" name="description" content="CMU15-445/645 Query Execution"><meta data-rh="true" property="og:description" content="CMU15-445/645 Query Execution"><meta data-rh="true" name="keywords" content="CMU15-445/645,Query Execution,CMU15-445/645 筆記"><link data-rh="true" rel="icon" href="/RulerChen-Website/img/profile.png"><link data-rh="true" rel="canonical" href="https://RulerChen.github.io/RulerChen-Website/docs/CMU15-445/c12/"><link data-rh="true" rel="alternate" href="https://RulerChen.github.io/RulerChen-Website/docs/CMU15-445/c12/" hreflang="zh-Hant"><link data-rh="true" rel="alternate" href="https://RulerChen.github.io/RulerChen-Website/docs/CMU15-445/c12/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://GSV9DQB5UM-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/RulerChen-Website/blog/rss.xml" title="RulerChen RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/RulerChen-Website/blog/atom.xml" title="RulerChen Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8BEHDPLQMG"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-8BEHDPLQMG",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="RulerChen" href="/RulerChen-Website/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/RulerChen-Website/assets/css/styles.4025f7b4.css">
<script src="/RulerChen-Website/assets/js/runtime~main.b143080d.js" defer="defer"></script>
<script src="/RulerChen-Website/assets/js/main.4fb49982.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳至主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳至主要内容</a></div><nav aria-label="主導航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/RulerChen-Website/"><div class="navbar__logo"><img src="/RulerChen-Website/img/profile.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/RulerChen-Website/img/profile.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">RulerChen</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/RulerChen-Website/docs/intro/">Notes</a><a class="navbar__item navbar__link" href="/RulerChen-Website/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/RulerChen" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://www.linkedin.com/in/rulerchen/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Linkdin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜尋"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜尋</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到頂部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文件側邊欄" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/RulerChen-Website/docs/intro/">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/RulerChen-Website/docs/Algorithm/KMP/">Algorithm</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/RulerChen-Website/docs/Database/pg-tuning/">Database</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/RulerChen-Website/docs/SystemDesign/cdn/">System Design</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/RulerChen-Website/docs/Docker/Introduction/">Docker</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/RulerChen-Website/docs/Kubernetes/Introduction/">Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/RulerChen-Website/docs/NodeJs/expresssetup/">Node.js</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/RulerChen-Website/docs/Next.js/Caching/">Next.js</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/RulerChen-Website/docs/CMU15-445/c01/">CMU15-445/645 Database Systems</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c01/">Relational Model &amp; Algebra</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c02/">Modern SQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c03/">Database Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c05/">Storage Models &amp; Compression</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c06/">Memory &amp; Disk I/O Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c07/">Hash Tables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c08/">Trees Indexes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c09/">Index Concurrency Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c10/">Sorting &amp; Aggregations Algorithms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c11/">Joins Algorithms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c12/">Query Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c14/">Query Planning &amp; Optimization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c15/">Concurrency Control Theory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c16/">Two-Phase Locking Concurrency Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c17/">Timestamp Ordering Concurrency Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c18/">Multi-Version Concurrency Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c19/">Database Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c20/">Database Recovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c21/">Introduction to Distributed Databases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c22/">Distributed OLTP Database Systems</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c23/">Distributed OLAP Database Systems</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c24/">SingleStore Database Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c25/">Final Review + Systems Potpourri</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="頁面路徑"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主頁面" class="breadcrumbs__link" href="/RulerChen-Website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">CMU15-445/645 Database Systems</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Query Execution</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本頁導覽</button></div><div class="theme-doc-markdown markdown"><header><h1>Query Execution</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="processing-model">Processing model<a class="hash-link" aria-label="Processing model的直接連結" title="Processing model的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#processing-model">​</a></h2>
<p>DBMS 的 processing model 定義了系統如何執行 query plan ，
主要包含了三種模型</p>
<ul>
<li>Iterator Model</li>
<li>Materialization Model</li>
<li>Vectorized / Batch Model</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="iterator-model">Iterator Model<a class="hash-link" aria-label="Iterator Model的直接連結" title="Iterator Model的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#iterator-model">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Iterator Model" src="/RulerChen-Website/assets/images/image-2263231061f1d294b09279825ce5d934.png" width="958" height="535" class="img_ev3q"></p>
<p>Iterator 模型，也被稱為 Volcano model 或 Pipeline model，是最常見的 processing model，幾乎每個 row-based 的 DBMS 都有使用這種模型。</p>
<p>這個模型的核心是讓每個資料庫 operator 都實現一個 Next 函數，
使查詢計畫中的每個節點在需要資料時，能夠向其子節點請求下一個 tuple (如果資料已經回傳完畢則返回 null)，
直到查詢計畫的葉節點發出資料為止。</p>
<p>Iterator 模型支持 pipelining，這代表 DBMS 會盡量對 tuple 進行處理，然後在處理下一個 tuple。
有些 operator (如 join、subquery 和 ORDER BY 等) 在處理時會阻塞直到它們的所有子節點都發出資料為止，這類操作符被稱為 Pipeline Breakers。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="materialization-model">Materialization Model<a class="hash-link" aria-label="Materialization Model的直接連結" title="Materialization Model的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#materialization-model">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Materialization Model" src="/RulerChen-Website/assets/images/image-1-a05cb620e01f0914c43b5c4c1eecbaae.png" width="959" height="539" class="img_ev3q"></p>
<p>每個 operator 都有一個 output 函數，會一次性處理完所有 input 並將結果一次性返回，輸出可以是 DSM 或 NSM 的形式。</p>
<p>這種方法更適合 OLTP 系統，因為 OLTP 通常只須回傳少量資料，可以減少調用 <code>Next</code> 函數的次數。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="vectorized--batch-model">Vectorized / Batch Model<a class="hash-link" aria-label="Vectorized / Batch Model的直接連結" title="Vectorized / Batch Model的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#vectorized--batch-model">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Vectorized / Batch Model" src="/RulerChen-Website/assets/images/image-2-2bc5fb32fb8c0d2fbbe202222f6c87f5.png" width="961" height="538" class="img_ev3q"></p>
<p>Vectorized / Batch Model 是一種 iterator 和 materialization 的混合模型，
在調用 Next 函數時，會一次性回傳一批 tuple，可以根據硬體條件來調整 batch 的大小。</p>
<p>這種方式適合於 OLAP 系統，可以減少調用 Next 函數的次數，並且可以使用 SIMD 指令集來批量處理 tuple。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="access-methods">Access Methods<a class="hash-link" aria-label="Access Methods的直接連結" title="Access Methods的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#access-methods">​</a></h2>
<p>access method 是指 DBMS 從 table 中獲得資料的方式，主要有以下幾種</p>
<ul>
<li>Sequential Scan</li>
<li>Index Scan</li>
<li>Multi-Index Scan</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sequential-scan">Sequential Scan<a class="hash-link" aria-label="Sequential Scan的直接連結" title="Sequential Scan的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#sequential-scan">​</a></h3>
<p>sequential scan 指的是 DBMS 逐行讀取 table 中的所有資料，通常效能會較差，DBMS 會維護一個 cursor 來記錄當前讀取的位置。</p>
<p>有許多的優化方法可以提升 sequential scan 的效能，如</p>
<ul>
<li>Prefetching</li>
<li>Buffer Pool Bypass</li>
<li>Parallelization (本節)</li>
<li>Late Materialization</li>
<li>Heap Clustering</li>
<li>Data Skipping (本節)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="data-skipping">Data Skipping<a class="hash-link" aria-label="Data Skipping的直接連結" title="Data Skipping的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#data-skipping">​</a></h4>
<p>有兩種方法可以實現 data skipping</p>
<ul>
<li>Approximate Queries (有損的) : 在表中選取一個子集，並生成近似的結果</li>
<li>Zone Maps (無損的) : 在每個 page 上維護一個 metadata (如平均值、最大最小值)，可以快速判斷是否包含需要的資料或是是否需要訪問這個 page</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="index-scan">Index Scan<a class="hash-link" aria-label="Index Scan的直接連結" title="Index Scan的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#index-scan">​</a></h3>
<p>DBMS 會選擇一個索引來幫助查詢，選擇的方式如下</p>
<ul>
<li>index 包含了那些屬性</li>
<li>query 中包含了那些屬性</li>
<li>屬性的範圍</li>
<li>謂詞組合 (AND、OR)</li>
<li>索引鍵是否唯一</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multi-index-scan">Multi-Index Scan<a class="hash-link" aria-label="Multi-Index Scan的直接連結" title="Multi-Index Scan的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#multi-index-scan">​</a></h3>
<p>有些資料庫支援多索引的查詢，可以透過多個索引來將找出每個對應的 record id ，並且將他們集合起來。</p>
<p>如 PostgreSQL 的 Bitmap Index Scan，MySQL 的 Index Merge 等。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="modification-queries">Modification Queries<a class="hash-link" aria-label="Modification Queries的直接連結" title="Modification Queries的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#modification-queries">​</a></h2>
<p>DBMS 中的 modification 主要包含 <code>INSERT</code>、<code>UPDATE</code> 和 <code>DELETE</code> 三種操作，這些操作會影響到 table 中的資料。</p>
<p>在 <code>UPDATE</code> 跟 <code>DELETE</code> 操作中，child operator 會跟蹤已經處理過的 tuple 並返回 record id，
而在 <code>INSERT</code> 中有兩種實現方式，一種是自己 materialize tuple，另一種是接收 child operator 的輸出。</p>
<p><img decoding="async" loading="lazy" alt="Modification Queries" src="/RulerChen-Website/assets/images/image-3-e0e83dfd319ed4e5611970eb8421ebae.png" width="959" height="540" class="img_ev3q"></p>
<p>如上面的圖，我們有可能會遇到 Halloween Problem，這個問題是指在更新過程中，
由於更新後的 tuple 位置可能會改變，所以可能會更新到已經更新過的 tuple。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="expression-evaluation">Expression Evaluation<a class="hash-link" aria-label="Expression Evaluation的直接連結" title="Expression Evaluation的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#expression-evaluation">​</a></h2>
<p><img decoding="async" loading="lazy" alt="Expression Evaluation" src="/RulerChen-Website/assets/images/image-4-2011795d05d5ebe9f975424347569490.png" width="957" height="538" class="img_ev3q"></p>
<p>DBMS 會將 <code>WHERE</code> 條件中的表達式轉換成一個 expression tree，遍歷之後產生結果，
可以使用 JIT 編譯技術來加速表達式的計算。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="scheduler">Scheduler<a class="hash-link" aria-label="Scheduler的直接連結" title="Scheduler的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#scheduler">​</a></h2>
<p><img decoding="async" loading="lazy" alt="Scheduler" src="/RulerChen-Website/assets/images/image-5-8091b11c083c87db802ea03ce7d8d693.png" width="958" height="537" class="img_ev3q"></p>
<p>scheduler 的功用是將 data flow 跟 control flow 進行清晰的分離，
適合在 batch mode (一次性處理一組資料) 中使用，尤其是在 vectorization model 中。</p>
<p>scheduler 會生成 work order，並將其放入 scheduling queue 中，然後 worker 會從 work queue 中取出 work order 並執行。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="parallel-vs-distributed-databases">Parallel vs Distributed Databases<a class="hash-link" aria-label="Parallel vs Distributed Databases的直接連結" title="Parallel vs Distributed Databases的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#parallel-vs-distributed-databases">​</a></h2>
<p>在前面的討論中，我們都只專注在 single worker 的環境下，但是在現實中，我們會需要多個 worker 來平行處理 query。</p>
<p>在平行或分散式的系統中，資料庫會分布在多個資源中來提高 parallelism，這些資源可以是多個 CPU、多個硬碟、多個機器等，
但在使用者的角度，這應該跟一個單一的資料庫是一樣的。</p>
<ul>
<li>Parallel Database<!-- -->
<ul>
<li>物理連結較近，且溝通快</li>
<li>通訊成本較小</li>
</ul>
</li>
<li>Distributed Database<!-- -->
<ul>
<li>節點之間相距較遠</li>
<li>通訊成本較大</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="process-model">Process Model<a class="hash-link" aria-label="Process Model的直接連結" title="Process Model的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#process-model">​</a></h2>
<p>process model 定義了 DBMS 的多用戶平行處理的架構，我們會用 worker 這個詞來代表執行的單位，
它可以是一個 process 或 thread。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="process-per-worker">Process per Worker<a class="hash-link" aria-label="Process per Worker的直接連結" title="Process per Worker的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#process-per-worker">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Process per Worker" src="/RulerChen-Website/assets/images/image-6-eb81036b3c7c3834188f3ade529d24f9.png" width="961" height="538" class="img_ev3q"></p>
<p>client 端的請求經過 dispatcher 後會由 dispatcher 分配一個 worker 來處理，每個 worker 都是一個獨立的 process。</p>
<ul>
<li>依賴於作業系統的 scheduler</li>
<li>使用 shared memory 來儲存全局的資料結構</li>
<li>單一的 process crash 並不會造成整個系統的 crash</li>
</ul>
<p>這種 process model 主要出現在 pthread 還沒有穩定的時候，主要是為了解決移植性問題，如舊版的 Oracle 和 DB2 以及現在的 PostgreSQL。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="thread-per-worker">Thread per Worker<a class="hash-link" aria-label="Thread per Worker的直接連結" title="Thread per Worker的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#thread-per-worker">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Thread per Worker" src="/RulerChen-Website/assets/images/image-7-e7f5ae04dbad4932e41271da1b0137d3.png" width="959" height="540" class="img_ev3q"></p>
<p>DBMS 由一個 process 和多個 worker thread 組成。</p>
<ul>
<li>DBMS 通常會自己管理 scheduler</li>
<li>可能沒有 dispatcher</li>
<li>thread crash 可能導致系統崩潰</li>
<li>由於使用 thread，context switch 的成本較低，且不需要維護 shared model</li>
</ul>
<p>這種 process model 是近年來最流行的，如 MySQL、SQL Server、MySQL 以及新版的 Oracle 都支持這種模型。</p>
<p>對於每個 query plan 來說，scheduler 可以決定</p>
<ul>
<li>要被拆成多少個 tasks</li>
<li>使用多少個 cpu core</li>
<li> 將 tasks 分配給哪些 core</li>
<li>輸出要被放在哪裡</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="embedded-dbms">Embedded DBMS<a class="hash-link" aria-label="Embedded DBMS的直接連結" title="Embedded DBMS的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#embedded-dbms">​</a></h3>
<p>Embedded DBMS 是一種與傳統 client-server 架構的 DBMS 不同的架構，
在這種架構中，DBMS 會直接在跟應用程式相同的 address space 中運行，
並由應用程式負責 task 和 scheduler 的管理。</p>
<p>常見的有 SQLite、DuckDB、RocksDB 等。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="inter-query-parallelism">Inter-Query Parallelism<a class="hash-link" aria-label="Inter-Query Parallelism的直接連結" title="Inter-Query Parallelism的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#inter-query-parallelism">​</a></h2>
<p>Inter-Query Parallelism 是指同時執行多個查詢的能力，如果都是 read only 的查詢，那麼不需要多餘的協調，
如果有 write 操作，則需要更多的機制來確保一致性。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="intra-query-parallelism">Intra-Query parallelism<a class="hash-link" aria-label="Intra-Query parallelism的直接連結" title="Intra-Query parallelism的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#intra-query-parallelism">​</a></h2>
<p>Intra-Query Parallelism 是指通過平行化來將單個 query 分解成多個 operators 來提升性能。</p>
<p>在這個過程中，每個 operator 都是資料的 producer，也同時是其他 operator 的 consumer，
這種設計使得平行算法可以應用於每個 relational operator。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="intra-operator-parallelism-horizontal">Intra-Operator Parallelism (Horizontal)<a class="hash-link" aria-label="Intra-Operator Parallelism (Horizontal)的直接連結" title="Intra-Operator Parallelism (Horizontal)的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#intra-operator-parallelism-horizontal">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Intra-Operator Parallelism" src="/RulerChen-Website/assets/images/image-8-3a0656fe6132977c1c4c790b0ed4969a.png" width="961" height="537" class="img_ev3q"></p>
<p>將資料拆解成多個子集，並透過 exchange operator 來合併子集處理的結果。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="inter-operator-parallelism-vertical">Inter-Operator Parallelism (Vertical)<a class="hash-link" aria-label="Inter-Operator Parallelism (Vertical)的直接連結" title="Inter-Operator Parallelism (Vertical)的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#inter-operator-parallelism-vertical">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Inter-Operator Parallelism" src="/RulerChen-Website/assets/images/image-9-0fcd2d3e03b5265d5e5447b4c215f0ed.png" width="957" height="536" class="img_ev3q"></p>
<p>將 operator 串聯成 pipeline，並由前一個階段不斷地產生 tuple 來供給下一個階段而不用等待整個階段處理完畢，
也叫做 pipelined parallelism。</p>
<p>通常會在一些 streaming 的系統中使用，如 Spark、Flink 等。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bushy-parallelism">Bushy Parallelism<a class="hash-link" aria-label="Bushy Parallelism的直接連結" title="Bushy Parallelism的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#bushy-parallelism">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Bushy Parallelism" src="/RulerChen-Website/assets/images/image-10-f5b06976dda9fa1ec86b03f48a053c67.png" width="956" height="536" class="img_ev3q"></p>
<p>Bushy Parallelism 是 Intra-Operator 和 Inter-Operator Parallelism 的混合形式。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="observation">Observation<a class="hash-link" aria-label="Observation的直接連結" title="Observation的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#observation">​</a></h3>
<p>使用額外的 process / thread 來平行執行 query 可以提高 CPU 的利用率，但如果瓶頸出現在 disk I/O 上，
那麼這種平行處理就沒有太大的意義，甚至有可能因為 cache miss 而導致效能下降。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="io-parallelism">I/O Parallelism<a class="hash-link" aria-label="I/O Parallelism的直接連結" title="I/O Parallelism的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#io-parallelism">​</a></h2>
<p>I/O Parallelism 是指在 DBMS 中使用額外的進程或執行緒來平行執行查詢，以提高資料存取的效能。
這種技術旨在克服硬碟是主要瓶頸的情況，透過將資料庫分散在多個存儲設備上來提高效能。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multi-disk-io-parallelism">Multi-Disk I/O Parallelism<a class="hash-link" aria-label="Multi-Disk I/O Parallelism的直接連結" title="Multi-Disk I/O Parallelism的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#multi-disk-io-parallelism">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Multi-Disk I/O Parallelism" src="/RulerChen-Website/assets/images/image-11-a7e17213e551d0316b71fca14cac216e.png" width="959" height="538" class="img_ev3q"></p>
<p>在 multi-disk I/O parallelism 中，DBMS 會將資料庫檔案分散在多個硬碟上，這可以使用 RAID 來實現，</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="database-partitioning">Database Partitioning<a class="hash-link" aria-label="Database Partitioning的直接連結" title="Database Partitioning的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#database-partitioning">​</a></h3>
<p>可以將一個 logical table 分割成多個 physical segments 分開儲存，以提高 I/O 效能。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a class="hash-link" aria-label="References的直接連結" title="References的直接連結" href="/RulerChen-Website/docs/CMU15-445/c12/#references">​</a></h2>
<ul>
<li><a href="https://15445.courses.cs.cmu.edu/fall2023/" target="_blank" rel="noopener noreferrer">CMU 15-445/645: Introduction to Database Systems</a></li>
<li><a href="https://www.youtube.com/watch?v=3F3FWgujN9Q&amp;list=PLSE8ODhjZXjbj8BMuIrRcacnQh20hmY9g&amp;index=13" target="_blank" rel="noopener noreferrer">CMU 15-445/645: Introduction to Database Systems Youtube 2023 Fall</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/c12.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>編輯此頁</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最後<!-- -->於 <b><time datetime="2024-08-21T06:04:50.000Z" itemprop="dateModified">2024年8月21日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件選項卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/RulerChen-Website/docs/CMU15-445/c11/"><div class="pagination-nav__sublabel">上一頁</div><div class="pagination-nav__label">Joins Algorithms</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/RulerChen-Website/docs/CMU15-445/c14/"><div class="pagination-nav__sublabel">下一頁</div><div class="pagination-nav__label">Query Planning &amp; Optimization</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#processing-model">Processing model</a><ul><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#iterator-model">Iterator Model</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#materialization-model">Materialization Model</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#vectorized--batch-model">Vectorized / Batch Model</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#access-methods">Access Methods</a><ul><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#sequential-scan">Sequential Scan</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#index-scan">Index Scan</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#multi-index-scan">Multi-Index Scan</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#modification-queries">Modification Queries</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#expression-evaluation">Expression Evaluation</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#scheduler">Scheduler</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#parallel-vs-distributed-databases">Parallel vs Distributed Databases</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#process-model">Process Model</a><ul><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#process-per-worker">Process per Worker</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#thread-per-worker">Thread per Worker</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#embedded-dbms">Embedded DBMS</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#inter-query-parallelism">Inter-Query Parallelism</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#intra-query-parallelism">Intra-Query parallelism</a><ul><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#intra-operator-parallelism-horizontal">Intra-Operator Parallelism (Horizontal)</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#inter-operator-parallelism-vertical">Inter-Operator Parallelism (Vertical)</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#bushy-parallelism">Bushy Parallelism</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#observation">Observation</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#io-parallelism">I/O Parallelism</a><ul><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#multi-disk-io-parallelism">Multi-Disk I/O Parallelism</a></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#database-partitioning">Database Partitioning</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/RulerChen-Website/docs/CMU15-445/c12/#references">References</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 RulerChen, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>