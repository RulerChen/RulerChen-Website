<!doctype html>
<html lang="zh-Hant" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-CMU15-445/c23" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">CMU 15-445 Distributed OLTP Database Systems</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://RulerChen.github.io/RulerChen-Website/img/profile/profile.webp"><meta data-rh="true" name="twitter:image" content="https://RulerChen.github.io/RulerChen-Website/img/profile/profile.webp"><meta data-rh="true" property="og:url" content="https://RulerChen.github.io/RulerChen-Website/docs/CMU15-445/c23/"><meta data-rh="true" property="og:locale" content="zh_Hant"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-Hant"><meta data-rh="true" name="docsearch:language" content="zh-Hant"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Distributed OLTP Database Systems | RulerChen"><meta data-rh="true" name="description" content="CMU15-445/645 Distributed OLTP Database Systems"><meta data-rh="true" property="og:description" content="CMU15-445/645 Distributed OLTP Database Systems"><meta data-rh="true" name="keywords" content="CMU15-445/645,Distributed OLTP Database Systems,CMU15-445/645 筆記"><link data-rh="true" rel="icon" href="/RulerChen-Website/img/profile/profile.webp"><link data-rh="true" rel="canonical" href="https://RulerChen.github.io/RulerChen-Website/docs/CMU15-445/c23/"><link data-rh="true" rel="alternate" href="https://RulerChen.github.io/RulerChen-Website/docs/CMU15-445/c23/" hreflang="zh-Hant"><link data-rh="true" rel="alternate" href="https://RulerChen.github.io/RulerChen-Website/en/docs/CMU15-445/c23/" hreflang="en"><link data-rh="true" rel="alternate" href="https://RulerChen.github.io/RulerChen-Website/docs/CMU15-445/c23/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://GSV9DQB5UM-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"CMU 15-445","item":"https://RulerChen.github.io/RulerChen-Website/docs/CMU15-445/"},{"@type":"ListItem","position":2,"name":"Distributed OLTP Database Systems","item":"https://RulerChen.github.io/RulerChen-Website/docs/CMU15-445/c23"}]}</script><link rel="alternate" type="application/rss+xml" href="/RulerChen-Website/blog/rss.xml" title="RulerChen RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/RulerChen-Website/blog/atom.xml" title="RulerChen Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8BEHDPLQMG"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-8BEHDPLQMG",{anonymize_ip:!0})</script>



<link rel="search" type="application/opensearchdescription+xml" title="RulerChen" href="/RulerChen-Website/opensearch.xml">
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/RulerChen-Website/assets/css/styles.4ef0d38f.css">
<script src="/RulerChen-Website/assets/js/runtime~main.3de9625d.js" defer="defer"></script>
<script src="/RulerChen-Website/assets/js/main.cf9092b7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","dark"),document.documentElement.setAttribute("data-theme-choice","dark"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/RulerChen-Website/img/profile/profile.webp"><div role="region" aria-label="跳至主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳至主要内容</a></div><nav aria-label="主導航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切換導覽列" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/RulerChen-Website/"><div class="navbar__logo"><img src="/RulerChen-Website/img/profile/profile.webp" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/RulerChen-Website/img/profile/profile.webp" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">RulerChen</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/RulerChen-Website/docs/intro/">Notes</a><a class="navbar__item navbar__link" href="/RulerChen-Website/blog/">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>繁體中文</a><ul class="dropdown__menu"><li><a href="/RulerChen-Website/docs/CMU15-445/c23/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hant">繁體中文</a></li><li><a href="/RulerChen-Website/en/docs/CMU15-445/c23/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜尋 (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜尋</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到頂部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文件側邊欄" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/RulerChen-Website/docs/intro/"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/RulerChen-Website/docs/CMU15-213/"><span title="CMU 15-213" class="categoryLinkLabel_W154">CMU 15-213</span></a><button aria-label="展開側邊欄分類 &#x27;CMU 15-213&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/RulerChen-Website/docs/CMU15-445/"><span title="CMU 15-445" class="categoryLinkLabel_W154">CMU 15-445</span></a><button aria-label="收起側邊欄分類 &#x27;CMU 15-445&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c01/"><span title="Relational Model &amp; Algebra" class="linkLabel_WmDU">Relational Model &amp; Algebra</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c02/"><span title="Modern SQL" class="linkLabel_WmDU">Modern SQL</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c03/"><span title="Database Storage" class="linkLabel_WmDU">Database Storage</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c05/"><span title="Storage Models &amp; Compression" class="linkLabel_WmDU">Storage Models &amp; Compression</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c06/"><span title="Memory &amp; Disk I/O Management" class="linkLabel_WmDU">Memory &amp; Disk I/O Management</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c07/"><span title="Hash Tables" class="linkLabel_WmDU">Hash Tables</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c08/"><span title="Indexes &amp; Filters" class="linkLabel_WmDU">Indexes &amp; Filters</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c09/"><span title="Index Concurrency Control" class="linkLabel_WmDU">Index Concurrency Control</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c11/"><span title="Sorting &amp; Aggregations Algorithms" class="linkLabel_WmDU">Sorting &amp; Aggregations Algorithms</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c12/"><span title="Joins Algorithms" class="linkLabel_WmDU">Joins Algorithms</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c13/"><span title="Query Execution" class="linkLabel_WmDU">Query Execution</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c15/"><span title="Query Planning &amp; Optimization" class="linkLabel_WmDU">Query Planning &amp; Optimization</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c16/"><span title="Concurrency Control Theory" class="linkLabel_WmDU">Concurrency Control Theory</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c17/"><span title="Two-Phase Locking Concurrency Control" class="linkLabel_WmDU">Two-Phase Locking Concurrency Control</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c18/"><span title="Timestamp Ordering Concurrency Control" class="linkLabel_WmDU">Timestamp Ordering Concurrency Control</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c19/"><span title="Multi-Version Concurrency Control" class="linkLabel_WmDU">Multi-Version Concurrency Control</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c20/"><span title="Database Logging" class="linkLabel_WmDU">Database Logging</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c21/"><span title="Database Recovery" class="linkLabel_WmDU">Database Recovery</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c22/"><span title="Introduction to Distributed Databases" class="linkLabel_WmDU">Introduction to Distributed Databases</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c23/"><span title="Distributed OLTP Database Systems" class="linkLabel_WmDU">Distributed OLTP Database Systems</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/c24/"><span title="Distributed OLAP Database Systems" class="linkLabel_WmDU">Distributed OLAP Database Systems</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/p0/"><span title="P0 - C++ Primer" class="linkLabel_WmDU">P0 - C++ Primer</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/p1/"><span title="P1 - Buffer Pool Manager" class="linkLabel_WmDU">P1 - Buffer Pool Manager</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/p2/"><span title="P2 - B+ Tree" class="linkLabel_WmDU">P2 - B+ Tree</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/p3/"><span title="P3 - Query Execution" class="linkLabel_WmDU">P3 - Query Execution</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/RulerChen-Website/docs/CMU15-445/p4/"><span title="P4 - Concurrency Control" class="linkLabel_WmDU">P4 - Concurrency Control</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/RulerChen-Website/docs/Security/"><span title="Security" class="categoryLinkLabel_W154">Security</span></a><button aria-label="展開側邊欄分類 &#x27;Security&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="頁面路徑"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主頁面" class="breadcrumbs__link" href="/RulerChen-Website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/RulerChen-Website/docs/CMU15-445/"><span>CMU 15-445</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Distributed OLTP Database Systems</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本頁導覽</button></div><div class="theme-doc-markdown markdown"><header><h1>Distributed OLTP Database Systems</h1></header>
<p>在上一篇筆記中，我們討論了基本的分散式資料庫系統，但仍然有很多細節沒有討論到。</p>
<p>這篇會討論一些分散式 OLTP 系統的細節，像是 :</p>
<ul>
<li>如果其中有節點發生故障怎麼處理</li>
<li>如果訊息在網路上延遲怎麼處理</li>
<li>是否需要所有節點都同意才能 commit 一個 transaction</li>
</ul>
<p>我們假設所有的節點都是可信任的，不然就需要採用 Byzantine Fault Tolerance 的方法。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="replication">Replication<a href="#replication" class="hash-link" aria-label="Replication的直接連結" title="Replication的直接連結" translate="no">​</a></h2>
<p>DBMS 可以將資料複製到多個節點上以實現高可用性。</p>
<p>在實現上，有幾個重要的考慮因素 :</p>
<ul>
<li>Replication Configuration</li>
<li>Propagation Scheme</li>
<li>Propagation Timing</li>
<li>Update Method</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="replication-configuration">Replication Configuration<a href="#replication-configuration" class="hash-link" aria-label="Replication Configuration的直接連結" title="Replication Configuration的直接連結" translate="no">​</a></h3>
<p>為了了確保資料的高可用性，DBMS 通常會將資料複製到多個節點上，這些節點可以分佈在不同的地理位置，以防止單點故障 (SPOF)。
主要可以分為兩種方式 :</p>
<ul>
<li>Primary-Replica : 所有關於寫的操作都會先寫到 primary node，primary node 更新完後再通知其他 replica node 更新，而只讀的資料可以直接從 replica node 讀取。如果 master 節點崩潰，則由共識算法選擇新的 master 節點</li>
<li>Multi-Master : 每個節點都可以更新資料，但節點之間需要透過 atomic commit protocol 來確保一致性</li>
</ul>
<figure class="image-modal-container"><img src="/RulerChen-Website/img/cmu15-445/c23/image.webp" alt="" width="100%" class="image-modal-thumbnail" style="cursor:pointer" loading="lazy"><figcaption class="image-modal-caption">Replication</figcaption></figure>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="k-safety">K-safety<a href="#k-safety" class="hash-link" aria-label="K-safety的直接連結" title="K-safety的直接連結" translate="no">​</a></h4>
<p>K-safety 是用來衡量資料庫的容錯能力的閾值，K 值表示每個物件必須始終可用的副本數量，如果副本數量低於這個閾值，DBMS 會停止系統。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="propagation-scheme">Propagation Scheme<a href="#propagation-scheme" class="hash-link" aria-label="Propagation Scheme的直接連結" title="Propagation Scheme的直接連結" translate="no">​</a></h3>
<p>當交易在資料庫上提交時，DBMS 會決定是否需要等待該交易傳播到其他節點後再向應用程式客戶端發送確認，主要有兩種方式 :</p>
<ul>
<li>Synchronous Propagation : 主節點將更新發送到從節點，並等待它們確認已完全應用更改後，再通知客戶端更新成功。這種方法確保了強一致性，不會丟失任何數據</li>
<li>Asynchronous Propagation : 主節點在本地更新完後立即向應用程式返回確認，而不等待從節點更改完成。可能會導致讀取過期數據，但如果可以容忍某些數據丟失，這種方式是一種有效的優化</li>
</ul>
<figure class="image-modal-container"><img src="/RulerChen-Website/img/cmu15-445/c23/image-2.webp" alt="" width="100%" class="image-modal-thumbnail" style="cursor:pointer" loading="lazy"><figcaption class="image-modal-caption">Propagation Scheme</figcaption></figure>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="propagation-timing">Propagation Timing<a href="#propagation-timing" class="hash-link" aria-label="Propagation Timing的直接連結" title="Propagation Timing的直接連結" translate="no">​</a></h3>
<p>主節點甚麼時候將更新發送到從節點的策略，主要有兩種方式 :</p>
<ul>
<li>Continuous Propagation : DBMS 在生成 log 後立即發送 log 給從節點，其中包括提交和中止消息</li>
<li>On Commit Propagation : DBMS 只有在交易提交後才將該交易的 log 發送到從節點，避免了為 abort 的交易傳送 log，但會導致同步效率較低</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="active-vs-passive">Active vs Passive<a href="#active-vs-passive" class="hash-link" aria-label="Active vs Passive的直接連結" title="Active vs Passive的直接連結" translate="no">​</a></h3>
<p>根據如何將更改應用到從節點上，複製可以分為兩種方式 :</p>
<ul>
<li>Active-Active : 交易在每個從節點上獨立執行，最後 DBMS 檢查每個節點上的結果是否一致，以確保交易正確提交</li>
<li>Active-Passive : 交易在一個節點上執行，然後將總體更改傳播到從節點</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="atomic-commit-protocols">Atomic Commit Protocols<a href="#atomic-commit-protocols" class="hash-link" aria-label="Atomic Commit Protocols的直接連結" title="Atomic Commit Protocols的直接連結" translate="no">​</a></h2>
<p>在多個節點上執行交易時，DBMS 需要確保所有節點都同意提交或中止交易，以確保資料的一致性，這就是原子提交協議 (Atomic Commit Protocols) 的作用。</p>
<p>通常來說，這種協議需要保證以下幾點 :</p>
<ul>
<li>Stability : 決定後不可更改</li>
<li>Consistency : 所有節點一致</li>
<li>Liveness : 協議能持續推進</li>
</ul>
<p>常見的協議包括 :</p>
<ul>
<li>Two-Phase Commit (2PC)</li>
<li>Three-Phase Commit (3PC)</li>
<li>Paxos</li>
<li>Raft</li>
<li>Zookeeper Atomic Broadcast (ZAB)</li>
<li>Viewstamped Replication</li>
</ul>
<p>這裡主要討論 2PC 和 Paxos。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="two-phase-commit-2pc">Two-Phase Commit (2PC)<a href="#two-phase-commit-2pc" class="hash-link" aria-label="Two-Phase Commit (2PC)的直接連結" title="Two-Phase Commit (2PC)的直接連結" translate="no">​</a></h3>
<p>2PC 是一個經典的分散式交易提交協議，分為兩個階段 :</p>
<ul>
<li>Prepare Phase</li>
<li>Commit Phase</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2pc-success">2PC Success<a href="#2pc-success" class="hash-link" aria-label="2PC Success的直接連結" title="2PC Success的直接連結" translate="no">​</a></h4>
<p>首先應用程式會向協調者發送提交請求之後進入準備階段 (prepare phase)。</p>
<p>協調者向參與節點發送 prepare 請求，詢問它們是否可以提交當前交易</p>
<figure class="image-modal-container"><img src="/RulerChen-Website/img/cmu15-445/c23/image-3.webp" alt="" width="100%" class="image-modal-thumbnail" style="cursor:pointer" loading="lazy"><figcaption class="image-modal-caption">2PC Success - 1</figcaption></figure>
<p>等待所有節點回覆 OK 後，則進入提交階段 (commit phase)。</p>
<p>協調者會向所有參與者發送提交消息，通知它們提交交易。</p>
<figure class="image-modal-container"><img src="/RulerChen-Website/img/cmu15-445/c23/image-4.webp" alt="" width="100%" class="image-modal-thumbnail" style="cursor:pointer" loading="lazy"><figcaption class="image-modal-caption">2PC Success - 2</figcaption></figure>
<p>等待所有交易提交後，協調者向應用程式回覆提交成功。</p>
<figure class="image-modal-container"><img src="/RulerChen-Website/img/cmu15-445/c23/image-5.webp" alt="" width="100%" class="image-modal-thumbnail" style="cursor:pointer" loading="lazy"><figcaption class="image-modal-caption">2PC Success - 3</figcaption></figure>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2pc-abort">2PC Abort<a href="#2pc-abort" class="hash-link" aria-label="2PC Abort的直接連結" title="2PC Abort的直接連結" translate="no">​</a></h4>
<p>在準備階段時，如果有任何一個節點無法執行，則應該回覆 ABORT 給協調者。</p>
<figure class="image-modal-container"><img src="/RulerChen-Website/img/cmu15-445/c23/image-6.webp" alt="" width="100%" class="image-modal-thumbnail" style="cursor:pointer" loading="lazy"><figcaption class="image-modal-caption">2PC Abort - 1</figcaption></figure>
<p>而此時協調者應該向應用程式回覆提交失敗，同時向所有參與者發送中止消息，並且確保所有交易都有回滾。</p>
<figure class="image-modal-container"><img src="/RulerChen-Website/img/cmu15-445/c23/image-7.webp" alt="" width="100%" class="image-modal-thumbnail" style="cursor:pointer" loading="lazy"><figcaption class="image-modal-caption">2PC Abort - 2</figcaption></figure>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2pc-optimization">2PC Optimization<a href="#2pc-optimization" class="hash-link" aria-label="2PC Optimization的直接連結" title="2PC Optimization的直接連結" translate="no">​</a></h4>
<ul>
<li>Early Prepare Voting (Rare): 如果發送查詢到已知將是交易中最後一個執行的遠端節點，該節點會連同查詢結果一起返回其準備階段的投票。</li>
<li>Early Acknowledgement after Prepare (Common): 如果所有節點都在準備階段同意提交交易，協調者可以在提交階段完成前向客戶端發送成功確認</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2pc-fault-tolerance">2PC Fault Tolerance<a href="#2pc-fault-tolerance" class="hash-link" aria-label="2PC Fault Tolerance的直接連結" title="2PC Fault Tolerance的直接連結" translate="no">​</a></h4>
<p>在 Two-Phase Commit 中，每個節點必須將自身在各階段的輸入與輸出記錄到日誌，以便在故障後進行恢復。恢復過程中可能出現的情況如下：</p>
<p>從協調者來看 :</p>
<ul>
<li>故障在準備階段結束前 : 由於沒有任何節點收到 commit 指令，因此可以直接 abort</li>
<li>故障在提交階段結束前 : 由於有些節點可能已經收到 commit 指令，因此需要重新發送 commit 指令並等待所有節點回覆</li>
</ul>
<p>從參與者來看 :</p>
<ul>
<li>故障在準備階段投票前 : 由於沒有回傳任何訊息，因此可以直接 abort，同時協調者也會因為沒有收到回覆而 abort</li>
<li>故障在準備階段投票後等待最終決定前 : 聯繫協調者以獲取最終決定，如果協調者也故障，則等待協調者恢復</li>
<li>故障在收到最終決定後 : 聯繫協調者以獲取最終決定，同時協調者也會因為沒有收到回覆而不斷重發最終決定</li>
</ul>
<p>由於 2PC 需要等待所有參與節點回覆，任何節點或協調者故障都可能導致 阻塞 (blocking)，甚至出現 livelock。
這是 2PC 的主要缺陷，因此在需要更高容錯性與非阻塞特性的系統中，通常會改採用共識協議 (如 Paxos 或 Raft)。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="paxos">Paxos<a href="#paxos" class="hash-link" aria-label="Paxos的直接連結" title="Paxos的直接連結" translate="no">​</a></h3>
<p>Paxos 是一種共識算法，在這個算法中，提議者會負責提交 commit 或 abort 的指令，而接受者則投票決定是否接受提議，由於不需要每個節點都同意，因此效能上會比 2PC 好。</p>
<p>Paxos 的協調者被稱為提議者 (Proposer)，參與者被稱為接受者 (Acceptor)。</p>
<p>首先，應用程式會向 proposer 發送提交請求，然後 proposer 會向 acceptor 發送提議。</p>
<figure class="image-modal-container"><img src="/RulerChen-Website/img/cmu15-445/c23/image-8.webp" alt="" width="100%" class="image-modal-thumbnail" style="cursor:pointer" loading="lazy"><figcaption class="image-modal-caption">Paxos</figcaption></figure>
<p>與 2PC 不同的是，Paxos 不需要等待所有節點的回覆，只需要等待過半數的節點同意即可，因此會繼續向 acceptor 發送 commit 請求。</p>
<figure class="image-modal-container"><img src="/RulerChen-Website/img/cmu15-445/c23/image-9.webp" alt="" width="100%" class="image-modal-thumbnail" style="cursor:pointer" loading="lazy"><figcaption class="image-modal-caption">Paxos</figcaption></figure>
<p>但不同的是，即使在 commit 階段，acceptor 也可以拒絕提議，舉例如下 :</p>
<p>假設有兩個 proposer，proposer 1 在 n 的時間提出協議並被所有人 agree。</p>
<figure class="image-modal-container"><img src="/RulerChen-Website/img/cmu15-445/c23/image-10.webp" alt="" width="100%" class="image-modal-thumbnail" style="cursor:pointer" loading="lazy"><figcaption class="image-modal-caption">Paxos</figcaption></figure>
<p>這時候 proposer 2 在 n+1 的時間提出協議，接著 proposer 1 發出 commit 請求，由於時間先後順序，acceptor 會拒絕 proposer 1 的提議，之後 proposer 2 會繼續直到提交完成。</p>
<figure class="image-modal-container"><img src="/RulerChen-Website/img/cmu15-445/c23/image-11.webp" alt="" width="100%" class="image-modal-thumbnail" style="cursor:pointer" loading="lazy"><figcaption class="image-modal-caption">Paxos</figcaption></figure>
<p>這樣會導致的問題是有可能同時兩個 proposer 互相組塞，因此我們可以透過 Multi-Paxos 來解決這個問題。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="multi-paxos">Multi-Paxos<a href="#multi-paxos" class="hash-link" aria-label="Multi-Paxos的直接連結" title="Multi-Paxos的直接連結" translate="no">​</a></h4>
<p>如果系統內常有任意數量的 proposer，達成共識就會有點困難，因此我們可以先透過 Paxos 選出一個主要的提議者，然後由主要提議者來進行提議，並在達到一定時間之後再重新選舉主要提議者。
這樣在一段時間內提交交易就不需要 propose 而是直接進行 commit，這樣就能提高效率。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="consistency-issues-cap--pacelc">Consistency Issues (CAP / PACELC)<a href="#consistency-issues-cap--pacelc" class="hash-link" aria-label="Consistency Issues (CAP / PACELC)的直接連結" title="Consistency Issues (CAP / PACELC)的直接連結" translate="no">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cap">CAP<a href="#cap" class="hash-link" aria-label="CAP的直接連結" title="CAP的直接連結" translate="no">​</a></h3>
<p>CAP 定理指出一個分散式系統無法同時滿足以下三個條件 :</p>
<ul>
<li>一致性 (Consistency) : 對所有節點上的操作來說，一旦寫入完成，所有後續的讀取應該返回該寫入的值或更晚的寫入值</li>
<li>可用性 (Availability) : 可用性指的是所有仍在運行的節點都能滿足所有請求的能力。即使部分節點故障，仍然能夠提供服務</li>
<li>分區容錯性 (Partition Tolerance) : 分區容錯性意味著即使系統中部分節點間的消息丟失，系統仍能正確運行</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pacelc">PACELC<a href="#pacelc" class="hash-link" aria-label="PACELC的直接連結" title="PACELC的直接連結" translate="no">​</a></h3>
<p>CAP 定理的現代版本是 PACELC 定理，這個定理進一步考慮了一致性和延遲之間的取捨。</p>
<ul>
<li>P (Partition)：當在網絡分區時，系統必須在可用性 (A) 和一致性 (C) 之間做出選擇。</li>
<li>E (Else)：即使在系統運行正常且無網絡分區的情況下，也必須在延遲 (L) 和一致性 (C) 之間做出選擇。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cap-vs-pacelc">CAP vs PACELC<a href="#cap-vs-pacelc" class="hash-link" aria-label="CAP vs PACELC的直接連結" title="CAP vs PACELC的直接連結" translate="no">​</a></h3>
<p>在 RDBMS 中，通常會在重要節點故障時拒絕寫入，以確保一致性，而在 NoSQL 中，通常會接受寫入，常採用的策略是最後一次寫入勝出。</p></div><div style="margin-top:32px"></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>標籤：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/RulerChen-Website/docs/tags/cmu-15-445/">CMU15-445</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/c23.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>編輯此頁</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最後<!-- -->於 <b><time datetime="2025-09-15T11:43:15.000Z" itemprop="dateModified">2025年9月15日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件選項卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/RulerChen-Website/docs/CMU15-445/c22/"><div class="pagination-nav__sublabel">上一頁</div><div class="pagination-nav__label">Introduction to Distributed Databases</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/RulerChen-Website/docs/CMU15-445/c24/"><div class="pagination-nav__sublabel">下一頁</div><div class="pagination-nav__label">Distributed OLAP Database Systems</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#replication" class="table-of-contents__link toc-highlight">Replication</a><ul><li><a href="#replication-configuration" class="table-of-contents__link toc-highlight">Replication Configuration</a></li><li><a href="#propagation-scheme" class="table-of-contents__link toc-highlight">Propagation Scheme</a></li><li><a href="#propagation-timing" class="table-of-contents__link toc-highlight">Propagation Timing</a></li><li><a href="#active-vs-passive" class="table-of-contents__link toc-highlight">Active vs Passive</a></li></ul></li><li><a href="#atomic-commit-protocols" class="table-of-contents__link toc-highlight">Atomic Commit Protocols</a><ul><li><a href="#two-phase-commit-2pc" class="table-of-contents__link toc-highlight">Two-Phase Commit (2PC)</a></li><li><a href="#paxos" class="table-of-contents__link toc-highlight">Paxos</a></li></ul></li><li><a href="#consistency-issues-cap--pacelc" class="table-of-contents__link toc-highlight">Consistency Issues (CAP / PACELC)</a><ul><li><a href="#cap" class="table-of-contents__link toc-highlight">CAP</a></li><li><a href="#pacelc" class="table-of-contents__link toc-highlight">PACELC</a></li><li><a href="#cap-vs-pacelc" class="table-of-contents__link toc-highlight">CAP vs PACELC</a></li></ul></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>