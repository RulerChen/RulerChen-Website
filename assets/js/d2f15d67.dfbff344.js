"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4e3],{39004:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"CMU15-445/p1","title":"P1 - Buffer Pool Manager","description":"Buffer Pool Manager","source":"@site/docs/CMU15-445/p1.mdx","sourceDirName":"CMU15-445","slug":"/CMU15-445/p1","permalink":"/RulerChen-Website/docs/CMU15-445/p1","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/p1.mdx","tags":[],"version":"current","lastUpdatedAt":1748006674000,"sidebarPosition":31,"frontMatter":{"title":"P1 - Buffer Pool Manager","sidebar_position":31,"description":"Buffer Pool Manager","keywords":["CMU15-445/645","Buffer Pool Manager","CMU15-445/645 \u7b46\u8a18"]},"sidebar":"tutorialSidebar","previous":{"title":"P0 - C++ Primer","permalink":"/RulerChen-Website/docs/CMU15-445/p0"},"next":{"title":"P2 - B+ Tree","permalink":"/RulerChen-Website/docs/CMU15-445/p2"}}');var i=r(74848),s=r(28453);const l={title:"P1 - Buffer Pool Manager",sidebar_position:"31",description:"Buffer Pool Manager",keywords:["CMU15-445/645","Buffer Pool Manager","CMU15-445/645 \u7b46\u8a18"]},d=void 0,t={},c=[{value:"Problem Description",id:"problem-description",level:2},{value:"Solution",id:"solution",level:2},{value:"Task 1: LRU-K Replacement Policy",id:"task-1-lru-k-replacement-policy",level:3},{value:"Task 2: Disk Scheduler",id:"task-2-disk-scheduler",level:3},{value:"Task 3: Buffer Pool Manager",id:"task-3-buffer-pool-manager",level:3},{value:"Submit",id:"submit",level:2},{value:"Reference",id:"reference",level:2}];function o(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components},{Head:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r,{children:(0,i.jsx)("title",{children:"CMU 15-445/645 Project#1 Buffer Pool Manager"})}),"\n",(0,i.jsx)(n.h2,{id:"problem-description",children:"Problem Description"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u9019\u500b project \u4e2d\uff0c\u6211\u5011\u9700\u8981\u5be6\u73fe\u4e00\u500b buffer pool manager\uff0c\u7e3d\u5171\u6709 3 \u500b Task :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["LRU-K Replacement Policy : \u4fee\u6539 ",(0,i.jsx)(n.code,{children:"/src/buffer/lru_k_replacer.cpp"})," \u4f86\u5be6\u73fe LRU-K replacement policy"]}),"\n",(0,i.jsxs)(n.li,{children:["Disk Scheduler : \u4fee\u6539 ",(0,i.jsx)(n.code,{children:"/src/storage/disk/disk_scheduler.cpp"})," \u4f86\u5be6\u73fe disk scheduler"]}),"\n",(0,i.jsxs)(n.li,{children:["Buffer Pool Manager : \u4fee\u6539 ",(0,i.jsx)(n.code,{children:"/src/buffer/buffer_pool_manager.cpp"})," \u8ddf ",(0,i.jsx)(n.code,{children:"/src/storage/page/page_guard.cpp"})," \u4f86\u5be6\u73fe buffer pool manager"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"solution",children:"Solution"}),"\n",(0,i.jsx)(n.p,{children:"\u6211\u63a1\u53d6\u7684\u505a\u6cd5\u90fd\u662f\u53ea\u6c42\u901a\u904e\u4e0d\u6c42\u6548\u80fd\uff0c\u5982\u679c\u60f3\u8981\u9032\u884c\u6548\u80fd\u512a\u5316\uff0c\u53ef\u4ee5\u53c3\u8003\u6700\u4e0b\u65b9 Reference \u4e2d\u7684\u6587\u7ae0\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"task-1-lru-k-replacement-policy",children:"Task 1: LRU-K Replacement Policy"}),"\n",(0,i.jsx)(n.p,{children:"\u9019\u500b Task \u4e3b\u8981\u662f\u8981\u5be6\u73fe LRU-K replacement policy\uff0c\u7528\u65bc\u5224\u65b7\u54ea\u500b\u9801\u9762\u8981\u88ab\u79fb\u51fa\u8a18\u61b6\u9ad4\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e0d\u8003\u616e\u6548\u80fd\u7684\u8a71\u53ea\u9700\u8981\u5168\u90e8\u90fd\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"std::scoped_lock"})," \u5373\u53ef\uff0c\u53ef\u4ee5\u9806\u4fbf\u5c0d ",(0,i.jsx)(n.code,{children:"LRUKNode"})," \u5beb\u4e00\u4e9b get function \u4f86\u65b9\u4fbf\u53d6\u5f97\u8cc7\u6599\u3002"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Evict() -> std::optional<frame_id_t>"})," : \u512a\u5148\u5ea6\u662f\u5148\u627e\u6709 inf \u7684\uff0c\u90fd\u662f inf \u5c31\u6bd4\u7b2c\u4e00\u6b21\u8b80\u53d6\u7684\u6642\u5019\u54ea\u500b\u6700\u65e9\uff0c\u5982\u679c\u90fd\u6c92\u6709 inf \u7684\u8a71\u5c31\u4e5f\u627e\u7b2c\u4e00\u6b21\u8b80\u53d6\u7684\u6642\u5019\u54ea\u500b\u6700\u65e9 (",(0,i.jsx)(n.code,{children:"this->history_.back()"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RecordAccess(frame_id_t frame_id)"})," : \u66f4\u65b0 ",(0,i.jsx)(n.code,{children:"history_"})," \u4e2d\u7684\u8cc7\u6599"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Remove(frame_id_t frame_id)"})," : \u6aa2\u67e5\u662f\u5426\u662f ",(0,i.jsx)(n.code,{children:"evictable"})," \u4e4b\u5f8c\u5c31\u53ef\u4ee5\u76f4\u63a5\u522a\u9664"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SetEvictable(frame_id_t frame_id, bool set_evictable)"})," : \u5224\u65b7 ",(0,i.jsx)(n.code,{children:"IsEvictable"})," \u7684\u60c5\u6cc1\u4e26\u522a\u9664\u5373\u53ef"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Size() -> size_t"})," : \u76f4\u63a5\u56de\u50b3 ",(0,i.jsx)(n.code,{children:"curr_size_"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd build\nmake lru_k_replacer_test -j$(nproc)\n\n./test/lru_k_replacer_test\n"})}),"\n",(0,i.jsx)(n.h3,{id:"task-2-disk-scheduler",children:"Task 2: Disk Scheduler"}),"\n",(0,i.jsx)(n.p,{children:"\u9019\u500b Task \u4e3b\u8981\u662f\u8981\u5be6\u73fe disk scheduler\uff0c\u4e3b\u8981\u662f\u7528\u4f86\u8655\u7406 IO \u7684\u8acb\u6c42\uff0c\u5c07\u8acb\u6c42\u6392\u5230 queue \u4e2d\uff0c\u6700\u5f8c\u80cc\u666f\u57f7\u884c\u7684 worker thread \u6703\u5c07\u8acb\u6c42\u8655\u7406\u5b8c\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u9700\u8981\u4fee\u6539\u5169\u500b function :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Schedule(DiskRequest r)"})," : \u53ea\u9700\u8981\u5c07 r \u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"std::move"})," \u4e1f\u5230 ",(0,i.jsx)(n.code,{children:"request_queue_"})," \u4e2d\u5373\u53ef"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"StartWorkerThread()"})," : \u8a2d\u8a08\u4e00\u500b\u6c92\u6709\u7d42\u6b62\u7684 while \u8ff4\u5708\uff0c\u4e26\u5c07 request \u4f9d\u64da read / write \u7684\u60c5\u6cc1\u4f86\u57f7\u884c\uff0c\u6700\u5f8c\u518d\u8a2d\u5b9a callback \u70ba true \u5373\u53ef"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u4ee5\u53ca\u8981\u6ce8\u610f\u8a3b\u89e3\u6389\u5efa\u69cb\u5b50\u4e2d\u7684 throw error\uff0c\u9019\u6a23\u624d\u80fd\u6b63\u5e38\u57f7\u884c test\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd build\nmake disk_scheduler_test -j$(nproc)\n\n./test/disk_scheduler_test\n"})}),"\n",(0,i.jsx)(n.h3,{id:"task-3-buffer-pool-manager",children:"Task 3: Buffer Pool Manager"}),"\n",(0,i.jsx)(n.p,{children:"\u9019\u500b Task \u61c9\u8a72\u662f\u9019\u500b project \u4e2d\u6700\u96e3\u7684\u90e8\u5206\uff0c\u4e3b\u8981\u662f\u8981\u5be6\u73fe Page Guard \u8ddf Buffer Pool Manager \u7684\u529f\u80fd\u3002"}),"\n",(0,i.jsx)(n.p,{children:"Page Guard \u61c9\u8a72\u662f 2024 \u7248\u672c\u624d\u6709\u7684\u65b0\u6771\u897f\uff0c\u5b83\u662f\u4e00\u500b\u53ef\u4ee5\u5c0d\u8a18\u61b6\u9ad4\u9032\u884c\u8b80\u5beb\u7684\u8cc7\u6599\u7d50\u69cb\uff0c\u662f Buffer Pool Manager \u4e2d\u7528\u4f86\u4fdd\u8b49\u5b89\u5168\u8b80\u5beb\u9801\u9762 (follow RAII) \u7684\u5de5\u5177\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["Buffer Pool Manager \u5247\u662f\u7528\u4f86\u7ba1\u7406 buffer pool \u7684\u8cc7\u6599\u7d50\u69cb\uff0c\u4e3b\u8981\u7dad\u8b77 page \u8ddf frame \u7684\u5c0d\u61c9\u95dc\u4fc2\uff0c\u9664\u6b64\u4e4b\u5916\u4e5f\u5305\u542b\u4e86 ",(0,i.jsx)(n.code,{children:"replacer_"})," \u8ddf ",(0,i.jsx)(n.code,{children:"disk_scheduler_"})," \u4f86\u505a\u9801\u9762\u66ff\u63db\u4ee5\u53ca\u786c\u789f\u7684\u8b80\u5beb\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u6211\u5011\u5148\u628a\u5728\u55ae\u7dda\u7a0b\u4e0b\u7684\u529f\u80fd\u5beb\u597d\uff0c\u7136\u5f8c\u518d\u4f86\u8a0e\u8ad6\u9396\u7684\u554f\u984c\uff0c\u6211\u5011\u7e3d\u5171\u8981\u8655\u7406\u4ee5\u4e0b\u5e7e\u500b function :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReadPageGuard::ReadPageGuard()"})," : \u53d6\u5f97 frame_->rwlatch \u7684\u5171\u4eab\u9396\uff0c\u4e26\u628a is_valid \u8a2d\u5b9a\u70ba true"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReadPageGuard::ReadPageGuard(ReadPageGuard &&that)"})," : \u5148 Drop \u6389\u539f\u672c PageGuard \u7684\u8cc7\u6599\uff0c\u518d\u4f7f\u7528\u79fb\u52d5\u8a9e\u610f\u4f86\u628a\u8cc7\u6599\u79fb\u904e\u4f86\uff0c\u7279\u5225\u6ce8\u610f\u9700\u8981\u5148\u6aa2\u67e5 this \u8ddf that \u662f\u5426\u76f8\u540c\uff0c\u4ee5\u53ca\u628a\u820a\u7684 is_valid \u8a2d\u5b9a\u70ba false"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReadPageGuard::operator=(ReadPageGuard &&that) -> ReadPageGuard &"})," : \u985e\u4f3c\u524d\u9762"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReadPageGuard::Drop()"})," : \u5148\u6aa2\u67e5 is_valid \u662f\u5426\u70ba true\uff0c\u5982\u679c\u662f\u7684\u8a71\u8655\u7406 pin_count \u8ddf SetEvictable \u7684\u60c5\u6cc1\uff0c\u7136\u5f8c\u518d\u628a is_valid \u8a2d\u5b9a\u70ba false"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"WritePageGuard \u7684\u90e8\u5206\u5927\u90e8\u5206\u8ddf ReadPageGuard \u4e00\u6a23\uff0c\u53ea\u662f\u8981\u6539\u6210\u4f7f\u7528\u7368\u4f54\u9396\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"NewPage() -> page_id_t"})," : \u628a next",(0,i.jsx)(n.em,{children:"page_id +1 \u4e4b\u5f8c\u4f7f\u7528 disk_scheduler"}),"->IncreaseDiskSpace() \u65b0\u589e\u7a7a\u9593\u5373\u53ef"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"DeletePage(page_id_t page_id) -> bool"})," : \u5148\u78ba\u5b9a\u9019\u500b page \u6709\u5728 page_table \u4e2d\uff0c\u63a5\u8457\u518d\u6aa2\u67e5 pin_count \u662f\u5426\u70ba 0\uff0c\u7136\u5f8c\u518d\u6aa2\u67e5 is_dirty \u770b\u662f\u5426\u9700\u8981 FlushPage\uff0c\u6700\u5f8c\u518d Reset() \u5373\u53ef"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"CheckedWritePage(page_id_t page_id) -> std::optional<WritePageGuard>"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"CheckedReadPage(page_id_t page_id) -> std::optional<ReadPageGuard>"})," :"]}),"\n",(0,i.jsx)(n.p,{children:"\u9019\u5169\u500b\u51fd\u6578\u662f\u9019\u500b Task \u6700\u91cd\u8981\u7684\u51fd\u6578\uff0c\u90fd\u5206\u6210\u4e09\u7a2e\u60c5\u6cc1 :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u9019\u500b page \u5df2\u7d93\u5728 buffer pool \u4e2d\u4e86\uff0c\u90a3\u6211\u5011\u5c31\u8981\u66f4\u65b0\u4ed6\u7684\u8cc7\u6599 (pin_count, evictable, recordaccess) \u4e26\u56de\u50b3"}),"\n",(0,i.jsx)(n.li,{children:"page_id \u4e0d\u5728 buffer pool \u4e2d\uff0c\u4f46\u662f free_frame \u4e2d\u6709\u7a7a\u9593\uff0c\u90a3\u6211\u5011\u5c31\u53ef\u4ee5 pop_front \u4e00\u500b frame\uff0c\u7136\u5f8c\u4e00\u6a23\u66f4\u65b0 metadata"}),"\n",(0,i.jsx)(n.li,{children:"page_id \u4e0d\u5728 buffer pool \u4e2d\uff0cfree_frame \u4e5f\u6c92\u6709\u7a7a\u9593\uff0c\u90a3\u6211\u5011\u5c31\u8981\u4f7f\u7528 lru_k_replacer \u4f86 evict \u4e00\u500b frame\uff0c\u7136\u5f8c\u4e00\u6a23\u66f4\u65b0 metadata"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"FlushPage(page_id_t page_id) -> bool"})," : \u6aa2\u67e5 page_id \u662f\u5426\u5728 page_table \u4e2d\uff0c\u7136\u5f8c\u6aa2\u67e5 is_dirty \uff0c\u53ef\u4ee5\u4f7f\u7528 disk_scheduler \u4f86\u628a\u8cc7\u6599\u5beb\u56de disk\uff0c\u4e0d\u7528\u7279\u5225\u4f7f\u7528 bpm \u7684\u5927\u9396"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"FlushAllPages()"})," : \u904d\u6b77 page_table \u4e2d\u7684\u8cc7\u6599\uff0c\u7136\u5f8c\u4f7f\u7528 FlushPage \u4f86\u5beb\u56de disk"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"GetPinCount(page_id_t page_id)"})," : \u4e00\u6a23\u904d\u6b77\u6aa2\u67e5\u5373\u53ef"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u8a0e\u8ad6\u5b8c\u57fa\u672c\u529f\u80fd\u4e4b\u5f8c\u6211\u8a8d\u70ba\u6700\u91cd\u8981\u7684\u90e8\u5206\u5c31\u662f concurrency \u7684\u554f\u984c\uff0c\u9700\u8981\u6ce8\u610f\u5230\u5728\u9019\u500b Task \u4e2d\u6211\u5011\u6709\u5169\u500b\u9396\uff0c\u4e00\u500b\u662f bpm \u7684\u5927\u9396\uff0c\u53e6\u4e00\u500b\u662f frame \u7684\u5c0f\u9396\uff0c\u6211\u5011\u9700\u8981\u78ba\u4fdd\u9019\u5169\u500b\u9396\u5728\u4f7f\u7528\u4e0a\u4e0d\u6703\u767c\u751f deadlock\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u6211\u5011\u53ef\u4ee5\u5f9e\u63d0\u4f9b\u7684 ",(0,i.jsx)(n.code,{children:"DeadlockTest"})," \u4f86\u5c0b\u627e\u65b9\u5411\uff0c\u9019\u500b\u6e2c\u8a66\u5982\u4e0b :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",metastring:'title="test/buffer/buffer_pool_manager_test.cpp"',children:'TEST(BufferPoolManagerTest, DeadlockTest) {\n  auto disk_manager = std::make_shared<DiskManager>(db_fname);\n  auto bpm = std::make_shared<BufferPoolManager>(FRAMES, disk_manager.get(), K_DIST);\n\n  auto pid0 = bpm->NewPage();\n  auto pid1 = bpm->NewPage();\n\n  auto guard0 = bpm->WritePage(pid0);\n\n  // A crude way of synchronizing threads, but works for this small case.\n  std::atomic<bool> start = false;\n\n  auto child = std::thread([&]() {\n    // Acknowledge that we can begin the test.\n    start.store(true);\n\n    // Attempt to write to page 0.\n    auto guard0 = bpm->WritePage(pid0);\n  });\n\n  // Wait for the other thread to begin before we start the test.\n  while (!start.load()) {\n  }\n\n  // Make the other thread wait for a bit.\n  // This mimics the main thread doing some work while holding the write latch on page 0.\n  std::this_thread::sleep_for(std::chrono::milliseconds(1000));\n\n  // If your latching mechanism is incorrect, the next line of code will deadlock.\n  // Think about what might happen if you hold a certain "all-encompassing" latch for too long...\n\n  // While holding page 0, take the latch on page 1.\n  auto guard1 = bpm->WritePage(pid1);\n\n  // Let the child thread have the page 0 since we\'re done with it.\n  guard0.Drop();\n\n  child.join();\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5148\u7c21\u55ae\u6558\u8ff0\u4e00\u4e0b\u9019\u500b Test \u7684\u908f\u8f2f\uff0c\u9996\u5148\u4e3b\u57f7\u884c\u7dd2\u6703\u5148\u53d6\u5f97 page 0 \u7684\u7368\u4f54\u9396\uff0c\u63a5\u8457\u555f\u52d5\u4e00\u500b\u5b50\u57f7\u884c\u7dd2\u4e5f\u4f86\u8b80\u53d6 page 0 \u7684\u7368\u4f54\u9396\uff0c\u9019\u6642\u5019\u4e3b\u57f7\u884c\u7dd2\u6703\u5148\u7761 1 \u79d2\u9418\uff0c\u7136\u5f8c\u518d\u53d6\u5f97 page 1 \u7684\u7368\u4f54\u9396\uff0c\u6700\u5f8c\u4e3b\u57f7\u884c\u7dd2\u518d\u91cb\u653e page 0 \u7684\u7368\u4f54\u9396\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u5982\u679c\u6211\u5011\u76f4\u63a5\u5728 ",(0,i.jsx)(n.code,{children:"CheckedWritePage"})," \u4e2d\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"std::scoped_lock"})," \u4f86\u9396\u4f4f bpm \u7684\u5927\u9396\uff0c\u90a3\u9ebc\u9019\u500b\u6e2c\u8a66\u5c31\u6703\u6b7b\u9396\uff0c\u4e3b\u8981\u7684\u6d41\u7a0b\u5982\u4e0b :"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"\u4e3b\u57f7\u884c\u7dd2\u53d6\u5f97 bpm \u7684\u5927\u9396"}),"\n",(0,i.jsx)(n.li,{children:"\u4e3b\u57f7\u884c\u7dd2\u53d6\u5f97 page 0 \u7684\u7368\u4f54\u9396"}),"\n",(0,i.jsx)(n.li,{children:"\u4e3b\u57f7\u884c\u7dd2\u653e\u68c4 bpm \u7684\u5927\u9396"}),"\n",(0,i.jsx)(n.li,{children:"\u5b50\u57f7\u884c\u7dd2\u53d6\u5f97 bpm \u7684\u5927\u9396"}),"\n",(0,i.jsx)(n.li,{children:"\u5b50\u57f7\u884c\u7dd2\u7b49\u5f85 page 0 \u7684\u7368\u4f54\u9396"}),"\n",(0,i.jsx)(n.li,{children:"\u4e3b\u57f7\u884c\u7dd2\u7b49\u5f85 bpm \u7684\u5927\u9396 (\u6e96\u5099\u8b80\u53d6 page 1)"}),"\n",(0,i.jsx)(n.li,{children:"\u7531\u65bc\u5169\u908a\u90fd\u5728\u7b49\u5f85\u5c0d\u65b9\u7684\u9396\uff0c\u6240\u4ee5\u5c31\u6703\u6b7b\u9396"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u7531\u4e0a\u9762\u7684\u7bc4\u4f8b\u6211\u5011\u53ef\u4ee5\u77e5\u9053\uff0c\u6211\u5011\u5fc5\u9808\u8981\u8b93\u4f4e\u7d1a\u7684\u9396 (rwlatch) \u53d6\u5f97\u7684\u6642\u5019\u9ad8\u7d1a\u7684\u9396\u4e0d\u6703\u540c\u6642\u88ab\u9396\u4f4f\uff0c\u9019\u6a23\u624d\u80fd\u907f\u514d\u6b7b\u9396\u7684\u554f\u984c\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u6211\u5728\u5be6\u4f5c\u4e0a\u63a1\u53d6\u7684\u65b9\u6cd5\u662f\u5728 ",(0,i.jsx)(n.code,{children:"CheckedWritePage"})," \u4e2d\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"std::unique_lock"})," \u4f86\u53d6\u5f97 bpm \u7684\u5927\u9396\uff0c\u63a5\u8457\u5728\u5275\u5efa ",(0,i.jsx)(n.code,{children:"WritePageGuard"})," \u524d\u89e3\u9396\uff0c\u63a5\u8457\u5728 ",(0,i.jsx)(n.code,{children:"WritePageGuard"})," \u7684 constructor \u4e2d\u53d6\u5f97 page \u7684\u5c0f\u9396\uff0c\u6700\u5f8c\u5728 ",(0,i.jsx)(n.code,{children:"Drop()"})," \u7684\u6642\u5019\u5148\u91cb\u653e page \u7684\u5c0f\u9396\uff0c\u518d\u4f7f\u7528 bpm \u7684\u5927\u9396\u66f4\u65b0 page \u7684 metadata\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u908f\u8f2f\u4e0a\u5927\u81f4\u5982\u4e0b :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"auto BufferPoolManager::CheckedWritePage() -> std::optional<WritePageGuard> {\n  std::unique_lock latch(*bpm_latch_);\n\n  // case 1: bpm have this page in memory\n  if (case1) {\n    // update metadata here\n    latch.unlock();\n    return std::make_optional(WritePageGuard());\n  }\n\n  // case 2: bpm does not have this page in memory but has free frames\n  if (case2) {\n    // update metadata here\n    latch.unlock();\n    return std::make_optional(WritePageGuard());\n  }\n  // anything else\n  return std::nullopt;\n}\n\nWritePageGuard::WritePageGuard(){\n  frame_->rwlatch_.lock();\n  // update metadata here\n}\n\nvoid WritePageGuard::Drop() {\n  frame_->rwlatch_.unlock();\n  {\n    std::scoped_lock lock(*bpm_latch_);\n    // update metadata here\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5176\u4e2d\u6211\u8a8d\u70ba\u6700\u91cd\u8981\u7684\u5730\u65b9\u5728\u65bc\u5728\u66f4\u65b0\u5982 pin_count \u4e4b\u985e\u7684 metadata \u6642\uff0c\u5fc5\u9808\u8981\u5728 bpm \u7684\u5927\u9396\u4e0b\u9032\u884c\uff0c\u9019\u6a23\u624d\u80fd\u78ba\u4fdd\u4e0d\u6703\u6709\u5176\u4ed6\u7684\u57f7\u884c\u7dd2\u540c\u6642\u4fee\u6539\u9019\u4e9b\u8cc7\u6599\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd build\n\nmake page_guard_test -j$(nproc)\n./test/page_guard_test\n\nmake buffer_pool_manager_test -j$(nproc)\n./test/buffer_pool_manager_test\n"})}),"\n",(0,i.jsx)(n.h2,{id:"submit",children:"Submit"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"make format\nmake check-format\nmake check-lint\nmake check-clang-tidy-p1\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"make submit-p1\n"})}),"\n",(0,i.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://4ever-xxxl.github.io/cmu-15445-project-1/",children:"CMU 15445 Project 1"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.aneureka.com/posts/cmu-15445-p1-opt",children:"CMU 15-445 2023 P1 \u4f18\u5316\u653b\u7565"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/1657237277",children:"CMU 15445 2024 Fall Project 1 \u8bb0\u5f55"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/828933572",children:"CMU Fall 2024 15-445 P1&P2[\u4f18\u5316 P2]"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>d});var a=r(96540);const i={},s=a.createContext(i);function l(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);