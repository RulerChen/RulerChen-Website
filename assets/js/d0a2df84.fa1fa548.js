"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[584],{3409:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>i,contentTitle:()=>t,default:()=>p,frontMatter:()=>c,metadata:()=>d,toc:()=>l});var s=o(5893),r=o(1151);const c={title:"[Docker] Docker Compose",sidebar_position:"60",description:"Docker Compose",keywords:["Docker Compose"]},t=void 0,d={id:"Docker/Compose",title:"[Docker] Docker Compose",description:"Docker Compose",source:"@site/docs/Docker/Compose.mdx",sourceDirName:"Docker",slug:"/Docker/Compose",permalink:"/RulerChen-Website/docs/Docker/Compose",draft:!1,unlisted:!1,editUrl:"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/Docker/Compose.mdx",tags:[],version:"current",lastUpdatedAt:1704861915,formattedLastUpdatedAt:"2024\u5e741\u670810\u65e5",sidebarPosition:60,frontMatter:{title:"[Docker] Docker Compose",sidebar_position:60,description:"Docker Compose",keywords:["Docker Compose"]},sidebar:"tutorialSidebar",previous:{title:"[Docker] Docker Network",permalink:"/RulerChen-Website/docs/Docker/Network"},next:{title:"[Docker] Docker Swarm",permalink:"/RulerChen-Website/docs/Docker/Swarm"}},i={},l=[{value:"\u751a\u9ebc\u662f Docker Compose",id:"\u751a\u9ebc\u662f-docker-compose",level:2},{value:"Docker Compose \u6307\u4ee4",id:"docker-compose-\u6307\u4ee4",level:2},{value:"Docker Compose \u7bc4\u4f8b",id:"docker-compose-\u7bc4\u4f8b",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"\u751a\u9ebc\u662f-docker-compose",children:"\u751a\u9ebc\u662f Docker Compose"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u4e4b\u524d\u7684\u4ecb\u7d39\u88e1\u9762\uff0c\u6211\u5011\u6240\u8b1b\u8ff0\u7684\u5927\u90e8\u5206\u53ea\u662f\u55ae\u4e00\u7684\u7269\u4ef6\uff0c\n\u4f46\u5728\u5be6\u969b\u7684\u958b\u767c\u4e2d\uff0c\u6211\u5011\u5f80\u5f80\u6703\u9700\u8981\u591a\u500b\u7269\u4ef6\u4f86\u904b\u4f5c\uff0c\n\u6211\u5011\u53ef\u80fd\u6703\u540c\u6642\u9700\u8981\u524d\u7aef\uff0c\u5f8c\u7aef\uff0c\u8cc7\u6599\u5eab\u7b49\u7b49\u7684\u670d\u52d9\uff0c\n\u5728 docker compose \u4e2d\uff0c\u6211\u5011\u53ef\u4ee5\u900f\u904e\u4e00\u500b ",(0,s.jsx)(n.code,{children:"docker-compose.yaml"})," \u6a94\u4f86\u5b9a\u7fa9\u6211\u5011\u6240\u9700\u8981\u7684\u670d\u52d9\uff0c\n\u4e26\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"docker compose up"})," \u4f86\u555f\u52d5\u9019\u4e9b\u670d\u52d9\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"docker-compose-\u6307\u4ee4",children:"Docker Compose \u6307\u4ee4"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u555f\u52d5 docker compose"}),"\n",(0,s.jsx)(n.p,{children:"\u91cd\u65b0\u69cb\u5efa\u4e26\u555f\u52d5\u670d\u52d9"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker compose up -d --build\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u522a\u9664\u7121\u7528\u7684\u5bb9\u5668"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker compose up -d --remove-orphans\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u91cd\u65b0\u555f\u52d5 docker compose"}),"\n",(0,s.jsx)(n.p,{children:"\u5e38\u7528\u65bc\u639b\u8f09 VOLUME \u5f8c\uff0c\u91cd\u65b0\u555f\u52d5\u670d\u52d9"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker compose restart\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u505c\u6b62 docker compose"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker compose stop\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u522a\u9664 docker compose"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker compose down\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u8986\u5beb docker compose"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728 dev \u548c prod \u74b0\u5883\u4e2d\uff0c\u6211\u5011\u53ef\u80fd\u6703\u6709\u4e0d\u540c\u7684\u8a2d\u5b9a\uff0c\n\u6211\u5011\u53ef\u4ee5\u900f\u904e ",(0,s.jsx)(n.code,{children:"docker-compose.dev.yaml"})," \u548c ",(0,s.jsx)(n.code,{children:"docker-compose.prod.yaml"})," \u4f86\u8986\u5beb ",(0,s.jsx)(n.code,{children:"docker-compose.yaml"})," \u7684\u8a2d\u5b9a\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://docker.robertchang.me/compose/extend-column#docker-compose-%E7%9A%84%E8%A6%86%E5%AF%AB%E6%AA%94%E6%A1%88",children:"\u8986\u5beb\u7bc4\u4f8b"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker compose -f docker-compose.yaml -f docker-compose.dev.yaml up -d\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u6c34\u5e73\u64f4\u5c55"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker compose up -d --scale web=3\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"docker-compose-\u7bc4\u4f8b",children:"Docker Compose \u7bc4\u4f8b"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/dockersamples/example-voting-app",children:"\u53c3\u8003\u7bc4\u4f8b\u4f86\u6e90"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"services:\n  vote:\n    build:\n      context: ./vote # Dockerfile \u6240\u5728\u7684\u8cc7\u6599\u593e\n      target: dev # \u6307\u5b9a Dockerfile \u7684 target\n    depends_on: # \u6307\u5b9a\u4f9d\u8cf4\u7684\u670d\u52d9\n      redis:\n        condition: service_healthy # \u7576 redis \u670d\u52d9\u5065\u5eb7\u6642\u624d\u555f\u52d5\n    healthcheck:\n      test: ['CMD', 'curl', '-f', 'http://localhost'] # \u5065\u5eb7\u6aa2\u67e5\n      interval: 15s # \u6bcf 15 \u79d2\u6aa2\u67e5\u4e00\u6b21\n      timeout: 5s # \u6aa2\u67e5\u903e\u6642\u6642\u9593\n      retries: 3 # \u91cd\u8a66\u6b21\u6578\n      start_period: 10s # \u555f\u52d5\u5f8c 10 \u79d2\u5f8c\u624d\u958b\u59cb\u6aa2\u67e5\n    volumes:\n      - ./vote:/usr/local/app # \u639b\u8f09\u672c\u5730\u8cc7\u6599\u593e\u5230\u5bb9\u5668\u4e2d\n    ports:\n      - '5000:80'\n    networks:\n      - front-tier\n      - back-tier\n\n  result:\n    build: ./result\n    entrypoint: nodemon --inspect=0.0.0.0 server.js\n    depends_on:\n      db:\n        condition: service_healthy\n    volumes:\n      - ./result:/usr/local/app\n    ports:\n      - '5001:80'\n      - '127.0.0.1:9229:9229'\n    networks:\n      - front-tier\n      - back-tier\n\n  worker:\n    build:\n      context: ./worker\n    depends_on:\n      redis:\n        condition: service_healthy\n      db:\n        condition: service_healthy\n    networks:\n      - back-tier\n\n  redis:\n    image: redis:alpine\n    volumes:\n      - './healthchecks:/healthchecks'\n    healthcheck:\n      test: /healthchecks/redis.sh\n      interval: '5s'\n    networks:\n      - back-tier\n\n  db:\n    image: postgres:15-alpine\n    environment:\n      POSTGRES_USER: 'postgres'\n      POSTGRES_PASSWORD: 'postgres'\n    volumes:\n      - 'db-data:/var/lib/postgresql/data'\n      - './healthchecks:/healthchecks'\n    healthcheck:\n      test: /healthchecks/postgres.sh\n      interval: '5s'\n    networks:\n      - back-tier\n\n  seed:\n    build: ./seed-data\n    profiles: ['seed']\n    depends_on:\n      vote:\n        condition: service_healthy\n    networks:\n      - front-tier\n    restart: 'no'\n\nvolumes:\n  db-data:\n\nnetworks:\n  front-tier:\n  back-tier:\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},1151:(e,n,o)=>{o.d(n,{Z:()=>d,a:()=>t});var s=o(7294);const r={},c=s.createContext(r);function t(e){const n=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);