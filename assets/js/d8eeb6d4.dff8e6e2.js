"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5013],{8913:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"Golang/grpc","title":"[Go] GRPC","description":"Go Remote Procedure Call","source":"@site/docs/Golang/grpc.mdx","sourceDirName":"Golang","slug":"/Golang/grpc","permalink":"/RulerChen-Website/docs/Golang/grpc","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/Golang/grpc.mdx","tags":[],"version":"current","lastUpdatedAt":1736349217000,"sidebarPosition":20,"frontMatter":{"title":"[Go] GRPC","sidebar_position":20,"description":"Go Remote Procedure Call","keywords":["golang","go","grpc","rpc"]},"sidebar":"tutorialSidebar","previous":{"title":"[Go] Basic Syntax","permalink":"/RulerChen-Website/docs/Golang/syntax"},"next":{"title":"[Next.js] ESlint in Next.js 13.4","permalink":"/RulerChen-Website/docs/Next.js/EslintPrettier"}}');var s=t(4848),o=t(8453);const c={title:"[Go] GRPC",sidebar_position:20,description:"Go Remote Procedure Call",keywords:["golang","go","grpc","rpc"]},i=void 0,l={},d=[{value:"RPC \u7684\u539f\u7406",id:"rpc-\u7684\u539f\u7406",level:2},{value:"GRPC",id:"grpc",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Environment Setup",id:"environment-setup",level:3}];function g(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"\u9019\u7bc7\u6587\u7ae0\u6703\u5305\u542b\u4e00\u4e9b GRPC \u7684\u4ecb\u7d39\uff0c\u4f7f\u7528 Golang \u4f5c\u70ba\u7bc4\u4f8b"}),"\n",(0,s.jsx)(n.h2,{id:"rpc-\u7684\u539f\u7406",children:"RPC \u7684\u539f\u7406"}),"\n",(0,s.jsx)(n.p,{children:"RPC (Remote Procedure Call) \u662f\u4e00\u7a2e\u901a\u8a0a\u5354\u5b9a\uff0c\u8a2d\u8a08\u7684\u76ee\u7684\u662f\u8b93\u958b\u767c\u8005\u7121\u9700\u8003\u616e\u5e95\u5c64\u7db2\u7d61\u901a\u8a0a\u7684\u7d30\u7bc0\uff0c\u53ea\u9700\u50cf\u547c\u53eb\u672c\u5730\u51fd\u5f0f\u4e00\u6a23\u8abf\u7528\u9060\u7aef\u65b9\u6cd5"}),"\n",(0,s.jsx)(n.p,{children:"\u6d41\u7a0b\u5927\u81f4\u5982\u4e0b :"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"client \u547c\u53eb\u672c\u5730\u7684 stub\uff0c\u8ca0\u8cac\u5c07 client \u7684\u8acb\u6c42\u5c01\u88dd\u4e26\u4e14\u5e8f\u5217\u5316\u5f8c\u50b3\u9001\u5230 server"}),"\n",(0,s.jsx)(n.li,{children:"server \u63a5\u6536\u5230\u8acb\u6c42\u5f8c\uff0c\u5c07\u8acb\u6c42\u53cd\u5e8f\u5217\u5316\uff0c\u4e26\u547c\u53eb\u672c\u5730\u7684 service"}),"\n",(0,s.jsx)(n.li,{children:"service \u57f7\u884c\u5b8c\u7562\u5f8c\uff0c\u5c07\u7d50\u679c\u5e8f\u5217\u5316\u4e26\u50b3\u9001\u56de client"}),"\n",(0,s.jsx)(n.li,{children:"client \u63a5\u6536\u5230\u7d50\u679c\u5f8c\uff0c\u5c07\u7d50\u679c\u53cd\u5e8f\u5217\u5316"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u5176\u4e2d\u5e8f\u5217\u5316\u7684\u904e\u7a0b\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u65b9\u5f0f\uff0c\u4f8b\u5982 JSON\u3001XML\u3001Protobuf \u7b49\uff0c\u57fa\u65bc\u7684\u5354\u8b70\u4e5f\u53ef\u80fd\u6709\u6240\u4e0d\u540c\uff0c\u5e38\u898b\u7684\u6709 HTTP\u3001TCP\u3001UDP \u7b49"}),"\n",(0,s.jsx)(n.h2,{id:"grpc",children:"GRPC"}),"\n",(0,s.jsx)(n.h2,{id:"implementation",children:"Implementation"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u5be6\u4f5c\u968e\u6bb5\uff0c\u6211\u5011\u6703\u5f9e\u982d\u5230\u5c3e\u6642\u505a\u4e00\u500b\u7c21\u55ae\u7684 grpc \u901a\u8a0a\uff0c\u5305\u542b\u4e00\u500b\u7c21\u55ae\u7684 service\uff0c\u4e26\u4e14\u900f\u904e grpc \u4f86\u547c\u53eb"}),"\n",(0,s.jsx)(n.h3,{id:"environment-setup",children:"Environment Setup"}),"\n",(0,s.jsx)(n.p,{children:"\u9032\u5165\u5c08\u6848\u76ee\u9304\uff0c\u4e26\u4e14 init \u4e00\u500b go module"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"go mod init grpc\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u65b0\u589e ",(0,s.jsx)(n.code,{children:"/pb/student_service.proto"})," \u6a94\u6848\uff0c\u5167\u5bb9\u5982\u4e0b"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-proto",children:'syntax = "proto3"; // \u4f7f\u7528 proto3 \u8a9e\u6cd5\n\npackage pb; // \u5b9a\u7fa9 package \u540d\u7a31\n\n// \u7b2c\u4e00\u500b\u53c3\u6578\u662f\u751f\u6210\u7684\u8def\u5f91\uff0c\u7b2c\u4e8c\u500b\u53c3\u6578\u662f\u751f\u6210\u5f8c\u7684\u540d\u7a31\noption go_package = "./pb/proto;student_service";\n\n// \u5b9a\u7fa9 message\nmessage Student {\n    string name = 1;\n    repeated string locations = 2;\n    map<string, float> scores = 3;\n    bool gender = 4;\n    int32 age = 5;\n    float height = 6;\n}\n\n// \u5b9a\u7fa9 message\nmessage GetStudentRequest {\n    string studentId = 1;\n}\n\n// \u5b9a\u7fa9 service\nservice StudentService {\n    rpc GetStudentInfo (GetStudentRequest) returns (Student);\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u5b89\u88dd protobuffer (windows)\uff0c\u9700\u8981\u53bb ",(0,s.jsx)(n.a,{href:"https://github.com/protocolbuffers/protobuf/releases",children:"\u5b98\u7db2"})," \u4e0b\u8f09\u5c0d\u61c9\u7684\u7248\u672c\uff0c\u89e3\u58d3\u7e2e\u5230\u5c08\u6848\u76ee\u9304\u4e26\u8a2d\u5b9a\u74b0\u5883\u8b8a\u6578"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"protoc --version\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u63a5\u8457\u5b89\u88dd Go \u7684 protoc plugin"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"go get github.com/golang/protobuf/protoc-gen-go\ngo install github.com/golang/protobuf/protoc-gen-go\ngo get google.golang.org/grpc/cmd/protoc-gen-go-grpc\ngo install google.golang.org/grpc/cmd/protoc-gen-go-grpc\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u63a5\u8457\u4f7f\u7528 protoc \u4f86\u7de8\u8b6f proto \u6a94\u6848"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"protoc --go_out=. --go_opt=paths=source_relative --go-grpc_out=. --go-grpc_opt=paths=source_relative pb/student_service.proto\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--go_out"})," : \u751f\u6210 Go \u7684 proto \u6a94\u6848\u8def\u5f91"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--go_opt"})," : \u8a2d\u5b9a\u751f\u6210\u7684\u8def\u5f91\uff0c\u76f8\u5c0d\u65bc .proto \u6a94\u6848\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u5247\u6703\u653e\u5230 package \u6307\u5b9a\u7684\u8def\u5f91\u4e0b"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--go-grpc_out"})," : \u751f\u6210 Go \u7684 grpc \u6a94\u6848\u8def\u5f91"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--go-grpc_opt"})," : \u8a2d\u5b9a\u751f\u6210\u7684\u8def\u5f91\uff0c\u76f8\u5c0d\u65bc .proto \u6a94\u6848\uff0c\u5982\u679c\u4e0d\u6307\u5b9a\u5247\u6703\u653e\u5230 package \u6307\u5b9a\u7684\u8def\u5f91\u4e0b"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"pb/student_service.proto"})," : \u9700\u8981\u7de8\u8b6f\u7684 proto \u6a94\u6848"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u4e4b\u5f8c\u57f7\u884c\u6307\u4ee4\u4f86\u66f4\u65b0 grpc \u6240\u9700\u7684\u5957\u4ef6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"go mod tidy\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u57f7\u884c\u5b8c\u4e0a\u9762\u7684\u6307\u4ee4\u4e4b\u5f8c\uff0c\u6703\u5728\u5c08\u6848\u76ee\u9304\u4e0b\u751f\u6210 ",(0,s.jsx)(n.code,{children:"pb/proto/student_service.pb.go"})," \u548c ",(0,s.jsx)(n.code,{children:"pb/proto/student_service_grpc.pb.go"})," \u5169\u500b\u6a94\u6848"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"student_service.pb.go"})," : \u5305\u542b proto \u6a94\u6848\u751f\u6210\u7684 struct"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"student_service_grpc.pb.go"})," : \u5305\u542b proto \u4e2d\u7684 ",(0,s.jsx)(n.code,{children:"service"})," \u8f49\u63db\u800c\u6210\u7684 Go \u7a0b\u5f0f\u78bc"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u7522\u751f\u5b8c\u6210\u7a0b\u5f0f\u78bc\u4e4b\u5f8c\u5c31\u53ef\u4ee5\u4f86\u5be6\u4f5c server \u4e86\uff0c\u5148\u5275\u5efa\u4e00\u500b ",(0,s.jsx)(n.code,{children:"server.go"})," \u6a94\u6848"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u5011\u7684\u76ee\u6a19\u662f\u5be6\u73fe\u4e00\u500b struct \u4f86\u6eff\u8db3 ",(0,s.jsx)(n.code,{children:"StudentServiceClient"})," interface"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:"type StudentServiceClient interface {\n\tGetStudentInfo(ctx context.Context, in *GetStudentRequest, opts ...grpc.CallOption) (*Student, error)\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u628a ",(0,s.jsx)(n.code,{children:"server.go"})," \u7684\u5167\u5bb9\u5beb\u5165\u5982\u4e0b"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n\t"context"\n\t"errors"\n\t"fmt"\n\t"net"\n\n\tstudent_service "grpc/pb"\n\n\t"google.golang.org/grpc"\n)\n\ntype StudentServer struct {\n\tstudent_service.UnimplementedStudentServiceServer\n}\n\nfunc (s *StudentServer) GetStudentInfo(ctx context.Context, request *student_service.GetStudentRequest) (*student_service.Student, error) {\n\tdefer func() {\n\t\tif r := recover(); r != nil {\n\t\t\tfmt.Println("Recovered in GetStudentInfo", r)\n\t\t\treturn\n\t\t}\n\t}()\n\n\tif len(request.StudentId) == 0 {\n\t\treturn nil, errors.New("studentId is required")\n\t}\n\n\tstudent := &student_service.Student{\n\t\tName:      "John Doe",\n\t\tLocations: []string{"New York", "Los Angeles", "San Francisco"},\n\t\tScores: map[string]float32{\n\t\t\t"Math":    95.5,\n\t\t\t"English": 88.0,\n\t\t\t"Science": 92.3,\n\t\t},\n\t\tGender: true,\n\t\tAge:    21,\n\t\tHeight: 175.5,\n\t}\n\n\treturn student, nil\n}\n\nfunc main() {\n\tlis, err := net.Listen("tcp", "127.0.0.1:8000")\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tserver := grpc.NewServer()\n\tstudent_service.RegisterStudentServiceServer(server, new(StudentServer))\n\n\terr = server.Serve(lis)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u63a5\u8457\u57f7\u884c ",(0,s.jsx)(n.code,{children:"go run server.go"}),"\uff0c\u9019\u6a23\u5c31\u555f\u52d5\u4e86\u4e00\u500b grpc server"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6700\u5f8c\u6211\u5011\u7528\u4e00\u500b\u55ae\u5143\u6e2c\u8a66\u4f86\u6e2c\u8a66 server \u662f\u5426\u6b63\u5e38\u904b\u4f5c\uff0c\u5275\u5efa\u4e00\u500b ",(0,s.jsx)(n.code,{children:"grpc_test.go"})," \u6a94\u6848"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n\t"context"\n\t"fmt"\n\tstudent_service "grpc/pb"\n\t"testing"\n\t"time"\n\n\t"google.golang.org/grpc"\n\t"google.golang.org/grpc/credentials/insecure"\n)\n\nfunc TestService(t *testing.T) {\n\tconn, err := grpc.NewClient("127.0.0.1:8000", grpc.WithTransportCredentials(insecure.NewCredentials()))\n\tif err != nil {\n\t\tfmt.Printf("connect failed %v\\n", err)\n\t\tt.Fail()\n\t}\n\tdefer conn.Close()\n\tclient := student_service.NewStudentServiceClient(conn)\n\n\tctx, cancel := context.WithTimeout(context.Background(), time.Second)\n\tdefer cancel()\n\n\tres, err := client.GetStudentInfo(ctx, &student_service.GetStudentRequest{StudentId: "123"})\n\tif err != nil {\n\t\tfmt.Printf("get student info failed %v\\n", err)\n\t\tt.Fail()\n\t}\n\tfmt.Printf("Name %s Age %d Height %.1f\\n", res.Name, res.Age, res.Height)\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u57f7\u884c ",(0,s.jsx)(n.code,{children:"go test -v"}),"\uff0c\u5982\u679c\u6c92\u6709\u932f\u8aa4\u7684\u8a71\uff0c\u5c31\u4ee3\u8868 server \u548c client \u90fd\u6b63\u5e38\u904b\u4f5c\u4e86"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(g,{...e})}):g(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>i});var r=t(6540);const s={},o=r.createContext(s);function c(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);