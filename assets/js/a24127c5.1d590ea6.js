"use strict";(self.webpackChunkrulerchen_website=self.webpackChunkrulerchen_website||[]).push([["9859"],{2260:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>i,toc:()=>a,default:()=>x,metadata:()=>t,assets:()=>l,contentTitle:()=>r});var t=JSON.parse('{"id":"CMU15-445/p4","title":"P4 - Concurrency Control","description":"Concurrency Control","source":"@site/docs/CMU15-445/p4.mdx","sourceDirName":"CMU15-445","slug":"/CMU15-445/p4","permalink":"/RulerChen-Website/docs/CMU15-445/p4","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/p4.mdx","tags":[{"inline":true,"label":"CMU15-445","permalink":"/RulerChen-Website/docs/tags/cmu-15-445"},{"inline":true,"label":"CMU15-445 Projects","permalink":"/RulerChen-Website/docs/tags/cmu-15-445-projects"}],"version":"current","lastUpdatedAt":1758608125000,"sidebarPosition":104,"frontMatter":{"title":"P4 - Concurrency Control","sidebar_position":104,"description":"Concurrency Control","keywords":["CMU15-445/645","Concurrency Control","CMU15-445/645 \u7B46\u8A18"],"tags":["CMU15-445","CMU15-445 Projects"]},"sidebar":"tutorialSidebar","previous":{"title":"P3 - Query Execution","permalink":"/RulerChen-Website/docs/CMU15-445/p3"},"next":{"title":"Security","permalink":"/RulerChen-Website/docs/Security/"}}'),d=s(4848),c=s(4429);let i={title:"P4 - Concurrency Control",sidebar_position:"104",description:"Concurrency Control",keywords:["CMU15-445/645","Concurrency Control","CMU15-445/645 \u7B46\u8A18"],tags:["CMU15-445","CMU15-445 Projects"]},r,l={},a=[{value:"Background",id:"background",level:2},{value:"Task 1 - Timestamps",id:"task-1---timestamps",level:2},{value:"Task 1.1 Timestamp Allocation",id:"task-11-timestamp-allocation",level:3},{value:"Task 1.2 Watermark",id:"task-12-watermark",level:3},{value:"Task 2 - Storage Format and Sequential Scan",id:"task-2---storage-format-and-sequential-scan",level:2},{value:"Task 2.1 - Tuple Reconstruction",id:"task-21---tuple-reconstruction",level:3},{value:"Task 2.2 - Sequential Scan (Tuple Retrieval)",id:"task-22---sequential-scan-tuple-retrieval",level:3},{value:"Task 3 - MVCC Executors",id:"task-3---mvcc-executors",level:2},{value:"Task 3.1 - Insert Executor",id:"task-31---insert-executor",level:3},{value:"Task 3.2 - Commit",id:"task-32---commit",level:3},{value:"Task 3.3 - Generate Undo Log",id:"task-33---generate-undo-log",level:3},{value:"Task 3.4 - Update &amp; Delete Executor",id:"task-34---update--delete-executor",level:3},{value:"Task 3.5 - Stop-the-world Garbage Collection",id:"task-35---stop-the-world-garbage-collection",level:3},{value:"Task 4 - Primary Key Index",id:"task-4---primary-key-index",level:2},{value:"Task 4.1 - Index Insert",id:"task-41---index-insert",level:3},{value:"Task 4.2 - Index Scan, Delete, &amp; Update",id:"task-42---index-scan-delete--update",level:3},{value:"Task 4.3 - Primary Key Updates",id:"task-43---primary-key-updates",level:3},{value:"Bonus 1 - Abort",id:"bonus-1---abort",level:2},{value:"Bonus 2 - Serializable Verification",id:"bonus-2---serializable-verification",level:2},{value:"Submit",id:"submit",level:2},{value:"Takeaways",id:"takeaways",level:2},{value:"References",id:"references",level:2}];function o(e){let n={a:"a",annotation:"annotation",code:"code",h2:"h2",h3:"h3",li:"li",math:"math",mi:"mi",mo:"mo",mrow:"mrow",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,c.R)(),...e.components},{Head:s,ImageModal:t}=n;return s||h("Head",!0),t||h("ImageModal",!0),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s,{children:(0,d.jsx)("title",{children:"CMU 15-445 2024Fall P4 Concurrency Control"})}),"\n",(0,d.jsx)(n.p,{children:"\u5728\u9019\u500B project \u4E2D\uFF0C\u6211\u5011\u9700\u8981\u5BE6\u73FE transaction \u8DDF MVCC\uFF0C\u7E3D\u5171\u6709 4 \u500B task \u8DDF 2 \u500B bonus :"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Timestamps"}),"\n",(0,d.jsx)(n.li,{children:"Storage Format and Sequential Scan"}),"\n",(0,d.jsx)(n.li,{children:"MVCC Executors"}),"\n",(0,d.jsx)(n.li,{children:"Primary Key Index"}),"\n",(0,d.jsx)(n.li,{children:"Abort"}),"\n",(0,d.jsx)(n.li,{children:"Serializable Verification"}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,d.jsx)(n.p,{children:"\u5728\u958B\u59CB\u5BE6\u4F5C\u4E4B\u524D\uFF0C\u6211\u5011\u9700\u8981\u5148\u4E86\u89E3\u4E00\u4E9B\u8DDF\u9019\u500B project \u6709\u95DC\u7684 class\uFF0C\u4E3B\u8981\u662F\u95DC\u65BC transaction \u8DDF MVCC \u7684\u90E8\u5206\u3002"}),"\n",(0,d.jsx)(t,{src:"/img/cmu15-445/p4/transaction.webp",caption:"Transaction Class"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"TransactionManager"})," \u662F\u5168\u5C40\u7684\u4EA4\u6613\u7BA1\u7406\u5668\uFF0C\u8CA0\u8CAC\u5982\u958B\u59CB\u4EA4\u6613\u3001\u63D0\u4EA4\u4EA4\u6613\u3001\u56DE\u6EFE\u4EA4\u6613\u7B49\u529F\u80FD\uFF0C\u4E5F\u8CA0\u8CAC\u7BA1\u7406 id \u7684\u5206\u914D\u8DDF\u56DE\u6536\u3002\n\u88E1\u9762\u4E3B\u8981\u6703\u7528\u5230\u7684\u6210\u54E1\u5305\u542B\u4E86 ",(0,d.jsx)(n.code,{children:"txn_map_"}),"\u3001",(0,d.jsx)(n.code,{children:"version_info_"}),"\u3001",(0,d.jsx)(n.code,{children:"watermark_"})," \u7B49\u7B49\u3002\n",(0,d.jsx)(n.code,{children:"txn_map_"})," \u7528\u65BC\u8A18\u9304\u6240\u6709\u7684\u4EA4\u6613\uFF0C",(0,d.jsx)(n.code,{children:"version_info_"})," \u7528\u65BC\u8A18\u9304\u6BCF\u500B tuple \u7684\u7248\u672C\u8CC7\u8A0A\uFF0C",(0,d.jsx)(n.code,{children:"watermark_"})," \u7528\u65BC\u8A18\u9304\u76EE\u524D\u6240\u6709\u6D3B\u8E8D\u4EA4\u6613\u4E2D\u6700\u5C0F\u7684 ",(0,d.jsx)(n.code,{children:"read_ts"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Transaction"})," \u985E\u5225\u4EE3\u8868\u4E00\u500B\u4EA4\u6613\uFF0C\u5305\u542B\u4EA4\u6613\u7684\u72C0\u614B (RUNNING\u3001TAINTED\u3001COMMITTED\u3001ABORTED)\u3001\u9694\u96E2\u7D1A\u5225 (SI & Serializable)\u3001\u958B\u59CB\u6642\u9593\u6233 (read_ts)\u3001\u7D50\u675F\u6642\u9593\u6233 (commit_ts) \u7B49\u8CC7\u8A0A\u3002\n\u6BCF\u500B\u4EA4\u6613\u5728\u958B\u59CB\u6642\u6703\u88AB\u5206\u914D\u4E00\u500B\u552F\u4E00\u7684 ",(0,d.jsx)(n.code,{children:"txn_id"}),"\uFF0C\u4E26\u4E14\u6703\u6709 ",(0,d.jsx)(n.code,{children:"write_set_"})," \u8DDF ",(0,d.jsx)(n.code,{children:"scan_predicates_"})," \u6210\u54E1\uFF0C\u5206\u5225\u7528\u65BC\u8A18\u9304\u8A72\u4EA4\u6613\u6240\u505A\u7684\u5BEB\u5165\u64CD\u4F5C\u4EE5\u53CA\u6383\u63CF\u64CD\u4F5C\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9664\u6B64\u4E4B\u5916\uFF0C",(0,d.jsx)(n.code,{children:"Transaction"})," \u9084\u6703\u7D00\u9304\u5B83\u7684\u6BCF\u4E00\u689D ",(0,d.jsx)(n.code,{children:"UndoLog"}),"\uFF0C\u9019\u500B log \u7528\u65BC\u67E5\u770B\u820A\u7248\u672C\u7684 tuple\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"UndoLog"})," \u5305\u542B\u4E86\u4EE5\u4E0B\u7684\u8CC7\u8A0A (",(0,d.jsx)(n.strong,{children:"\u975E\u5E38\u91CD\u8981"}),") :"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"is_deleted_"})," : ",(0,d.jsx)(n.code,{children:"bool"}),"\uFF0C\u7528\u65BC\u6A19\u8A18\u524D\u4E00\u500B\u7248\u672C\u7684 tuple \u662F\u5426\u88AB\u522A\u9664\u3002\u5982\u679C\u64CD\u4F5C\u662F INSERT\uFF0C",(0,d.jsx)(n.code,{children:"is_deleted_"})," \u5C31\u6703\u662F true\uFF0C\u8868\u793A\u4E0A\u4E00\u500B\u7248\u672C\u4E0D\u5B58\u5728"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"modified_fields_"})," : ",(0,d.jsx)(n.code,{children:"vector<bool>"}),"\uFF0C\u7528\u65BC\u6A19\u8A18\u54EA\u4E9B\u6B04\u4F4D\u88AB\u4FEE\u6539\u904E\u3002\u5047\u5982\u6709 3 \u500B\u6B04\u4F4D\uFF0C",(0,d.jsx)(n.code,{children:"modified_fields_"})," \u53EF\u80FD\u6703\u662F ",(0,d.jsx)(n.code,{children:"[true, false, true]"}),"\uFF0C\u8868\u793A\u7B2C 0 \u8DDF\u7B2C 2 \u500B\u6B04\u4F4D\u88AB\u4FEE\u6539\u904E"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"tuple_"})," : ",(0,d.jsx)(n.code,{children:"Tuple"}),"\uFF0C\u7D00\u9304\u4E0A\u4E00\u500B\u7248\u672C\u7684 tuple\uFF0C\u5167\u5BB9\u6703\u4F9D\u64DA ",(0,d.jsx)(n.code,{children:"modified_fields_"})," \u4F86\u6C7A\u5B9A\u6709\u54EA\u4E9B\u6B04\u4F4D\u3002\u5047\u5982 ",(0,d.jsx)(n.code,{children:"modified_fields_"})," \u662F ",(0,d.jsx)(n.code,{children:"[true, false, true]"}),"\uFF0C\u90A3 ",(0,d.jsx)(n.code,{children:"tuple_"})," \u53EA\u6703\u5305\u542B\u7B2C 0 \u8DDF\u7B2C 2 \u500B\u6B04\u4F4D\u7684\u503C"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"ts_"})," : ",(0,d.jsx)(n.code,{children:"timestamp_t"}),"\uFF0C\u5275\u5EFA\u9019\u500B log \u7684 transaction \u7684 commit timestamp"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"prev_version_"})," : ",(0,d.jsx)(n.code,{children:"UndoLink"}),"\uFF0C\u6307\u5411\u524D\u4E00\u500B\u7248\u672C\u7684 ",(0,d.jsx)(n.code,{children:"UndoLog"}),"\u3002",(0,d.jsx)(n.code,{children:"UndoLink"})," \u5305\u542B\u4E86 ",(0,d.jsx)(n.code,{children:"prev_txn_"})," (",(0,d.jsx)(n.code,{children:"txn_id"}),") \u8DDF ",(0,d.jsx)(n.code,{children:"prev_log_idx_"}),"\uFF0C\u8868\u793A\u9019\u500B log \u7684\u4E0A\u4E00\u7248\u662F\u7531\u90A3\u500B transaction \u7684\u7B2C\u5E7E\u689D ",(0,d.jsx)(n.code,{children:"UndoLog"})," \u6240\u5275\u5EFA\u7684"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"task-1---timestamps",children:"Task 1 - Timestamps"}),"\n",(0,d.jsx)(n.h3,{id:"task-11-timestamp-allocation",children:"Task 1.1 Timestamp Allocation"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500B task \u4E3B\u8981\u662F\u8981\u7406\u89E3 timestamp \u7684\u5206\u914D\u65B9\u5F0F\u3002"}),"\n",(0,d.jsxs)(n.p,{children:["\u6BCF\u4E00\u500B\u4EA4\u6613\u90FD\u6709\u5169\u500B timestamp\uFF0C",(0,d.jsx)(n.code,{children:"read_ts"})," \u8DDF ",(0,d.jsx)(n.code,{children:"commit_ts"}),"\u3002\n\u5728\u4EA4\u6613\u958B\u59CB\u6642\uFF0C\u6703\u5206\u914D\u4E00\u500B ",(0,d.jsx)(n.code,{children:"read_ts"}),"\uFF0C\u9019\u500B timestamp \u662F\u76EE\u524D\u5DF2\u63D0\u4EA4\u7684\u6700\u5927 timestamp\u3002\n\u5728\u4EA4\u6613\u63D0\u4EA4\u6642\uFF0C\u6703\u5206\u914D\u4E00\u500B ",(0,d.jsx)(n.code,{children:"commit_ts"}),"\uFF0C\u9019\u500B timestamp \u662F\u76EE\u524D\u5DF2\u63D0\u4EA4\u7684\u6700\u5927 timestamp \u52A0\u4E00\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u4E5F\u5C31\u662F\u8AAA\uFF0C\u5982\u679C\u4E00\u500B\u4EA4\u6613\u7684 ",(0,d.jsx)(n.code,{children:"read_ts"})," \u662F 5\uFF0C\u90A3\u9EBC\u5B83\u53EA\u80FD\u770B\u5230 ",(0,d.jsx)(n.code,{children:"commit_ts"})," \u5C0F\u65BC\u7B49\u65BC 5 \u7684\u7248\u672C\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u6211\u5011\u8981\u505A\u7684\u4E8B\u60C5\u5C31\u662F\u628A\u9019\u4E9B\u908F\u8F2F\u52A0\u5230 ",(0,d.jsx)(n.code,{children:"TransactionManager::Begin"})," \u8DDF ",(0,d.jsx)(n.code,{children:"TransactionManager::Commit"})," \u88E1\u9762\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"task-12-watermark",children:"Task 1.2 Watermark"}),"\n",(0,d.jsxs)(n.p,{children:["Watermark \u4E3B\u8981\u662F\u7528\u4F86\u8FFD\u8E64\u6240\u6709\u9084\u6C92 Abort \u6216 Commit \u7684\u4EA4\u6613\u4E2D\uFF0C\u6700\u5C0F\u7684 ",(0,d.jsx)(n.code,{children:"read_ts"}),"\uFF0C\u5982\u679C\u6C92\u6709\u4EFB\u4F55\u4EA4\u6613\u5728\u57F7\u884C\uFF0Cwatermark \u5C31\u6703\u662F ",(0,d.jsx)(n.code,{children:"commit_ts"}),"\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500B class \u4E3B\u8981\u662F\u8A2D\u8A08\u7528\u4F86\u5E6B\u52A9 task 3.5 \u7684 garbage collection\uFF0C\u7576\u6211\u5011\u8981\u56DE\u6536\u820A\u7248\u672C\u6642\uFF0Cwatermark \u53EF\u4EE5\u544A\u8A34\u6211\u5011\u90A3\u4E9B\u7248\u672C\u5DF2\u7D93\u4E0D\u6703\u518D\u88AB\u4EFB\u4F55\u4EA4\u6613\u4F7F\u7528\u4E86\u3002"}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u88E1\u6211\u4F7F\u7528\u4E86\u6700\u7C21\u55AE\u7684 ",(0,d.jsxs)(n.span,{className:"katex",children:[(0,d.jsx)(n.span,{className:"katex-mathml",children:(0,d.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,d.jsxs)(n.semantics,{children:[(0,d.jsxs)(n.mrow,{children:[(0,d.jsx)(n.mi,{children:"O"}),(0,d.jsx)(n.mo,{stretchy:"false",children:"("}),(0,d.jsx)(n.mi,{children:"l"}),(0,d.jsx)(n.mi,{children:"o"}),(0,d.jsx)(n.mi,{children:"g"}),(0,d.jsx)(n.mo,{stretchy:"false",children:"("}),(0,d.jsx)(n.mi,{children:"n"}),(0,d.jsx)(n.mo,{stretchy:"false",children:")"}),(0,d.jsx)(n.mo,{stretchy:"false",children:")"})]}),(0,d.jsx)(n.annotation,{encoding:"application/x-tex",children:"O(log(n))"})]})})}),(0,d.jsx)(n.span,{className:"katex-html","aria-hidden":"true",children:(0,d.jsxs)(n.span,{className:"base",children:[(0,d.jsx)(n.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,d.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"O"}),(0,d.jsx)(n.span,{className:"mopen",children:"("}),(0,d.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,d.jsx)(n.span,{className:"mord mathnormal",children:"o"}),(0,d.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"}),(0,d.jsx)(n.span,{className:"mopen",children:"("}),(0,d.jsx)(n.span,{className:"mord mathnormal",children:"n"}),(0,d.jsx)(n.span,{className:"mclose",children:"))"})]})})]})," \u7684\u65B9\u6CD5\u4F86\u5BE6\u4F5C\uFF0C\u5C31\u662F\u628A\u5132\u5B58\u7684\u65B9\u5F0F\u6539\u6210 ",(0,d.jsx)(n.code,{children:"std::map"}),"\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"task-2---storage-format-and-sequential-scan",children:"Task 2 - Storage Format and Sequential Scan"}),"\n",(0,d.jsx)(n.h3,{id:"task-21---tuple-reconstruction",children:"Task 2.1 - Tuple Reconstruction"}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u500B task \u7684\u76EE\u6A19\u662F\u5BE6\u4F5C ",(0,d.jsx)(n.code,{children:"ReconstructTuple"}),"\u3002\n\u9019\u500B\u51FD\u6578\u662F\u6839\u64DA tuple \u73FE\u5728\u7684\u60C5\u6CC1\u8DDF ",(0,d.jsx)(n.code,{children:"UndoLog"})," \u4F86\u9084\u539F\u51FA\u4EA4\u6613\u958B\u59CB\u6642\u7684 tuple\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u6211\u8A8D\u70BA\u9700\u8981\u6CE8\u610F\u7684\u662F ",(0,d.jsx)(n.code,{children:"UndoLog"})," \u7684\u9806\u5E8F\u662F\u5F9E\u65B0\u5230\u820A\uFF0C\u4EE5\u53CA ",(0,d.jsx)(n.code,{children:"is_deleted_"})," \u4EE3\u8868\u7684\u662F\u4E0A\u4E00\u500B\u7248\u672C\u7684 tuple \u662F\u5426\u88AB\u522A\u9664\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u88E1\u6211\u7684\u5BE6\u4F5C\u9806\u5E8F\u5982\u4E0B :"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\u6AA2\u67E5 ",(0,d.jsx)(n.code,{children:"undo_logs"})," \u662F\u5426\u70BA\u7A7A\uFF0C\u5982\u679C\u662F\u7A7A\u7684\u4E14\u6C92\u6709\u88AB\u522A\u9664\uFF0C\u76F4\u63A5\u56DE\u50B3\u7576\u524D\u7684 tuple"]}),"\n",(0,d.jsxs)(n.li,{children:["\u627E\u5230\u6700\u5F8C\u4E00\u500B ",(0,d.jsx)(n.code,{children:"is_deleted_"})," \u70BA true \u7684 log\uFF0C\u9019\u4EE3\u8868\u5F9E index 0 \u5230\u9019\u500B log \u7684 tuple \u90FD\u6C92\u6709\u7528\uFF0C\u5982\u679C\u9019\u662F\u6700\u5F8C\u4E00\u500B log\uFF0C\u4EE3\u8868\u9019\u500B tuple \u662F\u88AB\u522A\u9664\u7684\uFF0C\u76F4\u63A5\u56DE\u50B3 ",(0,d.jsx)(n.code,{children:"std::nullopt"})]}),"\n",(0,d.jsxs)(n.li,{children:["\u5F9E\u4E0B\u4E00\u500B log \u958B\u59CB\uFF0C\u4F9D\u5E8F\u628A ",(0,d.jsx)(n.code,{children:"modified_fields_"})," \u70BA true \u7684\u6B04\u4F4D\u5F9E ",(0,d.jsx)(n.code,{children:"undo_logs"})," \u8907\u88FD\u5230 ",(0,d.jsx)(n.code,{children:"tuple"})," \u4E0A"]}),"\n",(0,d.jsxs)(n.li,{children:["\u5982\u679C\u9084\u662F\u9019\u500B\u6B04\u4F4D\u5FA9\u539F\u5230\u6700\u5F8C\u90FD\u6C92\u6709\u503C\uFF0C\u76F4\u63A5\u586B ",(0,d.jsx)(n.code,{children:"base_tuple"})," \u4E0A\u7684\u503C (\u9019\u4EE3\u8868\u4E2D\u9593\u90FD\u6C92\u6709 ",(0,d.jsx)(n.code,{children:"is_deleted_"})," \u70BA true \u4E5F\u6C92\u6709\u88AB\u4FEE\u6539\u904E)"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"task-22---sequential-scan-tuple-retrieval",children:"Task 2.2 - Sequential Scan (Tuple Retrieval)"}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u500B task \u662F\u8981\u642D\u914D ",(0,d.jsx)(n.code,{children:"ReconstructTuple"})," \u4F86\u5BE6\u4F5C ",(0,d.jsx)(n.code,{children:"CollectUndoLogs"})," \u4E26\u4E14\u628A project 3 \u88E1\u9762\u7684 ",(0,d.jsx)(n.code,{children:"SeqScanExecutor"})," \u6539\u6210\u652F\u63F4 MVCC\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u908A\u9700\u8981\u5148\u7406\u89E3\u4E00\u4E0B bustub \u7684 timestamp \u5206\u914D\u65B9\u5F0F\u3002\ntimestamp \u5206\u70BA\u5169\u7A2E\uFF0C\u4E00\u7A2E\u662F commit \u904E\u5F8C\u7684 timestamp (",(0,d.jsx)(n.code,{children:"ts < TXN_START_ID"}),")\uFF0C\u53E6\u4E00\u7A2E\u662F\u9084\u6C92 commit \u7684 timestamp (",(0,d.jsx)(n.code,{children:"ts >= TXN_START_ID"}),")\uFF0C\u9084\u6C92 commit \u7684\u53EF\u4EE5\u7528 ",(0,d.jsx)(n.code,{children:"GetTransactionTempTs()"})," \u4F86\u53D6\u5F97\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"CollectUndoLogs"})," \u7684\u5BE6\u4F5C\u908F\u8F2F\u5F88\u7C21\u55AE\uFF0C\u5C31\u662F\u5F9E\u6700\u65B0\u7684 ",(0,d.jsx)(n.code,{children:"UndoLog"})," \u958B\u59CB\u5F80\u524D\u627E\uFF0C\u76F4\u5230\u8490\u96C6\u597D\u6240\u6709\u8981\u56DE\u6EFE\u7684 log \u5373\u53EF\u3002\n\u53EF\u898B\u6027\u5224\u65B7\u908F\u8F2F\u9664\u4E86\u8981 ",(0,d.jsx)(n.code,{children:"GetReadTs() >= ts"})," \u4E4B\u5916\uFF0C\u9084\u8981\u8003\u616E\u5230\u662F\u4E0D\u662F\u81EA\u5DF1\u4FEE\u6539\u904E\u7684 ",(0,d.jsx)(n.code,{children:"GetTransactionTempTs() == ts"}),"\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u63A5\u8457\u56DE\u5230 ",(0,d.jsx)(n.code,{children:"SeqScanExecutor"}),"\uFF0C\u9019\u908A\u7684\u5BE6\u4F5C\u908F\u8F2F\u4E5F\u6BD4\u8F03\u7C21\u55AE\uFF0C\u5C31\u662F\u628A ",(0,d.jsx)(n.code,{children:"CollectUndoLogs"})," \u8DDF ",(0,d.jsx)(n.code,{children:"ReconstructTuple"})," \u4E32\u8D77\u4F86\u5373\u53EF\uFF0C\u62FF metadata \u7684\u65B9\u6CD5\u53EF\u4EE5\u4F7F\u7528 ",(0,d.jsx)(n.code,{children:"GetTupleAndUndoLink()"}),"\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"task-3---mvcc-executors",children:"Task 3 - MVCC Executors"}),"\n",(0,d.jsx)(n.h3,{id:"task-31---insert-executor",children:"Task 3.1 - Insert Executor"}),"\n",(0,d.jsxs)(n.p,{children:["\u4E00\u6A23\u662F\u4FEE\u6539 project 3 \u88E1\u9762\u7684 ",(0,d.jsx)(n.code,{children:"InsertExecutor"}),"\uFF0C\u4E3B\u8981\u4FEE\u6539\u7684\u5730\u65B9\u5C31\u662F timestamp \u8DDF\u4F7F\u7528 ",(0,d.jsx)(n.code,{children:"AppendWriteSet()"})," \u4F86\u628A\u6709\u4FEE\u6539\u7684 RID \u52A0\u5165\u5230 ",(0,d.jsx)(n.code,{children:"write_set_"})," \u88E1\u9762\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u7531\u65BC insert \u662F\u63D2\u5165\u5230\u65B0\u7684 RID\uFF0C\u6240\u4EE5\u4E0D\u9700\u8981\u751F\u6210 ",(0,d.jsx)(n.code,{children:"UndoLog"}),"\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"task-32---commit",children:"Task 3.2 - Commit"}),"\n",(0,d.jsxs)(n.p,{children:["\u8DDF\u8457\u4F5C\u696D\u8AAA\u660E\u505A\u5C31\u597D\uFF0C\u4E3B\u8981\u5C31\u662F\u5728 ",(0,d.jsx)(n.code,{children:"Commit"})," \u88E1\u9762\u904D\u6B77 ",(0,d.jsx)(n.code,{children:"write_set_"}),"\uFF0C\u7136\u5F8C\u66F4\u65B0 timestamp\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9664\u6B64\u4E4B\u5916\u8AAA\u660E\u88E1\u9762\u9084\u6709\u8AAA\u53EF\u4EE5\u81EA\u5DF1\u5BE6\u73FE\u4E00\u500B ",(0,d.jsx)(n.code,{children:"TxnMgrDbg"}),"\uFF0C\u6211\u500B\u4EBA\u89BA\u5F97\u9019\u500B\u6771\u897F\u9084\u883B\u6709\u7528\u7684\uFF0C\u4F46\u5BEB\u8D77\u4F86\u4E5F\u662F\u5F88\u9EBB\u7169\uFF0C\u6240\u4EE5\u6211\u76F4\u63A5\u4E1F\u7D66 AI \u4E86..."]}),"\n",(0,d.jsx)(n.h3,{id:"task-33---generate-undo-log",children:"Task 3.3 - Generate Undo Log"}),"\n",(0,d.jsxs)(n.p,{children:["\u5BE6\u4F5C ",(0,d.jsx)(n.code,{children:"GenerateNewUndoLog"})," \u8DDF ",(0,d.jsx)(n.code,{children:"GenerateUpdatedUndoLog"}),"\uFF0C\u9019\u5169\u500B\u51FD\u6578\u5167\u5BB9\u4E0D\u8907\u96DC\uFF0C\u53EF\u4EE5\u5206\u6210 insert\u3001 delete\u3001 update \u4E09\u7A2E\u60C5\u6CC1\u4F86\u8655\u7406\u3002"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Insert : \u50B3\u5165\u7684 ",(0,d.jsx)(n.code,{children:"base_tuple"})," \u662F\u7A7A\u7684\uFF0C\u56DE\u50B3\u4E00\u500B ",(0,d.jsx)(n.code,{children:"is_deleted_=true"})," \u7684 ",(0,d.jsx)(n.code,{children:"UndoLog"})]}),"\n",(0,d.jsxs)(n.li,{children:["Delete : \u50B3\u5165\u7684 ",(0,d.jsx)(n.code,{children:"target_tuple"})," \u662F\u7A7A\u7684\uFF0C\u56DE\u50B3 ",(0,d.jsx)(n.code,{children:"is_deleted_=false"})," \u4E26\u4E14\u9700\u8981\u4FEE\u6539 ",(0,d.jsx)(n.code,{children:"modified_fields_"})," \u8DDF ",(0,d.jsx)(n.code,{children:"tuple_"})]}),"\n",(0,d.jsxs)(n.li,{children:["Update : \u56DE\u50B3 ",(0,d.jsx)(n.code,{children:"is_deleted_=false"}),"\uFF0C\u4E26\u8DDF\u64DA ",(0,d.jsx)(n.code,{children:"target_tuple"})," \u8DDF ",(0,d.jsx)(n.code,{children:"base_tuple"})," \u4F86\u6C7A\u5B9A ",(0,d.jsx)(n.code,{children:"modified_fields_"})," \u8DDF ",(0,d.jsx)(n.code,{children:"tuple_"})]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u5176\u4ED6\u7684\u90E8\u5206\u5C31\u7167\u8457\u4F5C\u696D\u8AAA\u660E\u505A\u5C31\u597D\uFF0C\u4E3B\u8981\u5C31\u662F\u8981\u628A tuple \u62FC\u8D77\u4F86\u6709\u9EDE\u9EBB\u7169\u3002"}),"\n",(0,d.jsx)(n.h3,{id:"task-34---update--delete-executor",children:"Task 3.4 - Update & Delete Executor"}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u88E1\u4E00\u6A23\u662F\u4FEE\u6539 project 3 \u88E1\u9762\u7684 ",(0,d.jsx)(n.code,{children:"UpdateExecutor"})," \u8DDF ",(0,d.jsx)(n.code,{children:"DeleteExecutor"}),"\uFF0C\u4E3B\u8981\u5C31\u662F\u4F7F\u7528 task 3.3 \u88E1\u9762\u7684 ",(0,d.jsx)(n.code,{children:"GenerateUpdatedUndoLog"})," \u8DDF ",(0,d.jsx)(n.code,{children:"GenerateNewUndoLog"})," \u4F86\u751F\u6210\u8DDF\u4FEE\u6539 ",(0,d.jsx)(n.code,{children:"UndoLog"}),"\uFF0C\u4E26\u4E14\u628A\u6709\u4FEE\u6539\u7684 RID \u52A0\u5165\u5230 ",(0,d.jsx)(n.code,{children:"write_set_"})," \u88E1\u9762\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9019\u90E8\u5206\u90FD\u9084\u5148\u4E0D\u7528\u7406\u6709\u95DC index \u7684\u90E8\u5206\uFF0C\u4F46\u9700\u8981\u6AA2\u67E5 WW \u885D\u7A81\u3002\n\u6709\u5169\u7A2E\u60C5\u6CC1\uFF0C\u7B2C\u4E00\u7A2E\u662F ",(0,d.jsx)(n.code,{children:"meta.ts_ > TXN_START_ID && meta.ts_ != txn->GetTransactionTempTs()"}),"\uFF0C\u9019\u4EE3\u8868\u9019\u500B tuple \u5DF2\u7D93\u88AB\u5176\u4ED6\u672A\u63D0\u4EA4\u7684\u4EA4\u6613\u4FEE\u6539\u904E\u4E86\u3002\n\u7B2C\u4E8C\u7A2E\u662F ",(0,d.jsx)(n.code,{children:"meta.ts_ < TXN_START_ID && meta.ts_ > txn->GetReadTs()"}),"\uFF0C\u9019\u4EE3\u8868\u9019\u500B tuple \u5DF2\u7D93\u88AB\u5176\u4ED6\u5DF2\u63D0\u4EA4\u4E14\u66F4\u665A\u7684\u4EA4\u6613\u4FEE\u6539\u904E\u4E86\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"task-35---stop-the-world-garbage-collection",children:"Task 3.5 - Stop-the-world Garbage Collection"}),"\n",(0,d.jsx)(n.p,{children:"\u70BA\u4E86\u964D\u4F4E\u4F75\u767C\u7684\u8907\u96DC\u5EA6\uFF0Cbustub \u63A1\u7528\u7684\u662F stop-the-world \u7684\u5783\u573E\u56DE\u6536\u6A5F\u5236\uFF0C\u53EA\u6703\u5728\u6240\u6709\u4EA4\u6613\u90FD\u7D50\u675F\u5F8C\u624D\u6703\u9032\u884C\u5783\u573E\u56DE\u6536\u3002"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500B task \u6703\u7D50\u5408\u6211\u5011\u5728 task 1.2 \u5BE6\u4F5C\u7684 watermark\uFF0C\u9019\u88E1\u6211\u81EA\u5DF1\u5206\u6210\u4E09\u500B\u6B65\u9A5F :"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u904D\u6B77 ",(0,d.jsx)(n.code,{children:"txn_map_"})," \u8DDF ",(0,d.jsx)(n.code,{children:"write_set_"}),"\uFF0C\u628A\u5DF2\u7D93 commit \u6216 abort \u7684\u4EA4\u6613\u4E2D\u6709\u4FEE\u6539\u904E\u7684 RID \u5168\u90E8\u8490\u96C6\u8D77\u4F86\uFF0C\u5EFA\u7ACB\u4E00\u500B ",(0,d.jsx)(n.code,{children:"unordered_map<txn_id_t, unordered_map<table_oid_t, unordered_set<RID>>>"})," \u7684\u6620\u5C04"]}),"\n",(0,d.jsxs)(n.li,{children:["\u7D00\u9304\u4E0D\u80FD\u88AB\u522A\u9664\u7684 txn (",(0,d.jsx)(n.code,{children:"unordered_set"}),")\uFF0C\u6AA2\u67E5 ",(0,d.jsx)(n.code,{children:"watermark <= meta.ts_"}),"\uFF0C\u5982\u679C\u662F\u7684\u8A71\u5C31\u628A\u9019\u500B txn \u52A0\u5165\u5230\u4E0D\u53EF\u522A\u9664\u7684\u96C6\u5408\u88E1\u9762\uFF0C\u63A5\u8457\u518D\u904D\u6B77\u9019\u500B RID \u7684 ",(0,d.jsx)(n.code,{children:"UndoLog"})," \u627E\u51FA ",(0,d.jsx)(n.code,{children:"watermark <= undo_log->ts_"})," \u7684\u4E5F\u52A0\u5165\u4E0D\u53EF\u522A\u9664\u7684\u96C6\u5408"]}),"\n",(0,d.jsxs)(n.li,{children:["\u6700\u5F8C\u904D\u6B77 ",(0,d.jsx)(n.code,{children:"txn_map_"}),"\uFF0C\u5982\u679C\u662F COMMITTED \u6216 ABORTED \u7136\u5F8C\u53C8\u4E0D\u5728\u4E0D\u53EF\u522A\u9664\u7684 txn \u88E1\u9762\uFF0C\u5C31\u53EF\u4EE5\u628A\u9019\u500B txn \u522A\u6389"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"task-4---primary-key-index",children:"Task 4 - Primary Key Index"}),"\n",(0,d.jsx)(n.h3,{id:"task-41---index-insert",children:"Task 4.1 - Index Insert"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500B task \u4E3B\u8981\u76EE\u6A19\u662F\u8B93 Insert \u64CD\u4F5C\u53EF\u4EE5\u5728\u4F75\u767C\u74B0\u5883\u4E0B\u6B63\u78BA\u7684\u8655\u7406\u4E3B\u9375\u7684\u885D\u7A81\u3002"}),"\n",(0,d.jsxs)(n.p,{children:["\u53EF\u4EE5\u5148\u900F\u904E ",(0,d.jsx)(n.code,{children:"index_info->index_->GetMetadata()->IsPrimaryKey()"})," \u62FF\u5230 primary key index \u7684\u8CC7\u8A0A\uFF0C\u63A5\u8457\u5728\u8B80\u8CC7\u6599\u7684\u6642\u5019\u5148\u6AA2\u67E5\u9019\u500B key \u662F\u4E0D\u662F\u5DF2\u7D93\u5B58\u5728\u4E86\uFF0C\u5982\u679C\u5B58\u5728\u5C31\u628A\u72C0\u614B\u6539\u6210 TAINTED \u4E26\u62CB\u932F\u5373\u53EF\uFF0C\u5982\u679C\u4E0D\u5B58\u5728\uFF0C\u90A3\u5C31\u5E36\u8457\u81E8\u6642\u7684 timestamp \u76F4\u63A5\u63D2\u5165\uFF0C\u4E26\u4E14\u547C\u53EB ",(0,d.jsx)(n.code,{children:"InsertEntry()"})," \u4F86\u63D2\u5165 index\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u4E5F\u8981\u6CE8\u610F\u8655\u7406 ",(0,d.jsx)(n.code,{children:"InsertEntry()"})," \u56DE\u50B3 false \u7684\u60C5\u6CC1\uFF0C\u9019\u4EE3\u8868\u6709\u5176\u4ED6\u4EA4\u6613\u5DF2\u7D93\u63D2\u5165\u4E86\u76F8\u540C\u7684 key\uFF0C\u8655\u7406\u65B9\u5F0F\u8DDF\u524D\u9762\u4E00\u6A23\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"task-42---index-scan-delete--update",children:"Task 4.2 - Index Scan, Delete, & Update"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500B task \u4E3B\u8981\u662F\u8B93\u6240\u6709\u7684\u64CD\u4F5C\u90FD\u80FD\u652F\u6301 MVCC (\u5305\u62EC Index Scan\u3001Delete\u3001Update\u3001Insert)\u3002"}),"\n",(0,d.jsx)(n.p,{children:"\u70BA\u4E86\u8B93\u7D22\u5F15\u53EF\u4EE5\u652F\u63F4\u904E\u53BB\u7684\u8CC7\u6599\uFF0Cbustub \u898F\u5B9A\u7D22\u5F15\u4E00\u65E6\u88AB\u5275\u5EFA\u5C31\u6C38\u9060\u4E0D\u6703\u88AB\u7269\u7406\u522A\u9664\uFF0C\u6240\u4EE5\u9019\u500B task \u9700\u8981\u4FEE\u6539\u6240\u6709\u7684 executors\u3002"}),"\n",(0,d.jsxs)(n.p,{children:["\u9996\u5148\uFF0C\u5728 project 3 \u4E2D\u7684 ",(0,d.jsx)(n.code,{children:"DeleteExecutor"})," \u9700\u8981\u628A ",(0,d.jsx)(n.code,{children:"TupleMeta"})," \u7684 ",(0,d.jsx)(n.code,{children:"is_deleted_"})," \u6539\u6210 true\uFF0C\u4E26\u4E14\u8981\u628A\u7D22\u5F15\u4E5F\u522A\u6389\u3002\n\u800C\u73FE\u5728\u9700\u8981\u628A\u522A\u9664\u7D22\u5F15\u7684\u90A3\u90E8\u5206\u5B8C\u5168\u79FB\u9664\uFF0C\u53EA\u9700\u8981\u628A ",(0,d.jsx)(n.code,{children:"TupleMeta"})," \u7684 ",(0,d.jsx)(n.code,{children:"is_deleted_"})," \u6539\u6210 true \u5373\u53EF\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u63A5\u8457\u662F INSERT \u7684\u90E8\u5206\uFF0C\u5728 task 4.1 \u4E2D\u6211\u5011\u6709\u63D0\u5230\u8981\u5148\u6AA2\u67E5\u4E3B\u9375\u662F\u5426\u5B58\u5728\uFF0C\u5982\u679C\u5B58\u5728\u5C31\u8981\u628A\u72C0\u614B\u6539\u6210 TAINTED \u4E26\u62CB\u932F\u3002\n\u800C\u73FE\u5728\u9700\u8981\u6539\u6210\u5982\u679C\u9019\u500B\u9375\u5B58\u5728\u4E14\u6C92\u6709\u88AB\u522A\u9664 (",(0,d.jsx)(n.code,{children:"meta.is_deleted_ == false"}),")\uFF0C\u624D\u628A\u72C0\u614B\u6539\u6210 TAINTED \u4E26\u62CB\u932F\uFF0C\u5982\u679C\u9019\u500B\u9375\u5B58\u5728\u4F46\u88AB\u522A\u9664 (",(0,d.jsx)(n.code,{children:"meta.is_deleted_ == true"}),")\uFF0C\u5C31\u53EF\u4EE5\u76F4\u63A5 reuse \u9019\u500B RID\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["Index scan \u7684\u90E8\u5206\u53EF\u4EE5\u53C3\u8003 task 2.2 \u7684 ",(0,d.jsx)(n.code,{children:"SeqScanExecutor"})," \u4F86\u5BE6\u4F5C\uFF0C\u5DEE\u5225\u5728\u65BC\u8981\u5148\u5F9E index \u88E1\u9762\u53D6\u5F97 RID\uFF0C\u4E5F\u662F\u4E00\u6A23\u4F7F\u7528 ",(0,d.jsx)(n.code,{children:"CollectUndoLogs"})," \u8DDF ",(0,d.jsx)(n.code,{children:"ReconstructTuple"})," \u4F86\u9084\u539F tuple\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u9664\u4E86\u4E0A\u9762\u9019\u5E7E\u500B executors \u4E4B\u5916\uFF0C\u6211\u5011\u9084\u9700\u8981\u5BE6\u4F5C ",(0,d.jsx)(n.code,{children:"UpdateTupleAndUndoLink()"})," \u88E1\u9762\u7684 check \u51FD\u6578\u4F86\u907F\u514D race condition \u7684\u60C5\u6CC1\u3002\n\u7531\u65BC\u5728\u57F7\u884C ",(0,d.jsx)(n.code,{children:"UpdateTupleAndUndoLink()"})," \u4E4B\u524D\uFF0C\u6211\u5011\u61C9\u8A72\u5DF2\u7D93\u6AA2\u67E5\u904E WW \u885D\u7A81\u4E86 (by task 3.4)\uFF0C\u6240\u4EE5\u9019\u88E1\u53EA\u8981\u6AA2\u67E5 ",(0,d.jsx)(n.code,{children:"meta.ts_ == ts"})," \u5373\u53EF\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"task-43---primary-key-updates",children:"Task 4.3 - Primary Key Updates"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500B task \u4E3B\u8981\u662F\u8981\u8655\u7406 UPDATE \u64CD\u4F5C\uFF0C\u91DD\u5C0D primary key \u88AB\u4FEE\u6539\u7684\u60C5\u6CC1\u3002"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u88E1\u7684\u908F\u8F2F\u5176\u5BE6\u883B\u591A\u7684\uFF0C\u4F46\u662F\u7E3D\u9AD4\u4F86\u8AAA\u53EF\u4EE5\u62C6\u6210\u4E00\u6B21\u522A\u9664\u8DDF\u4E00\u6B21\u63D2\u5165\u4F86\u8655\u7406\uFF0C\u5177\u9AD4\u5BE6\u4F5C\u8DDF task 4.2 \u7684 INSERT \u8DDF DELETE \u5DEE\u4E0D\u591A\u3002"}),"\n",(0,d.jsx)(n.h2,{id:"bonus-1---abort",children:"Bonus 1 - Abort"}),"\n",(0,d.jsx)(n.p,{children:"\u7531\u65BC\u5982\u679C\u4EA4\u6613\u5931\u6557\u7684\u8A71\uFF0C\u5C31\u6C92\u6709\u5176\u4ED6\u4EA4\u6613\u53EF\u4EE5\u7E7C\u7E8C\u4FEE\u6539\u9019\u500B tuple \u4E86\uFF0C\u6240\u4EE5\u6211\u5011\u53EA\u9700\u8981\u95DC\u5FC3\u88AB\u4FEE\u6539\u904E\u5F8C\u7684 tuple \u6700\u5F8C\u4E00\u6B21\u7684\u72C0\u614B\u5373\u53EF\u3002"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u88E1\u6211\u9078\u64C7\u7684\u662F Implementation #2 \u7684\u505A\u6CD5\uFF0C\u6709\u4E09\u7A2E\u60C5\u6CC1 :"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u5982\u679C\u6C92\u6709 ",(0,d.jsx)(n.code,{children:"UndoLink"}),"\uFF0C\u4EE3\u8868\u9019\u500B tuple \u662F\u88AB insert \u7684\uFF0C\u76F4\u63A5\u63D2\u5165 ",(0,d.jsx)(n.code,{children:"TupleMeta{0, true}"})," \u5373\u53EF"]}),"\n",(0,d.jsxs)(n.li,{children:["\u5982\u679C\u6709 ",(0,d.jsx)(n.code,{children:"UndoLink"}),"\uFF0C\u4EE3\u8868\u9019\u500B tuple \u662F\u88AB update \u6216 delete \u7684","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u5982\u679C ",(0,d.jsx)(n.code,{children:"ReconstructTuple"})," \u56DE\u50B3\u7A7A\u7684 optional\uFF0C\u4EE3\u8868\u9019\u500B tuple \u662F\u88AB delete \u7684\uFF0C\u66F4\u65B0\u70BA ",(0,d.jsx)(n.code,{children:"TupleMeta{undo_log.ts_, true}"})," \u5373\u53EF"]}),"\n",(0,d.jsxs)(n.li,{children:["\u5982\u679C ",(0,d.jsx)(n.code,{children:"ReconstructTuple"})," \u56DE\u50B3\u6709\u503C\uFF0C\u4EE3\u8868\u9019\u500B tuple \u662F\u88AB update \u7684\uFF0C\u66F4\u65B0\u70BA ",(0,d.jsx)(n.code,{children:"TupleMeta{undo_log.ts_, false}"})," \u5373\u53EF"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"bonus-2---serializable-verification",children:"Bonus 2 - Serializable Verification"}),"\n",(0,d.jsxs)(n.p,{children:["\u70BA\u4E86\u5BE6\u73FE\u53EF\u5E8F\u5217\u5316\uFF0C\u6211\u5011\u9700\u8981\u5728 index scan \u8DDF seq scan \u7684\u6642\u5019\u628A predicate \u52A0\u5165\u5230 ",(0,d.jsx)(n.code,{children:"scan_predicates_"})," \u88E1\u9762\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u5BE6\u73FE\u7684\u908F\u8F2F\u5982\u4E0B :"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"\u8DF3\u904E\u53EA\u8B80\u4EA4\u6613"}),"\n",(0,d.jsx)(n.li,{children:"\u6536\u96C6\u885D\u7A81\u4EA4\u6613 (commit_ts > \u672C txn \u7684 read_ts)"}),"\n",(0,d.jsxs)(n.li,{children:["\u5C0D\u6BCF\u500B\u885D\u7A81\u4EA4\u6613\u7684\u6BCF\u500B table \u7684\u5BEB\u96C6\u5408\u505A\u6AA2\u67E5\uFF0C\u4E26\u770B\u770B\u5B83\u662F\u5426\u6709\u8DDF\u7576\u524D\u4EA4\u6613\u6383\u63CF\u904E\u7684 predicate \u6709\u4EA4\u96C6 (\u540C\u4E00\u500B ",(0,d.jsx)(n.code,{children:"table_oid_t"}),")"]}),"\n",(0,d.jsxs)(n.li,{children:["\u5C0D\u885D\u7A81\u4EA4\u6613\u4FEE\u6539\u7684\u6BCF\u500B RID\uFF0C\u53D6\u5F97\u5230 read_ts \u6642\u7684\u6240\u6709 ",(0,d.jsx)(n.code,{children:"UndoLog"})]}),"\n",(0,d.jsxs)(n.li,{children:["\u63A5\u8457\u5C31\u53EF\u4EE5\u5617\u8A66\u5C0D\u9019\u500B RID \u4E0D\u65B7\u7528 ",(0,d.jsx)(n.code,{children:"ReconstructTuple"})," \u4F86\u9084\u539F tuple \u4E26\u6E2C\u8A66\u662F\u5426\u5728 predicate \u7684\u7BC4\u570D\u5167"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"submit",children:"Submit"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"make txn_timestamp_test -j$(nproc) && ./test/txn_timestamp_test\n\nmake txn_scan_test -j$(nproc) && ./test/txn_scan_test\n\nmake txn_executor_test -j$(nproc) && ./test/txn_executor_test\n\nmake txn_index_test -j$(nproc) && ./test/txn_index_test\n\nmake txn_index_concurrent_test -j$(nproc) && ./test/txn_index_concurrent_test\n\nmake txn_abort_serializable_test -j$(nproc) && ./test/txn_abort_serializable_test\n"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"make format && make check-format && make check-lint && make check-clang-tidy-p4\n"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:"make submit-p4\n"})}),"\n",(0,d.jsx)(n.h2,{id:"takeaways",children:"Takeaways"}),"\n",(0,d.jsx)(n.p,{children:"\u7D42\u65BC\u5BEB\u5B8C\u5168\u90E8\u7684\u7B46\u8A18\u5566~ \u7051\u82B1 \u{1F389}"}),"\n",(0,d.jsx)(n.p,{children:"\u9019\u500B project \u662F\u6211\u82B1\u6700\u4E45\u6642\u9593\u7684\u4E00\u500B\uFF0C\u6211\u89BA\u5F97\u4E3B\u8981\u539F\u56E0\u662F\u5F88\u96E3\u627E\u5230 bug \u5728\u54EA\uFF0C\u5373\u4F7F\u73FE\u5728\u4EA4\u5230 gradescope \u53EF\u4EE5\u5168\u904E\u6211\u4F9D\u7136\u89BA\u5F97\u6211\u7684\u5F88\u591A\u5BE6\u73FE\u7406\u8AD6\u4E0A\u61C9\u8A72\u8981\u6709\u554F\u984C\u624D\u5C0D\uFF0C\u4F46\u53CD\u6B63\u6E2C\u8CC7\u770B\u4E0D\u5230\u6211\u4E5F\u7576\u770B\u4E0D\u5230\u597D\u4E86 \u{1FAE3}"}),"\n",(0,d.jsx)(n.p,{children:"\u7E3D\u9AD4\u4F86\u8AAA\u9019\u6B21\u7684 project \u5C31\u662F\u4E00\u500B\u4E0D\u65B7\u91CD\u69CB\u7684\u904E\u7A0B\uFF0C\u9664\u4E86\u8981\u56DE\u61B6 project #3 \u7684\u5167\u5BB9\u4E4B\u5916\uFF0C\u751A\u81F3\u5728\u540C\u4E00\u500B task \u88E1\u9762\u4E5F\u6703\u4E0D\u65B7\u7684\u91CD\u69CB\uFF0C\u50CF\u662F task 4 \u5C31\u662F\u4E0D\u65B7\u7684\u91CD\u6539\u53C8\u91CD\u6539\uFF0C\u771F\u7684\u662F\u6709\u4E00\u9EDE\u7169\u3002\n\u4E0D\u904E\u9019\u6B21\u7684\u5BE6\u4F5C\u4F9D\u7136\u8B93\u6211\u5C0D MVCC \u7684\u6574\u9AD4\u6982\u5FF5\u6709\u6BD4\u8F03\u597D\u7684\u7406\u89E3\uFF0C\u6536\u7A6B\u9084\u7B97\u662F\u6EFF\u5927\u7684\u3002"}),"\n",(0,d.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/10666804837",children:"CMU Fall 2024 15-445 MVCC & SI & P4[\u5F85\u5B8C]"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://4ever-xxxl.github.io/cmu-15445-project-4/",children:"CMU 15445 Project4"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/1932549868683007217",children:"CMU15445-2024fall-project4\u8E29\u5751\u7ECF\u5386"})}),"\n"]})]})}function x(e={}){let{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(o,{...e})}):o(e)}function h(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},4429:function(e,n,s){s.d(n,{R:()=>i,x:()=>r});var t=s(6540);let d={},c=t.createContext(d);function i(e){let n=t.useContext(c);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:i(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);