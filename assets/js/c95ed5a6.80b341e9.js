"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6837],{9551:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>a,contentTitle:()=>r,default:()=>E,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"CMU15-445/c02","title":"Modern SQL","description":"CMU15-445/645 Modern SQL","source":"@site/docs/CMU15-445/c02.mdx","sourceDirName":"CMU15-445","slug":"/CMU15-445/c02","permalink":"/RulerChen-Website/docs/CMU15-445/c02","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/c02.mdx","tags":[{"inline":true,"label":"CMU15-445","permalink":"/RulerChen-Website/docs/tags/cmu-15-445"}],"version":"current","lastUpdatedAt":1757340208000,"sidebarPosition":2,"frontMatter":{"title":"Modern SQL","sidebar_position":2,"description":"CMU15-445/645 Modern SQL","keywords":["CMU15-445/645","Modern SQL","CMU15-445/645 \u7b46\u8a18"],"tags":["CMU15-445"]},"sidebar":"tutorialSidebar","previous":{"title":"Relational Model & Algebra","permalink":"/RulerChen-Website/docs/CMU15-445/c01"},"next":{"title":"Database Storage","permalink":"/RulerChen-Website/docs/CMU15-445/c03"}}');var d=s(4848),c=s(8453);const l={title:"Modern SQL",sidebar_position:"2",description:"CMU15-445/645 Modern SQL",keywords:["CMU15-445/645","Modern SQL","CMU15-445/645 \u7b46\u8a18"],tags:["CMU15-445"]},r=void 0,a={},o=[{value:"SQL History",id:"sql-history",level:2},{value:"Relational Languages",id:"relational-languages",level:2},{value:"SQL Syntax",id:"sql-syntax",level:2},{value:"Joins",id:"joins",level:3},{value:"Inner Join",id:"inner-join",level:4},{value:"Left Join",id:"left-join",level:4},{value:"Right Join",id:"right-join",level:4},{value:"Full Join",id:"full-join",level:4},{value:"Cross Join",id:"cross-join",level:4},{value:"Aggregates",id:"aggregates",level:3},{value:"String Operations",id:"string-operations",level:3},{value:"Date and Time",id:"date-and-time",level:3},{value:"Output Redirection",id:"output-redirection",level:3},{value:"Output Control",id:"output-control",level:3},{value:"Window Functions",id:"window-functions",level:3},{value:"Nested Queries",id:"nested-queries",level:3},{value:"Common Table Expressions",id:"common-table-expressions",level:3}];function t(n){const e={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...n.components},{Head:s,ImageModal:i}=e;return s||S("Head",!0),i||S("ImageModal",!0),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s,{children:(0,d.jsx)("title",{children:"CMU 15-445 Modern SQL"})}),"\n",(0,d.jsx)(e.p,{children:"\u9019\u7bc7\u7b46\u8a18\u6703\u7c21\u55ae\u4ecb\u7d39\u5e38\u898b\u7684 SQL \u8a9e\u6cd5\u3002"}),"\n",(0,d.jsx)(e.h2,{id:"sql-history",children:"SQL History"}),"\n",(0,d.jsx)(e.p,{children:"SQL \u6700\u65e9\u7531 IBM \u5728 1970 \u5e74\u4ee3\u521d\u671f\u958b\u767c\uff0c\u4e26\u65bc 1986 \u5e74\u6210\u70ba ANSI \u6a19\u6e96\uff0c\u96a8\u5f8c\u5728 1987 \u5e74\u88ab ISO \u63a1\u7528\u3002\n\u81ea\u90a3\u6642\u4ee5\u4f86\uff0cSQL \u6a19\u6e96\u7d93\u6b77\u4e86\u591a\u6b21\u4fee\u8a02\u548c\u64f4\u5c55\uff0c\u4e3b\u8981\u7684\u66f4\u65b0\u5305\u62ec :"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"SQL:1999 Regular expressions, Triggers"}),"\n",(0,d.jsx)(e.li,{children:"SQL:2003 XML, Windows, Sequences"}),"\n",(0,d.jsx)(e.li,{children:"SQL:2008 Truncation, Fancy sorting"}),"\n",(0,d.jsx)(e.li,{children:"SQL:2011 Temporal DBs, Pipelined DML"}),"\n",(0,d.jsx)(e.li,{children:"SQL:2016 JSON, Polymorphic tables"}),"\n",(0,d.jsx)(e.li,{children:"SQL:2023 Property Graph Queries, Muti-Dim. Arrays"}),"\n"]}),"\n",(0,d.jsx)(e.h2,{id:"relational-languages",children:"Relational Languages"}),"\n",(0,d.jsx)(e.p,{children:'\u5728 1969 \u5e74\uff0cTed Codd \u63d0\u51fa\u4e86 Relational Model\uff0c\u5176\u6838\u5fc3\u76ee\u6a19\u662f\u8b93\u8cc7\u6599\u5eab\u4f7f\u7528\u8005\u80fd\u4ee5\u9ad8\u968e\u8a9e\u8a00\u64cd\u4f5c\u8cc7\u6599\uff0c\u800c\u4e0d\u9700\u8981\u7406\u89e3\u5e95\u5c64\u7684\u7269\u7406\u5132\u5b58\u65b9\u5f0f\u3002\n\u8981\u5be6\u73fe\u9019\u500b\u6a21\u578b\uff0c\u5c31\u9700\u8981\u4e00\u5957\u5c08\u9580\u7684 "\u8a9e\u8a00" \u4f86\u63cf\u8ff0\u8cc7\u6599\u7684\u5b58\u53d6\u8207\u64cd\u4f5c\u65b9\u5f0f\uff0c\u9019\u4e9b\u8a9e\u8a00\u7684\u7e3d\u7a31\u5c31\u662f Relational Languages\u3002'}),"\n",(0,d.jsx)(e.p,{children:"Relational Languages \u53ef\u4ee5\u5206\u70ba\u5169\u5927\u985e\uff0c\u5206\u5225\u662f Relational Algebra \u8207 Relational Calculus\u3002"}),"\n",(0,d.jsx)(e.p,{children:"Relational Algebra \u662f\u4e00\u7a2e\u7a0b\u5e8f\u6027\u8a9e\u8a00 (Procedural Language)\uff0c\u4f7f\u7528\u8005\u9700\u8981\u660e\u78ba\u6307\u5b9a\u5982\u4f55 (How) \u7372\u53d6\u8cc7\u6599\u7684\u6b65\u9a5f\u3002\nRelational Calculus \u5247\u662f\u4e00\u7a2e\u5ba3\u544a\u5f0f\u8a9e\u8a00 (Non-Procedural Language)\uff0c\u4f7f\u7528\u8005\u53ea\u9700\u63cf\u8ff0\u60f3\u8981\u4ec0\u9ebc (What) \u8cc7\u6599\uff0c\u7531\u7cfb\u7d71\u81ea\u884c\u6c7a\u5b9a\u6700\u4f73\u7684\u57f7\u884c\u8a08\u756b\u3002"}),"\n",(0,d.jsx)(e.p,{children:"SQL \u5c31\u662f\u7d9c\u5408\u4e86\u9019\u5169\u7a2e\u6a21\u5f0f\u7684\u8a9e\u8a00\uff0c\u5b83\u5728\u8a9e\u6cd5\u4e0a\u662f\u5ba3\u544a\u5f0f\u7684\uff0c\u4f46\u5728\u7cfb\u7d71\u5167\u90e8\uff0c\u67e5\u8a62\u901a\u5e38\u6703\u88ab\u8f49\u63db\u70ba\u95dc\u806f\u4ee3\u6578\u904b\u7b97\uff0c\u9032\u800c\u751f\u6210\u6700\u4f73\u5316\u7684\u57f7\u884c\u8a08\u756b\u3002"}),"\n",(0,d.jsx)(e.p,{children:"\u8207\u7406\u8ad6\u4e0d\u540c\u7684\u662f\uff0cSQL \u4f7f\u7528\u7684\u662f bag (multiset) \u800c\u975e set\uff0c\u9019\u610f\u5473\u8457 SQL \u4e2d\u7684\u7d50\u679c\u53ef\u4ee5\u5305\u542b\u91cd\u8907\u7684\u8cc7\u6599\u5217\u3002"}),"\n",(0,d.jsx)(e.p,{children:"SQL \u53ef\u4ee5\u88ab\u7d30\u5206\u70ba\u5e7e\u7a2e\u5b50\u985e :"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"DML (Data Manipulation Language) : \u67e5\u8a62\u3001\u63d2\u5165\u3001\u66f4\u65b0\u3001\u522a\u9664\u8cc7\u6599\uff0c\u4f8b\u5982 SELECT, INSERT, UPDATE, DELETE"}),"\n",(0,d.jsx)(e.li,{children:"DDL (Data Definition Language) : \u5b9a\u7fa9 table, view, index \u7b49\u7b49\uff0c\u4f8b\u5982 CREATE, ALTER, DROP"}),"\n",(0,d.jsx)(e.li,{children:"DCL (Data Control Language) : \u5b9a\u7fa9\u6b0a\u9650 (\u8cc7\u5b89\u76f8\u95dc)\uff0c\u4f8b\u5982 GRANT, REVOKE"}),"\n",(0,d.jsx)(e.li,{children:"TCL (Transaction Control Language) : \u4ea4\u6613\u63a7\u5236\uff0c\u4f8b\u5982 COMMIT, ROLLBACK"}),"\n"]}),"\n",(0,d.jsx)(e.h2,{id:"sql-syntax",children:"SQL Syntax"}),"\n",(0,d.jsx)(e.p,{children:"\u63a5\u4e0b\u4f86\u6703\u4ecb\u7d39 SQL \u7684\u5e38\u7528\u8a9e\u6cd5\uff0c\u4f7f\u7528\u7684\u8cc7\u6599\u8868\u5982\u4e0b :"}),"\n",(0,d.jsx)(i,{src:"/img/cmu15-445/c02/image.webp",caption:"Example Table"}),"\n",(0,d.jsx)(e.p,{children:"\u5982\u679c\u60f3\u5be6\u969b\u64cd\u4f5c\u770b\u770b\u7684\u8a71\uff0c\u53ef\u4ee5\u4f7f\u7528 Docker \u5feb\u901f\u5efa\u7acb\u4e00\u500b PostgreSQL \u74b0\u5883\uff0c\u4ee5\u4e0b\u7684\u7bc4\u4f8b\u4e5f\u90fd\u6703\u4ee5 PostgreSQL \u7684\u8a9e\u6cd5\u70ba\u4e3b\u3002"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"docker run --name mypg -e POSTGRES_PASSWORD=123456 -p 5432:5432 -d postgres:17\ndocker exec -it mypg psql -U postgres\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u63a5\u8457\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u7684 SQL \u8a9e\u6cd5\u4f86\u5efa\u7acb\u8cc7\u6599\u8868\u4e26\u63d2\u5165\u8cc7\u6599 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"CREATE TABLE student(\n    sid INT PRIMARY KEY,\n    name VARCHAR(16),\n    login VARCHAR(32) UNIQUE,\n    age SMALLINT,\n    gpa FLOAT\n);\n\nCREATE TABLE course(\n    cid VARCHAR(32) PRIMARY KEY,\n    name VARCHAR(32) NOT NULL\n);\n\nCREATE TABLE enrolled(\n    sid INT REFERENCES student(sid),\n    cid VARCHAR(32) REFERENCES course(cid),\n    grade CHAR(1)\n);\n\nINSERT INTO student (sid, name, login, age, gpa) VALUES\n(53666, 'RZA', 'rza@cs', 44, 4.0),\n(53688, 'Bieber', 'jbieber@cs', 27, 3.9),\n(53655, 'Tupac', 'shakur@cs', 25, 3.5),\n(53621, 'GZA', 'gza@cs', 54, 3.8);\n\nINSERT INTO course (cid, name) VALUES\n('15-445', 'Database Systems'),\n('15-721', 'Advanced Database Systems'),\n('15-826', 'Data Mining'),\n('15-799', 'Special Topics in Databases'),\n('15-999', 'Non-Database Course');\n\nINSERT INTO enrolled (sid, cid, grade) VALUES\n(53666, '15-445', 'C'),\n(53688, '15-721', 'A'),\n(53688, '15-826', 'B'),\n(53655, '15-445', 'B'),\n(53666, '15-721', 'C');\n"})}),"\n",(0,d.jsx)(e.h3,{id:"joins",children:"Joins"}),"\n",(0,d.jsx)(e.p,{children:"\u53ef\u4ee5\u7528\u65bc\u9023\u63a5\u5169\u5f35 table\uff0c\u4e26\u4e14\u53ef\u4ee5\u4f9d\u64da\u4e0d\u540c\u7684\u689d\u4ef6\u4f86\u9023\u63a5\u3002"}),"\n",(0,d.jsx)(e.h4,{id:"inner-join",children:"Inner Join"}),"\n",(0,d.jsx)(e.p,{children:"\u53ea\u56de\u50b3\u5169\u500b\u8cc7\u6599\u8868\u4e2d\uff0c\u9023\u63a5\u6b04\u4f4d\u7686\u80fd\u5339\u914d\u4e0a\u7684\u8cc7\u6599\u5217 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u627e\u51fa\u6240\u6709\u6709\u4fee\u8ab2\u7684\u5b78\u751f\u4ee5\u53ca\u4ed6\u5011\u4fee\u7684\u8ab2\u7a0b\nSELECT s.name, e.cid\nFROM student AS s\nJOIN enrolled AS e ON s.sid = e.sid;\n\n-- equivalent to\nSELECT s.name, e.cid\nFROM student AS s\nINNER JOIN enrolled AS e ON s.sid = e.sid;\n\n--   name  |  cid\n-- --------+--------\n--  RZA    | 15-445\n--  Bieber | 15-721\n--  Bieber | 15-826\n--  Tupac  | 15-445\n--  RZA    | 15-721\n"})}),"\n",(0,d.jsx)(e.h4,{id:"left-join",children:"Left Join"}),"\n",(0,d.jsx)(e.p,{children:"\u56de\u50b3\u5de6\u908a\u8cc7\u6599\u8868\u7684\u6240\u6709\u8cc7\u6599\u5217\uff0c\u53f3\u908a\u8cc7\u6599\u8868\u4e2d\u9023\u63a5\u6b04\u4f4d\u80fd\u5339\u914d\u4e0a\u7684\u8cc7\u6599\u5217\uff0c\u82e5\u7121\u6cd5\u5339\u914d\u5247\u4ee5 NULL \u88dc\u8db3 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u627e\u51fa\u6240\u6709\u5b78\u751f\u4ee5\u53ca\u4ed6\u5011\u4fee\u7684\u8ab2\u7a0b (\u82e5\u7121\u4fee\u8ab2\u5247\u986f\u793a NULL)\nSELECT s.name, e.cid\nFROM student AS s\nLEFT JOIN enrolled AS e ON s.sid = e.sid;\n\n--   name  |  cid\n-- --------+--------\n--  RZA    | 15-445\n--  Bieber | 15-721\n--  Bieber | 15-826\n--  Tupac  | 15-445\n--  RZA    | 15-721\n--  GZA    |\n"})}),"\n",(0,d.jsx)(e.h4,{id:"right-join",children:"Right Join"}),"\n",(0,d.jsx)(e.p,{children:"\u56de\u50b3\u53f3\u908a\u8cc7\u6599\u8868\u7684\u6240\u6709\u8cc7\u6599\u5217\uff0c\u5de6\u908a\u8cc7\u6599\u8868\u4e2d\u9023\u63a5\u6b04\u4f4d\u80fd\u5339\u914d\u4e0a\u7684\u8cc7\u6599\u5217\uff0c\u82e5\u7121\u6cd5\u5339\u914d\u5247\u4ee5 NULL \u88dc\u8db3 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u627e\u51fa\u6240\u6709\u8ab2\u7a0b\u4ee5\u53ca\u4fee\u9019\u4e9b\u8ab2\u7a0b\u7684\u5b78\u751f (\u82e5\u7121\u5b78\u751f\u4fee\u8ab2\u5247\u986f\u793a NULL)\nSELECT c.cid, e.sid\nFROM enrolled AS e\nRIGHT JOIN course AS c ON e.cid = c.cid;\n\n--   cid   |  sid\n-- --------+-------\n--  15-445 | 53666\n--  15-721 | 53688\n--  15-826 | 53688\n--  15-445 | 53655\n--  15-721 | 53666\n--  15-999 |\n--  15-799 |\n"})}),"\n",(0,d.jsx)(e.h4,{id:"full-join",children:"Full Join"}),"\n",(0,d.jsx)(e.p,{children:"\u56de\u50b3\u5169\u500b\u8cc7\u6599\u8868\u7684\u806f\u96c6\uff0c\u5169\u908a\u8cc7\u6599\u8868\u4e2d\u9023\u63a5\u6b04\u4f4d\u80fd\u5339\u914d\u4e0a\u7684\u8cc7\u6599\u5217\uff0c\u82e5\u7121\u6cd5\u5339\u914d\u5247\u4ee5 NULL \u88dc\u8db3 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u627e\u51fa\u6240\u6709\u5b78\u751f\u4ee5\u53ca\u6709\u9078\u904e\u7684\u8ab2\u7a0b (\u82e5\u7121\u4fee\u8ab2\u6216\u6c92\u88ab\u9078\u904e\u5247\u986f\u793a NULL)\nSELECT s.name, e.cid\nFROM student AS s\nFULL JOIN enrolled AS e ON s.sid = e.sid;\n\n--   name  |  cid\n-- --------+--------\n--  RZA    | 15-445\n--  Bieber | 15-721\n--  Bieber | 15-826\n--  Tupac  | 15-445\n--  RZA    | 15-721\n--  GZA    |\n"})}),"\n",(0,d.jsx)(e.h4,{id:"cross-join",children:"Cross Join"}),"\n",(0,d.jsx)(e.p,{children:"\u56de\u50b3\u5169\u500b\u8cc7\u6599\u8868\u7684\u7b1b\u5361\u5152\u7a4d (Cartesian Product) :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u627e\u51fa\u6240\u6709\u5b78\u751f\u4ee5\u53ca\u6240\u6709\u8ab2\u7a0b\u7684\u7d44\u5408\nSELECT s.name, c.cid\nFROM student AS s\nCROSS JOIN course AS c;\n\n--   name  |  cid\n-- --------+--------\n--  RZA    | 15-445\n--  RZA    | 15-721\n--  RZA    | 15-826\n--  RZA    | 15-799\n--  RZA    | 15-999\n--  Bieber | 15-445\n--  Bieber | 15-721\n--  Bieber | 15-826\n--  Bieber | 15-799\n--  Bieber | 15-999\n--  Tupac  | 15-445\n--  Tupac  | 15-721\n--  Tupac  | 15-826\n--  Tupac  | 15-799\n--  Tupac  | 15-999\n--  GZA    | 15-445\n--  GZA    | 15-721\n--  GZA    | 15-826\n--  GZA    | 15-799\n--  GZA    | 15-999\n"})}),"\n",(0,d.jsx)(e.h3,{id:"aggregates",children:"Aggregates"}),"\n",(0,d.jsxs)(e.p,{children:["\u5e38\u898b\u7684\u5305\u62ec ",(0,d.jsx)(e.code,{children:"COUNT"}),", ",(0,d.jsx)(e.code,{children:"SUM"}),", ",(0,d.jsx)(e.code,{children:"AVG"}),", ",(0,d.jsx)(e.code,{children:"MIN"}),", ",(0,d.jsx)(e.code,{children:"MAX"})," \u7b49\u7b49 :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u8a08\u7b97 login \u4ee5 '@cs' \u7d50\u5c3e\u7684\u5b78\u751f\u4eba\u6578\uff0c\u53ea\u7b97 login \u6b04\u4f4d\u4e0d\u70ba NULL \u7684\u8cc7\u6599\u5217\nSELECT COUNT(login) AS cnt\nFROM student\nWHERE login LIKE '%@cs';\n\n-- \u4e5f\u53ef\u4ee5\u4f7f\u7528 COUNT(*) \u6216 COUNT(1)\uff0c\u4f46\u6703\u5c07\u6240\u6709\u8cc7\u6599\u5217\u90fd\u7b97\u9032\u53bb (\u5305\u542b NULL)\nSELECT COUNT(*) AS cnt\nFROM student\nWHERE login LIKE '%@cs';\n\nSELECT COUNT(1) AS cnt\nFROM student\nWHERE login LIKE '%@cs';\n"})}),"\n",(0,d.jsx)(e.p,{children:"Aggregates function \u4e0d\u80fd\u8207\u5176\u4ed6\u6b04\u4f4d\u540c\u6642\u51fa\u73fe\u5728 SELECT \u5b50\u53e5\u4e2d\uff0c\u56e0\u6b64\u4e0b\u9762\u7684\u5beb\u6cd5\u662f\u932f\u8aa4\u7684 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:'-- \u8a08\u7b97\u6bcf\u9580\u8ab2\u7684\u5e73\u5747 GPA\nSELECT AVG(s.gpa), e.cid\nFROM enrolled AS e\nJOIN student AS s ON e.sid = s.sid;\n\n-- ERROR:  column "e.cid" must appear in the GROUP BY clause or be used in an aggregate function\n-- LINE 1: SELECT AVG(s.gpa), e.cid\n'})}),"\n",(0,d.jsxs)(e.p,{children:["\u9700\u8981\u4f7f\u7528 ",(0,d.jsx)(e.code,{children:"GROUP BY"})," \u5b50\u53e5\u4f86\u89e3\u6c7a\u9019\u500b\u554f\u984c\uff0c\u6240\u6709\u975e\u805a\u5408\u51fd\u6578\u7684\u6b04\u4f4d\u90fd\u5fc5\u9808\u51fa\u73fe\u5728 ",(0,d.jsx)(e.code,{children:"GROUP BY"})," \u5b50\u53e5\u4e2d :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT AVG(s.gpa), e.cid\nFROM enrolled AS e JOIN student AS s\nON e.sid = s.sid\nGROUP BY e.cid;\n"})}),"\n",(0,d.jsxs)(e.p,{children:["\u5982\u679c\u8981\u904e\u6ffe\u7684\u8a71\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,d.jsx)(e.code,{children:"HAVING"})," \u5b50\u53e5 :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT AVG(s.gpa), e.cid\nFROM enrolled AS e JOIN student AS s\nON e.sid = s.sid\nGROUP BY e.cid\nHAVING AVG(s.gpa) > 3.8;\n"})}),"\n",(0,d.jsx)(e.h3,{id:"string-operations",children:"String Operations"}),"\n",(0,d.jsx)(e.p,{children:"\u4e0d\u540c\u7684\u8cc7\u6599\u5eab\u6709\u4e0d\u540c\u7684\u6bd4\u8f03\u5b57\u4e32\u4ee5\u53ca\u5927\u5c0f\u5beb\u7684\u65b9\u5f0f\uff0c\u5177\u9ad4\u5982\u4e0b\u5716\u6240\u793a :"}),"\n",(0,d.jsx)(i,{src:"/img/cmu15-445/c02/image-1.webp",caption:"String Operations in Different DBMS"}),"\n",(0,d.jsxs)(e.p,{children:["\u4e5f\u53ef\u4ee5\u5728 ",(0,d.jsx)(e.code,{children:"LIKE"})," \u4e2d\u4f7f\u7528 ",(0,d.jsx)(e.code,{children:"%"})," \u6216 ",(0,d.jsx)(e.code,{children:"_"})," \u4f86\u9032\u884c\u5b57\u4e32\u6bd4\u8f03\uff0c",(0,d.jsx)(e.code,{children:"%"})," \u4ee3\u8868\u4efb\u610f\u9577\u5ea6\u7684\u5b57\u4e32 (\u5305\u62ec\u7a7a\u5b57\u4e32)\uff0c",(0,d.jsx)(e.code,{children:"_"})," \u4ee3\u8868\u4efb\u610f\u55ae\u4e00\u5b57\u5143 :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT *\nFROM enrolled AS e\nWHERE e.cid LIKE '15-%';\n\n--   sid  |  cid   | grade\n-- -------+--------+-------\n--  53666 | 15-445 | C\n--  53688 | 15-721 | A\n--  53688 | 15-826 | B\n--  53655 | 15-445 | B\n--  53666 | 15-721 | C\n"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT *\nFROM student AS s\nWHERE s.login LIKE '%@c_';\n\n--   sid  |  name  |   login    | age | gpa\n-- -------+--------+------------+-----+-----\n--  53666 | RZA    | rza@cs     |  44 |   4\n--  53688 | Bieber | jbieber@cs |  27 | 3.9\n--  53655 | Tupac  | shakur@cs  |  25 | 3.5\n--  53621 | GZA    | gza@cs     |  54 | 3.8\n"})}),"\n",(0,d.jsxs)(e.p,{children:["PostgreSQL \u4e5f\u63d0\u4f9b\u4e86\u5f88\u591a\u5b57\u4e32\u8655\u7406\u7684\u51fd\u6578\uff0c\u4f8b\u5982 ",(0,d.jsx)(e.code,{children:"LENGTH"}),", ",(0,d.jsx)(e.code,{children:"SUBSTRING"}),", ",(0,d.jsx)(e.code,{children:"LOWER"}),", ",(0,d.jsx)(e.code,{children:"UPPER"}),", ",(0,d.jsx)(e.code,{children:"TRIM"}),", ",(0,d.jsx)(e.code,{children:"CONCAT"})," \u7b49\u7b49 :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT LENGTH(name) AS len, SUBSTRING(name FROM 1 FOR 2) AS sub\nFROM student;\n\n--  len | sub\n-- -----+-----\n--    3 | RZ\n--    6 | Bi\n--    5 | Tu\n--    3 | GZ\n"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT LOWER(name) AS lower_name, UPPER(name) AS upper_name\nFROM student\nWHERE name IN ('rza', 'Bieber', 'tupac', 'GZA');\n\n--  lower_name | upper_name\n-- ------------+------------\n--  bieber     | BIEBER\n--  gza        | GZA\n"})}),"\n",(0,d.jsx)(e.h3,{id:"date-and-time",children:"Date and Time"}),"\n",(0,d.jsx)(e.p,{children:"\u4e0d\u540c\u7684 DBMS \u5dee\u7570\u975e\u5e38\u5927\uff0c\u6240\u4ee5\u9700\u8981\u4f9d\u64da\u4e0d\u540c\u7684 DBMS \u4f86\u64b0\u5beb SQL \u8a9e\u6cd5 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT NOW();\n\n--               now\n-- -------------------------------\n--  2025-09-07 00:54:17.279466+00\n"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT CURRENT_TIMESTAMP;\n\n--        current_timestamp\n-- -------------------------------\n--  2025-09-07 00:54:23.033652+00\n"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT CAST('2023-08-01' AS DATE) - CAST('2023-01-02' AS DATE) AS diff;\n\n--  diff\n-- ------\n--   211\n"})}),"\n",(0,d.jsx)(e.h3,{id:"output-redirection",children:"Output Redirection"}),"\n",(0,d.jsx)(e.p,{children:"\u53ef\u4ee5\u5c07\u67e5\u8a62\u7d50\u679c\u5132\u5b58\u5230\u53e6\u4e00\u5f35\u5df2\u7d93\u5b58\u5728\u4e14\u6709\u76f8\u540c\u6b04\u4f4d\u7d50\u69cb\u7684 table \u4e2d :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT DISTINCT cid\nINTO TEMPORARY CourseIds\nFROM enrolled;\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u4e5f\u53ef\u4ee5\u7528\u65bc insert \u8a9e\u53e5\u4e2d\uff0c\u5c07\u67e5\u8a62\u7d50\u679c\u63d2\u5165\u5230\u53e6\u4e00\u5f35 table \u4e2d :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"INSERT INTO CourseIds (cid)\n(SELECT DISTINCT cid FROM enrolled);\n"})}),"\n",(0,d.jsx)(e.h3,{id:"output-control",children:"Output Control"}),"\n",(0,d.jsxs)(e.p,{children:["\u53ef\u4ee5\u4f7f\u7528 ",(0,d.jsx)(e.code,{children:"ORDER BY"})," \u5b50\u53e5\u4f86\u6392\u5e8f\u67e5\u8a62\u7d50\u679c\uff0c\u8a9e\u6cd5\u70ba ",(0,d.jsx)(e.code,{children:"ORDER BY <column*> [ASC|DESC]"}),"\uff0c\u9810\u8a2d\u70ba ASC\uff0c\u53ef\u4ee5\u4f9d\u64da\u591a\u500b\u6b04\u4f4d\u9032\u884c\u6392\u5e8f :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT sid FROM enrolled\nWHERE cid = '15-721'\nORDER BY grade DESC, sid ASC;\n"})}),"\n",(0,d.jsxs)(e.p,{children:["\u4e5f\u53ef\u4ee5\u4f7f\u7528 ",(0,d.jsx)(e.code,{children:"LIMIT"})," \u5b50\u53e5\u4f86\u9650\u5236\u67e5\u8a62\u7d50\u679c\u7684\u6578\u91cf\uff0c\u8a9e\u6cd5\u70ba ",(0,d.jsx)(e.code,{children:"LIMIT <number> [OFFSET <number>]"}),"\uff0c\u5176\u4e2d ",(0,d.jsx)(e.code,{children:"OFFSET"})," \u7528\u65bc\u8df3\u904e\u524d\u9762\u7684\u8cc7\u6599\u5217 :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT * FROM student\nORDER BY sid\nLIMIT 1 OFFSET 1;\n"})}),"\n",(0,d.jsxs)(e.p,{children:["\u9084\u6709\u4e00\u7a2e\u4f7f\u7528 ",(0,d.jsx)(e.code,{children:"FETCH"})," \u7684\u65b9\u6cd5\uff0c\u8a9e\u6cd5\u5982\u4e0b (WITH TIES \u6703\u5c07\u76f8\u540c\u7684\u8cc7\u6599\u5217\u5168\u90e8\u53d6\u51fa) :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u5c07\u5b78\u751f\u4f9d\u7167 GPA \u7531\u4f4e\u5230\u9ad8\u6392\u5e8f\uff0c\u8df3\u904e\u524d 10 \u540d\uff0c\u4e26\u53d6\u51fa\u63a5\u4e0b\u4f86\u7684 10 \u540d\uff0c\u5982\u679c\u6709\u4e26\u5217\u7684\u8a71\u4e5f\u6703\u5168\u90e8\u53d6\u51fa\nSELECT sid, name\nFROM student\nWHERE login LIKE '%@cs'\nORDER BY gpa\nOFFSET 1 ROWS\nFETCH FIRST 2 ROWS WITH TIES;\n"})}),"\n",(0,d.jsx)(e.h3,{id:"window-functions",children:"Window Functions"}),"\n",(0,d.jsx)(e.p,{children:"\u5728 SQL \u7684\u65e9\u671f\uff0c\u6211\u5011\u4e3b\u8981\u7528 \u805a\u5408\u51fd\u6578\u642d\u914d GROUP BY \u4f86\u505a\u7d71\u8a08\uff0c\u4f8b\u5982\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT cid, AVG(CASE grade\n                  WHEN 'A' THEN 4\n                  WHEN 'B' THEN 3\n                  WHEN 'C' THEN 2\n                  ELSE 0 END) AS avg_gpa\nFROM enrolled\nGROUP BY cid;\n\n--   cid   |      avg_gpa\n-- --------+--------------------\n--  15-445 | 2.5000000000000000\n--  15-826 | 3.0000000000000000\n--  15-721 | 3.0000000000000000\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u9019\u6a23\u80fd\u8a08\u7b97\u6bcf\u9580\u8ab2\u7684\u5e73\u5747\u5206\u6578\uff0c\u4f46\u554f\u984c\u5728\u65bc :"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u7d50\u679c\u6703\u58d3\u7e2e\u8cc7\u6599\u5217\u3002\u4f8b\u5982\u4e0a\u9762\uff0c\u8f38\u51fa\u53ea\u6709\u8ab2\u7a0b\u8ddf\u5e73\u5747\u5206\u6578\uff0c\u7121\u6cd5\u540c\u6642\u4fdd\u7559\u5b78\u751f\u500b\u5225\u8cc7\u6599\u3002"}),"\n",(0,d.jsx)(e.li,{children:"\u7121\u6cd5\u5728\u540c\u4e00\u67e5\u8a62\u4e2d\uff0c\u540c\u6642\u770b\u5230\u500b\u4eba\u8cc7\u8a0a\u8207\u7fa4\u9ad4\u7d71\u8a08\u3002\u5982\u679c\u8981\u67e5\u6bcf\u500b\u5b78\u751f\u7684\u5206\u6578\uff0c\u9084\u6709\u4ed6\u5728\u8ab2\u7a0b\u4e2d\u7684\u5e73\u5747\uff0c\u5c31\u5f97\u5beb\u5b50\u67e5\u8a62\u6216 join\uff0c\u8a9e\u6cd5\u5197\u9577\u3002"}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:"\u56e0\u6b64\uff0c\u70ba\u4e86\u89e3\u6c7a\u9019\u4e9b\u554f\u984c\uff0cSQL \u5f15\u5165\u4e86 Window Functions (\u8996\u7a97\u51fd\u6578)\u3002"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT e.sid, s.name, e.cid, e.grade,\n       AVG(CASE grade\n             WHEN 'A' THEN 4\n             WHEN 'B' THEN 3\n             WHEN 'C' THEN 2\n             ELSE 0 END)\n       OVER (PARTITION BY e.cid) AS avg_gpa\nFROM enrolled e\nJOIN student s ON e.sid = s.sid;\n\n--   sid  |  name  |  cid   | grade |      avg_gpa\n-- -------+--------+--------+-------+--------------------\n--  53666 | RZA    | 15-445 | C     | 2.5000000000000000\n--  53655 | Tupac  | 15-445 | B     | 2.5000000000000000\n--  53688 | Bieber | 15-721 | A     | 3.0000000000000000\n--  53666 | RZA    | 15-721 | C     | 3.0000000000000000\n--  53688 | Bieber | 15-826 | B     | 3.0000000000000000\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u9019\u6a23\u5c31\u80fd\u5728\u540c\u4e00\u67e5\u8a62\u4e2d\uff0c\u540c\u6642\u770b\u5230\u500b\u4eba\u8cc7\u8a0a\u8207\u7fa4\u9ad4\u7d71\u8a08\u3002"}),"\n",(0,d.jsx)(e.p,{children:"\u9664\u4e86\u4e00\u822c\u7684\u805a\u5408\u51fd\u6578\uff0c\u5e38\u898b\u7684\u8996\u7a97\u51fd\u6578\u9084\u6709 RANK, DENSE_RANK, ROW_NUMBER \u7b49\u7b49\u3002"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u6bcf\u9580\u8ab2\u7684\u6210\u7e3e\u6392\u540d\nSELECT e.cid, s.name, e.grade,\n       RANK() OVER (\n         PARTITION BY e.cid\n         ORDER BY CASE e.grade\n                    WHEN 'A' THEN 4\n                    WHEN 'B' THEN 3\n                    WHEN 'C' THEN 2\n                    ELSE 0 END DESC\n       ) AS rank_in_course\nFROM enrolled e\nJOIN student s ON e.sid = s.sid;\n\n--   cid   |  name  | grade | rank_in_course\n-- --------+--------+-------+----------------\n--  15-445 | Tupac  | B     |              1\n--  15-445 | RZA    | C     |              2\n--  15-721 | Bieber | A     |              1\n--  15-721 | RZA    | C     |              2\n--  15-826 | Bieber | B     |              1\n"})}),"\n",(0,d.jsx)(e.h3,{id:"nested-queries",children:"Nested Queries"}),"\n",(0,d.jsx)(e.p,{children:"\u5728\u4e00\u500b\u67e5\u8a62\u4e2d\u5d4c\u5957\u53e6\u4e00\u500b\u67e5\u8a62\uff0c\u5167\u5c64\u67e5\u8a62\u6703\u5148\u88ab\u57f7\u884c\uff0c\u7136\u5f8c\u5c07\u7d50\u679c\u50b3\u905e\u7d66\u5916\u5c64\u67e5\u8a62\u3002"}),"\n",(0,d.jsxs)(e.p,{children:["\u53ef\u4ee5\u652f\u6301 ",(0,d.jsx)(e.code,{children:"NOT"}),"\u3001",(0,d.jsx)(e.code,{children:"IN"}),"\u3001",(0,d.jsx)(e.code,{children:"ANY"}),"\u3001",(0,d.jsx)(e.code,{children:"ALL"}),"\u3001",(0,d.jsx)(e.code,{children:"EXISTS"})," \u7b49\u7b49\u3002"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u627e\u51fa\u6709\u4fee\u8ab2\u7684\u5b78\u751f\nSELECT s.sid, s.name\nFROM student AS s\nWHERE EXISTS (\n    SELECT 1\n    FROM enrolled AS e\n    WHERE e.sid = s.sid\n);\n\n--   sid  |  name\n-- -------+--------\n--  53666 | RZA\n--  53688 | Bieber\n--  53655 | Tupac\n"})}),"\n",(0,d.jsxs)(e.p,{children:["\u9664\u6b64\u4e4b\u5916\u4e5f\u53ef\u4ee5\u4f7f\u7528 ",(0,d.jsx)(e.code,{children:"LATERAL"})," \u4f86\u9032\u884c\u67e5\u8a62\uff0c",(0,d.jsx)(e.code,{children:"LATERAL"})," \u6703\u4f9d\u64da\u5916\u5c64\u67e5\u8a62\u7684\u6bcf\u4e00\u5217\u4f86\u57f7\u884c\u5167\u5c64\u67e5\u8a62 :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u627e\u51fa\u6bcf\u9580\u8ab2\u7684\u4fee\u8ab2\u4eba\u6578\u4ee5\u53ca\u5e73\u5747 GPA\nSELECT *\nFROM course AS c,\nLATERAL (\n    SELECT COUNT(*) AS cnt\n    FROM enrolled AS e\n    WHERE e.cid = c.cid\n) AS t1,\nLATERAL (\n    SELECT AVG(gpa) AS avg\n    FROM student AS s\n    JOIN enrolled AS e ON s.sid = e.sid\n    WHERE e.cid = c.cid\n) AS t2;\n\n--   cid   |            name             | cnt | avg\n-- --------+-----------------------------+-----+------\n--  15-445 | Database Systems            |   2 | 3.75\n--  15-721 | Advanced Database Systems   |   2 | 3.95\n--  15-826 | Data Mining                 |   1 |  3.9\n--  15-799 | Special Topics in Databases |   0 |\n--  15-999 | Non-Database Course         |   0 |\n"})}),"\n",(0,d.jsx)(e.h3,{id:"common-table-expressions",children:"Common Table Expressions"}),"\n",(0,d.jsx)(e.p,{children:"CTE \u662f SQL \u63d0\u4f9b\u7684\u4e00\u7a2e\u8a9e\u6cd5\u6a5f\u5236\uff0c\u7528\u4f86\u5728\u4e00\u500b\u67e5\u8a62\u4e2d\u5b9a\u7fa9\u81e8\u6642\u7684\u7d50\u679c\uff0c\u53ef\u4ee5\u5728\u5f8c\u7e8c\u7684\u4e3b\u67e5\u8a62\u4e2d\u91cd\u8907\u4f7f\u7528\uff0c\u63d0\u4f9b\u53ef\u8b80\u6027\u4e26\u4e14\u652f\u63f4\u905e\u8ff4\u67e5\u8a62\u3002"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u4f7f\u7528 CTE \u8a08\u7b97\u6bcf\u9580\u8ab2\u7684\u5e73\u5747 GPA\nWITH course_avg AS (\n    SELECT e.cid, AVG(s.gpa) AS avg_gpa\n    FROM enrolled e\n    JOIN student s ON e.sid = s.sid\n    GROUP BY e.cid\n)\nSELECT c.cid, c.name, ca.avg_gpa\nFROM course c\nJOIN course_avg ca ON c.cid = ca.cid;\n"})}),"\n",(0,d.jsx)(e.p,{children:"CTE \u4e5f\u53ef\u4ee5\u652f\u63f4\u905e\u8ff4\u67e5\u8a62 (Recursive CTE)\uff0c\u4f8b\u5982\u8a08\u7b97\u968e\u4e58 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"WITH RECURSIVE factorial(n, fact) AS (\n    SELECT 0 AS n, 1 AS fact\n    UNION ALL\n    SELECT n + 1, (n + 1) * fact\n    FROM factorial\n    WHERE n < 5\n)\nSELECT * FROM factorial;\n\n--  n | fact\n-- ---+------\n--  0 |    1\n--  1 |    1\n--  2 |    2\n--  3 |    6\n--  4 |   24\n--  5 |  120\n"})})]})}function E(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,d.jsx)(e,{...n,children:(0,d.jsx)(t,{...n})}):t(n)}function S(n,e){throw new Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453:(n,e,s)=>{s.d(e,{R:()=>l,x:()=>r});var i=s(6540);const d={},c=i.createContext(d);function l(n){const e=i.useContext(c);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(d):n.components||d:l(n.components),i.createElement(c.Provider,{value:e},n.children)}}}]);