"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6838],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>N});var r=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n,r,s={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var p=r.createContext({}),l=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=l(e.components);return r.createElement(p.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,s=e.mdxType,o=e.originalType,p=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=l(n),d=s,N=c["".concat(p,".").concat(d)]||c[d]||m[d]||o;return n?r.createElement(N,a(a({ref:t},u),{},{components:n})):r.createElement(N,a({ref:t},u))}));function N(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var o=n.length,a=new Array(o);a[0]=d;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[c]="string"==typeof e?e:s,a[1]=i;for(var l=2;l<o;l++)a[l]=n[l];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2524:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>a,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var r=n(7462),s=(n(7294),n(3905));const o={title:"\u8def\u7531\u8655\u7406\u7a0b\u5e8f",sidebar_position:"11",description:"Route Handlers",keywords:["Next.js","\u8def\u7531\u8655\u7406\u7a0b\u5e8f","Route Handlers"]},a=void 0,i={unversionedId:"Next.js/App Router/Routing/Route Handlers",id:"Next.js/App Router/Routing/Route Handlers",title:"\u8def\u7531\u8655\u7406\u7a0b\u5e8f",description:"Route Handlers",source:"@site/docs/Next.js/App Router/Routing/Route Handlers.mdx",sourceDirName:"Next.js/App Router/Routing",slug:"/Next.js/App Router/Routing/Route Handlers",permalink:"/RulerChen-Website/docs/Next.js/App Router/Routing/Route Handlers",draft:!1,tags:[],version:"current",sidebarPosition:11,frontMatter:{title:"\u8def\u7531\u8655\u7406\u7a0b\u5e8f",sidebar_position:11,description:"Route Handlers",keywords:["Next.js","\u8def\u7531\u8655\u7406\u7a0b\u5e8f","Route Handlers"]},sidebar:"tutorialSidebar",previous:{title:"\u6514\u622a\u8def\u7531",permalink:"/RulerChen-Website/docs/Next.js/App Router/Routing/Intercepting Routes"},next:{title:"\u4e2d\u4ecb\u8edf\u9ad4",permalink:"/RulerChen-Website/docs/Next.js/App Router/Routing/Middleware"}},p={},l=[{value:"\u7fd2\u6163",id:"\u7fd2\u6163",level:2},{value:"\u884c\u70ba",id:"\u884c\u70ba",level:2},{value:"\u975c\u614b\u8def\u7531\u8655\u7406",id:"\u975c\u614b\u8def\u7531\u8655\u7406",level:3},{value:"\u52d5\u614b\u8def\u7531\u8655\u7406",id:"\u52d5\u614b\u8def\u7531\u8655\u7406",level:3},{value:"\u4f8b\u5b50",id:"\u4f8b\u5b50",level:2},{value:"\u91cd\u65b0\u9a57\u8b49\u975c\u614b\u8cc7\u6599",id:"\u91cd\u65b0\u9a57\u8b49\u975c\u614b\u8cc7\u6599",level:3},{value:"\u52d5\u614b\u51fd\u5f0f",id:"\u52d5\u614b\u51fd\u5f0f",level:3},{value:"\u91cd\u65b0\u5c0e\u5411",id:"\u91cd\u65b0\u5c0e\u5411",level:3},{value:"\u52d5\u614b\u8def\u7531\u6bb5\u843d",id:"\u52d5\u614b\u8def\u7531\u6bb5\u843d",level:3},{value:"\u4e32\u6d41",id:"\u4e32\u6d41",level:3},{value:"\u8acb\u6c42\u7684\u4e3b\u9ad4",id:"\u8acb\u6c42\u7684\u4e3b\u9ad4",level:3},{value:"CORS",id:"cors",level:3},{value:"Edge \u548c Node.js \u74b0\u5883",id:"edge-\u548c-nodejs-\u74b0\u5883",level:3},{value:"\u6c92\u6709 UI \u7684\u56de\u61c9",id:"\u6c92\u6709-ui-\u7684\u56de\u61c9",level:3}],u={toc:l},c="wrapper";function m(e){let{components:t,...n}=e;return(0,s.kt)(c,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h2",{id:"\u7fd2\u6163"},"\u7fd2\u6163"),(0,s.kt)("p",null,"\u8def\u7531\u8655\u7406\u7a0b\u5e8f\uff08Route Handlers\uff09\u5b9a\u7fa9\u5728 app \u76ee\u9304\u5167\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"route.js")," \u6216 ",(0,s.kt)("inlineCode",{parentName:"p"},"route.ts")," \u6587\u4ef6\u4e2d\uff1a"),(0,s.kt)("p",null,"\u652f\u6301\u7684 HTTP \u65b9\u6cd5\n\u652f\u6301\u4ee5\u4e0b HTTP \u65b9\u6cd5\uff1aGET\u3001POST\u3001PUT\u3001PATCH\u3001DELETE\u3001HEAD \u548c OPTIONS\u3002\n\u5982\u679c\u4f7f\u7528\u4e86\u4e0d\u652f\u6301\u7684\u65b9\u6cd5\uff0cNext.js \u5c07\u8fd4\u56de ",(0,s.kt)("inlineCode",{parentName:"p"},"405 Method Not Allowed")," \u97ff\u61c9\u3002"),(0,s.kt)("p",null,"\u64f4\u5c55\u7684 NextRequest \u548c NextResponse API\n\u9664\u4e86\u652f\u6301\u539f\u751f\u7684 Request \u548c Response \u5c0d\u8c61\u5916\uff0cNext.js \u901a\u904e\u64f4\u5c55\u5b83\u5011\u7684\u529f\u80fd\uff0c\u63d0\u4f9b\u4e86 NextRequest \u548c NextResponse\uff0c\u4ee5\u4fbf\u63d0\u4f9b\u65b9\u4fbf\u7684\u8f14\u52a9\u529f\u80fd\u3002"),(0,s.kt)("h2",{id:"\u884c\u70ba"},"\u884c\u70ba"),(0,s.kt)("h3",{id:"\u975c\u614b\u8def\u7531\u8655\u7406"},"\u975c\u614b\u8def\u7531\u8655\u7406"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/items/route.ts" showLineNumber',title:'"app/items/route.ts"',showLineNumber:!0},'import { NextResponse } from "next/server";\n\nexport async function GET() {\n  const res = await fetch("https://data.mongodb-api.com/...", {\n    headers: {\n      "Content-Type": "application/json",\n      "API-Key": process.env.DATA_API_KEY,\n    },\n  });\n  const data = await res.json();\n\n  return NextResponse.json({ data });\n}\n')),(0,s.kt)("h3",{id:"\u52d5\u614b\u8def\u7531\u8655\u7406"},"\u52d5\u614b\u8def\u7531\u8655\u7406"),(0,s.kt)("p",null,"\u5728\u4ee5\u4e0b\u60c5\u6cc1\u4e0b\uff0c\u8def\u7531\u8655\u7406\u7a0b\u5e8f\u5c07\u4ee5\u52d5\u614b\u65b9\u5f0f\u8655\u7406\uff1a"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"\u4f7f\u7528 Request \u7269\u4ef6\u548c GET \u65b9\u6cd5\u3002"),(0,s.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u4efb\u4f55\u5176\u4ed6 HTTP \u65b9\u6cd5\u3002"),(0,s.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u52d5\u614b\u51fd\u6578\uff0c\u4f8b\u5982 cookies \u548c headers\u3002"),(0,s.kt)("li",{parentName:"ul"},"\u624b\u52d5\u6307\u5b9a\u914d\u7f6e\u9078\u9805\u4e2d\u7684\u52d5\u614b\u6a21\u5f0f\u3002")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/products/api/route.ts" showLineNumber',title:'"app/products/api/route.ts"',showLineNumber:!0},'import { NextResponse } from "next/server";\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url);\n  const id = searchParams.get("id");\n  const res = await fetch(`https://data.mongodb-api.com/product/${id}`, {\n    headers: {\n      "Content-Type": "application/json",\n      "API-Key": process.env.DATA_API_KEY,\n    },\n  });\n  const product = await res.json();\n\n  return NextResponse.json({ product });\n}\n')),(0,s.kt)("p",null,"\u540c\u6a23\u5730\uff0c\u4f7f\u7528 POST \u65b9\u6cd5\u5c07\u5c0e\u81f4\u8def\u7531\u8655\u7406\u7a0b\u5e8f\u4ee5\u52d5\u614b\u65b9\u5f0f\u9032\u884c\u8a55\u4f30\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/items/route.ts" showLineNumber',title:'"app/items/route.ts"',showLineNumber:!0},'import { NextResponse } from "next/server";\n\nexport async function POST() {\n  const res = await fetch("https://data.mongodb-api.com/...", {\n    method: "POST",\n    headers: {\n      "Content-Type": "application/json",\n      "API-Key": process.env.DATA_API_KEY,\n    },\n    body: JSON.stringify({ time: new Date().toISOString() }),\n  });\n\n  const data = await res.json();\n\n  return NextResponse.json(data);\n}\n')),(0,s.kt)("h2",{id:"\u4f8b\u5b50"},"\u4f8b\u5b50"),(0,s.kt)("h3",{id:"\u91cd\u65b0\u9a57\u8b49\u975c\u614b\u8cc7\u6599"},"\u91cd\u65b0\u9a57\u8b49\u975c\u614b\u8cc7\u6599"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/items/route.ts" showLineNumber',title:'"app/items/route.ts"',showLineNumber:!0},'import { NextResponse } from "next/server";\n\nexport async function GET() {\n  const res = await fetch("https://data.mongodb-api.com/...", {\n    next: { revalidate: 60 }, // Revalidate every 60 seconds\n  });\n  const data = await res.json();\n\n  return NextResponse.json(data);\n}\n')),(0,s.kt)("h3",{id:"\u52d5\u614b\u51fd\u5f0f"},"\u52d5\u614b\u51fd\u5f0f"),(0,s.kt)("p",null,"\u8def\u7531\u8655\u7406\u7a0b\u5e8f\u53ef\u4ee5\u8207 Next.js \u7684\u52d5\u614b\u51fd\u6578\u4e00\u8d77\u4f7f\u7528\uff0c\u4f8b\u5982 cookies \u548c headers\u3002"),(0,s.kt)("p",null,"\u53ef\u4ee5\u4f7f\u7528 ",(0,s.kt)("inlineCode",{parentName:"p"},"next/headers")," \u6a21\u7d44\u4e2d\u7684 cookies \u51fd\u6578\u4f86\u8b80\u53d6 cookie\u3002\n\u6b64\u4f3a\u670d\u5668\u51fd\u6578\u53ef\u4ee5\u76f4\u63a5\u5728\u8def\u7531\u8655\u7406\u7a0b\u5e8f\u4e2d\u8abf\u7528\uff0c\u6216\u8005\u5d4c\u5957\u5728\u5176\u4ed6\u51fd\u6578\u5167\u90e8\u3002\n\u8a72 cookies \u662f\u53ea\u8b80\u7684\u3002\n\u8981\u8a2d\u7f6e cookie\uff0c\u60a8\u9700\u8981\u8fd4\u56de\u4e00\u500b\u5305\u542b Set-Cookie \u6a19\u982d\u7684\u65b0 Response\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/api/route.ts" showLineNumber',title:'"app/api/route.ts"',showLineNumber:!0},'import { cookies } from "next/headers";\n\nexport async function GET(request: Request) {\n  const cookieStore = cookies();\n  const token = cookieStore.get("token");\n\n  return new Response("Hello, Next.js!", {\n    status: 200,\n    headers: { "Set-Cookie": `token=${token.value}` },\n  });\n}\n')),(0,s.kt)("p",null,"\u53ef\u4ee5\u4f7f\u7528 ",(0,s.kt)("inlineCode",{parentName:"p"},"next/headers")," \u6a21\u7d44\u4e2d\u7684 headers \u51fd\u6578\u4f86\u8b80\u53d6 headers\u3002\n\u6b64\u4f3a\u670d\u5668\u51fd\u6578\u53ef\u4ee5\u76f4\u63a5\u5728\u8def\u7531\u8655\u7406\u7a0b\u5e8f\u4e2d\u8abf\u7528\uff0c\u6216\u8005\u5d4c\u5957\u5728\u5176\u4ed6\u51fd\u6578\u5167\u90e8\u3002\n\u8a72 headers \u662f\u53ea\u8b80\u7684\u3002\u8981\u8a2d\u7f6e\u6a19\u982d\uff0c\u60a8\u9700\u8981\u8fd4\u56de\u4e00\u500b\u5305\u542b\u65b0\u6a19\u982d\u7684\u65b0 Response\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/api/route.ts" showLineNumber',title:'"app/api/route.ts"',showLineNumber:!0},'import { headers } from "next/headers";\n\nexport async function GET(request: Request) {\n  const headersList = headers();\n  const referer = headersList.get("referer");\n\n  return new Response("Hello, Next.js!", {\n    status: 200,\n    headers: { referer: referer },\n  });\n}\n')),(0,s.kt)("h3",{id:"\u91cd\u65b0\u5c0e\u5411"},"\u91cd\u65b0\u5c0e\u5411"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/api/route.ts" showLineNumber',title:'"app/api/route.ts"',showLineNumber:!0},'import { redirect } from "next/navigation";\n\nexport async function GET(request: Request) {\n  redirect("https://nextjs.org/");\n}\n')),(0,s.kt)("h3",{id:"\u52d5\u614b\u8def\u7531\u6bb5\u843d"},"\u52d5\u614b\u8def\u7531\u6bb5\u843d"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/items/[slug]/route.ts" showLineNumber',title:'"app/items/[slug]/route.ts"',showLineNumber:!0},"export async function GET(request: Request, { params }: { params: { slug: string } }) {\n  const slug = params.slug; // 'a', 'b', or 'c'\n}\n")),(0,s.kt)("h3",{id:"\u4e32\u6d41"},"\u4e32\u6d41"),(0,s.kt)("p",null,"\u4e32\u6d41\u662f\u5e38\u8207\u5927\u578b\u8a9e\u8a00\u6a21\u578b\uff08LLM\uff09\u7d50\u5408\u4f7f\u7528\u7684\uff0c\u4f8b\u5982 OpenAI\uff0c\u7528\u65bc\u751f\u6210 AI \u5167\u5bb9\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/api/completion/route.ts" showLineNumber',title:'"app/api/completion/route.ts"',showLineNumber:!0},'import { Configuration, OpenAIApi } from "openai-edge";\nimport { OpenAIStream, StreamingTextResponse } from "ai";\n\nconst config = new Configuration({\n  apiKey: process.env.OPENAI_API_KEY,\n});\nconst openai = new OpenAIApi(config);\n\nexport const runtime = "edge";\n\nexport async function POST(req: Request) {\n  const { prompt } = await req.json();\n  const response = await openai.createCompletion({\n    model: "text-davinci-003",\n    stream: true,\n    temperature: 0.6,\n    prompt: "What is Next.js?",\n  });\n\n  const stream = OpenAIStream(response);\n  return new StreamingTextResponse(stream);\n}\n')),(0,s.kt)("h3",{id:"\u8acb\u6c42\u7684\u4e3b\u9ad4"},"\u8acb\u6c42\u7684\u4e3b\u9ad4"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/items/route.ts" showLineNumber',title:'"app/items/route.ts"',showLineNumber:!0},'import { NextResponse } from "next/server";\n\nexport async function POST(request: Request) {\n  const res = await request.json();\n  return NextResponse.json({ res });\n}\n')),(0,s.kt)("h3",{id:"cors"},"CORS"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/api/route.ts" showLineNumber',title:'"app/api/route.ts"',showLineNumber:!0},'export async function GET(request: Request) {\n  return new Response("Hello, Next.js!", {\n    status: 200,\n    headers: {\n      "Access-Control-Allow-Origin": "*",\n      "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS",\n      "Access-Control-Allow-Headers": "Content-Type, Authorization",\n    },\n  });\n}\n')),(0,s.kt)("h3",{id:"edge-\u548c-nodejs-\u74b0\u5883"},"Edge \u548c Node.js \u74b0\u5883"),(0,s.kt)("p",null,"Route Handlers \u5177\u6709\u540c\u6a23\u7684 API\uff0c\u53ef\u7121\u7e2b\u652f\u63f4 Edge \u548c Node.js \u57f7\u884c\u6642\u74b0\u5883\uff0c\u5305\u62ec\u5c0d\u6d41\u5f0f\u50b3\u8f38\u7684\u652f\u63f4\u3002\n\u7531\u65bc Route Handlers \u4f7f\u7528\u8207 Pages \u548c Layouts \u76f8\u540c\u7684\u8def\u7531\u6bb5\u914d\u7f6e\uff0c\u56e0\u6b64\u5b83\u5011\u652f\u63f4\u4e00\u4e9b\u671f\u5f85\u5df2\u4e45\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u901a\u7528\u7684\u975c\u614b\u518d\u751f\u6210\u7684 Route Handlers\u3002"),(0,s.kt)("h3",{id:"\u6c92\u6709-ui-\u7684\u56de\u61c9"},"\u6c92\u6709 UI \u7684\u56de\u61c9"),(0,s.kt)("p",null,"\u60a8\u53ef\u4ee5\u4f7f\u7528 Route Handlers \u8fd4\u56de\u975e UI \u5167\u5bb9\u3002\u8acb\u6ce8\u610f\uff0c ",(0,s.kt)("inlineCode",{parentName:"p"},"sitemap.xml"),"\u3001",(0,s.kt)("inlineCode",{parentName:"p"},"robots.txt"),"\u3001\u61c9\u7528\u7a0b\u5f0f\u5716\u793a\u548c Open Graph \u5716\u7247\u90fd\u5177\u6709\u5167\u5efa\u652f\u63f4\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="app/rss.xml/route.ts" showLineNumber',title:'"app/rss.xml/route.ts"',showLineNumber:!0},'export async function GET() {\n  return new Response(`<?xml version="1.0" encoding="UTF-8" ?>\n<rss version="2.0">\n \n<channel>\n  <title>Next.js Documentation</title>\n  <link>https://nextjs.org/docs</link>\n  <description>The React Framework for the Web</description>\n</channel>\n \n</rss>`);\n}\n')))}m.isMDXComponent=!0}}]);