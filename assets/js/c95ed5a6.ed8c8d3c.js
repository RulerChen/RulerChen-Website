"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["8738"],{1326:function(n,e,s){s.r(e),s.d(e,{frontMatter:()=>c,default:()=>E,toc:()=>o,metadata:()=>i,assets:()=>a,contentTitle:()=>r});var i=JSON.parse('{"id":"CMU15-445/c02","title":"Modern SQL","description":"CMU15-445/645 Modern SQL","source":"@site/docs/CMU15-445/c02.mdx","sourceDirName":"CMU15-445","slug":"/CMU15-445/c02","permalink":"/RulerChen-Website/docs/CMU15-445/c02","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/c02.mdx","tags":[{"inline":true,"label":"CMU15-445","permalink":"/RulerChen-Website/docs/tags/cmu-15-445"}],"version":"current","lastUpdatedAt":1757340208000,"sidebarPosition":2,"frontMatter":{"title":"Modern SQL","sidebar_position":2,"description":"CMU15-445/645 Modern SQL","keywords":["CMU15-445/645","Modern SQL","CMU15-445/645 \u7B46\u8A18"],"tags":["CMU15-445"]},"sidebar":"tutorialSidebar","previous":{"title":"Relational Model & Algebra","permalink":"/RulerChen-Website/docs/CMU15-445/c01"},"next":{"title":"Database Storage","permalink":"/RulerChen-Website/docs/CMU15-445/c03"}}'),d=s(5893),l=s(65);let c={title:"Modern SQL",sidebar_position:"2",description:"CMU15-445/645 Modern SQL",keywords:["CMU15-445/645","Modern SQL","CMU15-445/645 \u7B46\u8A18"],tags:["CMU15-445"]},r=void 0,a={},o=[{value:"SQL History",id:"sql-history",level:2},{value:"Relational Languages",id:"relational-languages",level:2},{value:"SQL Syntax",id:"sql-syntax",level:2},{value:"Joins",id:"joins",level:3},{value:"Inner Join",id:"inner-join",level:4},{value:"Left Join",id:"left-join",level:4},{value:"Right Join",id:"right-join",level:4},{value:"Full Join",id:"full-join",level:4},{value:"Cross Join",id:"cross-join",level:4},{value:"Aggregates",id:"aggregates",level:3},{value:"String Operations",id:"string-operations",level:3},{value:"Date and Time",id:"date-and-time",level:3},{value:"Output Redirection",id:"output-redirection",level:3},{value:"Output Control",id:"output-control",level:3},{value:"Window Functions",id:"window-functions",level:3},{value:"Nested Queries",id:"nested-queries",level:3},{value:"Common Table Expressions",id:"common-table-expressions",level:3}];function t(n){let e={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.a)(),...n.components},{Head:s,ImageModal:i}=e;return s||S("Head",!0),i||S("ImageModal",!0),(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s,{children:(0,d.jsx)("title",{children:"CMU 15-445 Modern SQL"})}),"\n",(0,d.jsx)(e.p,{children:"\u9019\u7BC7\u7B46\u8A18\u6703\u7C21\u55AE\u4ECB\u7D39\u5E38\u898B\u7684 SQL \u8A9E\u6CD5\u3002"}),"\n",(0,d.jsx)(e.h2,{id:"sql-history",children:"SQL History"}),"\n",(0,d.jsx)(e.p,{children:"SQL \u6700\u65E9\u7531 IBM \u5728 1970 \u5E74\u4EE3\u521D\u671F\u958B\u767C\uFF0C\u4E26\u65BC 1986 \u5E74\u6210\u70BA ANSI \u6A19\u6E96\uFF0C\u96A8\u5F8C\u5728 1987 \u5E74\u88AB ISO \u63A1\u7528\u3002\n\u81EA\u90A3\u6642\u4EE5\u4F86\uFF0CSQL \u6A19\u6E96\u7D93\u6B77\u4E86\u591A\u6B21\u4FEE\u8A02\u548C\u64F4\u5C55\uFF0C\u4E3B\u8981\u7684\u66F4\u65B0\u5305\u62EC :"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"SQL:1999 Regular expressions, Triggers"}),"\n",(0,d.jsx)(e.li,{children:"SQL:2003 XML, Windows, Sequences"}),"\n",(0,d.jsx)(e.li,{children:"SQL:2008 Truncation, Fancy sorting"}),"\n",(0,d.jsx)(e.li,{children:"SQL:2011 Temporal DBs, Pipelined DML"}),"\n",(0,d.jsx)(e.li,{children:"SQL:2016 JSON, Polymorphic tables"}),"\n",(0,d.jsx)(e.li,{children:"SQL:2023 Property Graph Queries, Muti-Dim. Arrays"}),"\n"]}),"\n",(0,d.jsx)(e.h2,{id:"relational-languages",children:"Relational Languages"}),"\n",(0,d.jsx)(e.p,{children:'\u5728 1969 \u5E74\uFF0CTed Codd \u63D0\u51FA\u4E86 Relational Model\uFF0C\u5176\u6838\u5FC3\u76EE\u6A19\u662F\u8B93\u8CC7\u6599\u5EAB\u4F7F\u7528\u8005\u80FD\u4EE5\u9AD8\u968E\u8A9E\u8A00\u64CD\u4F5C\u8CC7\u6599\uFF0C\u800C\u4E0D\u9700\u8981\u7406\u89E3\u5E95\u5C64\u7684\u7269\u7406\u5132\u5B58\u65B9\u5F0F\u3002\n\u8981\u5BE6\u73FE\u9019\u500B\u6A21\u578B\uFF0C\u5C31\u9700\u8981\u4E00\u5957\u5C08\u9580\u7684 "\u8A9E\u8A00" \u4F86\u63CF\u8FF0\u8CC7\u6599\u7684\u5B58\u53D6\u8207\u64CD\u4F5C\u65B9\u5F0F\uFF0C\u9019\u4E9B\u8A9E\u8A00\u7684\u7E3D\u7A31\u5C31\u662F Relational Languages\u3002'}),"\n",(0,d.jsx)(e.p,{children:"Relational Languages \u53EF\u4EE5\u5206\u70BA\u5169\u5927\u985E\uFF0C\u5206\u5225\u662F Relational Algebra \u8207 Relational Calculus\u3002"}),"\n",(0,d.jsx)(e.p,{children:"Relational Algebra \u662F\u4E00\u7A2E\u7A0B\u5E8F\u6027\u8A9E\u8A00 (Procedural Language)\uFF0C\u4F7F\u7528\u8005\u9700\u8981\u660E\u78BA\u6307\u5B9A\u5982\u4F55 (How) \u7372\u53D6\u8CC7\u6599\u7684\u6B65\u9A5F\u3002\nRelational Calculus \u5247\u662F\u4E00\u7A2E\u5BA3\u544A\u5F0F\u8A9E\u8A00 (Non-Procedural Language)\uFF0C\u4F7F\u7528\u8005\u53EA\u9700\u63CF\u8FF0\u60F3\u8981\u4EC0\u9EBC (What) \u8CC7\u6599\uFF0C\u7531\u7CFB\u7D71\u81EA\u884C\u6C7A\u5B9A\u6700\u4F73\u7684\u57F7\u884C\u8A08\u756B\u3002"}),"\n",(0,d.jsx)(e.p,{children:"SQL \u5C31\u662F\u7D9C\u5408\u4E86\u9019\u5169\u7A2E\u6A21\u5F0F\u7684\u8A9E\u8A00\uFF0C\u5B83\u5728\u8A9E\u6CD5\u4E0A\u662F\u5BA3\u544A\u5F0F\u7684\uFF0C\u4F46\u5728\u7CFB\u7D71\u5167\u90E8\uFF0C\u67E5\u8A62\u901A\u5E38\u6703\u88AB\u8F49\u63DB\u70BA\u95DC\u806F\u4EE3\u6578\u904B\u7B97\uFF0C\u9032\u800C\u751F\u6210\u6700\u4F73\u5316\u7684\u57F7\u884C\u8A08\u756B\u3002"}),"\n",(0,d.jsx)(e.p,{children:"\u8207\u7406\u8AD6\u4E0D\u540C\u7684\u662F\uFF0CSQL \u4F7F\u7528\u7684\u662F bag (multiset) \u800C\u975E set\uFF0C\u9019\u610F\u5473\u8457 SQL \u4E2D\u7684\u7D50\u679C\u53EF\u4EE5\u5305\u542B\u91CD\u8907\u7684\u8CC7\u6599\u5217\u3002"}),"\n",(0,d.jsx)(e.p,{children:"SQL \u53EF\u4EE5\u88AB\u7D30\u5206\u70BA\u5E7E\u7A2E\u5B50\u985E :"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"DML (Data Manipulation Language) : \u67E5\u8A62\u3001\u63D2\u5165\u3001\u66F4\u65B0\u3001\u522A\u9664\u8CC7\u6599\uFF0C\u4F8B\u5982 SELECT, INSERT, UPDATE, DELETE"}),"\n",(0,d.jsx)(e.li,{children:"DDL (Data Definition Language) : \u5B9A\u7FA9 table, view, index \u7B49\u7B49\uFF0C\u4F8B\u5982 CREATE, ALTER, DROP"}),"\n",(0,d.jsx)(e.li,{children:"DCL (Data Control Language) : \u5B9A\u7FA9\u6B0A\u9650 (\u8CC7\u5B89\u76F8\u95DC)\uFF0C\u4F8B\u5982 GRANT, REVOKE"}),"\n",(0,d.jsx)(e.li,{children:"TCL (Transaction Control Language) : \u4EA4\u6613\u63A7\u5236\uFF0C\u4F8B\u5982 COMMIT, ROLLBACK"}),"\n"]}),"\n",(0,d.jsx)(e.h2,{id:"sql-syntax",children:"SQL Syntax"}),"\n",(0,d.jsx)(e.p,{children:"\u63A5\u4E0B\u4F86\u6703\u4ECB\u7D39 SQL \u7684\u5E38\u7528\u8A9E\u6CD5\uFF0C\u4F7F\u7528\u7684\u8CC7\u6599\u8868\u5982\u4E0B :"}),"\n",(0,d.jsx)(i,{src:"/img/cmu15-445/c02/image.webp",caption:"Example Table"}),"\n",(0,d.jsx)(e.p,{children:"\u5982\u679C\u60F3\u5BE6\u969B\u64CD\u4F5C\u770B\u770B\u7684\u8A71\uFF0C\u53EF\u4EE5\u4F7F\u7528 Docker \u5FEB\u901F\u5EFA\u7ACB\u4E00\u500B PostgreSQL \u74B0\u5883\uFF0C\u4EE5\u4E0B\u7684\u7BC4\u4F8B\u4E5F\u90FD\u6703\u4EE5 PostgreSQL \u7684\u8A9E\u6CD5\u70BA\u4E3B\u3002"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-bash",children:"docker run --name mypg -e POSTGRES_PASSWORD=123456 -p 5432:5432 -d postgres:17\ndocker exec -it mypg psql -U postgres\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u63A5\u8457\u53EF\u4EE5\u4F7F\u7528\u4EE5\u4E0B\u7684 SQL \u8A9E\u6CD5\u4F86\u5EFA\u7ACB\u8CC7\u6599\u8868\u4E26\u63D2\u5165\u8CC7\u6599 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"CREATE TABLE student(\n    sid INT PRIMARY KEY,\n    name VARCHAR(16),\n    login VARCHAR(32) UNIQUE,\n    age SMALLINT,\n    gpa FLOAT\n);\n\nCREATE TABLE course(\n    cid VARCHAR(32) PRIMARY KEY,\n    name VARCHAR(32) NOT NULL\n);\n\nCREATE TABLE enrolled(\n    sid INT REFERENCES student(sid),\n    cid VARCHAR(32) REFERENCES course(cid),\n    grade CHAR(1)\n);\n\nINSERT INTO student (sid, name, login, age, gpa) VALUES\n(53666, 'RZA', 'rza@cs', 44, 4.0),\n(53688, 'Bieber', 'jbieber@cs', 27, 3.9),\n(53655, 'Tupac', 'shakur@cs', 25, 3.5),\n(53621, 'GZA', 'gza@cs', 54, 3.8);\n\nINSERT INTO course (cid, name) VALUES\n('15-445', 'Database Systems'),\n('15-721', 'Advanced Database Systems'),\n('15-826', 'Data Mining'),\n('15-799', 'Special Topics in Databases'),\n('15-999', 'Non-Database Course');\n\nINSERT INTO enrolled (sid, cid, grade) VALUES\n(53666, '15-445', 'C'),\n(53688, '15-721', 'A'),\n(53688, '15-826', 'B'),\n(53655, '15-445', 'B'),\n(53666, '15-721', 'C');\n"})}),"\n",(0,d.jsx)(e.h3,{id:"joins",children:"Joins"}),"\n",(0,d.jsx)(e.p,{children:"\u53EF\u4EE5\u7528\u65BC\u9023\u63A5\u5169\u5F35 table\uFF0C\u4E26\u4E14\u53EF\u4EE5\u4F9D\u64DA\u4E0D\u540C\u7684\u689D\u4EF6\u4F86\u9023\u63A5\u3002"}),"\n",(0,d.jsx)(e.h4,{id:"inner-join",children:"Inner Join"}),"\n",(0,d.jsx)(e.p,{children:"\u53EA\u56DE\u50B3\u5169\u500B\u8CC7\u6599\u8868\u4E2D\uFF0C\u9023\u63A5\u6B04\u4F4D\u7686\u80FD\u5339\u914D\u4E0A\u7684\u8CC7\u6599\u5217 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u627E\u51FA\u6240\u6709\u6709\u4FEE\u8AB2\u7684\u5B78\u751F\u4EE5\u53CA\u4ED6\u5011\u4FEE\u7684\u8AB2\u7A0B\nSELECT s.name, e.cid\nFROM student AS s\nJOIN enrolled AS e ON s.sid = e.sid;\n\n-- equivalent to\nSELECT s.name, e.cid\nFROM student AS s\nINNER JOIN enrolled AS e ON s.sid = e.sid;\n\n--   name  |  cid\n-- --------+--------\n--  RZA    | 15-445\n--  Bieber | 15-721\n--  Bieber | 15-826\n--  Tupac  | 15-445\n--  RZA    | 15-721\n"})}),"\n",(0,d.jsx)(e.h4,{id:"left-join",children:"Left Join"}),"\n",(0,d.jsx)(e.p,{children:"\u56DE\u50B3\u5DE6\u908A\u8CC7\u6599\u8868\u7684\u6240\u6709\u8CC7\u6599\u5217\uFF0C\u53F3\u908A\u8CC7\u6599\u8868\u4E2D\u9023\u63A5\u6B04\u4F4D\u80FD\u5339\u914D\u4E0A\u7684\u8CC7\u6599\u5217\uFF0C\u82E5\u7121\u6CD5\u5339\u914D\u5247\u4EE5 NULL \u88DC\u8DB3 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u627E\u51FA\u6240\u6709\u5B78\u751F\u4EE5\u53CA\u4ED6\u5011\u4FEE\u7684\u8AB2\u7A0B (\u82E5\u7121\u4FEE\u8AB2\u5247\u986F\u793A NULL)\nSELECT s.name, e.cid\nFROM student AS s\nLEFT JOIN enrolled AS e ON s.sid = e.sid;\n\n--   name  |  cid\n-- --------+--------\n--  RZA    | 15-445\n--  Bieber | 15-721\n--  Bieber | 15-826\n--  Tupac  | 15-445\n--  RZA    | 15-721\n--  GZA    |\n"})}),"\n",(0,d.jsx)(e.h4,{id:"right-join",children:"Right Join"}),"\n",(0,d.jsx)(e.p,{children:"\u56DE\u50B3\u53F3\u908A\u8CC7\u6599\u8868\u7684\u6240\u6709\u8CC7\u6599\u5217\uFF0C\u5DE6\u908A\u8CC7\u6599\u8868\u4E2D\u9023\u63A5\u6B04\u4F4D\u80FD\u5339\u914D\u4E0A\u7684\u8CC7\u6599\u5217\uFF0C\u82E5\u7121\u6CD5\u5339\u914D\u5247\u4EE5 NULL \u88DC\u8DB3 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u627E\u51FA\u6240\u6709\u8AB2\u7A0B\u4EE5\u53CA\u4FEE\u9019\u4E9B\u8AB2\u7A0B\u7684\u5B78\u751F (\u82E5\u7121\u5B78\u751F\u4FEE\u8AB2\u5247\u986F\u793A NULL)\nSELECT c.cid, e.sid\nFROM enrolled AS e\nRIGHT JOIN course AS c ON e.cid = c.cid;\n\n--   cid   |  sid\n-- --------+-------\n--  15-445 | 53666\n--  15-721 | 53688\n--  15-826 | 53688\n--  15-445 | 53655\n--  15-721 | 53666\n--  15-999 |\n--  15-799 |\n"})}),"\n",(0,d.jsx)(e.h4,{id:"full-join",children:"Full Join"}),"\n",(0,d.jsx)(e.p,{children:"\u56DE\u50B3\u5169\u500B\u8CC7\u6599\u8868\u7684\u806F\u96C6\uFF0C\u5169\u908A\u8CC7\u6599\u8868\u4E2D\u9023\u63A5\u6B04\u4F4D\u80FD\u5339\u914D\u4E0A\u7684\u8CC7\u6599\u5217\uFF0C\u82E5\u7121\u6CD5\u5339\u914D\u5247\u4EE5 NULL \u88DC\u8DB3 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u627E\u51FA\u6240\u6709\u5B78\u751F\u4EE5\u53CA\u6709\u9078\u904E\u7684\u8AB2\u7A0B (\u82E5\u7121\u4FEE\u8AB2\u6216\u6C92\u88AB\u9078\u904E\u5247\u986F\u793A NULL)\nSELECT s.name, e.cid\nFROM student AS s\nFULL JOIN enrolled AS e ON s.sid = e.sid;\n\n--   name  |  cid\n-- --------+--------\n--  RZA    | 15-445\n--  Bieber | 15-721\n--  Bieber | 15-826\n--  Tupac  | 15-445\n--  RZA    | 15-721\n--  GZA    |\n"})}),"\n",(0,d.jsx)(e.h4,{id:"cross-join",children:"Cross Join"}),"\n",(0,d.jsx)(e.p,{children:"\u56DE\u50B3\u5169\u500B\u8CC7\u6599\u8868\u7684\u7B1B\u5361\u5152\u7A4D (Cartesian Product) :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u627E\u51FA\u6240\u6709\u5B78\u751F\u4EE5\u53CA\u6240\u6709\u8AB2\u7A0B\u7684\u7D44\u5408\nSELECT s.name, c.cid\nFROM student AS s\nCROSS JOIN course AS c;\n\n--   name  |  cid\n-- --------+--------\n--  RZA    | 15-445\n--  RZA    | 15-721\n--  RZA    | 15-826\n--  RZA    | 15-799\n--  RZA    | 15-999\n--  Bieber | 15-445\n--  Bieber | 15-721\n--  Bieber | 15-826\n--  Bieber | 15-799\n--  Bieber | 15-999\n--  Tupac  | 15-445\n--  Tupac  | 15-721\n--  Tupac  | 15-826\n--  Tupac  | 15-799\n--  Tupac  | 15-999\n--  GZA    | 15-445\n--  GZA    | 15-721\n--  GZA    | 15-826\n--  GZA    | 15-799\n--  GZA    | 15-999\n"})}),"\n",(0,d.jsx)(e.h3,{id:"aggregates",children:"Aggregates"}),"\n",(0,d.jsxs)(e.p,{children:["\u5E38\u898B\u7684\u5305\u62EC ",(0,d.jsx)(e.code,{children:"COUNT"}),", ",(0,d.jsx)(e.code,{children:"SUM"}),", ",(0,d.jsx)(e.code,{children:"AVG"}),", ",(0,d.jsx)(e.code,{children:"MIN"}),", ",(0,d.jsx)(e.code,{children:"MAX"})," \u7B49\u7B49 :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u8A08\u7B97 login \u4EE5 '@cs' \u7D50\u5C3E\u7684\u5B78\u751F\u4EBA\u6578\uFF0C\u53EA\u7B97 login \u6B04\u4F4D\u4E0D\u70BA NULL \u7684\u8CC7\u6599\u5217\nSELECT COUNT(login) AS cnt\nFROM student\nWHERE login LIKE '%@cs';\n\n-- \u4E5F\u53EF\u4EE5\u4F7F\u7528 COUNT(*) \u6216 COUNT(1)\uFF0C\u4F46\u6703\u5C07\u6240\u6709\u8CC7\u6599\u5217\u90FD\u7B97\u9032\u53BB (\u5305\u542B NULL)\nSELECT COUNT(*) AS cnt\nFROM student\nWHERE login LIKE '%@cs';\n\nSELECT COUNT(1) AS cnt\nFROM student\nWHERE login LIKE '%@cs';\n"})}),"\n",(0,d.jsx)(e.p,{children:"Aggregates function \u4E0D\u80FD\u8207\u5176\u4ED6\u6B04\u4F4D\u540C\u6642\u51FA\u73FE\u5728 SELECT \u5B50\u53E5\u4E2D\uFF0C\u56E0\u6B64\u4E0B\u9762\u7684\u5BEB\u6CD5\u662F\u932F\u8AA4\u7684 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:'-- \u8A08\u7B97\u6BCF\u9580\u8AB2\u7684\u5E73\u5747 GPA\nSELECT AVG(s.gpa), e.cid\nFROM enrolled AS e\nJOIN student AS s ON e.sid = s.sid;\n\n-- ERROR:  column "e.cid" must appear in the GROUP BY clause or be used in an aggregate function\n-- LINE 1: SELECT AVG(s.gpa), e.cid\n'})}),"\n",(0,d.jsxs)(e.p,{children:["\u9700\u8981\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"GROUP BY"})," \u5B50\u53E5\u4F86\u89E3\u6C7A\u9019\u500B\u554F\u984C\uFF0C\u6240\u6709\u975E\u805A\u5408\u51FD\u6578\u7684\u6B04\u4F4D\u90FD\u5FC5\u9808\u51FA\u73FE\u5728 ",(0,d.jsx)(e.code,{children:"GROUP BY"})," \u5B50\u53E5\u4E2D :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT AVG(s.gpa), e.cid\nFROM enrolled AS e JOIN student AS s\nON e.sid = s.sid\nGROUP BY e.cid;\n"})}),"\n",(0,d.jsxs)(e.p,{children:["\u5982\u679C\u8981\u904E\u6FFE\u7684\u8A71\uFF0C\u53EF\u4EE5\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"HAVING"})," \u5B50\u53E5 :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT AVG(s.gpa), e.cid\nFROM enrolled AS e JOIN student AS s\nON e.sid = s.sid\nGROUP BY e.cid\nHAVING AVG(s.gpa) > 3.8;\n"})}),"\n",(0,d.jsx)(e.h3,{id:"string-operations",children:"String Operations"}),"\n",(0,d.jsx)(e.p,{children:"\u4E0D\u540C\u7684\u8CC7\u6599\u5EAB\u6709\u4E0D\u540C\u7684\u6BD4\u8F03\u5B57\u4E32\u4EE5\u53CA\u5927\u5C0F\u5BEB\u7684\u65B9\u5F0F\uFF0C\u5177\u9AD4\u5982\u4E0B\u5716\u6240\u793A :"}),"\n",(0,d.jsx)(i,{src:"/img/cmu15-445/c02/image-1.webp",caption:"String Operations in Different DBMS"}),"\n",(0,d.jsxs)(e.p,{children:["\u4E5F\u53EF\u4EE5\u5728 ",(0,d.jsx)(e.code,{children:"LIKE"})," \u4E2D\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"%"})," \u6216 ",(0,d.jsx)(e.code,{children:"_"})," \u4F86\u9032\u884C\u5B57\u4E32\u6BD4\u8F03\uFF0C",(0,d.jsx)(e.code,{children:"%"})," \u4EE3\u8868\u4EFB\u610F\u9577\u5EA6\u7684\u5B57\u4E32 (\u5305\u62EC\u7A7A\u5B57\u4E32)\uFF0C",(0,d.jsx)(e.code,{children:"_"})," \u4EE3\u8868\u4EFB\u610F\u55AE\u4E00\u5B57\u5143 :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT *\nFROM enrolled AS e\nWHERE e.cid LIKE '15-%';\n\n--   sid  |  cid   | grade\n-- -------+--------+-------\n--  53666 | 15-445 | C\n--  53688 | 15-721 | A\n--  53688 | 15-826 | B\n--  53655 | 15-445 | B\n--  53666 | 15-721 | C\n"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT *\nFROM student AS s\nWHERE s.login LIKE '%@c_';\n\n--   sid  |  name  |   login    | age | gpa\n-- -------+--------+------------+-----+-----\n--  53666 | RZA    | rza@cs     |  44 |   4\n--  53688 | Bieber | jbieber@cs |  27 | 3.9\n--  53655 | Tupac  | shakur@cs  |  25 | 3.5\n--  53621 | GZA    | gza@cs     |  54 | 3.8\n"})}),"\n",(0,d.jsxs)(e.p,{children:["PostgreSQL \u4E5F\u63D0\u4F9B\u4E86\u5F88\u591A\u5B57\u4E32\u8655\u7406\u7684\u51FD\u6578\uFF0C\u4F8B\u5982 ",(0,d.jsx)(e.code,{children:"LENGTH"}),", ",(0,d.jsx)(e.code,{children:"SUBSTRING"}),", ",(0,d.jsx)(e.code,{children:"LOWER"}),", ",(0,d.jsx)(e.code,{children:"UPPER"}),", ",(0,d.jsx)(e.code,{children:"TRIM"}),", ",(0,d.jsx)(e.code,{children:"CONCAT"})," \u7B49\u7B49 :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT LENGTH(name) AS len, SUBSTRING(name FROM 1 FOR 2) AS sub\nFROM student;\n\n--  len | sub\n-- -----+-----\n--    3 | RZ\n--    6 | Bi\n--    5 | Tu\n--    3 | GZ\n"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT LOWER(name) AS lower_name, UPPER(name) AS upper_name\nFROM student\nWHERE name IN ('rza', 'Bieber', 'tupac', 'GZA');\n\n--  lower_name | upper_name\n-- ------------+------------\n--  bieber     | BIEBER\n--  gza        | GZA\n"})}),"\n",(0,d.jsx)(e.h3,{id:"date-and-time",children:"Date and Time"}),"\n",(0,d.jsx)(e.p,{children:"\u4E0D\u540C\u7684 DBMS \u5DEE\u7570\u975E\u5E38\u5927\uFF0C\u6240\u4EE5\u9700\u8981\u4F9D\u64DA\u4E0D\u540C\u7684 DBMS \u4F86\u64B0\u5BEB SQL \u8A9E\u6CD5 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT NOW();\n\n--               now\n-- -------------------------------\n--  2025-09-07 00:54:17.279466+00\n"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT CURRENT_TIMESTAMP;\n\n--        current_timestamp\n-- -------------------------------\n--  2025-09-07 00:54:23.033652+00\n"})}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT CAST('2023-08-01' AS DATE) - CAST('2023-01-02' AS DATE) AS diff;\n\n--  diff\n-- ------\n--   211\n"})}),"\n",(0,d.jsx)(e.h3,{id:"output-redirection",children:"Output Redirection"}),"\n",(0,d.jsx)(e.p,{children:"\u53EF\u4EE5\u5C07\u67E5\u8A62\u7D50\u679C\u5132\u5B58\u5230\u53E6\u4E00\u5F35\u5DF2\u7D93\u5B58\u5728\u4E14\u6709\u76F8\u540C\u6B04\u4F4D\u7D50\u69CB\u7684 table \u4E2D :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT DISTINCT cid\nINTO TEMPORARY CourseIds\nFROM enrolled;\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u4E5F\u53EF\u4EE5\u7528\u65BC insert \u8A9E\u53E5\u4E2D\uFF0C\u5C07\u67E5\u8A62\u7D50\u679C\u63D2\u5165\u5230\u53E6\u4E00\u5F35 table \u4E2D :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"INSERT INTO CourseIds (cid)\n(SELECT DISTINCT cid FROM enrolled);\n"})}),"\n",(0,d.jsx)(e.h3,{id:"output-control",children:"Output Control"}),"\n",(0,d.jsxs)(e.p,{children:["\u53EF\u4EE5\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"ORDER BY"})," \u5B50\u53E5\u4F86\u6392\u5E8F\u67E5\u8A62\u7D50\u679C\uFF0C\u8A9E\u6CD5\u70BA ",(0,d.jsx)(e.code,{children:"ORDER BY <column*> [ASC|DESC]"}),"\uFF0C\u9810\u8A2D\u70BA ASC\uFF0C\u53EF\u4EE5\u4F9D\u64DA\u591A\u500B\u6B04\u4F4D\u9032\u884C\u6392\u5E8F :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT sid FROM enrolled\nWHERE cid = '15-721'\nORDER BY grade DESC, sid ASC;\n"})}),"\n",(0,d.jsxs)(e.p,{children:["\u4E5F\u53EF\u4EE5\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"LIMIT"})," \u5B50\u53E5\u4F86\u9650\u5236\u67E5\u8A62\u7D50\u679C\u7684\u6578\u91CF\uFF0C\u8A9E\u6CD5\u70BA ",(0,d.jsx)(e.code,{children:"LIMIT <number> [OFFSET <number>]"}),"\uFF0C\u5176\u4E2D ",(0,d.jsx)(e.code,{children:"OFFSET"})," \u7528\u65BC\u8DF3\u904E\u524D\u9762\u7684\u8CC7\u6599\u5217 :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT * FROM student\nORDER BY sid\nLIMIT 1 OFFSET 1;\n"})}),"\n",(0,d.jsxs)(e.p,{children:["\u9084\u6709\u4E00\u7A2E\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"FETCH"})," \u7684\u65B9\u6CD5\uFF0C\u8A9E\u6CD5\u5982\u4E0B (WITH TIES \u6703\u5C07\u76F8\u540C\u7684\u8CC7\u6599\u5217\u5168\u90E8\u53D6\u51FA) :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u5C07\u5B78\u751F\u4F9D\u7167 GPA \u7531\u4F4E\u5230\u9AD8\u6392\u5E8F\uFF0C\u8DF3\u904E\u524D 10 \u540D\uFF0C\u4E26\u53D6\u51FA\u63A5\u4E0B\u4F86\u7684 10 \u540D\uFF0C\u5982\u679C\u6709\u4E26\u5217\u7684\u8A71\u4E5F\u6703\u5168\u90E8\u53D6\u51FA\nSELECT sid, name\nFROM student\nWHERE login LIKE '%@cs'\nORDER BY gpa\nOFFSET 1 ROWS\nFETCH FIRST 2 ROWS WITH TIES;\n"})}),"\n",(0,d.jsx)(e.h3,{id:"window-functions",children:"Window Functions"}),"\n",(0,d.jsx)(e.p,{children:"\u5728 SQL \u7684\u65E9\u671F\uFF0C\u6211\u5011\u4E3B\u8981\u7528 \u805A\u5408\u51FD\u6578\u642D\u914D GROUP BY \u4F86\u505A\u7D71\u8A08\uFF0C\u4F8B\u5982\uFF1A"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT cid, AVG(CASE grade\n                  WHEN 'A' THEN 4\n                  WHEN 'B' THEN 3\n                  WHEN 'C' THEN 2\n                  ELSE 0 END) AS avg_gpa\nFROM enrolled\nGROUP BY cid;\n\n--   cid   |      avg_gpa\n-- --------+--------------------\n--  15-445 | 2.5000000000000000\n--  15-826 | 3.0000000000000000\n--  15-721 | 3.0000000000000000\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u9019\u6A23\u80FD\u8A08\u7B97\u6BCF\u9580\u8AB2\u7684\u5E73\u5747\u5206\u6578\uFF0C\u4F46\u554F\u984C\u5728\u65BC :"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsx)(e.li,{children:"\u7D50\u679C\u6703\u58D3\u7E2E\u8CC7\u6599\u5217\u3002\u4F8B\u5982\u4E0A\u9762\uFF0C\u8F38\u51FA\u53EA\u6709\u8AB2\u7A0B\u8DDF\u5E73\u5747\u5206\u6578\uFF0C\u7121\u6CD5\u540C\u6642\u4FDD\u7559\u5B78\u751F\u500B\u5225\u8CC7\u6599\u3002"}),"\n",(0,d.jsx)(e.li,{children:"\u7121\u6CD5\u5728\u540C\u4E00\u67E5\u8A62\u4E2D\uFF0C\u540C\u6642\u770B\u5230\u500B\u4EBA\u8CC7\u8A0A\u8207\u7FA4\u9AD4\u7D71\u8A08\u3002\u5982\u679C\u8981\u67E5\u6BCF\u500B\u5B78\u751F\u7684\u5206\u6578\uFF0C\u9084\u6709\u4ED6\u5728\u8AB2\u7A0B\u4E2D\u7684\u5E73\u5747\uFF0C\u5C31\u5F97\u5BEB\u5B50\u67E5\u8A62\u6216 join\uFF0C\u8A9E\u6CD5\u5197\u9577\u3002"}),"\n"]}),"\n",(0,d.jsx)(e.p,{children:"\u56E0\u6B64\uFF0C\u70BA\u4E86\u89E3\u6C7A\u9019\u4E9B\u554F\u984C\uFF0CSQL \u5F15\u5165\u4E86 Window Functions (\u8996\u7A97\u51FD\u6578)\u3002"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"SELECT e.sid, s.name, e.cid, e.grade,\n       AVG(CASE grade\n             WHEN 'A' THEN 4\n             WHEN 'B' THEN 3\n             WHEN 'C' THEN 2\n             ELSE 0 END)\n       OVER (PARTITION BY e.cid) AS avg_gpa\nFROM enrolled e\nJOIN student s ON e.sid = s.sid;\n\n--   sid  |  name  |  cid   | grade |      avg_gpa\n-- -------+--------+--------+-------+--------------------\n--  53666 | RZA    | 15-445 | C     | 2.5000000000000000\n--  53655 | Tupac  | 15-445 | B     | 2.5000000000000000\n--  53688 | Bieber | 15-721 | A     | 3.0000000000000000\n--  53666 | RZA    | 15-721 | C     | 3.0000000000000000\n--  53688 | Bieber | 15-826 | B     | 3.0000000000000000\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u9019\u6A23\u5C31\u80FD\u5728\u540C\u4E00\u67E5\u8A62\u4E2D\uFF0C\u540C\u6642\u770B\u5230\u500B\u4EBA\u8CC7\u8A0A\u8207\u7FA4\u9AD4\u7D71\u8A08\u3002"}),"\n",(0,d.jsx)(e.p,{children:"\u9664\u4E86\u4E00\u822C\u7684\u805A\u5408\u51FD\u6578\uFF0C\u5E38\u898B\u7684\u8996\u7A97\u51FD\u6578\u9084\u6709 RANK, DENSE_RANK, ROW_NUMBER \u7B49\u7B49\u3002"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u6BCF\u9580\u8AB2\u7684\u6210\u7E3E\u6392\u540D\nSELECT e.cid, s.name, e.grade,\n       RANK() OVER (\n         PARTITION BY e.cid\n         ORDER BY CASE e.grade\n                    WHEN 'A' THEN 4\n                    WHEN 'B' THEN 3\n                    WHEN 'C' THEN 2\n                    ELSE 0 END DESC\n       ) AS rank_in_course\nFROM enrolled e\nJOIN student s ON e.sid = s.sid;\n\n--   cid   |  name  | grade | rank_in_course\n-- --------+--------+-------+----------------\n--  15-445 | Tupac  | B     |              1\n--  15-445 | RZA    | C     |              2\n--  15-721 | Bieber | A     |              1\n--  15-721 | RZA    | C     |              2\n--  15-826 | Bieber | B     |              1\n"})}),"\n",(0,d.jsx)(e.h3,{id:"nested-queries",children:"Nested Queries"}),"\n",(0,d.jsx)(e.p,{children:"\u5728\u4E00\u500B\u67E5\u8A62\u4E2D\u5D4C\u5957\u53E6\u4E00\u500B\u67E5\u8A62\uFF0C\u5167\u5C64\u67E5\u8A62\u6703\u5148\u88AB\u57F7\u884C\uFF0C\u7136\u5F8C\u5C07\u7D50\u679C\u50B3\u905E\u7D66\u5916\u5C64\u67E5\u8A62\u3002"}),"\n",(0,d.jsxs)(e.p,{children:["\u53EF\u4EE5\u652F\u6301 ",(0,d.jsx)(e.code,{children:"NOT"}),"\u3001",(0,d.jsx)(e.code,{children:"IN"}),"\u3001",(0,d.jsx)(e.code,{children:"ANY"}),"\u3001",(0,d.jsx)(e.code,{children:"ALL"}),"\u3001",(0,d.jsx)(e.code,{children:"EXISTS"})," \u7B49\u7B49\u3002"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u627E\u51FA\u6709\u4FEE\u8AB2\u7684\u5B78\u751F\nSELECT s.sid, s.name\nFROM student AS s\nWHERE EXISTS (\n    SELECT 1\n    FROM enrolled AS e\n    WHERE e.sid = s.sid\n);\n\n--   sid  |  name\n-- -------+--------\n--  53666 | RZA\n--  53688 | Bieber\n--  53655 | Tupac\n"})}),"\n",(0,d.jsxs)(e.p,{children:["\u9664\u6B64\u4E4B\u5916\u4E5F\u53EF\u4EE5\u4F7F\u7528 ",(0,d.jsx)(e.code,{children:"LATERAL"})," \u4F86\u9032\u884C\u67E5\u8A62\uFF0C",(0,d.jsx)(e.code,{children:"LATERAL"})," \u6703\u4F9D\u64DA\u5916\u5C64\u67E5\u8A62\u7684\u6BCF\u4E00\u5217\u4F86\u57F7\u884C\u5167\u5C64\u67E5\u8A62 :"]}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u627E\u51FA\u6BCF\u9580\u8AB2\u7684\u4FEE\u8AB2\u4EBA\u6578\u4EE5\u53CA\u5E73\u5747 GPA\nSELECT *\nFROM course AS c,\nLATERAL (\n    SELECT COUNT(*) AS cnt\n    FROM enrolled AS e\n    WHERE e.cid = c.cid\n) AS t1,\nLATERAL (\n    SELECT AVG(gpa) AS avg\n    FROM student AS s\n    JOIN enrolled AS e ON s.sid = e.sid\n    WHERE e.cid = c.cid\n) AS t2;\n\n--   cid   |            name             | cnt | avg\n-- --------+-----------------------------+-----+------\n--  15-445 | Database Systems            |   2 | 3.75\n--  15-721 | Advanced Database Systems   |   2 | 3.95\n--  15-826 | Data Mining                 |   1 |  3.9\n--  15-799 | Special Topics in Databases |   0 |\n--  15-999 | Non-Database Course         |   0 |\n"})}),"\n",(0,d.jsx)(e.h3,{id:"common-table-expressions",children:"Common Table Expressions"}),"\n",(0,d.jsx)(e.p,{children:"CTE \u662F SQL \u63D0\u4F9B\u7684\u4E00\u7A2E\u8A9E\u6CD5\u6A5F\u5236\uFF0C\u7528\u4F86\u5728\u4E00\u500B\u67E5\u8A62\u4E2D\u5B9A\u7FA9\u81E8\u6642\u7684\u7D50\u679C\uFF0C\u53EF\u4EE5\u5728\u5F8C\u7E8C\u7684\u4E3B\u67E5\u8A62\u4E2D\u91CD\u8907\u4F7F\u7528\uFF0C\u63D0\u4F9B\u53EF\u8B80\u6027\u4E26\u4E14\u652F\u63F4\u905E\u8FF4\u67E5\u8A62\u3002"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"-- \u4F7F\u7528 CTE \u8A08\u7B97\u6BCF\u9580\u8AB2\u7684\u5E73\u5747 GPA\nWITH course_avg AS (\n    SELECT e.cid, AVG(s.gpa) AS avg_gpa\n    FROM enrolled e\n    JOIN student s ON e.sid = s.sid\n    GROUP BY e.cid\n)\nSELECT c.cid, c.name, ca.avg_gpa\nFROM course c\nJOIN course_avg ca ON c.cid = ca.cid;\n"})}),"\n",(0,d.jsx)(e.p,{children:"CTE \u4E5F\u53EF\u4EE5\u652F\u63F4\u905E\u8FF4\u67E5\u8A62 (Recursive CTE)\uFF0C\u4F8B\u5982\u8A08\u7B97\u968E\u4E58 :"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-SQL",children:"WITH RECURSIVE factorial(n, fact) AS (\n    SELECT 0 AS n, 1 AS fact\n    UNION ALL\n    SELECT n + 1, (n + 1) * fact\n    FROM factorial\n    WHERE n < 5\n)\nSELECT * FROM factorial;\n\n--  n | fact\n-- ---+------\n--  0 |    1\n--  1 |    1\n--  2 |    2\n--  3 |    6\n--  4 |   24\n--  5 |  120\n"})})]})}function E(n={}){let{wrapper:e}={...(0,l.a)(),...n.components};return e?(0,d.jsx)(e,{...n,children:(0,d.jsx)(t,{...n})}):t(n)}function S(n,e){throw Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}},65:function(n,e,s){s.d(e,{Z:()=>r,a:()=>c});var i=s(7294);let d={},l=i.createContext(d);function c(n){let e=i.useContext(l);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(d):n.components||d:c(n.components),i.createElement(l.Provider,{value:e},n.children)}}}]);