"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["1322"],{8509:function(e,n,c){c.r(n),c.d(n,{frontMatter:()=>s,default:()=>h,toc:()=>d,metadata:()=>i,assets:()=>o,contentTitle:()=>t});var i=JSON.parse('{"id":"CMU15-445/p3","title":"P3 - Query Execution","description":"Query Execution","source":"@site/docs/CMU15-445/p3.mdx","sourceDirName":"CMU15-445","slug":"/CMU15-445/p3","permalink":"/RulerChen-Website/docs/CMU15-445/p3","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/p3.mdx","tags":[{"inline":true,"label":"CMU15-445","permalink":"/RulerChen-Website/docs/tags/cmu-15-445"},{"inline":true,"label":"CMU15-445 Projects","permalink":"/RulerChen-Website/docs/tags/cmu-15-445-projects"}],"version":"current","lastUpdatedAt":1755332301000,"sidebarPosition":103,"frontMatter":{"title":"P3 - Query Execution","sidebar_position":103,"description":"Query Execution","keywords":["CMU15-445/645","Query Execution","CMU15-445/645 \u7B46\u8A18"],"tags":["CMU15-445","CMU15-445 Projects"]},"sidebar":"tutorialSidebar","previous":{"title":"P2 - B+ Tree","permalink":"/RulerChen-Website/docs/CMU15-445/p2"},"next":{"title":"P4 - Concurrency Control","permalink":"/RulerChen-Website/docs/CMU15-445/p4"}}'),l=c(5893),r=c(65);let s={title:"P3 - Query Execution",sidebar_position:"103",description:"Query Execution",keywords:["CMU15-445/645","Query Execution","CMU15-445/645 \u7B46\u8A18"],tags:["CMU15-445","CMU15-445 Projects"]},t=void 0,o={},d=[{value:"Problem Description",id:"problem-description",level:2},{value:"Overview",id:"overview",level:2},{value:"Solution",id:"solution",level:2},{value:"Submit",id:"submit",level:2},{value:"Reference",id:"reference",level:2}];function a(e){let n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components},{Head:c}=n;return c||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c,{children:(0,l.jsx)("title",{children:"CMU 15-445 2024Fall P3 Query Execution"})}),"\n",(0,l.jsx)(n.h2,{id:"problem-description",children:"Problem Description"}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u9019\u500B project \u4E2D\uFF0C\u6211\u5011\u9700\u8981\u5BE6\u73FE\u4E00\u500B query execution engine\uFF0C\u7E3D\u5171\u6709 4 \u500B Task :"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Access Method Executors"}),"\n",(0,l.jsx)(n.li,{children:"Aggregation & Join Executors"}),"\n",(0,l.jsx)(n.li,{children:"HashJoin Executor and Optimization"}),"\n",(0,l.jsx)(n.li,{children:"External Merge Sort + Limit Executors"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/tools/shell/shell.cpp"}),": \u9019\u662F shell \u7684\u5165\u53E3\u9EDE\uFF0C\u8CA0\u8CAC\u89E3\u6790 SQL \u8A9E\u53E5\u4E26\u8ABF\u7528\u76F8\u61C9\u7684 executor"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/common/bustub_instance.cpp"}),": \u9019\u662F Bustub \u7684\u5BE6\u4F8B\uFF0C\u8CA0\u8CAC\u7BA1\u7406\u8CC7\u6599\u5EAB\u7684\u9023\u63A5\u548C\u57F7\u884C SQL \u8A9E\u53E5\uFF0C",(0,l.jsx)(n.code,{children:"ExecuteSql()"})," \u51FD\u6578\u662F\u57F7\u884C SQL \u7684\u4E3B\u8981\u5165\u53E3"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/common/bustub_instance.cpp"}),": \u63A5\u8457\u6703\u9032\u5165\u5230 ",(0,l.jsx)(n.code,{children:"ExecuteSqlTxn()"})," \u51FD\u6578","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5148\u8655\u7406\u9810\u8A2D\u7684\u6307\u4EE4\uFF0C\u5982 ",(0,l.jsx)(n.code,{children:"dt"}),"\u3001",(0,l.jsx)(n.code,{children:"di"}),"\u3001",(0,l.jsx)(n.code,{children:"help"}),"\u3001",(0,l.jsx)(n.code,{children:"dbgmvcc"}),"\u3001",(0,l.jsx)(n.code,{children:"txn"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u5EFA\u7ACB Binder \u4E26\u547C\u53EB ",(0,l.jsx)(n.code,{children:"ParseAndSave()"}),"\uFF0C\u9019\u500B\u51FD\u6578\u6703\u547C\u53EB\u7B2C\u4E09\u65B9\u7684\u5DE5\u5177 ",(0,l.jsx)(n.code,{children:"libpg_query"})," \u4F86\u89E3\u6790 SQL \u8A9E\u53E5\uFF0C\u4E26\u5C07\u89E3\u6790\u7D50\u679C\u5B58\u5132\u5230 ",(0,l.jsx)(n.code,{children:"Binder"})," \u4E2D"]}),"\n",(0,l.jsx)(n.li,{children:"\u4F9D\u64DA\u4E0D\u540C\u7684\u985E\u578B (\u5982 DDL\u3001DML\u3001Meta-command) \u4F86\u547C\u53EB\u4E0D\u540C\u7684\u51FD\u6578\u4F86\u7D81\u5B9A\u5BE6\u9AD4"}),"\n",(0,l.jsxs)(n.li,{children:["\u5EFA\u7ACB Planner \u4E26\u547C\u53EB ",(0,l.jsx)(n.code,{children:"PlanQuery()"}),"\uFF0C\u9019\u500B\u51FD\u6578\u6703\u5C07 ",(0,l.jsx)(n.code,{children:"Binder"})," \u4E2D\u7684 SQL \u8A9E\u53E5\u8F49\u63DB\u70BA ",(0,l.jsx)(n.code,{children:"PlanNode"}),"\uFF0C\u9019\u662F\u4E00\u500B\u6A39\u72C0\u7D50\u69CB\uFF0C\u8868\u793A SQL \u8A9E\u53E5\u7684\u57F7\u884C\u8A08\u5283"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5EFA\u7ACB Optimizer \u4E26\u547C\u53EB ",(0,l.jsx)(n.code,{children:"Optimize()"}),"\uFF0C\u9019\u500B\u51FD\u6578\u6703\u5C0D ",(0,l.jsx)(n.code,{children:"PlanNode"})," \u9032\u884C\u512A\u5316\uFF0C\u751F\u6210\u6700\u7D42\u7684\u57F7\u884C\u8A08\u5283"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5EFA\u7ACB ExecutorContext \u4E26\u547C\u53EB ",(0,l.jsx)(n.code,{children:"ExecutionEngine"})," \u4E2D\u7684 ",(0,l.jsx)(n.code,{children:"Execute()"}),"\uFF0C\u9019\u500B\u51FD\u6578\u6703\u6839\u64DA ",(0,l.jsx)(n.code,{children:"PlanNode"})," \u57F7\u884C SQL \u8A9E\u53E5\uFF0C\u4E26\u8FD4\u56DE\u7D50\u679C"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/execution/executor_engine.cpp"}),": \u9019\u662F\u57F7\u884C\u5F15\u64CE\u7684\u5165\u53E3\u9EDE","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u547C\u53EB ",(0,l.jsx)(n.code,{children:"ExecutorFactory::CreateExecutor()"})," \u4F86\u5275\u5EFA\u5C0D\u61C9\u7684 Executor\uFF0C\u9019\u500B\u51FD\u6578\u5728 ",(0,l.jsx)(n.code,{children:"src/execution/executor_factory.cpp"})," \u4E2D\u5BE6\u73FE\uFF0C\u6703\u4F9D\u64DA ",(0,l.jsx)(n.code,{children:"AbstractPlanNodeRef"})," \u7684\u985E\u578B\u4F86\u905E\u8FF4\u7684\u5275\u5EFA\u5C0D\u61C9\u7684 Executor"]}),"\n",(0,l.jsxs)(n.li,{children:["\u547C\u53EB ",(0,l.jsx)(n.code,{children:"Executor::Init()"})," \u4F86\u521D\u59CB\u5316 Executor\uFF0C\u9019\u500B\u51FD\u6578\u6703\u6839\u64DA ",(0,l.jsx)(n.code,{children:"PlanNode"})," \u7684\u985E\u578B\u4F86\u521D\u59CB\u5316 Executor \u7684\u72C0\u614B\uFF0C\u4E26\u905E\u8FF4\u5730\u521D\u59CB\u5316\u5B50 Executor"]}),"\n",(0,l.jsxs)(n.li,{children:["\u547C\u53EB ",(0,l.jsx)(n.code,{children:"PollExecutor()"})," \u4F86\u57F7\u884C Executor\uFF0C\u9019\u500B\u51FD\u6578\u6703\u4E0D\u65B7\u547C\u53EB ",(0,l.jsx)(n.code,{children:"Executor::Next()"})," \u4F86\u7372\u53D6\u4E0B\u4E00\u500B\u7D50\u679C\uFF0C\u76F4\u5230\u6C92\u6709\u66F4\u591A\u7684\u7D50\u679C\u70BA\u6B62"]}),"\n",(0,l.jsxs)(n.li,{children:["\u547C\u53EB ",(0,l.jsx)(n.code,{children:"PerformChecks()"})," \u4F86\u505A\u4E00\u4E9B\u9A57\u8B49\u6027\u6E2C\u8A66\uFF0C\u4E3B\u8981\u91DD\u5C0D Nested Loop Join \u7684\u60C5\u6CC1\\"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u4E26\u4E14\u6709\u5F88\u591A\u7684 class \u90FD\u9700\u8981\u8B80\u4E00\u4E0B\uFF0C\u5EFA\u8B70\u53EF\u4EE5\u5148\u53C3\u8003 Reference \u4E2D\u7684\u6587\u7AE0\uFF0C\u9019\u6A23\u53EF\u4EE5\u66F4\u5FEB\u7684\u4E86\u89E3\u6574\u500B\u6D41\u7A0B\u3002"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/include/execution/executor_context.h"}),": \u9019\u500B\u6A94\u6848\u5B9A\u7FA9\u4E86 Executor \u7684\u4E0A\u4E0B\u6587\uFF0C\u5305\u542B\u4E86\u57F7\u884C\u6240\u9700\u7684\u5404\u7A2E\u8CC7\u8A0A\uFF0C\u5982\u7576\u524D\u7684 Transaction\u3001Catalog\u3001Statistics \u7B49\u7B49\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/include/catalog/catalog.h"}),": Catalog \u8CA0\u8CAC\u7BA1\u7406\u8CC7\u6599\u5EAB\u7684 metadata\uFF0C\u4E3B\u8981\u6709 ",(0,l.jsx)(n.code,{children:"TableInfo"})," \u8DDF ",(0,l.jsx)(n.code,{children:"IndexInfo"})," \u5169\u500B\u985E\u578B\uFF0C\u5206\u5225\u7528\u4F86\u8868\u793A\u8CC7\u6599\u8868\u548C\u7D22\u5F15\u7684\u8CC7\u8A0A\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/include/storage/table/table_heap.h"}),": TableHeap \u662F\u4E00\u500B\u96D9\u5411\u93C8\u8868 (\u6307\u6A19\u5132\u5B58\u5728 ",(0,l.jsx)(n.code,{children:"TableInfo"})," \u4E2D)\uFF0C\u7528\u4F86\u5B58\u5132\u8A72\u8CC7\u6599\u8868\u7684 page\uFF0C"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/include/storage/table/table_page.h"}),": TablePage \u662F\u4E00\u500B page \u7684\u5BE6\u73FE\uFF0C\u5305\u542B\u4E86\u8CC7\u6599\u8868\u7684\u5BE6\u969B\u8CC7\u6599\uFF0C\u4F7F\u7528\u4E0A\u8AB2\u8AAA\u904E\u7684 slotted page \u7684\u65B9\u5F0F\u4F86\u5B58\u5132\u8CC7\u6599\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/include/storage/table/tuple.h"}),": Tuple \u662F\u4E00\u500B\u8CC7\u6599\u8868\u7684\u884C (row) \u7684\u5BE6\u73FE\uFF0C\u5305\u542B\u4E86 rid \u8DDF data\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"src/include/storage/index/value.h"}),": Value \u662F\u4E00\u500B\u8CC7\u6599\u8868\u7684\u503C (value) \u7684\u5BE6\u73FE\uFF0C\u5305\u542B\u4E86\u5404\u7A2E\u8CC7\u6599\u578B\u5225\u7684\u503C\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u800C\u5728\u9019\u6B21\u4F5C\u696D\u4E2D\uFF0C\u6211\u5011\u4E3B\u8981\u5C31\u662F\u5BE6\u4F5C\u5404\u500B Executor \u7684 ",(0,l.jsx)(n.code,{children:"Init()"})," \u8DDF ",(0,l.jsx)(n.code,{children:"Next()"})," \u51FD\u6578\uFF0C\u4F86\u5B8C\u6210 SQL \u7684\u57F7\u884C\u3002"]}),"\n",(0,l.jsx)(n.h2,{id:"solution",children:"Solution"}),"\n",(0,l.jsx)(n.p,{children:"\u4E0D\u8981\u4F7F\u7528\u4EE5\u4E0B\u7684\u5BEB\u6CD5\uFF0C\u53EF\u80FD\u6703\u5C0E\u81F4\u6A21\u677F\u51FD\u6578\u7121\u6CD5\u6B63\u78BA\u89E3\u6790:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:"auto [key, rid] = *iter_;\n"})}),"\n",(0,l.jsx)(n.h2,{id:"submit",children:"Submit"}),"\n",(0,l.jsxs)(n.p,{children:["\u5982\u679C\u8981\u57F7\u884C SQL\uFF0C\u53EF\u4EE5\u4F7F\u7528\u4EE5\u4E0B\u6307\u4EE4\u6216\u662F\u5230",(0,l.jsx)(n.a,{href:"https://15445.courses.cs.cmu.edu/fall2024/bustub/",children:"\u7DB2\u7AD9"}),"\u4E0A\u57F7\u884C"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"cd build && make -j$(nproc) shell\n./bin/bustub-shell\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6E2C\u8A66\u7684\u65B9\u5F0F\u6709\u9EDE\u9EBB\u7169\uFF0C\u8981\u81EA\u5DF1\u4E00\u500B\u4E00\u500B\u8A66"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"make -j$(nproc) sqllogictest\n./bin/bustub-sqllogictest ../test/sql/p3.05-index-scan-btree.slt\n./bin/bustub-sqllogictest ../test/sql/p3.05-index-scan-btree.slt --verbose\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"make format\nmake check-format\nmake check-lint\nmake check-clang-tidy-p3\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"make submit-p3\n"})}),"\n",(0,l.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/5843407385",children:"CMU Fall 2024 15-445 P3[\u5F85\u4F18\u5316]&PaperNotes"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/587566135",children:"\u505A\u4E2A\u6570\u636E\u5E93\uFF1A2022 CMU15-445 Project3 Query Execution"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/570917775",children:"BusTub \u517B\u6210\u8BB0\uFF1A\u4ECE\u8BFE\u7A0B\u9879\u76EE\u5230 SQL \u6570\u636E\u5E93"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/593909820",children:"CMU 15445-2022 P3 Query Optimize"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://juejin.cn/post/7527199538878939146",children:"CMU15445-2024fall-project3 \u8E29\u5751\u7ECF\u5386"})}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},65:function(e,n,c){c.d(n,{Z:()=>t,a:()=>s});var i=c(7294);let l={},r=i.createContext(l);function s(e){let n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);