"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7582],{7089:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var r=s(5893),t=s(1151);const i=s.p+"assets/images/6-e051d396d6cafc91de6531fd7eb109f4.webp",l={title:"[K8s] Kubernetes Network",sidebar_position:"45",description:"Kubernetes Network",keywords:["Kubernetes","Network"]},a=void 0,o={id:"Kubernetes/Network",title:"[K8s] Kubernetes Network",description:"Kubernetes Network",source:"@site/docs/Kubernetes/Network.mdx",sourceDirName:"Kubernetes",slug:"/Kubernetes/Network",permalink:"/RulerChen-Website/docs/Kubernetes/Network",draft:!1,unlisted:!1,editUrl:"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/Kubernetes/Network.mdx",tags:[],version:"current",lastUpdatedAt:1706183872,formattedLastUpdatedAt:"2024\u5e741\u670825\u65e5",sidebarPosition:45,frontMatter:{title:"[K8s] Kubernetes Network",sidebar_position:45,description:"Kubernetes Network",keywords:["Kubernetes","Network"]},sidebar:"tutorialSidebar",previous:{title:"[K8s] Kubernetes Service",permalink:"/RulerChen-Website/docs/Kubernetes/Service"},next:{title:"[K8s] Kubernetes Storage",permalink:"/RulerChen-Website/docs/Kubernetes/Storage"}},c={},d=[{value:"Network Overview",id:"network-overview",level:2},{value:"Container and Container in the same Pod",id:"container-and-container-in-the-same-pod",level:2},{value:"Pod and Pod Network",id:"pod-and-pod-network",level:2},{value:"Cluster DNS",id:"cluster-dns",level:2},{value:"Ingress",id:"ingress",level:2},{value:"Single Service",id:"single-service",level:3},{value:"Multiple Service (Fanout)",id:"multiple-service-fanout",level:3},{value:"Virtual Hosting",id:"virtual-hosting",level:3},{value:"TLS",id:"tls",level:3},{value:"Reference",id:"reference",level:2}];function p(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"network-overview",children:"Network Overview"}),"\n",(0,r.jsx)(n.p,{children:"\u5728 kubernetes \u7684\u7db2\u8def\u4e2d\uff0c\u6211\u5011\u9700\u8981\u8003\u616e\u5230\u4ee5\u4e0b\u5e7e\u500b\u90e8\u5206\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Container \u8207 Container \u5728\u540c\u4e00\u500b Pod \u4e2d\u7684\u7db2\u8def"}),"\n",(0,r.jsx)(n.li,{children:"Pod \u8207 Pod \u4e4b\u9593\u7684\u7db2\u8def (\u540c\u4e00\u500b Node)"}),"\n",(0,r.jsx)(n.li,{children:"Pod \u8207 Pod \u4e4b\u9593\u7684\u7db2\u8def (\u4e0d\u540c\u7684 Node)"}),"\n",(0,r.jsx)(n.li,{children:"Pod \u8207 Service \u4e4b\u9593\u7684\u7db2\u8def"}),"\n",(0,r.jsx)(n.li,{children:"\u5916\u90e8\u7db2\u8def\u8207 Service \u4e4b\u9593\u7684\u7db2\u8def"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u5f8c\u9762\u5169\u7a2e\u90fd\u662f\u900f\u904e Service \u4f86\u9032\u884c\u7ba1\u7406\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"container-and-container-in-the-same-pod",children:"Container and Container in the same Pod"}),"\n",(0,r.jsxs)(n.p,{children:["\u7531\u65bc\u5728\u540c\u4e00\u500b Pod \u4e2d\u7684 Container \u662f\u5171\u4eab\u540c\u4e00\u500b\u7db2\u8def\u547d\u540d\u7a7a\u9593\uff0c\u56e0\u6b64\u53ef\u4ee5\u900f\u904e ",(0,r.jsx)(n.code,{children:"localhost"})," \u4f86\u9032\u884c\u6e9d\u901a\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"pod-and-pod-network",children:"Pod and Pod Network"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"k8s-network",src:s(9051).Z+"",width:"2866",height:"1459"})}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u540c\u4e00\u500b\u7bc0\u9ede\u4e2d\u7684 Pod \u4e4b\u9593\uff0c\u8655\u5728\u540c\u4e00\u500b\u7db2\u6bb5\u4e2d\uff0c\u53ef\u4ee5\u900f\u904e cni \u7684 bridge \u4f86\u9032\u884c\u6e9d\u901a\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u4e0d\u540c\u7bc0\u9ede\u4e2d\u7684 Pod \u4e4b\u9593\uff0c\u6211\u5011\u9996\u5148\u6703\u9700\u8981\u7d93\u904e cni \u7684 bridge \u4e26\u7531 flannel \u7684 vxlan \u4f86\u9032\u884c\u5c01\u88dd\uff0c\u4e26\u901a\u904e enp0s8 \u4f86\u9032\u884c\u6e9d\u901a\uff0c\n\u518d\u900f\u904e flannel \u7684 vxlan \u4f86\u9032\u884c\u89e3\u5c01\u88dd\uff0c\u6700\u5f8c\u900f\u904e cni \u7684 bridge \u4f86\u50b3\u905e\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"cluster-dns",children:"Cluster DNS"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 kubernetes \u4e2d\uff0c\u6211\u5011\u9810\u8a2d\u6703\u7522\u751f ",(0,r.jsx)(n.code,{children:"coredns"})," \u7684 Deployment\uff0c\u4e26\u4e14\u6703\u7522\u751f\u4e00\u500b ",(0,r.jsx)(n.code,{children:"kube-dns"})," \u7684 Service\uff0c\n\u6211\u5011\u53ef\u4ee5\u5728\u5bb9\u5668\u4e2d\u7684 ",(0,r.jsx)(n.code,{children:"/etc/resolv.conf"})," \u4e2d\u770b\u5230 ",(0,r.jsx)(n.code,{children:"nameserver"}),"\uff0c\u4e5f\u5c31\u662f\u6211\u5011 ",(0,r.jsx)(n.code,{children:"kube-dns"})," \u7684 IP\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["Pod \u9810\u8a2d\u7684 DNS \u662f ",(0,r.jsx)(n.code,{children:"pod-ip-address.namespace.pod.cluster.local"}),"\uff0c\u6211\u5011\u53ef\u4ee5\u901a\u904e ",(0,r.jsx)(n.code,{children:"nslookup"})," \u4f86\u9032\u884c\u67e5\u8a62\uff0c\u4e5f\u53ef\u4ee5\u5728 configmap \u4e2d\u4fee\u6539 DNS \u7684\u4f4d\u7f6e\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"ingress",children:"Ingress"}),"\n","\n","\n",(0,r.jsx)("img",{src:i,alt:"k8s-ingress",width:"100%",height:"auto"}),"\n",(0,r.jsx)(n.p,{children:"Ingress \u662f\u4e00\u500b API \u7269\u4ef6\uff0c\u5b83\u6703\u5c07\u5916\u90e8\u7684\u7db2\u8def\u6d41\u91cf\u5c0e\u5165\u5230 kubernetes \u7684\u96c6\u7fa4\u4e2d\uff0c\n\u4e26\u4e14\u5c07\u6d41\u91cf\u5c0e\u5165\u5230 Service \u4e2d\uff0c\u800c Service \u6703\u5c07\u6d41\u91cf\u5c0e\u5165\u5230 Pod \u4e2d\u3002"}),"\n",(0,r.jsx)(n.p,{children:"Ingress \u6709\u5169\u500b\u90e8\u5206:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ingress Resource: \u7528\u4f86\u5b9a\u7fa9\u6d41\u91cf\u5c0e\u5165\u7684\u898f\u5247 (routing rules)"}),"\n",(0,r.jsx)(n.li,{children:"Ingress Controller: \u7528\u4f86\u5be6\u73fe Ingress Resource \u7684\u898f\u5247\uff0c\u50cf\u662f nginx-ingress-controller"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u5011\u53ef\u4ee5\u4f7f\u7528 ",(0,r.jsx)(n.a,{href:"https://github.com/kubernetes/ingress-nginx/blob/main/docs/deploy/index.md",children:"ingress-nginx"})," \u4f86\u9032\u884c\u90e8\u7f72\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.8.2/deploy/static/provider/cloud/deploy.yaml\n"})}),"\n",(0,r.jsx)(n.h3,{id:"single-service",children:"Single Service"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl create deployment demo --image=httpd --port=80\nkubectl expose deployment demo\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: demo-localhost\n  namespace: default\nspec:\n  ingressClassName: nginx\n  rules:\n    - host: demo.localdev.me\n      http:\n        paths:\n          - backend:\n              service:\n                name: demo\n                port:\n                  number: 80\n            path: /\n            pathType: Prefix\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u5011\u5c31\u53ef\u4ee5\u76f4\u63a5\u900f\u904e ",(0,r.jsx)(n.code,{children:"demo.localdev.me"})," \u4f86\u9032\u884c\u5b58\u53d6\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl demo.localdev.me\n<html><body><h1>It works!</h1></body></html>\n"})}),"\n",(0,r.jsx)(n.h3,{id:"multiple-service-fanout",children:"Multiple Service (Fanout)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"k8s-ingress-fanout",src:s(6875).Z+"",width:"1850",height:"868"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl create deployment web1 --image=gcr.io/google-samples/hello-app:1.0 --port=8080 --replicas=2\nkubectl expose deployment web1 --port 9001 --target-port 8080\nkubectl create deployment web2 --image=gcr.io/google-samples/hello-app:2.0 --port=8080 --replicas=2\nkubectl expose deployment web2 --port 9002 --target-port 8080\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: ingress-multiple\nspec:\n  ingressClassName: nginx\n  rules:\n    - host: api.example.com\n      http:\n        paths:\n          - path: /v1\n            pathType: Prefix\n            backend:\n              service:\n                name: web1\n                port:\n                  number: 9001\n          - path: /v2\n            pathType: Prefix\n            backend:\n              service:\n                name: web2\n                port:\n                  number: 9002\n  defaultBackend:\n    service:\n      name: web1\n      port:\n        number: 9001\n"})}),"\n",(0,r.jsx)(n.h3,{id:"virtual-hosting",children:"Virtual Hosting"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"k8s-ingress-virtual-hosting",src:s(8486).Z+"",width:"1830",height:"886"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: ingress-multiple\nspec:\n  ingressClassName: nginx\n  rules:\n    - host: v1.api.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: web1\n                port:\n                  number: 9001\n    - host: v2.api.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: web2\n                port:\n                  number: 9002\n"})}),"\n",(0,r.jsx)(n.h3,{id:"tls",children:"TLS"}),"\n",(0,r.jsx)(n.p,{children:"\u9996\u5148\u8981\u751f\u6210\u8b49\u66f8"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj "/CN=api.example.com"\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u7522\u751f secret"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl create secret tls test-tls --key="tls.key" --cert="tls.crt"\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: ingress-https\nspec:\n  ingressClassName: nginx\n  tls:\n    - hosts:\n        - api.example.com\n      secretName: test-tls\n  rules:\n    - host: api.example.com\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: web1\n                port:\n                  number: 9001\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528 curl \u4f86\u9032\u884c\u6e2c\u8a66"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -k https://api.example.com --insecure\n"})}),"\n",(0,r.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/xiaopeng163/learn-k8s-from-scratch/blob/master/source/_static/pdf/k8s-network.pdf",children:"Kubernetes Network"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},9051:(e,n,s)=>{s.d(n,{Z:()=>r});const r=s.p+"assets/images/5-0511f45bcbe56fbe6b8c19c09946047c.webp"},6875:(e,n,s)=>{s.d(n,{Z:()=>r});const r=s.p+"assets/images/7-905e6fb3f3037f500571f3833eb10cf2.webp"},8486:(e,n,s)=>{s.d(n,{Z:()=>r});const r=s.p+"assets/images/8-e65f9ef05b4ec95e57b8dc786782c389.webp"},1151:(e,n,s)=>{s.d(n,{Z:()=>a,a:()=>l});var r=s(7294);const t={},i=r.createContext(t);function l(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);