"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4e3],{39004:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>t});const l=JSON.parse('{"id":"CMU15-445/p1","title":"P1 - Buffer Pool Manager","description":"Buffer Pool Manager","source":"@site/docs/CMU15-445/p1.mdx","sourceDirName":"CMU15-445","slug":"/CMU15-445/p1","permalink":"/RulerChen-Website/docs/CMU15-445/p1","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/p1.mdx","tags":[],"version":"current","lastUpdatedAt":1730367610000,"sidebarPosition":31,"frontMatter":{"title":"P1 - Buffer Pool Manager","sidebar_position":31,"description":"Buffer Pool Manager","keywords":["CMU15-445/645","Buffer Pool Manager","CMU15-445/645 \u7b46\u8a18"]},"sidebar":"tutorialSidebar","previous":{"title":"P0 - C++ Primer","permalink":"/RulerChen-Website/docs/CMU15-445/p0"},"next":{"title":"P2 - Hash Index","permalink":"/RulerChen-Website/docs/CMU15-445/p2"}}');var c=r(74848),s=r(28453);const i={title:"P1 - Buffer Pool Manager",sidebar_position:"31",description:"Buffer Pool Manager",keywords:["CMU15-445/645","Buffer Pool Manager","CMU15-445/645 \u7b46\u8a18"]},o=void 0,d={},t=[{value:"Problem Description",id:"problem-description",level:2},{value:"Solution",id:"solution",level:2},{value:"LRU-K Replacement Policy",id:"lru-k-replacement-policy",level:3},{value:"Disk Scheduler",id:"disk-scheduler",level:3},{value:"Buffer Pool Manager",id:"buffer-pool-manager",level:3},{value:"Reference",id:"reference",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components},{Head:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(r,{children:(0,c.jsx)("title",{children:"CMU 15-445/645 Project#1 Buffer Pool Manager"})}),"\n",(0,c.jsx)(n.h2,{id:"problem-description",children:"Problem Description"}),"\n",(0,c.jsx)(n.p,{children:"\u5728\u9019\u500b project \u4e2d\uff0c\u6211\u5011\u9700\u8981\u5be6\u73fe\u4e00\u500b buffer pool manager\uff0c\u7e3d\u5171\u6709 3 \u500b Task :"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["LRU-K Replacement Policy : \u4fee\u6539 ",(0,c.jsx)(n.code,{children:"/src/buffer/lru_k_replacer.cpp"})," \u4f86\u5be6\u73fe LRU-K replacement policy"]}),"\n",(0,c.jsxs)(n.li,{children:["Disk Scheduler : \u4fee\u6539 ",(0,c.jsx)(n.code,{children:"/src/storage/disk/disk_scheduler.cpp"})," \u4f86\u5be6\u73fe disk scheduler"]}),"\n",(0,c.jsxs)(n.li,{children:["Buffer Pool Manager : \u4fee\u6539 ",(0,c.jsx)(n.code,{children:"/src/buffer/buffer_pool_manager.cpp"})," \u4f86\u5be6\u73fe buffer pool manager"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"solution",children:"Solution"}),"\n",(0,c.jsx)(n.p,{children:"\u66ab\u6642\u6c92\u6709\u91dd\u5c0d leaderboard \u505a\u4efb\u4f55\u512a\u5316 (\u5e0c\u671b\u4ee5\u5f8c\u6709\u6642\u9593...)\uff0c\u5982\u679c\u60f3\u8981\u9032\u884c\u6548\u80fd\u512a\u5316\uff0c\u53ef\u4ee5\u53c3\u8003\u6700\u4e0b\u65b9 Reference \u4e2d\u7684\u6587\u7ae0\u3002"}),"\n",(0,c.jsxs)(n.p,{children:["\u5728\u57f7\u884c\u6e2c\u8a66\u524d\uff0c\u9700\u8981\u628a\u6e2c\u8a66\u4e2d\u7684 ",(0,c.jsx)(n.code,{children:"DISABLED_"})," \u62ff\u6389\u518d\u57f7\u884c\u3002"]}),"\n",(0,c.jsx)(n.h3,{id:"lru-k-replacement-policy",children:"LRU-K Replacement Policy"}),"\n",(0,c.jsxs)(n.p,{children:["\u53ea\u9700\u8981\u5168\u90e8\u90fd\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"std::scoped_lock"})," \u5373\u53ef\uff0c\u9806\u4fbf\u91dd\u5c0d ",(0,c.jsx)(n.code,{children:"LRUKNode"})," \u5beb\u4e00\u4e9b get function \u4f86\u65b9\u4fbf\u53d6\u5f97\u8cc7\u6599\u3002"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"Evict"})," : \u512a\u5148\u5ea6\u662f\u5148\u627e\u6709 inf \u7684\uff0c\u90fd\u662f inf \u5c31\u6bd4\u7b2c\u4e00\u6b21\u8b80\u53d6\u7684\u6642\u5019\u54ea\u500b\u6700\u65e9\uff0c\u5982\u679c\u90fd\u6c92\u6709 inf \u7684\u8a71\u5c31\u4e5f\u627e\u7b2c\u4e00\u6b21\u8b80\u53d6\u7684\u6642\u5019\u54ea\u500b\u6700\u65e9 (",(0,c.jsx)(n.code,{children:"this->history_.back()"}),")"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"RecordAccess"})," : \u66f4\u65b0 ",(0,c.jsx)(n.code,{children:"history_"})," \u4e2d\u7684\u8cc7\u6599"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"Remove"})," : \u76f4\u63a5\u522a\u9664\u4e26\u6ce8\u610f\u62cb\u51fa\u932f\u8aa4"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"SetEvictable"})," : \u5224\u65b7\u73fe\u5728\u7684\u60c5\u6cc1\u4e26\u66f4\u6539\u72c0\u614b"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"Size"})," : \u76f4\u63a5\u56de\u50b3 ",(0,c.jsx)(n.code,{children:"curr_size_"})]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cd build\nmake lru_k_replacer_test -j$(nproc)\n\n./test/lru_k_replacer_test\n"})}),"\n",(0,c.jsx)(n.h3,{id:"disk-scheduler",children:"Disk Scheduler"}),"\n",(0,c.jsx)(n.p,{children:"\u9700\u8981\u4fee\u6539\u5169\u500b function :"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"Schedule"})," : \u53ea\u9700\u8981\u5c07 r \u4e1f\u5230 ",(0,c.jsx)(n.code,{children:"request_queue_"})," \u4e2d\u5373\u53ef"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"StartWorkerThread"})," : \u8a2d\u8a08\u4e00\u500b while \u8ff4\u5708\uff0c\u4e26\u5c07 request \u4f9d\u64da read / write \u7684\u60c5\u6cc1\u4f86\u57f7\u884c"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cd build\nmake disk_scheduler_test -j$(nproc)\n\n./test/disk_scheduler_test\n"})}),"\n",(0,c.jsx)(n.h3,{id:"buffer-pool-manager",children:"Buffer Pool Manager"}),"\n",(0,c.jsxs)(n.p,{children:["\u4e00\u6a23\u4e5f\u662f\u6bcf\u500b function \u90fd\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"std::scoped_lock"})," \u9396\u4f4f\uff0c\u9700\u8981\u7279\u5225\u6ce8\u610f\u5982\u679c\u8981\u5728\u5982 NewPage \u7684 function \u88e1\u9762\u4f7f\u7528 FlushPage \u7684\u8a71\uff0c\u8981\u6ce8\u610f\u4e0d\u8981\u9020\u6210 deadlock\u3002"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"FetchPage"})," : \u5148\u5224\u65b7\u6709\u6c92\u6709\u5728 buffer pool \u4e2d\uff0c\u5982\u679c\u6709\u7684\u8a71\u5c31\u76f4\u63a5\u56de\u50b3\uff0c\u6c92\u6709\u7684\u8a71\u5c31\u8981\u7528\u8ddf NewPage \u4e00\u6a23\u7684\u65b9\u5f0f\u4f86\u627e\u4e00\u500b\u4f4d\u7f6e\uff0c\u4e26\u4e14\u5c07\u8cc7\u6599\u8b80\u9032\u4f86\uff0c\u7279\u5225\u6ce8\u610f\u4fee\u6539\u5982 ",(0,c.jsx)(n.code,{children:"pin_count_"})," \u7b49\u8cc7\u6599"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"UnpinPage"})," : \u8655\u7406 ",(0,c.jsx)(n.code,{children:"pin_count_"})," \u70ba 0 \u7684\u60c5\u6cc1\u4ee5\u53ca ",(0,c.jsx)(n.code,{children:"is_dirty_"})," \u7684\u60c5\u6cc1"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"FlushPage"})," : \u5c07\u8cc7\u6599\u5beb\u56de disk\uff0c\u9700\u8981\u7279\u5225\u6ce8\u610f\u9396\u7684\u554f\u984c\uff0c\u6211\u7684\u4f5c\u6cd5\u662f\u5beb\u5169\u500b function\uff0c\u4e00\u500b\u6709\u9396\u4e00\u500b\u6c92\u6709\u9396\uff0c\u5982\u679c\u5176\u4ed6\u6709\u9396\u7684 function \u8981\u547c\u53eb\u7684\u8a71\u5c31\u4f7f\u7528\u6c92\u6709\u9396\u7684 function"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"NewPage"})," : \u5148\u6aa2\u67e5 ",(0,c.jsx)(n.code,{children:"free_list_"})," \u6709\u6c92\u6709\u7a7a\u9593\uff0c\u5982\u679c\u6709\u7684\u8a71\u5c31\u76f4\u63a5\u4f7f\u7528\uff0c\u6c92\u6709\u7684\u8a71\u5c31\u8981\u5f9e ",(0,c.jsx)(n.code,{children:"lru_k_replacer"})," \u4e2d\u6392\u9664\u4e00\u500b\u8cc7\u6599\u4e26\u5beb\u5165"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"DeletePage"})," : \u522a\u9664\u8cc7\u6599\uff0c\u9700\u8981\u7279\u5225\u6ce8\u610f\u4e00\u4e9b metadata \u7684\u66f4\u65b0"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"FlushAllPages"})," : \u905e\u8ff4\u7684 call \u6c92\u6709\u9396\u7684 ",(0,c.jsx)(n.code,{children:"FlushPage"})," function \u5373\u53ef"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cd build\nmake buffer_pool_manager_test -j$(nproc)\n\n./test/buffer_pool_manager_test\n"})}),"\n",(0,c.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"https://4ever-xxxl.github.io/cmu-15445-project-1/",children:"CMU 15445 Project 1"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"https://www.aneureka.com/posts/cmu-15445-p1-opt",children:"CMU 15-445 2023 P1 \u4f18\u5316\u653b\u7565"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(a,{...e})}):a(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var l=r(96540);const c={},s=l.createContext(c);function i(e){const n=l.useContext(s);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);