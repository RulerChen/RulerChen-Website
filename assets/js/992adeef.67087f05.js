"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["9073"],{50263:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>a,default:()=>u,toc:()=>o,metadata:()=>r,assets:()=>d,contentTitle:()=>l});var r=JSON.parse('{"id":"C++/move","title":"[C++] \u79FB\u52D5\u8A9E\u610F (Move Semantics)","description":"C++ \u79FB\u52D5\u8A9E\u7FA9","source":"@site/docs/C++/move.mdx","sourceDirName":"C++","slug":"/C++/move","permalink":"/RulerChen-Website/docs/C++/move","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/C++/move.mdx","tags":[],"version":"current","lastUpdatedAt":1730087164000,"sidebarPosition":100,"frontMatter":{"title":"[C++] \u79FB\u52D5\u8A9E\u610F (Move Semantics)","sidebar_position":100,"description":"C++ \u79FB\u52D5\u8A9E\u7FA9","keywords":["C++","\u79FB\u52D5\u8A9E\u7FA9","Move Semantics"]},"sidebar":"tutorialSidebar","previous":{"title":"[C++] \u667A\u6167\u6307\u6A19 (Smart Pointer)","permalink":"/RulerChen-Website/docs/C++/smartpointer"},"next":{"title":"[C++] \u540C\u6B65\u539F\u8A9E (Synchronize Primitive)","permalink":"/RulerChen-Website/docs/C++/synchronize"}}'),s=t(85893),i=t(50065);let a={title:"[C++] \u79FB\u52D5\u8A9E\u610F (Move Semantics)",sidebar_position:"100",description:"C++ \u79FB\u52D5\u8A9E\u7FA9",keywords:["C++","\u79FB\u52D5\u8A9E\u7FA9","Move Semantics"]},l=void 0,d={},o=[{value:"\u5DE6\u503C\u548C\u53F3\u503C",id:"\u5DE6\u503C\u548C\u53F3\u503C",level:2},{value:"\u5DE6\u503C\u5F15\u7528\u548C\u53F3\u503C\u5F15\u7528",id:"\u5DE6\u503C\u5F15\u7528\u548C\u53F3\u503C\u5F15\u7528",level:2},{value:"\u79FB\u52D5\u8A9E\u610F",id:"\u79FB\u52D5\u8A9E\u610F",level:2},{value:"\u53C3\u8003\u6587\u7AE0",id:"\u53C3\u8003\u6587\u7AE0",level:2}];function c(e){let n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"\u672C\u6587\u6703\u8B1B\u89E3 C++ \u4E2D\u79FB\u52D5\u8A9E\u7FA9 (move semantics) \u4EE5\u53CA\u5DE6\u503C (lvalue) \u548C\u53F3\u503C (rvalue) \u7684\u57FA\u672C\u6982\u5FF5\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u53F3\u503C\u5F15\u7528\u662F\u5728 C++11 \u5F15\u5165\u7684\u65B0\u7279\u6027\uFF0C\u5B83\u7684\u5F15\u5165\u89E3\u6C7A\u4E86 C++ \u4E2D\u5927\u91CF\u7684\u6B77\u53F2\u907A\u7559\u554F\u984C\uFF0C\u50CF\u662F\u5C0D\u81E8\u6642\u7269\u4EF6\u7684\u62F7\u8C9D\u9020\u6210\u7684\u6548\u80FD\u554F\u984C\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u5DE6\u503C\u548C\u53F3\u503C",children:"\u5DE6\u503C\u548C\u53F3\u503C"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u4E86\u89E3\u9019\u500B\u5F37\u5927\u529F\u80FD\u4E4B\u524D\uFF0C\u6211\u5011\u9700\u8981\u5148\u4E86\u89E3\u5DE6\u503C\u548C\u53F3\u503C\u7684\u6982\u5FF5 :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5DE6\u503C (lvalue\u3001left value)"}),": \u8868\u9054\u5F0F\u7D50\u675F\u5F8C\u4F9D\u7136\u5B58\u5728\u7684\u5C0D\u8C61\uFF0C\u901A\u5E38\u5728\u7B49\u865F\u5DE6\u908A\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u53F3\u503C (rvalue\u3001right value)"}),": \u8868\u9054\u5F0F\u7D50\u675F\u5F8C\u5C31\u6703\u88AB\u92B7\u6BC0\u7684\u81E8\u6642\u5C0D\u8C61\uFF0C\u901A\u5E38\u5728\u7B49\u865F\u53F3\u908A\uFF0C\u5305\u542B\u7D14\u53F3\u503C (prvalue) \u8DDF\u5C07\u4EA1\u503C (xvalue)\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u800C\u70BA\u4E86\u5BE6\u73FE\u53F3\u503C\u5F15\u7528\uFF0CC++11 \u505A\u4E86\u66F4\u7CBE\u78BA\u7684\u5B9A\u7FA9 :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u6CDB\u5DE6\u503C (glvalue\u3001generalized lvalue)"}),": \u5305\u542B lvalue \u8DDF xvalue \uFF0C\u4EE3\u8868\u6240\u6709\u53EF\u4EE5\u88AB\u53D6\u5740\u7684\u5C0D\u8C61\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u7D14\u53F3\u503C (prvalue\u3001pure rvalue)"}),": \u7D14\u7CB9\u7684\u81E8\u6642\u5C0D\u8C61\uFF0C\u50CF\u662F ",(0,s.jsx)(n.code,{children:"int a = 42;"})," \u4E2D\u7684 ",(0,s.jsx)(n.code,{children:"42"}),"\uFF0C\u4F46 string \u5247\u70BA\u5DE6\u503C\uFF0C\u50CF\u662F ",(0,s.jsx)(n.code,{children:'const char* str = "Hello";'}),"\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u5C07\u4EA1\u503C (xvalue\u3001expiring value)"}),": \u5373\u5C07\u88AB\u92B7\u6BC0\u7684\u5C0D\u8C61\u537B\u80FD\u88AB\u79FB\u52D5\u7684\u503C\uFF0C\u8209\u4F8B\u5982\u4E0B :"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"std::vector<int> foo() {\n    std::vector<int> temp = {1, 2, 3};\n    return v;\n}\n\nstd::vector<int> v = foo();\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u4E0A\u9762\u7684\u4F8B\u5B50\u4E2D\uFF0Ctemp \u6703\u88AB\u5275\u5EFA\u7136\u5F8C\u50B3\u7D66 v \u518D\u88AB\u92B7\u6BC0\uFF0C\u9019\u500B\u904E\u7A0B\u4E2D ",(0,s.jsx)(n.code,{children:"foo()"})," \u8FD4\u56DE\u7684\u662F\u4E00\u500B\u5C07\u4EA1\u503C\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u7576 temp \u4E2D\u7684\u8CC7\u6599\u5F88\u5927\u6642\uFF0C\u9019\u6A23\u7684\u62F7\u8C9D\u64CD\u4F5C\u6703\u5C0E\u81F4\u6548\u80FD\u554F\u984C\uFF0C\u56E0\u6B64\u5728 C++11 \u4E4B\u5F8C\uFF0C\u7DE8\u8B6F\u5668\u5C31\u6703\u5E6B\u6211\u5011\u505A\u96B1\u6027\u8F49\u63DB\uFF0C\u76F8\u7576\u65BC ",(0,s.jsx)(n.code,{children:"static_cast<std::vector<int>&&>(temp)"}),"\uFF0C\u4E5F\u5C31\u662F\u6211\u5011\u4E4B\u5F8C\u6703\u63D0\u53CA\u7684\u79FB\u52D5\u8A9E\u610F\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"\u5DE6\u503C\u5F15\u7528\u548C\u53F3\u503C\u5F15\u7528",children:"\u5DE6\u503C\u5F15\u7528\u548C\u53F3\u503C\u5F15\u7528"}),"\n",(0,s.jsxs)(n.p,{children:["\u8981\u62FF\u5230\u4E00\u500B\u5C07\u4EA1\u503C\uFF0C\u6211\u5011\u5C31\u9700\u8981\u7528\u5230\u53F3\u503C\u5F15\u7528\uFF0C\u5B83\u7684\u8A9E\u6CD5\u662F ",(0,s.jsx)(n.code,{children:"T&&"}),"\uFF0C\u5176\u4E2D T \u662F\u4E00\u500B\u578B\u5225\uFF0C\u53F3\u503C\u5F15\u7528\u53EF\u4EE5\u8B93\u9019\u500B\u5C07\u4EA1\u503C\u7684\u751F\u547D\u9031\u671F\u5EF6\u9577\uFF0C\u53EA\u8981\u9019\u500B\u53F3\u503C\u5F15\u7528\u9084\u5728\u4F5C\u7528\u57DF\u5167\uFF0C\u9019\u500B\u5C07\u4EA1\u503C\u5C31\u4E0D\u6703\u88AB\u92B7\u6BC0\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["C++ \u63D0\u4F9B\u7684 ",(0,s.jsx)(n.code,{children:"std::move"})," \u53EF\u4EE5\u8B93\u6211\u5011\u5C07\u5DE6\u503C\u8F49\u63DB\u70BA\u53F3\u503C\uFF0C\u65B9\u4FBF\u9032\u884C\u53F3\u503C\u5F15\u7528\u7684\u64CD\u4F5C\uFF0C\u4F8B\u5982 :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:'#include <iostream>\n#include <utility>\n#include <vector>\n\nint main() {\n    std::vector<int> int_array = {1, 2, 3, 4};\n    std::vector<int> stealing_ints = std::move(int_array);\n    std::vector<int> &&rvalue_stealing_ints = std::move(stealing_ints);\n\n    // std::cout << "Printing from int_array: " << int_array[1] << std::endl; // int_array has been moved from\n    std::cout << "Printing from stealing_ints: " << stealing_ints[1] << std::endl;\n    std::cout << "Printing from rvalue_stealing_ints: " << rvalue_stealing_ints[1] << std::endl;\n\n    return 0;\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u79FB\u52D5\u8A9E\u610F",children:"\u79FB\u52D5\u8A9E\u610F"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u50B3\u7D71\u7684 C++ \u4E2D\u4E26\u6C92\u6709\u79FB\u52D5\u8A9E\u610F\uFF0C\u7576\u6211\u5011\u5C0D\u4E00\u500B\u53F3\u503C\u9032\u884C\u62F7\u8C9D\u6642\uFF0C\u5BE6\u969B\u4E0A\u662F\u5728\u505A\u4E00\u6B21\u6DF1\u62F7\u8C9D\uFF0C\u9019\u6A23\u7684\u64CD\u4F5C\u6703\u5C0E\u81F4\u6548\u80FD\u554F\u984C\u3002\n\u5982\u679C\u4F7F\u7528\u53C3\u8003\u7684\u8A71\uFF0C\u539F\u59CB\u7269\u4EF6\u7684\u6240\u6709\u6B0A\u5C31\u4E0D\u6703\u88AB\u8F49\u79FB\uFF0C\u4E14\u5982\u679C buffer1 \u8DDF buffer2 \u90FD\u6307\u5411\u76F8\u540C\u7684\u8CC7\u6599\u7684\u8A71\uFF0C\u53EF\u80FD\u5C0E\u81F4 double deletion \u7684\u554F\u984C\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u53EF\u4EE5\u900F\u904E\u4EE5\u4E0B\u7684\u4F8B\u5B50\u4F86\u4E86\u89E3\u79FB\u52D5\u8A9E\u610F\u7684\u6982\u5FF5\u548C\u7528\u9014 :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:'#include <iostream>\n#include <string>\n#include <utility>\n\nclass Buffer {\nprivate:\n    std::string data;\n\npublic:\n    Buffer() {\n        std::cout << "Default-constructed Buffer\\n";\n    }\n    Buffer(const std::string& init_data) : data(init_data) {\n        std::cout << "Constructed with data: " << data << "\\n";\n    }\n    Buffer(Buffer&& other) : data(std::move(other.data)) {\n        std::cout << "Moved from another Buffer\\n";\n    }\n    Buffer& operator=(Buffer&& other) {\n        if (this != &other) {\n            data = std::move(other.data);\n            std::cout << "Move-assigned from another Buffer\\n";\n        }\n        return *this;\n    }\n\n    // Delete the copy constructor and copy assignment operator\n    Buffer(const Buffer&) = delete;\n    Buffer& operator=(const Buffer&) = delete;\n\n    void print() const {\n        std::cout << "Buffer data: " << data << std::endl;\n    }\n};\n\nint main() {\n    Buffer buffer1("This is some large data");\n    buffer1.print();\n\n    Buffer buffer2;\n    buffer2 = std::move(buffer1);\n    buffer1.print();\n    buffer2.print();\n\n    Buffer buffer3 = std::move(buffer2);\n    buffer2.print();\n    buffer3.print();\n\n    // Buffer buffer4;\n    // buffer4 = buffer3; // Error: copy assignment operator is deleted\n\n    // Buffer buffer5(buffer3); // Error: copy constructor is deleted\n\n    return 0;\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u5B83\u7684\u8F38\u51FA\u5982\u4E0B :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Constructed with data: This is some large data\nBuffer data: This is some large data\nDefault-constructed Buffer\nMove-assigned from another Buffer\nBuffer data:\nBuffer data: This is some large data\nMoved from another Buffer\nBuffer data:\nBuffer data: This is some large data\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u9019\u500B\u7BC4\u4F8B\u4E2D\uFF0C\u5982\u679C\u6211\u5011\u4F7F\u7528\u985E\u4F3C buffer4 \u6216 buffer5 \u7684\u65B9\u5F0F\u4F86\u9032\u884C\u62F7\u8C9D\uFF0C\u6211\u5011\u5C31\u9700\u8981\u5C0D buffer3 \u7684\u6240\u6709\u8CC7\u6599\u9032\u884C deep copy \u5F9E\u800C\u5C0E\u81F4\u6548\u80FD\u554F\u984C\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u53C3\u8003\u6587\u7AE0",children:"\u53C3\u8003\u6587\u7AE0"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://stackoverflow.com/questions/3601602/what-are-rvalues-lvalues-xvalues-glvalues-and-prvalues",children:"What are rvalues, lvalues, xvalues, glvalues, and prvalues?"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://changkun.de/modern-cpp/zh-cn/03-runtime/#3-3-%E5%8F%B3%E5%80%BC%E5%BC%95%E7%94%A8",children:"Modern C++ Tutorial"})}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},50065:function(e,n,t){t.d(n,{Z:()=>l,a:()=>a});var r=t(67294);let s={},i=r.createContext(s);function a(e){let n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);