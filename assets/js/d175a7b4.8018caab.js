"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2028],{4005:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>t});const l=JSON.parse('{"id":"CMU15-445/c21","title":"Database Recovery","description":"CMU15-445/645 Database Recovery","source":"@site/docs/CMU15-445/c21.mdx","sourceDirName":"CMU15-445","slug":"/CMU15-445/c21","permalink":"/RulerChen-Website/docs/CMU15-445/c21","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/c21.mdx","tags":[{"inline":true,"label":"CMU15-445","permalink":"/RulerChen-Website/docs/tags/cmu-15-445"}],"version":"current","lastUpdatedAt":1757907567000,"sidebarPosition":21,"frontMatter":{"title":"Database Recovery","sidebar_position":21,"description":"CMU15-445/645 Database Recovery","keywords":["CMU15-445/645","Database Recovery","CMU15-445/645 \u7b46\u8a18"],"tags":["CMU15-445"]},"sidebar":"tutorialSidebar","previous":{"title":"Database Logging","permalink":"/RulerChen-Website/docs/CMU15-445/c20"},"next":{"title":"Introduction to Distributed Databases","permalink":"/RulerChen-Website/docs/CMU15-445/c22"}}');var s=i(4848),c=i(8453);const r={title:"Database Recovery",sidebar_position:"21",description:"CMU15-445/645 Database Recovery",keywords:["CMU15-445/645","Database Recovery","CMU15-445/645 \u7b46\u8a18"],tags:["CMU15-445"]},o=void 0,d={},t=[{value:"ARIES",id:"aries",level:2},{value:"Log Sequence Numbers",id:"log-sequence-numbers",level:2},{value:"Normal Execution",id:"normal-execution",level:2},{value:"Transaction Commit",id:"transaction-commit",level:3},{value:"Transaction Abort",id:"transaction-abort",level:3},{value:"Compensation Log Record",id:"compensation-log-record",level:3},{value:"Checkpoint",id:"checkpoint",level:2},{value:"Non-Fuzzy Checkpoint",id:"non-fuzzy-checkpoint",level:3},{value:"Slightly Better Checkpoints",id:"slightly-better-checkpoints",level:3},{value:"Fuzzy Checkpoint",id:"fuzzy-checkpoint",level:3},{value:"ARIES Recovery",id:"aries-recovery",level:2},{value:"Analysis Phase",id:"analysis-phase",level:3},{value:"Redo Phase",id:"redo-phase",level:3},{value:"Undo Phase",id:"undo-phase",level:3},{value:"Additional Topics",id:"additional-topics",level:2}];function a(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",ul:"ul",...(0,c.R)(),...e.components},{Head:i,ImageModal:l}=n;return i||x("Head",!0),l||x("ImageModal",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i,{children:(0,s.jsx)("title",{children:"CMU 15-445 Database Recovery"})}),"\n",(0,s.jsx)(n.p,{children:"\u672c\u7bc7\u4e3b\u8981\u5ef6\u7e8c\u4e0a\u4e00\u7bc0\u7684\u5167\u5bb9\uff0c\u8a0e\u8ad6\u6545\u969c\u767c\u751f\u5f8c\uff0c\u8981\u5982\u4f55\u6062\u5fa9\u8cc7\u6599\u5eab\u7684\u72c0\u614b\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"aries",children:"ARIES"}),"\n",(0,s.jsx)(n.p,{children:"ARIES (Algorithms for Recovery and Isolation Exploiting Semantics) \u662f IBM \u5728 1990 \u5e74\u4ee3\u521d\u671f\u70ba DB2 \u7cfb\u7d71\u958b\u767c\u7684\u4e00\u7a2e\u6062\u5fa9\u6f14\u7b97\u6cd5\uff0c\u5118\u7ba1\u4e0d\u662f\u6bcf\u500b DBMS \u90fd\u56b4\u683c\u4f9d\u7167 ARIES \u7684\u898f\u7bc4\u5be6\u73fe\uff0c\u4f46 ARIES \u7684\u57fa\u672c\u601d\u60f3\u548c\u8a31\u591a\u6280\u8853\u7d30\u7bc0\u4ecd\u7136\u88ab\u5ee3\u6cdb\u4f7f\u7528\u3002"}),"\n",(0,s.jsx)(n.p,{children:"ARIES \u6709\u4e09\u500b\u95dc\u9375\u6982\u5ff5 :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"WAL : \u5728\u8cc7\u6599\u5eab\u5be6\u969b\u5beb\u5165\u8b8a\u66f4\u4e4b\u524d\uff0c\u5148\u5c07\u6240\u6709\u8b8a\u66f4\u8a18\u9304\u5230\u7a69\u5b9a\u7684\u5b58\u5132\u4e2d\uff0c\u5fc5\u9808\u4f7f\u7528 steal / no-force"}),"\n",(0,s.jsx)(n.li,{children:"Repeating History During Redo : \u5728\u7cfb\u7d71\u91cd\u65b0\u555f\u52d5\u6642\uff0c\u91cd\u6f14\u5d29\u6f70\u524d\u7684\u6240\u6709\u64cd\u4f5c\uff0c\u5c07\u8cc7\u6599\u5eab\u6062\u5fa9\u5230\u5d29\u6f70\u524d\u7684\u78ba\u5207\u72c0\u614b"}),"\n",(0,s.jsx)(n.li,{children:"Logging Changes During Undo : \u5728\u9032\u884c undo \u64cd\u4f5c\u6642\uff0c\u5c07\u9019\u4e9b\u64a4\u92b7\u64cd\u4f5c\u8a18\u9304\u5230\u65e5\u8a8c\u4e2d\u3002\u5982\u679c\u5728 undo \u671f\u9593\u767c\u751f\u518d\u6b21\u5d29\u6f70\uff0c\u7cfb\u7d71\u53ef\u4ee5\u78ba\u4fdd\u9019\u4e9b\u64a4\u92b7\u64cd\u4f5c\u4e0d\u6703\u88ab\u91cd\u8907\u57f7\u884c"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"log-sequence-numbers",children:"Log Sequence Numbers"}),"\n",(0,s.jsx)(n.p,{children:"WAL \u4e2d\u7684\u6bcf\u689d\u7d00\u9304\u90fd\u9700\u8981\u5305\u542b\u4e00\u500b\u552f\u4e00\u7684\u5e8f\u5217\u865f\uff0c\u7a31\u70ba LSN (Log Sequence Number)\uff0c\u5404\u500b\u5143\u4ef6\u90fd\u9700\u8981\u7d00\u9304\u5c6c\u65bc\u4ed6\u5011\u7684 LSN\u3002"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"LSN : \u5168\u5c40\u552f\u4e00\u7684\u5e8f\u5217\u865f\uff0c\u7528\u4f86\u6a19\u8b58\u6bcf\u500b\u65e5\u8a8c\u8a18\u9304\uff0c\u6bcf\u6b21\u65e5\u8a8c\u5beb\u5165\u6642\uff0cLSN \u6703\u905e\u589e"}),"\n",(0,s.jsx)(n.li,{children:"flushedLSN : \u8868\u793a\u5df2\u7d93\u5beb\u5165\u5230\u786c\u789f\u7684\u6700\u5f8c\u4e00\u689d\u65e5\u8a8c\u7684 LSN"}),"\n",(0,s.jsx)(n.li,{children:"pageLSN : \u8868\u793a\u8a72\u9801\u9762\u4e0a\u6700\u5f8c\u4e00\u6b21\u4fee\u6539\u7684\u65e5\u8a8c\u7684 LSN"}),"\n",(0,s.jsx)(n.li,{children:"recLSN : \u81ea\u9801\u9762\u4e0a\u6b21\u88ab\u5beb\u5165\u786c\u789f\u5f8c\uff0c\u6700\u65e9\u7684\u4e00\u6b21\u66f4\u65b0\u64cd\u4f5c\u7684 LSN"}),"\n",(0,s.jsx)(n.li,{children:"lastLSN : \u67d0\u500b\u4ea4\u6613\u6700\u5f8c\u4e00\u6b21\u5beb\u5165\u65e5\u8a8c\u7684 LSN"}),"\n",(0,s.jsx)(n.li,{children:"MasterRecord : \u6700\u8fd1\u4e00\u6b21 checkpoint \u7684 LSN"}),"\n"]}),"\n",(0,s.jsx)(l,{src:"/img/cmu15-445/c21/image.webp",caption:"Log Record Types"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u9801\u9762\u5beb\u5165\u786c\u789f\u524d\uff0cDBMS \u6703\u78ba\u4fdd\u8a72\u9801\u9762\u7684 pageLSN \u5c0f\u65bc\u7b49\u65bc flushedLSN\uff0c\u9019\u6a23\u53ef\u4ee5\u4fdd\u8b49\u65e5\u8a8c\u8a18\u9304\u5df2\u7d93\u5b89\u5168\u5730\u8a18\u9304\u5728\u786c\u789f\u4e0a\u3002"}),"\n",(0,s.jsx)(l,{src:"/img/cmu15-445/c21/image-1.webp",caption:"Log Record Example"}),"\n",(0,s.jsx)(n.h2,{id:"normal-execution",children:"Normal Execution"}),"\n",(0,s.jsx)(n.p,{children:"\u5927\u90e8\u5206\u7684\u4ea4\u6613\u90fd\u6703\u5305\u62ec\u4e00\u7cfb\u5217\u7684\u8b80\u5beb\u64cd\u4f5c\uff0c\u7136\u5f8c commit \u6216\u662f abort\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u9019\u88e1\u6211\u5011\u5148\u4f86\u8a0e\u8ad6\u5047\u5982\u6c92\u6709\u767c\u751f\u6545\u969c\uff0c\u4ea4\u6613\u662f\u5982\u4f55\u57f7\u884c\u7684\uff0c\u6211\u5011\u6703\u6709\u56db\u500b\u5047\u8a2d\u4f86\u7c21\u5316\u8a0e\u8ad6 :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u6240\u6709\u7684 log file \u90fd\u80fd\u653e\u9032\u4e00\u500b page \u4e2d"}),"\n",(0,s.jsx)(n.li,{children:"\u5beb\u5165\u786c\u789f\u662f\u539f\u5b50\u6027\u7684"}),"\n",(0,s.jsx)(n.li,{children:"\u4f7f\u7528 SS2PL \u4e14\u4e0d\u4f7f\u7528 MVCC"}),"\n",(0,s.jsx)(n.li,{children:"\u4f7f\u7528 WAL\uff0c\u4e14\u662f steal / no-force \u7b56\u7565"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"transaction-commit",children:"Transaction Commit"}),"\n",(0,s.jsx)(n.p,{children:"\u57f7\u884c commit \u7684\u9806\u5e8f\u5982\u4e0b :"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u5c07 COMMIT \u5beb\u5165 WAL buffer"}),"\n",(0,s.jsx)(n.li,{children:"\u5c07 WAL buffer \u5beb\u5165\u786c\u789f"}),"\n",(0,s.jsx)(n.li,{children:"\u4fee\u6539 flushedLSN \u70ba COMMIT \u7684 LSN"}),"\n",(0,s.jsx)(n.li,{children:"\u5beb\u5165\u4e00\u500b TXN-END \u544a\u8a34\u7cfb\u7d71\u8a72\u4ea4\u6613\u5df2\u7d93\u7d50\u675f (\u5305\u62ec\u91cb\u653e\u9396\u8ddf\u6e05\u9664 ATT)\uff0c\u9019\u500b\u64cd\u4f5c\u4e0d\u9700\u8981\u7acb\u5373\u5beb\u5165\u786c\u789f"}),"\n"]}),"\n",(0,s.jsx)(l,{src:"/img/cmu15-445/c21/image-9.webp",caption:"Transaction Commit"}),"\n",(0,s.jsx)(n.h3,{id:"transaction-abort",children:"Transaction Abort"}),"\n",(0,s.jsx)(n.p,{children:"\u8981\u8655\u7406 abort \u7684\u60c5\u6cc1\uff0c\u6211\u5011\u5c31\u5fc5\u9808\u627e\u5230\u8207\u8a72\u4ea4\u6613\u6709\u95dc\u7684\u6240\u6709\u65e5\u8a8c\u8a18\u9304\u4ee5\u53ca\u57f7\u884c\u9806\u5e8f\uff0c\u70ba\u4e86\u63d0\u9ad8\u6548\u7387\uff0c\u540c\u4e00\u500b\u4ea4\u6613\u4e2d\u7684\u6bcf\u500b log \u90fd\u6703\u7d00\u9304\u4e0a\u4e00\u500b log \u7684 LSN\uff0c\u5373 prevLSN\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u57f7\u884c abort \u7684\u9806\u5e8f\u5982\u4e0b :"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u5c07 ABORT \u5beb\u5165 WAL buffer"}),"\n",(0,s.jsxs)(n.li,{children:["\u6309\u7167\u683c\u5f0f\u70ba ",(0,s.jsx)(n.code,{children:"LSN | prevLSN"})," \u7684 linked list\uff0c\u5012\u5e8f\u56de\u6efe\u6240\u6709\u7684 log"]}),"\n",(0,s.jsx)(n.li,{children:"\u70ba\u4e86\u9632\u6b62\u56de\u6efe\u518d\u6b21\u6545\u969c\uff0c\u9700\u8981\u5c07\u56de\u6efe\u7684 log \u5beb\u5165 WAL"}),"\n",(0,s.jsx)(n.li,{children:"\u56de\u6efe\u5b8c\u4e4b\u5f8c\uff0c\u5beb\u5165 TXN-END \u7d00\u9304"}),"\n"]}),"\n",(0,s.jsx)(l,{src:"/img/cmu15-445/c21/image-3.webp",caption:"Transaction Abort"}),"\n",(0,s.jsx)(n.h3,{id:"compensation-log-record",children:"Compensation Log Record"}),"\n",(0,s.jsx)(n.p,{children:"Compensation Log Record (CLR) \u662f\u4e00\u7a2e\u63cf\u8ff0\u64a4\u92b7\u524d\u4e00\u6b21\u66f4\u65b0\u64cd\u4f5c\u7684\u65e5\u8a8c\u8a18\u9304\u3002\n\u5b83\u5305\u542b\u66f4\u65b0\u65e5\u8a8c\u8a18\u9304\u7684\u6240\u6709\u5b57\u6bb5\uff0c\u4e26\u984d\u5916\u5305\u542b\u4e00\u500b UndoNextLSN \u6307\u6a19\uff0c\u6307\u5411\u4e0b\u4e00\u500b\u9700\u8981\u64a4\u92b7\u7684 LSN\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cCLR \u4e0d\u9700\u8981\u88ab undo\uff0c\u56e0\u70ba\u5b83\u5011\u672c\u8cea\u4e0a\u662f\u5c0d\u5148\u524d\u64cd\u4f5c\u7684\u88dc\u511f\u3002"}),"\n",(0,s.jsx)(l,{src:"/img/cmu15-445/c21/image-10.webp",caption:"Compensation Log Record"}),"\n",(0,s.jsx)(n.h2,{id:"checkpoint",children:"Checkpoint"}),"\n",(0,s.jsx)(n.p,{children:"\u5728 DBMS \u4e2d\uff0ccheckpoint \u53ef\u4ee5\u7528\u65bc\u6e1b\u5c11\u7cfb\u7d71\u5d29\u6f70\u5f8c\u9700\u8981\u56de\u653e\u7684\u65e5\u8a8c\u91cf\uff0c\u4ee5\u52a0\u901f\u6062\u5fa9\u904e\u7a0b\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"non-fuzzy-checkpoint",children:"Non-Fuzzy Checkpoint"}),"\n",(0,s.jsx)(n.p,{children:"\u5728 non-fuzzy checkpoint \u4e2d\uff0cDBMS \u6703\u66ab\u505c\u6240\u6709\u4ea4\u6613\u7684\u57f7\u884c\uff0c\u4ee5\u78ba\u4fdd\u80fd\u5920\u5c07\u4e00\u81f4\u6027\u5feb\u7167\u5beb\u5165\u786c\u789f\u4e2d\uff0c\u5177\u9ad4\u6b65\u9a5f\u5982\u4e0b :"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u66ab\u505c\u65b0\u7684\u4ea4\u6613\u555f\u52d5"}),"\n",(0,s.jsx)(n.li,{children:"\u7b49\u5f85\u6240\u6709\u6d3b\u8e8d\u4ea4\u6613\u57f7\u884c\u5b8c\u7562"}),"\n",(0,s.jsx)(n.li,{children:"\u5c07\u6240\u6709 dirty page \u5beb\u5165\u786c\u789f"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u9019\u7a2e\u65b9\u5f0f\u53ef\u4ee5\u4fdd\u8b49\u8cc7\u6599\u7684\u4e00\u81f4\u6027\uff0c\u4f46\u662f\u6703\u5c0e\u81f4\u7cfb\u7d71\u66ab\u505c\uff0c\u986f\u7136\u4e0d\u662f\u500b\u597d\u65b9\u6cd5\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"slightly-better-checkpoints",children:"Slightly Better Checkpoints"}),"\n",(0,s.jsx)(n.p,{children:"Non-fuzzy checkpoint \u7684\u554f\u984c\u5728\u65bc\u66ab\u505c\u6240\u6709\u4ea4\u6613\u4e26\u4e14\u7b49\u5f85\u6240\u6709\u6d3b\u8e8d\u4ea4\u6613\u57f7\u884c\u5b8c\u7562\uff0c\u800c\u5728 slightly better checkpoint \u4e2d\uff0c\u6211\u5011\u53ea\u66ab\u505c\u9700\u8981 write latch \u7684\u4ea4\u6613\uff0c\u4e0d\u9700\u8981\u7b49\u5f85\u6240\u6709\u6d3b\u8e8d\u4ea4\u6613\u57f7\u884c\u5b8c\u7562\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u9019\u7a2e\u505a\u6cd5\u7684\u6d41\u7a0b\u5982\u4e0b :"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u66ab\u505c\u65b0\u7684\u548c\u9700\u8981\u4fee\u6539\u7684\u4ea4\u6613"}),"\n",(0,s.jsx)(n.li,{children:"\u7d00\u9304\u5167\u90e8\u72c0\u614b (ATT\u3001DPT)"}),"\n",(0,s.jsx)(n.li,{children:"\u5c07\u6240\u6709 dirty page \u5beb\u5165\u786c\u789f"}),"\n",(0,s.jsxs)(n.li,{children:["\u5beb\u5165\u4e00\u500b ",(0,s.jsx)(n.code,{children:"CHECKPOINT"})," \u4e26\u5e36\u4e0a ATT \u548c DPT \u7684\u5167\u5bb9"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u9019\u500b\u904e\u7a0b\u4e2d\uff0c\u6211\u5011\u9700\u8981\u4ee5\u4e0b\u5169\u500b\u8cc7\u8a0a :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Active Transaction Table (ATT) : \u8ffd\u8e64\u7576\u524d\u6b63\u5728\u904b\u884c\u7684\u4ea4\u6613\uff0c\u5305\u62ec txn_id\u3001status (Running\u3001Committing\u3001Candidate for Undo)\u3001lastLSN\uff0c\u53ea\u8981\u6c92\u6709 ",(0,s.jsx)(n.code,{children:"TXN-END"})," \u5c31\u6703\u5728 ATT \u4e2d"]}),"\n",(0,s.jsx)(n.li,{children:"Dirty Page Table (DPT) : \u8a18\u9304 buffer pool \u4e2d\u5df2\u88ab\u4fee\u6539\u4f46\u5c1a\u672a\u5beb\u5165\u786c\u789f\u7684\u9801\u9762\uff0c\u5305\u62ec recLSN"}),"\n"]}),"\n",(0,s.jsx)(l,{src:"/img/cmu15-445/c21/image-11.webp",caption:"Slightly Better Checkpoint"}),"\n",(0,s.jsx)(n.p,{children:"\u9019\u7a2e\u65b9\u6cd5\u6bd4\u7b2c\u4e00\u500b\u65b9\u6cd5\u66f4\u597d\uff0c\u4f46\u662f\u4ecd\u7136\u9700\u8981\u66ab\u505c\u5beb\u7684\u4ea4\u6613\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"fuzzy-checkpoint",children:"Fuzzy Checkpoint"}),"\n",(0,s.jsx)(n.p,{children:"Fuzzy checkpoint \u653e\u68c4\u4e86\u628a\u6240\u6709\u6771\u897f\u90fd\u5beb\u5165\u786c\u789f\u7684\u60f3\u6cd5\uff0c\u5141\u8a31\u5728 checkpoint \u904e\u7a0b\u4e2d\u4ea4\u6613\u7e7c\u7e8c\u57f7\u884c\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u9019\u7a2e\u505a\u6cd5\u7684\u6d41\u7a0b\u5982\u4e0b :"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5beb\u5165\u4e00\u500b ",(0,s.jsx)(n.code,{children:"CHECKPOINT-BEGIN"})," \u8a18\u9304"]}),"\n",(0,s.jsx)(n.li,{children:"\u4e26\u62cd\u651d ATT \u548c DPT \u7684\u5feb\u7167"}),"\n",(0,s.jsx)(n.li,{children:"\u5f8c\u53f0\u7dda\u7a0b\u5c07\u6240\u6709\u5728 DPT \u4e2d\u7684 dirty page \u5beb\u5165\u786c\u789f"}),"\n",(0,s.jsxs)(n.li,{children:["\u5168\u90e8\u5b8c\u6210\u5f8c\uff0c\u5beb\u5165\u4e00\u500b ",(0,s.jsx)(n.code,{children:"CHECKPOINT-END"})," \u8a18\u9304\uff0c\u4e26\u8a18\u9304\u4e00\u958b\u59cb\u7684 ATT \u548c DPT"]}),"\n",(0,s.jsxs)(n.li,{children:["\u4e26\u66f4\u65b0 MasterRecord \u6307\u5411 ",(0,s.jsx)(n.code,{children:"CHECKPOINT-BEGIN"})]}),"\n"]}),"\n",(0,s.jsx)(l,{src:"/img/cmu15-445/c21/image-6.webp",caption:"Fuzzy Checkpoint"}),"\n",(0,s.jsx)(n.h2,{id:"aries-recovery",children:"ARIES Recovery"}),"\n",(0,s.jsx)(n.p,{children:"ARIES \u6062\u5fa9\u5354\u8b70\u662f\u4e00\u7a2e\u5728\u6545\u969c\u5f8c\u6062\u5fa9\u6578\u64da\u7684\u5e38\u898b\u65b9\u6cd5\uff0c\u7e3d\u5171\u5206\u70ba\u4e09\u500b\u968e\u6bb5 :"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Analysis Phase"}),"\n",(0,s.jsx)(n.li,{children:"Redo Phase"}),"\n",(0,s.jsx)(n.li,{children:"Undo Phase"}),"\n"]}),"\n",(0,s.jsx)(l,{src:"/img/cmu15-445/c21/image-12.webp",caption:"ARIES Recovery Overview"}),"\n",(0,s.jsx)(n.h3,{id:"analysis-phase",children:"Analysis Phase"}),"\n",(0,s.jsx)(n.p,{children:"Analysis Phase \u7684\u76ee\u6a19\u662f\u641e\u6e05\u695a\u6545\u969c\u6642\u7684\u7cfb\u7d71\u72c0\u614b\uff0c\u4e26\u91cd\u5efa ATT \u548c DPT\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["DBMS \u6703\u5f9e MasterRecord \u627e\u5230\u6307\u5411\u6700\u5f8c\u4e00\u500b ",(0,s.jsx)(n.code,{children:"CHECKPOINT-BEGIN"})," \u7684 LSN\uff0c\u4e26\u5f9e\u8a72 LSN \u958b\u59cb\u6383\u63cf\u65e5\u8a8c\uff0c\u76f4\u5230\u65e5\u8a8c\u7684\u672b\u5c3e\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u6383\u63cf\u65e5\u8a8c\u6642\uff0cDBMS \u6703\u57f7\u884c\u4ee5\u4e0b\u64cd\u4f5c :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5982\u679c\u767c\u73fe ",(0,s.jsx)(n.code,{children:"TXN-END"}),"\uff0c\u5247\u5728 ATT \u4e2d\u79fb\u9664\u8a72\u4ea4\u6613"]}),"\n",(0,s.jsx)(n.li,{children:"\u9047\u5230\u5176\u4ed6\u4ea4\u6613\u6642\uff0c\u5c07\u5176\u52a0\u5165 ATT \u4e26\u8a2d\u70ba UNDO"}),"\n",(0,s.jsx)(n.li,{children:"\u5982\u679c\u767c\u73fe\u63d0\u4ea4\u7d00\u9304\uff0c\u5247\u5728 ATT \u4e2d\u628a\u8a72\u4ea4\u6613\u8a2d\u70ba COMMIT"}),"\n",(0,s.jsx)(n.li,{children:"\u5982\u679c\u767c\u73fe\u662f\u66f4\u65b0\u7d00\u9304\u4e14\u4e0d\u5728 DPT \u4e2d\uff0c\u5247\u5c07\u5176\u52a0\u5165 DPT \u4e26\u8a2d recLSN \u70ba\u8a72\u7d00\u9304\u7684 LSN"}),"\n"]}),"\n",(0,s.jsx)(l,{src:"/img/cmu15-445/c21/image-13.webp",caption:"Analysis Phase Example"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u7d93\u904e\u9019\u500b\u968e\u6bb5\u5f8c\uff0cATT \u4e2d\u5269\u4e0b\u7684\u5c31\u662f\u6545\u969c\u7576\u6642\u672a\u5b8c\u6210\u7684\u4ea4\u6613\uff0cDPT \u4e2d\u7684\u9801\u9762\u5247\u662f\u9700\u8981\u5728 redo \u968e\u6bb5\u91cd\u65b0\u61c9\u7528\u7684\u9801\u9762\u3002"}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"\u9019\u908a\u6211\u6709\u4e00\u500b\u5730\u65b9\u6c92\u641e\u61c2\u662f\u70ba\u751a\u9ebc\u8981\u5728 030 \u7684\u6642\u5019\u628a P20 \u52a0\u5230 DPT \u4e2d\uff0c\u731c\u6e2c\u53ef\u80fd\u53ea\u662f\u70ba\u4e86\u4fdd\u96aa?"})}),"\n",(0,s.jsx)(n.h3,{id:"redo-phase",children:"Redo Phase"}),"\n",(0,s.jsx)(n.p,{children:"Redo phase \u7684\u76ee\u6a19\u662f\u91cd\u5efa\u8cc7\u6599\u5eab\u6545\u969c\u6642\u7684\u72c0\u614b\uff0c\u5f9e DPT \u4e2d\u6700\u5c0f\u7684 recLSN \u5c0d\u61c9\u7684\u65e5\u8a8c\u8a18\u9304\u958b\u59cb\u6383\u63cf\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5c0d\u65bc\u6bcf\u4e00\u689d\u65e5\u8a8c\u6216\u662f CLR\uff0cDBMS \u90fd\u6703\u91cd\u65b0\u61c9\u7528\u66f4\u65b0\uff0c\u9664\u975e\u4ee5\u4e0b\u60c5\u6cc1\u4e4b\u4e00\u6210\u7acb :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u53d7\u5f71\u97ff\u7684\u9801\u9762\u4e0d\u5728 DPT \u4e2d"}),"\n",(0,s.jsx)(n.li,{children:"\u53d7\u5f71\u97ff\u7684\u9801\u9762\u5728 DPT \u4e2d\uff0c\u4f46\u8a72\u8a18\u9304\u7684 LSN \u5c0f\u65bc\u8a72\u9801\u9762\u5728 DPT \u4e2d\u7684 recLSN"}),"\n",(0,s.jsx)(n.li,{children:"\u53d7\u5f71\u97ff\u9801\u9762\u7684 pageLSN (\u5728\u786c\u789f\u4e0a) \u5927\u65bc\u7b49\u65bc LSN"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Redo \u6642\uff0c\u9700\u8981\u91cd\u65b0\u57f7\u884c log \u4e2d\u7684\u64cd\u4f5c\uff0c\u5c07 pageLSN \u66f4\u65b0\u70ba LSN\uff0c\u4e26\u4e14\u4e0d\u518d\u65b0\u589e CLR\u3002\n\u5728\u7d50\u675f\u6642\uff0cDBMS \u6703\u5c07\u6240\u6709\u72c0\u614b\u70ba COMMIT \u7684\u4ea4\u6613\u5beb\u5165 TXN-END \u65e5\u8a8c\u8a18\u9304\uff0c\u4e26\u628a\u5b83\u5011\u5f9e ATT \u4e2d\u79fb\u9664\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"undo-phase",children:"Undo Phase"}),"\n",(0,s.jsx)(n.p,{children:"Undo phase \u7684\u76ee\u6a19\u662f\u56de\u6efe\u6240\u6709\u672a\u5b8c\u6210\u7684\u4ea4\u6613\uff0c\u4f7f\u8cc7\u6599\u5eab\u6062\u5fa9\u5230\u4e00\u81f4\u7684\u72c0\u614b\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u9019\u500b\u968e\u6bb5\u7684\u57f7\u884c\u65b9\u6cd5\u5982\u4e0b :"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u5f9e ATT \u4e2d\u9078\u64c7\u72c0\u614b\u70ba UNDO \u7684\u4ea4\u6613"}),"\n",(0,s.jsx)(n.li,{children:"\u5f9e\u4e2d\u9078\u64c7 lastLSN \u6700\u5927\u7684\u4ea4\u6613\uff0c\u4e26\u5f9e\u8a72\u4ea4\u6613\u958b\u59cb\u9006\u5e8f\u8655\u7406\u6240\u6709\u7684 log \u4e26\u7522\u751f CLR"}),"\n",(0,s.jsx)(n.li,{children:"\u5982\u679c\u8a72\u4ea4\u6613\u7684 UndoNextLSN \u70ba null\uff0c\u5247\u5beb\u5165 TXN-END \u4e26\u5c07\u5176\u5f9e ATT \u4e2d\u79fb\u9664"}),"\n",(0,s.jsx)(n.li,{children:"\u6301\u7e8c\u9006\u5e8f\u8655\u7406 log\uff0c\u76f4\u5230 ATT \u4e2d\u6c92\u6709 UNDO \u72c0\u614b\u7684\u4ea4\u6613\u70ba\u6b62"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4e86\u89e3\u4e86\u4ee5\u4e0a\u4e09\u500b\u6b65\u9a5f\u5f8c\uff0c\u53ef\u4ee5\u5728\u642d\u914d\u8b1b\u7fa9\u7684\u7bc4\u4f8b\u4f86\u7406\u89e3\u6574\u500b\u904e\u7a0b\u3002 ",(0,s.jsx)(n.a,{href:"https://15445.courses.cs.cmu.edu/fall2024/slides/21-recovery.pdf",children:"PPT Link"})]}),"\n",(0,s.jsx)(n.h2,{id:"additional-topics",children:"Additional Topics"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Q1 : \u5982\u679c\u7cfb\u7d71\u5728 recovery \u7684 analysis \u968e\u6bb5\u5d29\u6f70\u8981\u600e\u9ebc\u8fa6 ?"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u91cd\u65b0\u57f7\u884c recovery \u5373\u53ef"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Q2 : \u5982\u679c\u7cfb\u7d71\u5728 recovery \u7684 redo \u968e\u6bb5\u5d29\u6f70\u8981\u600e\u9ebc\u8fa6 ?"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u91cd\u65b0\u57f7\u884c recovery \u5373\u53ef"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Q3 : \u5982\u4f55\u5728 redo \u968e\u6bb5\u6642\u63d0\u5347\u6548\u80fd ?"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u5047\u8a2d\u7cfb\u7d71\u4e0d\u6703\u518d\u6b21\u5d29\u6f70\uff0c\u5247\u53ef\u4ee5\u7528\u7570\u6b65\u7684\u65b9\u5f0f\u5c07\u6240\u6709\u8b8a\u66f4\u5beb\u5165\u786c\u789f"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Q4 : \u5982\u4f55\u5728 undo \u968e\u6bb5\u6642\u63d0\u5347\u6548\u80fd ?"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528 Lazy Undo\uff0c\u53ea\u6709\u5728\u65b0\u7684\u4ea4\u6613\u9700\u8981\u8b80\u53d6\u88ab\u56de\u6efe\u7684\u9801\u9762\u6642\u624d\u9032\u884c\u56de\u6efe\uff0c\u4ee5\u53ca\u907f\u514d\u4f7f\u7528 long-running \u7684\u4ea4\u6613"})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}function x(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>o});var l=i(6540);const s={},c=l.createContext(s);function r(e){const n=l.useContext(c);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),l.createElement(c.Provider,{value:n},e.children)}}}]);