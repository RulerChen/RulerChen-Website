"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6123],{4712:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>g,frontMatter:()=>r,metadata:()=>c,toc:()=>d});var i=t(5893),s=t(1151);const l=t.p+"assets/images/3-2a403e86d8b6d3af3c512c5e4913127c.png",r={title:"[K8s] Kubernetes Monitor",sidebar_position:"60",description:"Kubernetes Monitor",keywords:["Kubernetes Monitor"]},o=void 0,c={id:"Kubernetes/Monitor",title:"[K8s] Kubernetes Monitor",description:"Kubernetes Monitor",source:"@site/docs/Kubernetes/Monitor.mdx",sourceDirName:"Kubernetes",slug:"/Kubernetes/Monitor",permalink:"/RulerChen-Website/docs/Kubernetes/Monitor",draft:!1,unlisted:!1,editUrl:"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/Kubernetes/Monitor.mdx",tags:[],version:"current",lastUpdatedAt:1706183872e3,sidebarPosition:60,frontMatter:{title:"[K8s] Kubernetes Monitor",sidebar_position:60,description:"Kubernetes Monitor",keywords:["Kubernetes Monitor"]},sidebar:"tutorialSidebar",previous:{title:"[K8s] Kubernetes Cluster",permalink:"/RulerChen-Website/docs/Kubernetes/Cluster"},next:{title:"[K8s] Kubernetes Auto Scaling",permalink:"/RulerChen-Website/docs/Kubernetes/AutoScaling"}},a={},d=[{value:"Log",id:"log",level:2},{value:"Pod Log",id:"pod-log",level:3},{value:"Node Log",id:"node-log",level:3},{value:"Control Plane Log",id:"control-plane-log",level:3},{value:"Centralized Logging",id:"centralized-logging",level:3},{value:"Event",id:"event",level:2},{value:"Request / Limit",id:"request--limit",level:2},{value:"Limit Range",id:"limit-range",level:2},{value:"Metric",id:"metric",level:2}];function u(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"log",children:"Log"}),"\n",(0,i.jsx)(n.h3,{id:"pod-log",children:"Pod Log"}),"\n",(0,i.jsx)(n.p,{children:"\u6211\u5011\u53ef\u4ee5\u900f\u904e\u67e5\u770b Pod \u7684 log \u4f86\u4e86\u89e3 Pod \u7684\u72c0\u614b\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ kubectl logs $POD_NAME\n$ kubectl logs $POD_NAME -c $CONTAINER_NAME\n$ kubectl logs $POD_NAME --all-containers\n$ kubectl logs --selector app=demo\n$ kubectl logs -f $POD_NAME   # \u8ddf\u8e64 log\n$ kubectl logs $POD_NAME --tail 5   # \u67e5\u770b\u6700\u5f8c 5 \u884c\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u6211\u5011\u7121\u6cd5\u4f7f\u7528 api server \u4f86\u67e5\u770b log\uff0c\u6211\u5011\u5c31\u9700\u8981\u624b\u52d5\u53bb\u90a3\u500b node \u4e0a\u67e5\u770b log\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"crictl --runtime-endpoint unix:///run/containerd/containerd.sock logs $CONTAINER_ID\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6216\u662f"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"tail /var/log/containers/$CONTAINER_NAME_$CONTAINER_ID\n"})}),"\n",(0,i.jsx)(n.h3,{id:"node-log",children:"Node Log"}),"\n",(0,i.jsx)(n.p,{children:"\u6211\u5011\u4e5f\u53ef\u4ee5\u67e5\u770b Node \u7684 log\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"systemctl status kubelet.service  # check service status\n\njournalctl -u kubelet.service\njournalctl -u kubelet.service | grep -i ERROR\njournalctl -u kubelet.service --since today --no-pager\n"})}),"\n",(0,i.jsx)(n.h3,{id:"control-plane-log",children:"Control Plane Log"}),"\n",(0,i.jsx)(n.p,{children:"\u6216\u8005\u662f\u67e5\u770b Control Plane \u7684 log\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl logs -n kube-system $POD_NAME\n"})}),"\n",(0,i.jsx)(n.h3,{id:"centralized-logging",children:"Centralized Logging"}),"\n","\n",(0,i.jsx)("img",{src:l,alt:"logging",width:"100%",height:"auto"}),"\n",(0,i.jsx)(n.h2,{id:"event",children:"Event"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get events\nkubectl get events --field-selector type=Warning,reason=Failed\nkubectl get events --watch &   # ( run `fg` and ctrl +c to break it)\n\nkubectl describe pods nginx\n"})}),"\n",(0,i.jsx)(n.h2,{id:"request--limit",children:"Request / Limit"}),"\n",(0,i.jsx)(n.p,{children:"request \u662f\u5bb9\u5668\u6700\u5c0f\u9700\u8981\u7684\u8cc7\u6e90\uff0c\u53ea\u6709\u7576\u524d\u7bc0\u9ede\u6709\u8db3\u5920\u7684\u8cc7\u6e90\u6642\uff0cPod \u624d\u6703\u88ab\u8abf\u5ea6\u5230\u8a72\u7bc0\u9ede\u4e0a\u3002"}),"\n",(0,i.jsx)(n.p,{children:"limit \u662f\u5bb9\u5668\u6700\u5927\u53ef\u4ee5\u4f7f\u7528\u7684\u8cc7\u6e90\uff0c\u8a2d\u7f6e\u70ba 0 \u8868\u793a\u4e0d\u9650\u5236\u3002"}),"\n",(0,i.jsx)(n.p,{children:"k8s \u6703\u4f9d\u64da request \u548c limit \u4f86\u6c7a\u5b9a Pod \u7684 QoS \u7a2e\u985e:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Guaranteed: request = limit"}),"\n",(0,i.jsx)(n.li,{children:"Burstable: request < limit"}),"\n",(0,i.jsx)(n.li,{children:"BestEffort: request = limit = 0"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u8cc7\u6e90\u4e0d\u8db3\u6642\uff0ck8s \u6703\u4f9d\u7167 QoS \u7a2e\u985e\u4f86\u6c7a\u5b9a\u54ea\u4e9b Pod \u6703\u88ab kill \u6389\uff0c\u5176\u4e2d BestEffort \u6703\u88ab\u512a\u5148 kill \u6389\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Pod\nmetadata:\n  name: qos-demo\n  namespace: qos-example\nspec:\n  containers:\n    - name: qos-demo-ctr\n      image: nginx\n      resources:\n        limits:\n          memory: '200Mi'\n          cpu: '700m'\n        requests:\n          memory: '200Mi'\n          cpu: '700m'\n"})}),"\n",(0,i.jsx)(n.h2,{id:"limit-range",children:"Limit Range"}),"\n",(0,i.jsx)(n.p,{children:"\u6211\u5011\u53ef\u4ee5\u900f\u904e LimitRange \u4f86\u9650\u5236 Pod \u548c PVC \u6700\u591a\u80fd\u4f7f\u7528\u5230\u7684\u8cc7\u6e90\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: LimitRange\nmetadata:\n  name: my-limit-range\nspec:\n  limits:\n    - max:\n        cpu: 1\n        memory: 1Gi\n      min:\n        cpu: 0.5\n        memory: 500Mi\n  requests:\n    - cpu: 0.2\n      memory: 200Mi\n"})}),"\n",(0,i.jsx)(n.h2,{id:"metric",children:"Metric"}),"\n",(0,i.jsxs)(n.p,{children:["\u5982\u679c\u6211\u5011\u60f3\u8981\u4e86\u89e3\u6211\u5011\u96c6\u7fa4\u5167\u7684\u8cc7\u6e90\u4f7f\u7528\u60c5\u6cc1\uff0c\u6211\u5011\u53ef\u4ee5\u900f\u904e ",(0,i.jsx)(n.a,{href:"https://kubernetes-sigs.github.io/metrics-server/",children:"Metric Server"})," \u4f86\u67e5\u770b\uff0c\n\u4e5f\u53ef\u4ee5\u4f7f\u7528 Garfana \u548c Prometheus \u4f86\u76e3\u63a7\u6211\u5011\u7684\u96c6\u7fa4\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl top node\nkubectl top pod\n"})})]})}function g(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>o,a:()=>r});var i=t(7294);const s={},l=i.createContext(s);function r(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);