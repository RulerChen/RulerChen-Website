"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8014],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=r.createContext({}),l=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=l(e.components);return r.createElement(c.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},f=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=l(t),f=a,m=p["".concat(c,".").concat(f)]||p[f]||d[f]||o;return t?r.createElement(m,i(i({ref:n},u),{},{components:t})):r.createElement(m,i({ref:n},u))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=f;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s[p]="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=t[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}f.displayName="MDXCreateElement"},820:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var r=t(7462),a=(t(7294),t(3905));const o={title:"useEffect",sidebar_position:"5",description:"",keywords:["React Hook","useEffect","React"]},i=void 0,s={unversionedId:"React/React Hook/useEffect",id:"React/React Hook/useEffect",title:"useEffect",description:"",source:"@site/docs/React/React Hook/useEffect.mdx",sourceDirName:"React/React Hook",slug:"/React/React Hook/useEffect",permalink:"/RulerChen-Website/docs/React/React Hook/useEffect",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"useEffect",sidebar_position:5,description:"",keywords:["React Hook","useEffect","React"]},sidebar:"tutorialSidebar",previous:{title:"useDeferredValue",permalink:"/RulerChen-Website/docs/React/React Hook/useDeferredValue"},next:{title:"useId",permalink:"/RulerChen-Website/docs/React/React Hook/useId"}},c={},l=[{value:"Syntax",id:"syntax",level:2},{value:"Parameters",id:"parameters",level:3},{value:"Return",id:"return",level:3},{value:"Caveats",id:"caveats",level:3},{value:"Usage",id:"usage",level:2},{value:"Connecting to an external system",id:"connecting-to-an-external-system",level:3},{value:"Wrapping Effects in custom Hooks",id:"wrapping-effects-in-custom-hooks",level:3},{value:"Controlling a non-React widget",id:"controlling-a-non-react-widget",level:3},{value:"Fetching data with Effects",id:"fetching-data-with-effects",level:3},{value:"Specifying reactive dependencies",id:"specifying-reactive-dependencies",level:3},{value:"Updating state based on previous state from an Effect",id:"updating-state-based-on-previous-state-from-an-effect",level:3},{value:"Removing unnecessary object and function dependencies",id:"removing-unnecessary-object-and-function-dependencies",level:3},{value:"Reading the latest props and state from an Effect",id:"reading-the-latest-props-and-state-from-an-effect",level:3},{value:"Displaying different content on the server and the client",id:"displaying-different-content-on-the-server-and-the-client",level:3},{value:"Tips",id:"tips",level:2},{value:"My Effect does something visual, and I see a flicker before it runs",id:"my-effect-does-something-visual-and-i-see-a-flicker-before-it-runs",level:3}],u={toc:l},p="wrapper";function d(e){let{components:n,...t}=e;return(0,a.kt)(p,(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"syntax"},"Syntax"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"showLineNumbers",showLineNumbers:!0},"useEffect(() => {\n  setUp();\n  return () => {\n    cleanUp();\n  };\n}, [dependencies]);\n")),(0,a.kt)("h3",{id:"parameters"},"Parameters"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"setup")," : \u7576 component \u88ab\u52a0\u5230 DOM \u4e0a\u6642\uff0c\u57f7\u884c\u7684 function \uff0c\u6bcf\u4e00\u6b21 re-render \u6642\uff0c\u6703\u5148\u57f7\u884c cleanUp function \u518d\u57f7\u884c setup function\u3002"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"dependencies")," :")),(0,a.kt)("h3",{id:"return"},"Return"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," \u56de\u50b3 ",(0,a.kt)("inlineCode",{parentName:"p"},"undefined"),"\u3002"),(0,a.kt)("h3",{id:"caveats"},"Caveats"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5728 ",(0,a.kt)("inlineCode",{parentName:"li"},"strictMode")," \u4e0b\uff0c React \u6703\u5148\u57f7\u884c\u4e00\u6b21 development-only setup+cleanup cycle \uff0c\u4ee5\u78ba\u4fdd ",(0,a.kt)("inlineCode",{parentName:"li"},"setUp")," \u548c ",(0,a.kt)("inlineCode",{parentName:"li"},"cleanUp")," \u7684\u5c0d\u61c9\u95dc\u4fc2\u3002")),(0,a.kt)("h2",{id:"usage"},"Usage"),(0,a.kt)("h3",{id:"connecting-to-an-external-system"},"Connecting to an external system"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"showLineNumbers",showLineNumbers:!0},'import { useEffect } from "react";\nimport { createConnection } from "./chat.js";\n\nfunction ChatRoom({ roomId }) {\n  const [serverUrl, setServerUrl] = useState("https://localhost:1234");\n\n  useEffect(() => {\n    const connection = createConnection(serverUrl, roomId);\n    connection.connect();\n    return () => {\n      connection.disconnect();\n    };\n  }, [serverUrl, roomId]);\n  // ...\n}\n')),(0,a.kt)("h3",{id:"wrapping-effects-in-custom-hooks"},"Wrapping Effects in custom Hooks"),(0,a.kt)("p",null,"\u53ef\u4ee5\u5c07 ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," \u5305\u88dd\u5728 custom hook \u4e2d\uff0c\u4ee5\u4fbf\u91cd\u8907\u4f7f\u7528\u3002"),(0,a.kt)("h3",{id:"controlling-a-non-react-widget"},"Controlling a non-React widget"),(0,a.kt)("p",null,"\u4f7f\u5916\u90e8\u7cfb\u7d71\u8207 React \u4fdd\u6301\u4e00\u81f4\u3002"),(0,a.kt)("h3",{id:"fetching-data-with-effects"},"Fetching data with Effects"),(0,a.kt)("p",null,"\u539f\u5247\u4e0a\u9f13\u52f5\u4f7f\u7528 React \u6846\u67b6\u6216\u8005\u662f\u4f9d\u4e9b\u958b\u6e90\u5957\u4ef6\uff0c\u6bd4\u5982 react-query\u3002"),(0,a.kt)("p",null,"\u5728\u4e0b\u65b9\u7684\u7a0b\u5f0f\u78bc\u4e2d\uff0c\u6211\u5011\u4f7f\u7528 ignore \u4f86\u907f\u514d race condition (\u6216\u8005\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 AbortController)\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"showLineNumbers",showLineNumbers:!0},'import { useState, useEffect } from "react";\nimport { fetchBio } from "./api.js";\n\nexport default function Page() {\n  const [person, setPerson] = useState("Alice");\n  const [bio, setBio] = useState(null);\n\n  useEffect(() => {\n    let ignore = false;\n    setBio(null);\n    fetchBio(person).then((result) => {\n      if (!ignore) {\n        setBio(result);\n      }\n    });\n    return () => {\n      ignore = true;\n    };\n  }, [person]);\n}\n')),(0,a.kt)("h3",{id:"specifying-reactive-dependencies"},"Specifying reactive dependencies"),(0,a.kt)("p",null,"\u628a\u6240\u6709\u53ef\u4e92\u52d5\u7684\u8b8a\u6578\u90fd\u653e\u5728 dependencies \u4e2d\uff0c\u4ee5\u78ba\u4fdd ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," \u6703\u5728\u9019\u4e9b\u8b8a\u6578\u6539\u8b8a\u6642\u88ab\u89f8\u767c\u3002"),(0,a.kt)("p",null,"\u53ef\u4e92\u52d5\u7684\u8b8a\u6578(Reactive values)\u5305\u62ec props \u548c\u5b9a\u7fa9\u5728 component \u4e2d\u7684 \u8b8a\u6578\u548c\u51fd\u6578\u3002"),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"\u4e0d\u8981\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"eslint-ignore-next-line react-hooks/exhaustive-deps")," \u4f86\u5ffd\u7565 dependencies \u7684\u6aa2\u67e5\u3002")),(0,a.kt)("h3",{id:"updating-state-based-on-previous-state-from-an-effect"},"Updating state based on previous state from an Effect"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"showLineNumbers",showLineNumbers:!0},'import { useState, useEffect } from "react";\n\nexport default function Counter() {\n  const [count, setCount] = useState(0);\n\n  useEffect(() => {\n    const intervalId = setInterval(() => {\n      setCount((c) => c + 1); // \u2705 Pass a state updater\n    }, 1000);\n    return () => clearInterval(intervalId);\n  }, []); // \u2705 Now count is not a dependency\n\n  return <h1>{count}</h1>;\n}\n')),(0,a.kt)("h3",{id:"removing-unnecessary-object-and-function-dependencies"},"Removing unnecessary object and function dependencies"),(0,a.kt)("p",null,"\u5982\u679c\u6709 object or function \u4f5c\u70ba dependencies \uff0c\u6bcf\u4e00\u6b21 re-render \u6642\uff0c\u90fd\u6703\u91cd\u65b0\u5efa\u7acb\u4e00\u500b\u65b0\u7684 object or function\n\uff0c\u9019\u6a23\u6703\u5c0e\u81f4 ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," \u6bcf\u4e00\u6b21\u90fd\u6703\u88ab\u89f8\u767c\uff0c\u5982\u679c\u53ef\u4ee5\u7684\u8a71\u76e1\u91cf\u79fb\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," \u88e1\u9762\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"showLineNumbers",showLineNumbers:!0},'const serverUrl = "https://localhost:1234";\n\nfunction ChatRoom({ roomId }) {\n  const [message, setMessage] = useState("");\n\n  // \ud83d\udea9 This object is created from scratch on every re-render\n  const options = {\n    serverUrl: serverUrl,\n    roomId: roomId,\n  };\n\n  useEffect(() => {\n    const connection = createConnection(options); // It\'s used inside the Effect\n    connection.connect();\n    return () => connection.disconnect();\n  }, [options]); // \ud83d\udea9 As a result, these dependencies are always different on a re-render\n}\n')),(0,a.kt)("h3",{id:"reading-the-latest-props-and-state-from-an-effect"},"Reading the latest props and state from an Effect"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"showLineNumbers",showLineNumbers:!0},"function Page({ url, shoppingCart }) {\n  const onVisit = useEffectEvent((visitedUrl) => {\n    logVisit(visitedUrl, shoppingCart.length);\n  });\n\n  useEffect(() => {\n    onVisit(url);\n  }, [url]); // \u2705 All dependencies declared\n}\n")),(0,a.kt)("h3",{id:"displaying-different-content-on-the-server-and-the-client"},"Displaying different content on the server and the client"),(0,a.kt)("p",null,"\u5982\u679c\u4f60\u7684\u7a0b\u5f0f\u78bc\u9700\u8981\u5728 server \u548c client \u4e0a\u6709\u4e0d\u540c\u7684\u884c\u70ba\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," \u4f86\u9054\u6210\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"showLineNumbers",showLineNumbers:!0},"function MyComponent() {\n  const [didMount, setDidMount] = useState(false);\n\n  useEffect(() => {\n    setDidMount(true);\n  }, []);\n\n  if (didMount) {\n    // ... return client-only JSX ...\n  } else {\n    // ... return initial JSX ...\n  }\n}\n")),(0,a.kt)("h2",{id:"tips"},"Tips"),(0,a.kt)("h3",{id:"my-effect-does-something-visual-and-i-see-a-flicker-before-it-runs"},"My Effect does something visual, and I see a flicker before it runs"),(0,a.kt)("p",null,"\u5982\u679c\u4f60\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," \u6703\u505a\u4e00\u4e9b\u8996\u89ba\u4e0a\u7684\u8b8a\u5316\uff0c\u4f60\u53ef\u80fd\u6703\u770b\u5230\u4e00\u4e9b\u9583\u720d\u7684\u60c5\u6cc1\uff0c\u9019\u662f\u56e0\u70ba ",(0,a.kt)("inlineCode",{parentName:"p"},"useEffect")," \u6703\u5728 re-render \u4e4b\u5f8c\u624d\u6703\u88ab\u89f8\u767c\uff0c\n\u5982\u679c\u4f60\u60f3\u8981\u907f\u514d\u9019\u7a2e\u60c5\u6cc1\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"useLayoutEffect")," \u4f86\u9054\u6210\u3002"))}d.isMDXComponent=!0}}]);