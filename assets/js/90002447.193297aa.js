"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3573],{825:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>r,contentTitle:()=>a,default:()=>g,frontMatter:()=>s,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"CMU15-445/c20","title":"Database Logging","description":"CMU15-445/645 Database Logging","source":"@site/docs/CMU15-445/c20.mdx","sourceDirName":"CMU15-445","slug":"/CMU15-445/c20","permalink":"/RulerChen-Website/docs/CMU15-445/c20","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/c20.mdx","tags":[{"inline":true,"label":"CMU15-445","permalink":"/RulerChen-Website/docs/tags/cmu-15-445"}],"version":"current","lastUpdatedAt":1757907567000,"sidebarPosition":20,"frontMatter":{"title":"Database Logging","sidebar_position":20,"description":"CMU15-445/645 Database Logging","keywords":["CMU15-445/645","Database Logging","CMU15-445/645 \u7b46\u8a18"],"tags":["CMU15-445"]},"sidebar":"tutorialSidebar","previous":{"title":"Multi-Version Concurrency Control","permalink":"/RulerChen-Website/docs/CMU15-445/c19"},"next":{"title":"Database Recovery","permalink":"/RulerChen-Website/docs/CMU15-445/c21"}}');var c=n(4848),o=n(8453);const s={title:"Database Logging",sidebar_position:"20",description:"CMU15-445/645 Database Logging",keywords:["CMU15-445/645","Database Logging","CMU15-445/645 \u7b46\u8a18"],tags:["CMU15-445"]},a=void 0,r={},d=[{value:"Failure Classification",id:"failure-classification",level:2},{value:"Transaction Failures",id:"transaction-failures",level:3},{value:"System Failures",id:"system-failures",level:3},{value:"Storage Media Failure",id:"storage-media-failure",level:3},{value:"Buffer Pool Management Policies",id:"buffer-pool-management-policies",level:2},{value:"Steal Policy",id:"steal-policy",level:3},{value:"Force Policy",id:"force-policy",level:3},{value:"Shadow Paging",id:"shadow-paging",level:2},{value:"Write-Ahead Logging (WAL)",id:"write-ahead-logging-wal",level:2},{value:"WAL Group Commit",id:"wal-group-commit",level:3},{value:"Capture Data Changes (CDC)",id:"capture-data-changes-cdc",level:3},{value:"Logging Schemes",id:"logging-schemes",level:2},{value:"Physical Logging",id:"physical-logging",level:3},{value:"Logical Logging",id:"logical-logging",level:3},{value:"Physiological Logging",id:"physiological-logging",level:3},{value:"Checkpoint",id:"checkpoint",level:2},{value:"Blocking Checkpoint",id:"blocking-checkpoint",level:3}];function t(e){const i={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",ul:"ul",...(0,o.R)(),...e.components},{Head:n,ImageModal:l}=i;return n||h("Head",!0),l||h("ImageModal",!0),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n,{children:(0,c.jsx)("title",{children:"CMU 15-445 Database Logging"})}),"\n",(0,c.jsx)(l,{src:"/img/cmu15-445/c20/image.webp",caption:"Database Logging"}),"\n",(0,c.jsx)(i.p,{children:"\u8cc7\u6599\u5eab\u5728\u904b\u884c\u6642\u53ef\u80fd\u6703\u767c\u751f\u5404\u7a2e\u6545\u969c\uff0c\u5982\u679c\u4e2d\u65b7\u4e86\u4e8b\u52d9\u7684\u904b\u4f5c\uff0c\u5c31\u53ef\u80fd\u7522\u751f\u8cc7\u6599\u4e0d\u4e00\u81f4\u7684\u554f\u984c\uff0c\u9019\u6642\u5019\u5c31\u9700\u8981\u6545\u969c\u6062\u5fa9\u6a5f\u5236\u4f86\u4fdd\u8b49\u8cc7\u6599\u7684\u5b8c\u6574\uff0c\u4e3b\u8981\u6703\u5206\u6210\u5169\u500b\u90e8\u5206\u4f86\u8a0e\u8ad6 :"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"\u5728\u6b63\u5e38\u64cd\u4f5c\u6642\u9032\u884c\u4e00\u4e9b\u6e96\u5099\u5de5\u4f5c\uff0c\u4ee5\u78ba\u4fdd\u7cfb\u7d71\u80fd\u5920\u5f9e\u6545\u969c\u4e2d\u6062\u5fa9 (\u672c\u7bc0)"}),"\n",(0,c.jsx)(i.li,{children:"\u6545\u969c\u767c\u751f\u5f8c\uff0c\u7528\u4f86\u6062\u5fa9\u8cc7\u6599\u5eab\u72c0\u614b\u7684\u64cd\u4f5c\uff0c\u4ee5\u78ba\u4fdd\u4ea4\u6613\u7684\u539f\u5b50\u6027\u3001\u4e00\u81f4\u6027\u8207\u6301\u4e45\u6027 (\u4e0b\u4e00\u7bc0)"}),"\n"]}),"\n",(0,c.jsx)(i.h2,{id:"failure-classification",children:"Failure Classification"}),"\n",(0,c.jsx)(i.p,{children:"\u4e16\u754c\u4e0a\u4e26\u4e0d\u5b58\u5728\u5b8c\u5168\u53ef\u9760\u7684\u7cfb\u7d71\uff0c\u56e0\u6b64\u6211\u5011\u9700\u8981\u8003\u616e\u5404\u7a2e\u53ef\u80fd\u7684\u6545\u969c\u60c5\u6cc1\u3002"}),"\n",(0,c.jsx)(i.h3,{id:"transaction-failures",children:"Transaction Failures"}),"\n",(0,c.jsx)(i.p,{children:"\u9019\u7a2e\u985e\u578b\u7684\u6545\u969c\u767c\u751f\u5728\u4ea4\u6613\u904e\u7a0b\u4e2d\uff0c\u7531\u65bc\u67d0\u4e9b\u932f\u8aa4\u5c0e\u81f4\u4ea4\u6613\u88ab\u4e2d\u6b62 :"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"Logical Errors : \u4ea4\u6613\u4e2d\u7684\u67d0\u4e9b\u64cd\u4f5c\u5c0e\u81f4\u4e86\u932f\u8aa4\uff0c\u4f8b\u5982\u9918\u984d\u4e0d\u8db3"}),"\n",(0,c.jsx)(i.li,{children:"Internal State Errors : \u4ea4\u6613\u4e2d\u7684\u67d0\u4e9b\u64cd\u4f5c\u5c0e\u81f4\u4e86\u7cfb\u7d71\u932f\u8aa4\uff0c\u4f8b\u5982 deadlock"}),"\n"]}),"\n",(0,c.jsx)(i.h3,{id:"system-failures",children:"System Failures"}),"\n",(0,c.jsx)(i.p,{children:"\u9019\u7a2e\u6545\u969c\u767c\u751f\u5728\u627f\u8f09 DBMS \u7684\u5e95\u5c64\u8edf\u786c\u9ad4\u51fa\u73fe\u975e\u9810\u671f\u7684\u554f\u984c\u6642 :"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"Software Failure : DBMS \u8edf\u9ad4\u7684\u5be6\u73fe\u51fa\u73fe\u554f\u984c\uff0c\u5982\u9664\u4ee5\u96f6"}),"\n",(0,c.jsx)(i.li,{children:"Hardware Failure : DBMS \u6240\u5728\u7684\u786c\u9ad4\u51fa\u73fe\u932f\u8aa4\uff0c\u5982\u65b7\u96fb"}),"\n"]}),"\n",(0,c.jsx)(i.h3,{id:"storage-media-failure",children:"Storage Media Failure"}),"\n",(0,c.jsx)(i.p,{children:"\u9019\u7a2e\u6545\u969c\u767c\u751f\u5728\u7269\u7406\u5b58\u5132\u8a2d\u5099\u53d7\u5230\u640d\u58de\u4e26\u4e14\u7121\u6cd5\u4fee\u5fa9\u6642\uff0c\u901a\u5e38\u7121\u6cd5\u4fee\u5fa9\uff0c\u53ea\u80fd\u5f9e\u5099\u7528\u7684\u786c\u789f\u6062\u5fa9\u3002"}),"\n",(0,c.jsx)(i.h2,{id:"buffer-pool-management-policies",children:"Buffer Pool Management Policies"}),"\n",(0,c.jsx)(i.p,{children:"\u5728\u6211\u5011\u4fee\u6539\u8cc7\u6599\u6642\uff0cDBMS \u9700\u8981\u5148\u628a\u8cc7\u6599\u8b80\u5230\u8a18\u61b6\u9ad4\u4e2d\uff0c\u7136\u5f8c\u6839\u64da\u8acb\u6c42\u9032\u884c\u4fee\u6539\uff0c\u6700\u5f8c\u518d\u5c07\u4fee\u6539\u5f8c\u7684\u8cc7\u6599\u5beb\u56de\u786c\u789f\u3002\n\u5728\u9019\u500b\u904e\u7a0b\u4e2d\uff0cDBMS \u9700\u8981\u4fdd\u8b49\u4ee5\u4e0b\u5169\u9ede :"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"\u4e00\u65e6\u63d0\u4ea4\u5f8c\uff0c\u4ea4\u6613\u7684\u4fee\u6539\u5c31\u61c9\u8a72\u662f\u6c38\u4e45\u7684"}),"\n",(0,c.jsx)(i.li,{children:"\u5982\u679c\u4e2d\u6b62\uff0c\u4ea4\u6613\u7684\u4fee\u6539\u4e0d\u61c9\u8a72\u88ab\u6301\u4e45\u5316"}),"\n"]}),"\n",(0,c.jsx)(i.p,{children:"\u5982\u679c\u771f\u7684\u9047\u5230\u4e86\u6545\u969c\uff0cDBMS \u53ef\u4ee5\u4f7f\u7528 redo \u548c undo \u4f86\u6062\u5fa9\u8cc7\u6599\u5eab\u7684\u72c0\u614b\uff0credo \u662f\u5c07\u5df2\u63d0\u4ea4\u7684\u4ea4\u6613\u91cd\u65b0\u61c9\u7528\u5230\u8cc7\u6599\u5eab\u4e2d\uff0c\u800c undo \u5247\u662f\u56de\u6efe\u672a\u63d0\u4ea4\u7684\u4ea4\u6613\u3002"}),"\n",(0,c.jsx)(i.p,{children:"DBMS \u5982\u4f55\u8655\u7406 undo / redo \u4e3b\u8981\u53d6\u6c7a\u65bc buffer pool management policies\uff0c\u6709\u5169\u7a2e\u7b56\u7565 :"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"Steal Policy : DBMS \u662f\u5426\u5141\u8a31\u5c07\u672a\u63d0\u4ea4\u7684\u66f4\u6539\u5beb\u5165\u786c\u789f"}),"\n",(0,c.jsx)(i.li,{children:"Force Policy : DBMS \u662f\u5426\u8981\u6c42\u5c07\u63d0\u4ea4\u7684\u66f4\u6539\u5beb\u5165\u786c\u789f\uff0c\u6216\u662f\u53ea\u9700\u8981\u78ba\u4fdd log \u88ab\u5beb\u5165\u786c\u789f"}),"\n"]}),"\n",(0,c.jsx)(i.p,{children:"\u5728\u5be6\u52d9\u4e0a\uff0c\u6211\u5011\u901a\u5e38\u6703\u9078\u64c7 steal / no-force \u4f86\u9032\u884c\u7ba1\u7406\uff0cno-steal / force \u7684\u554f\u984c\u5728\u65bc\u9019\u6a23\u80fd\u8655\u7406\u7684\u4ea4\u6613\u5927\u5c0f\u53d7\u5230 buffer pool \u5927\u5c0f\u7684\u9650\u5236\u3002"}),"\n",(0,c.jsx)(l,{src:"/img/cmu15-445/c20/image-13.webp",caption:"No-Steal / Force Example"}),"\n",(0,c.jsx)(i.h3,{id:"steal-policy",children:"Steal Policy"}),"\n",(0,c.jsx)(i.p,{children:"\u5982\u679c\u9078\u64c7 steal\uff0c\u82e5 T1 rollback\uff0c\u5247\u9700\u8981\u628a\u5df2\u7d93\u9032\u884c\u6301\u4e45\u5316\u7684\u8cc7\u6599\u91cd\u65b0\u4fee\u6539\u56de\u539f\u672c\u7684\u72c0\u614b\u518d\u5b58\u56de\u786c\u789f\uff0c\u9019\u7a2e\u65b9\u6cd5\u5728\u4e0d\u767c\u751f\u6545\u969c\u7684\u60c5\u6cc1\u4e0b\u53ef\u4ee5\u63d0\u9ad8\u6548\u7387\u3002"}),"\n",(0,c.jsx)(i.p,{children:"\u5982\u679c\u9078\u64c7 no-steal\uff0c\u82e5 T1 rollback\uff0cDBMS \u4e0d\u9700\u8981\u9032\u884c\u4efb\u4f55\u64cd\u4f5c\uff0c\u9019\u7a2e\u65b9\u6cd5\u5728\u767c\u751f\u6545\u969c\u6642\u6548\u7387\u8f03\u9ad8\u3002"}),"\n",(0,c.jsx)(i.h3,{id:"force-policy",children:"Force Policy"}),"\n",(0,c.jsx)(i.p,{children:"\u5982\u679c\u9078\u64c7 force\uff0c\u7576\u4ea4\u6613\u63d0\u4ea4\u6642\uff0cDBMS \u9700\u8981\u7acb\u5373\u5c07\u4fee\u6539\u5beb\u56de\u786c\u789f\uff0c\u4e00\u81f4\u6027\u8f03\u9ad8\u3002"}),"\n",(0,c.jsx)(i.p,{children:"\u5982\u679c\u9078\u64c7 no-force\uff0c\u7576\u4ea4\u6613\u63d0\u4ea4\u6642\uff0cDBMS \u53ef\u4ee5\u9078\u64c7\u5ef6\u9072\u5c07\u8cc7\u6599\u6279\u91cf\u5beb\u56de\u786c\u789f\uff0c\u6548\u7387\u8f03\u9ad8\u3002"}),"\n",(0,c.jsx)(i.h2,{id:"shadow-paging",children:"Shadow Paging"}),"\n",(0,c.jsx)(i.p,{children:"\u5728 buffer pool \u7684\u7b56\u7565\u4e0a\uff0c\u6700\u5bb9\u6613\u5be6\u4f5c\u7684\u5c31\u662f no-steal / force \u7684\u7d44\u5408\uff0c\u5728\u4ea4\u6613\u88ab\u4e2d\u6b62\u6642\u4e0d\u9700\u8981 undo \u8cc7\u6599\uff0c\u63d0\u4ea4\u5f8c\u4e5f\u4e0d\u9700\u8981 redo \u8cc7\u6599\uff0c\u552f\u4e00\u7684\u554f\u984c\u662f\u7121\u6cd5\u8655\u7406\u8d85\u904e buffer pool \u5927\u5c0f\u7684\u8cc7\u6599\u3002"}),"\n",(0,c.jsx)(i.p,{children:"\u800c shadow paging \u5c31\u662f\u4e00\u7a2e\u4f7f\u7528 no-steal / force \u7684\u4ee3\u8868\uff0c\u5b83\u6703\u7dad\u8b77\u5169\u4efd\u7368\u7acb\u7684\u8cc7\u6599\u7248\u672c :"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"Master : \u5305\u542b\u4e86\u6240\u6709\u5df2\u63d0\u4ea4\u7684\u4ea4\u6613\u8b8a\u66f4\uff0c\u662f\u76ee\u524d\u88ab\u6240\u6709\u8b80\u53d6\u64cd\u4f5c\u4f7f\u7528\u7684\u8cc7\u6599\u5eab\u7248\u672c"}),"\n",(0,c.jsx)(i.li,{children:"Shadow : \u5305\u542b\u4e86\u672a\u63d0\u4ea4\u7684\u4ea4\u6613\u8b8a\u66f4\u7684\u81e8\u6642\u8cc7\u6599\u5eab\u7248\u672c\uff0c\u6240\u6709\u7684\u66f4\u65b0\u64cd\u4f5c\u90fd\u6703\u5728\u9019\u500b\u9670\u5f71\u7248\u672c\u4e2d\u9032\u884c"}),"\n"]}),"\n",(0,c.jsx)(i.p,{children:"\u4e0b\u5716\u4e2d\uff0c\u5de6\u908a\u662f\u8a18\u61b6\u9ad4\u4e2d\u7684\u4f4d\u7f6e\uff0c\u53f3\u908a\u662f\u786c\u789f\u4e2d\u7684\u4f4d\u7f6e\u3002"}),"\n",(0,c.jsx)(i.p,{children:"\u7576\u5beb\u5165\u7684\u4ea4\u6613\u767c\u751f\u6642\uff0cDBMS \u6703\u751f\u6210\u4e00\u4efd shadow page\uff0c\u4e26\u5728 shadow page \u4e0a\u9032\u884c\u4fee\u6539\uff0c\u4e26\u5c07 DB root \u7684\u6307\u91dd\u6307\u5411 shadow page\uff0c\u540c\u6642\u5c07\u8cc7\u6599\u90fd\u5b58\u5728\u786c\u789f\u4e0a\u3002"}),"\n",(0,c.jsx)(l,{src:"/img/cmu15-445/c20/image-4.webp",caption:"Shadow Paging"}),"\n",(0,c.jsx)(i.p,{children:"\u5728 commit \u4e4b\u5f8c\uff0cDBMS \u6703\u522a\u9664\u820a\u7684 master page\u3002"}),"\n",(0,c.jsx)(l,{src:"/img/cmu15-445/c20/image-5.webp",caption:"Shadow Paging"}),"\n",(0,c.jsx)(i.p,{children:"\u5728 shadow paging \u7684\u5be6\u73fe\u4e2d\uff0c\u4e0d\u7ba1\u662f undo \u9084\u662f redo \u90fd\u975e\u5e38\u7c21\u55ae\uff0cundo \u53ea\u9700\u8981\u522a\u9664 shadow page\uff0c\u800c\u56e0\u70ba\u6bcf\u6b21\u90fd\u6703\u5c07\u8cc7\u6599\u5beb\u5165\u786c\u789f\uff0credo \u4e5f\u4e0d\u9700\u8981\u9032\u884c\u4efb\u4f55\u64cd\u4f5c\u3002"}),"\n",(0,c.jsx)(i.p,{children:"\u4f46 shadow paging \u7684\u7f3a\u9ede\u4e5f\u5f88\u660e\u986f :"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"\u6bcf\u6b21\u63d0\u4ea4\u9700\u8981\u5c07\u9801\u8868\u3001\u6839\u9801\u9762\u548c\u6240\u6709\u66f4\u65b0\u7684\u9801\u9762\u540c\u6b65\u5230\u786c\u789f\u4e2d\uff0c\u5c0e\u81f4\u5927\u91cf\u7684\u96a8\u6a5f\u5beb\u5165"}),"\n",(0,c.jsx)(i.li,{children:"\u7531\u65bc\u8981\u63d0\u4ea4\u7684\u8cc7\u6599\u53ef\u80fd\u88ab\u5206\u5272\u5230\u4e0d\u540c\u7684\u9801\u9762\u4e2d\uff0c\u5c0e\u81f4\u8cc7\u6599\u788e\u7247\u5316"}),"\n",(0,c.jsx)(i.li,{children:"\u96a8\u8457\u8cc7\u6599\u7684\u66f4\u65b0\uff0c\u820a\u7684\u9801\u9762\u5c07\u6703\u5931\u6548\uff0c\u6240\u4ee5\u9700\u8981 gc"}),"\n",(0,c.jsx)(i.li,{children:"\u901a\u5e38\u4f86\u8aaa\u53ea\u652f\u6301\u55ae\u4e00\u5beb\u5165\uff0c\u6216\u8005\u9700\u8981\u5c07\u591a\u500b\u4ea4\u6613\u4ee5\u6279\u6b21\u5f62\u5f0f\u63d0\u4ea4\uff0c\u9019\u9650\u5236\u4e86\u4f75\u767c\u6027"}),"\n"]}),"\n",(0,c.jsx)(i.p,{children:"\u5728 2010 \u5e74\u4ee5\u524d\u7684 SQLite \u4e5f\u66fe\u63a1\u7528\u904e\u985e\u4f3c\u7684 shadow paging \u7684\u65b9\u6cd5\u3002\n\u5982\u679c\u8981\u4fee\u6539\u67d0\u500b page\uff0c\u5b83\u6703\u5148\u5c07\u539f\u59cb\u7684 page \u4fdd\u5b58\u5230\u4e00\u500b journal file \u4e2d\uff0c\u7136\u5f8c\u76f4\u63a5\u4fee\u6539\u539f\u59cb\u7684 page\u3002\n\u5982\u679c\u63d0\u4ea4\u6210\u529f\uff0c\u5247\u522a\u9664 journal file\uff0c\u5982\u679c\u4e2d\u9014\u767c\u751f\u6545\u969c\uff0c\u5247\u6839\u64da journal file \u5c07 page \u6062\u5fa9\u5230\u539f\u59cb\u72c0\u614b\u3002"}),"\n",(0,c.jsx)(i.h2,{id:"write-ahead-logging-wal",children:"Write-Ahead Logging (WAL)"}),"\n",(0,c.jsx)(i.p,{children:"\u5c0d\u65bc shadow paging \u4f86\u8aaa\uff0c\u6700\u5927\u7684\u554f\u984c\u5c31\u662f\u9700\u8981\u5c07\u8a31\u591a\u4e0d\u9023\u7e8c\u7684\u9801\u9762\u5beb\u5165\u786c\u789f\uff0c\u800c WAL \u5c31\u662f\u4e00\u7a2e\u80fd\u5920\u89e3\u6c7a\u9019\u500b\u554f\u984c\u7684\u65b9\u6cd5\u3002"}),"\n",(0,c.jsx)(i.p,{children:"WAL \u7684\u6838\u5fc3\u6982\u5ff5\u662f\u5728\u8cc7\u6599\u5eab\u9032\u884c\u8b8a\u66f4\u4e4b\u524d\uff0c\u5148\u5c07\u8b8a\u66f4\u5beb\u5165\u4e00\u500b log file \u4e26\u5beb\u5165\u786c\u789f\uff0c\u7136\u5f8c\u518d\u4fee\u6539\u771f\u6b63\u7684\u6578\u64da\u9801\u9762\u3002\n\u9019\u6a23\u53ef\u4ee5\u4fdd\u8b49\u5373\u4f7f\u767c\u751f\u6545\u969c\uff0c\u4e5f\u53ef\u4ee5\u6839\u64da log file \u4f86\u9032\u884c\u6062\u5fa9\uff0c\u901a\u5e38 WAL \u63a1\u7528\u7684 buffer pool \u7b56\u7565\u901a\u5e38\u662f steal / no-force\u3002"}),"\n",(0,c.jsxs)(i.p,{children:["\u5728\u4ea4\u6613\u958b\u59cb\u6642\uff0cDBMS \u6703\u5728 log file \u4e2d\u5beb\u5165\u4e00\u689d ",(0,c.jsx)(i.code,{children:"BEGIN"})," \u8a18\u9304\uff0c\u7d50\u675f\u6642\u9700\u8981\u5beb\u5165\u4e00\u689d ",(0,c.jsx)(i.code,{children:"COMMIT"})," \u8a18\u9304\u3002\n\u5728\u57f7\u884c\u904e\u7a0b\u4e2d\u6703\u8a18\u9304\u5b8c\u6574\u7684\u8cc7\u8a0a\uff0c\u5305\u542b\u4e86 transaction_id\u3001object_id\u3001\u820a\u503c\u3001\u65b0\u503c\u7b49\u3002"]}),"\n",(0,c.jsx)(i.p,{children:"\u5982\u4e0b\u9762\u7684\u7bc4\u4f8b\u6240\u793a\uff0c\u6211\u5011\u6703\u5148\u5beb\u5165 WAL buffer \u4e2d\uff0c\u63a5\u8457\u4fee\u6539 buffer pool \u4e2d\u7684\u8cc7\u6599\uff0c\u518d\u5c07 WAL buffer flush \u5230\u786c\u789f\u4e2d\uff0c\u6700\u5f8c\u5047\u5982\u65b7\u96fb\u4e86\uff0c\u5247\u53ef\u4ee5\u6839\u64da log file \u4f86\u9032\u884c\u6062\u5fa9\u3002"}),"\n",(0,c.jsx)(l,{src:"/img/cmu15-445/c20/image-7.webp",caption:"Write-Ahead Logging"}),"\n",(0,c.jsx)(l,{src:"/img/cmu15-445/c20/image-8.webp",caption:"Write-Ahead Logging"}),"\n",(0,c.jsx)(l,{src:"/img/cmu15-445/c20/image-9.webp",caption:"Write-Ahead Logging"}),"\n",(0,c.jsx)(l,{src:"/img/cmu15-445/c20/image-10.webp",caption:"Write-Ahead Logging"}),"\n",(0,c.jsx)(i.h3,{id:"wal-group-commit",children:"WAL Group Commit"}),"\n",(0,c.jsx)(i.p,{children:"\u6bcf\u6b21\u90fd\u5c07 log flush \u5230\u786c\u789f\u53ef\u80fd\u6703\u6210\u70ba\u6548\u80fd\u74f6\u9838\uff0c\u56e0\u6b64\u6211\u5011\u53ef\u4ee5\u900f\u904e group commit \u4f86\u63d0\u9ad8\u6548\u80fd\uff0c\u53ea\u5728\u9054\u5230\u4e00\u5b9a\u6578\u91cf\u6216\u8005\u4e00\u5b9a\u6642\u9593\u5f8c\u624d\u9032\u884c flush\u3002"}),"\n",(0,c.jsx)(i.h3,{id:"capture-data-changes-cdc",children:"Capture Data Changes (CDC)"}),"\n",(0,c.jsx)(i.p,{children:"WAL \u662f\u4e00\u4efd\u5305\u542b\u4e86\u8cc7\u6599\u5eab\u6240\u6709\u8b8a\u66f4\u6b77\u53f2\u7684 log file\uff0c\u56e0\u6b64\u6211\u5011\u53ef\u4ee5\u5229\u7528\u9019\u4efd log file \u4f86\u5be6\u6642\u50b3\u9001\u8b8a\u52d5\u7d66\u5176\u4ed6\u7cfb\u7d71\uff0c\u9019\u7a2e\u6280\u8853\u7a31\u70ba Capture Data Changes (CDC)\u3002"}),"\n",(0,c.jsx)(i.p,{children:"CDC \u53ef\u4ee5\u7528\u65bc\u8cc7\u6599\u540c\u6b65\u3001ETL \u7b49\u5834\u666f\uff0c\u901a\u904e\u6355\u6349\u8cc7\u6599\u5eab\u7684\u8b8a\u66f4\u4e8b\u4ef6\uff0c\u5c07\u5176\u8f49\u63db\u70ba\u9069\u5408\u7684\u683c\u5f0f\uff0c\u4e26\u767c\u9001\u5230\u5176\u4ed6\u7cfb\u7d71\u4e2d\uff0c\u5e38\u898b\u7684\u6709 Debezium \u7b49\u7b49\u3002"}),"\n",(0,c.jsx)(i.h2,{id:"logging-schemes",children:"Logging Schemes"}),"\n",(0,c.jsx)(i.p,{children:"Log \u7d00\u9304\u7684\u5167\u5bb9\u53ef\u80fd\u4f9d\u64da\u4e0d\u540c\u7684\u7b56\u7565\u800c\u6709\u6240\u4e0d\u540c\uff0c\u4e3b\u8981\u6709\u4ee5\u4e0b\u5e7e\u7a2e :"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"Physical Logging"}),"\n",(0,c.jsx)(i.li,{children:"Logical Logging"}),"\n",(0,c.jsx)(i.li,{children:"Physiological Logging"}),"\n"]}),"\n",(0,c.jsx)(l,{src:"/img/cmu15-445/c20/image-11.webp",caption:"Logging Schemes"}),"\n",(0,c.jsx)(i.h3,{id:"physical-logging",children:"Physical Logging"}),"\n",(0,c.jsxs)(i.p,{children:["\u7269\u7406\u65e5\u8a8c\u8a18\u9304\u662f\u5c0d\u8cc7\u6599\u5eab\u4e2d\u7279\u5b9a\u4f4d\u7f6e\u7684\u4f4d\u5143\u7d1a\u5225\u8b8a\u66f4\u9032\u884c\u8a18\u9304\u3002\u6bcf\u689d\u65e5\u8a8c\u6703\u5305\u542b page_id\u3001offset\u3001before-image\u3001after-image\u3002\n\u985e\u4f3c\u65bc ",(0,c.jsx)(i.code,{children:"git diff"})," \u7684\u65b9\u5f0f\u3002"]}),"\n",(0,c.jsx)(i.h3,{id:"logical-logging",children:"Logical Logging"}),"\n",(0,c.jsx)(i.p,{children:"\u908f\u8f2f\u65e5\u8a8c\u8a18\u9304\u8a18\u9304\u7684\u662f\u4ea4\u6613\u57f7\u884c\u7684\u9ad8\u968e\u64cd\u4f5c\uff0c\u800c\u4e0d\u662f\u5177\u9ad4\u7684\u4f4d\u5143\u8b8a\u66f4\u3002\n\u4f8b\u5982\uff0c\u5b83\u6703\u8a18\u9304 UPDATE\u3001DELETE \u6216 INSERT \u64cd\u4f5c\u7684\u8a9e\u53e5\u3002"}),"\n",(0,c.jsx)(i.h3,{id:"physiological-logging",children:"Physiological Logging"}),"\n",(0,c.jsx)(i.p,{children:"\u7269\u7406\u908f\u8f2f\u6df7\u5408\u65e5\u8a8c\u8a18\u9304\u662f\u4e00\u7a2e\u6df7\u5408\u65b9\u6cd5\uff0c\u5c07\u7269\u7406\u548c\u908f\u8f2f\u65e5\u8a8c\u8a18\u9304\u7d50\u5408\u5728\u4e00\u8d77\u3002"}),"\n",(0,c.jsx)(i.p,{children:"\u5177\u9ad4\u4f86\u8aaa\uff0c\u5b83\u91dd\u5c0d\u55ae\u500b\u9801\u9762\u9032\u884c\u65e5\u8a8c\u8a18\u9304\uff0c\u4f46\u4e0d\u5177\u9ad4\u8a18\u9304\u9801\u9762\u4e2d\u6578\u64da\u7684\u7d44\u7e54\u65b9\u5f0f\u3002\n\u9019\u7a2e\u65b9\u6cd5\u6703\u57fa\u65bc\u9801\u9762\u7684 slot number \u4f86\u8b58\u5225\u8cc7\u6599\u5217\uff0c\u4f46\u4e0d\u6307\u5b9a\u8b8a\u66f4\u5728\u9801\u9762\u4e2d\u7684\u78ba\u5207\u4f4d\u7f6e (offset)\u3002"}),"\n",(0,c.jsx)(i.p,{children:"\u9019\u7a2e\u65b9\u6cd5\u4e5f\u662f\u7576\u4e0b\u6700\u6d41\u884c\u7684\u65b9\u6cd5\u3002"}),"\n",(0,c.jsx)(i.h2,{id:"checkpoint",children:"Checkpoint"}),"\n",(0,c.jsx)(i.p,{children:"\u5728\u4f7f\u7528 WAL \u6642\uff0clog \u6703\u96a8\u8457\u6642\u9593\u4e0d\u65b7\u589e\u9577\uff0c\u5c0e\u81f4\u5728\u6545\u969c\u6062\u5fa9\u6642\u9700\u8981\u56de\u653e\u5927\u91cf\u7684 log\uff0c\u5f9e\u800c\u589e\u52a0\u6062\u5fa9\u6642\u9593\u3002\n\u70ba\u4e86\u907f\u514d\u9019\u7a2e\u60c5\u6cc1\uff0cDBMS \u6703\u5b9a\u671f\u9032\u884c checkpoint \u64cd\u4f5c\uff0c\u5c07\u7576\u524d\u7684\u9ad2\u9801\u5beb\u5165\u786c\u789f\uff0c\u4e26\u5728 log file \u4e2d\u52a0\u4e0a\u4e00\u500b checkpoint \u8a18\u9304\uff0c\u8868\u793a\u5728\u9019\u500b\u9ede\u4e4b\u524d\u7684 log \u90fd\u5df2\u7d93\u6c38\u4e45\u7684\u61c9\u7528\u5230\u8cc7\u6599\u5eab\u4e2d\u3002"}),"\n",(0,c.jsx)(i.p,{children:"\u4ee5\u4e0b\u5716\u70ba\u4f8b\uff0c\u5728 checkpoint \u4e4b\u524d commit \u5b8c\u6210\u7684\u4ea4\u6613 T1 \u5df2\u7d93\u7d93\u88ab\u61c9\u7528\u5230\u8cc7\u6599\u5eab\u4e2d\u4e86\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u505a\u4efb\u4f55\u64cd\u4f5c\u3002\n\u800c\u5728 checkpoint \u4e4b\u5f8c commit \u7684\u4ea4\u6613 T2 \u5247\u9700\u8981\u9032\u884c redo\uff0c\u672a commit \u7684\u4ea4\u6613 T3 \u5247\u9700\u8981\u9032\u884c undo\u3002"}),"\n",(0,c.jsx)(l,{src:"/img/cmu15-445/c20/image-12.webp",caption:"Checkpoints"}),"\n",(0,c.jsx)(i.p,{children:"Checkpoint \u6700\u9700\u8981\u8003\u616e\u7684\u554f\u984c\u662f\u591a\u4e45\u57f7\u884c\u4e00\u6b21\u3002\n\u5982\u679c\u904e\u65bc\u983b\u7e41\uff0c\u6703\u5c0e\u81f4\u6548\u80fd\u4e0b\u964d\uff0c\u4f46\u5982\u679c\u592a\u4e45\u624d\u505a\u4e00\u6b21\uff0c\u5247\u6703\u5c0e\u81f4\u6062\u5fa9\u6642\u9593\u904e\u9577\u3002"}),"\n",(0,c.jsx)(i.p,{children:"\u4ee5 PostgreSQL \u70ba\u4f8b\uff0c\u5b83\u6703\u5728\u4ee5\u4e0b\u60c5\u6cc1\u4e0b\u89f8\u767c checkpoint :"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"checkpoint_timeout"})," : \u7576\u8ddd\u96e2\u4e0a\u6b21 checkpoint \u5df2\u7d93\u904e\u4e86\u4e00\u5b9a\u6642\u9593 (\u9810\u8a2d 5 \u5206\u9418)"]}),"\n",(0,c.jsxs)(i.li,{children:[(0,c.jsx)(i.code,{children:"max_wal_size"})," : \u7576 log file \u7684\u5927\u5c0f\u8d85\u904e\u4e86\u4e00\u5b9a\u7684\u9650\u5236 (\u9810\u8a2d 1GB)"]}),"\n",(0,c.jsxs)(i.li,{children:["\u624b\u52d5\u57f7\u884c SQL ",(0,c.jsx)(i.code,{children:"CHECKPOINT"})," \u6307\u4ee4"]}),"\n"]}),"\n",(0,c.jsx)(i.h3,{id:"blocking-checkpoint",children:"Blocking Checkpoint"}),"\n",(0,c.jsx)(i.p,{children:"Blocking checkpoint \u662f\u4e00\u7a2e\u6700\u7c21\u55ae\u7684 checkpoint \u5be6\u4f5c\u65b9\u6cd5\uff0c\u6b65\u9a5f\u5982\u4e0b :"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"\u66ab\u505c\u65b0\u4ea4\u6613 : \u66ab\u505c\u63a5\u53d7\u65b0\u7684\u4ea4\u6613\uff0c\u4e26\u7b49\u5f85\u6240\u6709\u7576\u524d\u6d3b\u8e8d\u7684\u4ea4\u6613\u5b8c\u6210"}),"\n",(0,c.jsx)(i.li,{children:"\u5237\u65b0\u7de9\u885d\u5340 : \u5c07\u7576\u524d\u8a18\u61b6\u9ad4\u4e2d\u7684\u6240\u6709\u65e5\u8a8c\u8a18\u9304\u548c\u4fee\u6539\u904e\u7684\u7de9\u885d\u5340\u5beb\u5230\u786c\u789f\u4e2d"}),"\n",(0,c.jsxs)(i.li,{children:["\u8a18\u9304 checkpoint : \u5beb\u5165\u4e00\u500b ",(0,c.jsx)(i.code,{children:"<CHECKPOINT>"})," \u8a18\u9304\u5230\u65e5\u8a8c\u6a94\u6848\u4e2d\uff0c\u4e26\u5c07\u5176\u5beb\u5165\u786c\u789f"]}),"\n"]}),"\n",(0,c.jsx)(i.p,{children:"\u4f46\u4e00\u822c\u4f86\u8aaa\uff0cblocking checkpoint \u6703\u5c0e\u81f4\u7cfb\u7d71\u505c\u9813\uff0c\u56e0\u6b64\u8f03\u5c11\u4f7f\u7528\uff0c\u6211\u5011\u6703\u5728\u4e0b\u4e00\u7bc0\u4e2d\u8a0e\u8ad6\u5176\u4ed6\u66f4\u597d\u7684\u65b9\u6cd5\u3002"})]})}function g(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,c.jsx)(i,{...e,children:(0,c.jsx)(t,{...e})}):t(e)}function h(e,i){throw new Error("Expected "+(i?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453:(e,i,n)=>{n.d(i,{R:()=>s,x:()=>a});var l=n(6540);const c={},o=l.createContext(c);function s(e){const i=l.useContext(o);return l.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:s(e.components),l.createElement(o.Provider,{value:i},e.children)}}}]);