"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["693"],{8995:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>a,default:()=>p,toc:()=>d,metadata:()=>t,assets:()=>c,contentTitle:()=>l});var t=JSON.parse('{"id":"CMU15-445/p2","title":"P2 - B+ Tree","description":"B+ tree Index","source":"@site/docs/CMU15-445/p2.mdx","sourceDirName":"CMU15-445","slug":"/CMU15-445/p2","permalink":"/RulerChen-Website/docs/CMU15-445/p2","draft":false,"unlisted":false,"editUrl":"https://github.com/RulerChen/RulerChen-Website/tree/main/docs/CMU15-445/p2.mdx","tags":[{"inline":true,"label":"CMU15-445","permalink":"/RulerChen-Website/docs/tags/cmu-15-445"},{"inline":true,"label":"CMU15-445 Projects","permalink":"/RulerChen-Website/docs/tags/cmu-15-445-projects"}],"version":"current","lastUpdatedAt":1758276763000,"sidebarPosition":102,"frontMatter":{"title":"P2 - B+ Tree","sidebar_position":102,"description":"B+ tree Index","keywords":["CMU15-445/645","B+ Tree","CMU15-445/645 \u7B46\u8A18"],"tags":["CMU15-445","CMU15-445 Projects"]},"sidebar":"tutorialSidebar","previous":{"title":"P1 - Buffer Pool Manager","permalink":"/RulerChen-Website/docs/CMU15-445/p1"},"next":{"title":"P3 - Query Execution","permalink":"/RulerChen-Website/docs/CMU15-445/p3"}}'),s=r(5893),i=r(65);let a={title:"P2 - B+ Tree",sidebar_position:"102",description:"B+ tree Index",keywords:["CMU15-445/645","B+ Tree","CMU15-445/645 \u7B46\u8A18"],tags:["CMU15-445","CMU15-445 Projects"]},l=void 0,c={},d=[{value:"Background",id:"background",level:2},{value:"Task 1 - B+Tree Pages",id:"task-1---btree-pages",level:2},{value:"Task 2 - B+Tree Operations",id:"task-2---btree-operations",level:2},{value:"Point Search",id:"point-search",level:3},{value:"Insertion",id:"insertion",level:3},{value:"Deletion",id:"deletion",level:3},{value:"Task 3 - Index Iterator",id:"task-3---index-iterator",level:2},{value:"Task 4 - Concurrency Control",id:"task-4---concurrency-control",level:2},{value:"Submit",id:"submit",level:2},{value:"Takeaways",id:"takeaways",level:2},{value:"References",id:"references",level:2}];function o(e){let n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components},{Head:r}=n;return r||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r,{children:(0,s.jsx)("title",{children:"CMU 15-445 2024Fall P2 B+ Tree"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u9019\u500B project \u4E2D\uFF0C\u6211\u5011\u9700\u8981\u5BE6\u73FE B+ tree index\uFF0C\u7E3D\u5171\u6709 4 \u500B Task :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"B+Tree Pages"}),"\n",(0,s.jsx)(n.li,{children:"B+Tree Operations (Insertion, Deletion, and Point Search)"}),"\n",(0,s.jsx)(n.li,{children:"Index Iterator"}),"\n",(0,s.jsx)(n.li,{children:"Concurrency Control"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,s.jsx)(n.p,{children:"\u9019\u500B project \u7684\u80CC\u666F\u77E5\u8B58\u61C9\u8A72\u662F\u76F8\u5C0D\u597D\u7406\u89E3\u7684\uFF0C\u53EF\u4EE5\u53C3\u8003\u4E0A\u8AB2\u8B1B\u7FA9\u4F86\u719F\u6089 B+ tree \u7684\u7D50\u69CB\u4EE5\u53CA\u64CD\u4F5C\u65B9\u5F0F\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"task-1---btree-pages",children:"Task 1 - B+Tree Pages"}),"\n",(0,s.jsxs)(n.p,{children:["B+ tree \u4E2D\u7E3D\u5171\u6709\u56DB\u7A2E page\uFF0C\u5206\u5225\u662F ",(0,s.jsx)(n.code,{children:"BPlusTreePage"}),"\u3001",(0,s.jsx)(n.code,{children:"BPlusTreeInternalPage"}),"\u3001",(0,s.jsx)(n.code,{children:"BPlusTreeLeafPage"})," \u4EE5\u53CA ",(0,s.jsx)(n.code,{children:"BPlusTreeHeaderPage"}),"\u3002\n\u9019\u500B task \u53EA\u9700\u8981\u6309\u7167\u8981\u6C42\u8B80\u61C2\u9019\u5E7E\u500B page \u5728\u5E79\u9EBC\u4EE5\u53CA\u5BE6\u4F5C\u4E00\u4E9B\u5982\u521D\u59CB\u5316 size \u8DDF type \u4E4B\u985E\u7684\u6771\u897F\u800C\u5DF2\uFF0C\u9019\u88E1\u5C31\u4E0D\u591A\u8AAA\u660E\u4E86\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u5728 bustub \u4E2D\uFF0C\u6BCF\u4E00\u500B page \u7684\u5927\u5C0F\u90FD\u662F 4 kb\uFF0C\u4E0B\u9762\u662F\u9019\u56DB\u7A2E page \u7684\u7D50\u69CB :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"BPlusTreePage"})," : B+ tree page \u7684 base class\uFF0C\u5305\u542B\u4E86\u4E00\u4E9B\u5171\u7528\u7684\u65B9\u6CD5\u53CA\u5C6C\u6027 (page type, size, max size) \u5171 12 bytes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"BPlusTreeInternalPage"})," : B+ tree \u7684 internal page\uFF0C\u5305\u542B\u4E86 key \u8DDF child page id \u7684 mapping\uFF0C\u9700\u8981\u6CE8\u610F ",(0,s.jsx)(n.code,{children:"key_array_[0]"})," \u662F\u7121\u610F\u7FA9\u7684"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"BPlusTreeLeafPage"})," : B+ tree \u7684 leaf page\uFF0C\u5305\u542B\u4E86 key \u8DDF RID \u7684 mapping\uFF0C\u4E26\u4E14\u6709\u4E00\u500B\u6307\u5411\u4E0B\u4E00\u500B leaf page \u7684\u6307\u6A19 ",(0,s.jsx)(n.code,{children:"next_page_id_"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"BPlusTreeHeaderPage"})," : B+ tree \u7684 header page\uFF0C\u76EE\u524D\u53EA\u5305\u542B\u4E86 ",(0,s.jsx)(n.code,{children:"root_page_id_"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"task-2---btree-operations",children:"Task 2 - B+Tree Operations"}),"\n",(0,s.jsxs)(n.p,{children:["\u9664\u4E86\u4E0A\u9762\u63D0\u5230\u7684\u5E7E\u500B class \u5916\uFF0C\u4E5F\u53EF\u4EE5\u770B\u4E00\u4E0B ",(0,s.jsx)(n.code,{children:"Context"})," \u9019\u500B class \u4F86\u5E6B\u52A9\u6211\u5011\u7BA1\u7406 PageGuard\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"point-search",children:"Point Search"}),"\n",(0,s.jsxs)(n.p,{children:["Search \u7684\u90E8\u5206\u61C9\u8A72\u662F\u88E1\u9762\u6700\u7C21\u55AE\u7684\uFF0C\u5F9E root page \u958B\u59CB\u7528 binary search \u7684\u65B9\u6CD5\u4E00\u76F4\u5F80\u4E0B\u641C\u5C0B\uFF0C\u76F4\u5230\u627E\u5230 leaf page \u70BA\u6B62\uFF0C\u53EF\u4EE5\u628A\u4E2D\u9014\u7684\u7BC0\u9EDE\u90FD\u653E\u5230 ",(0,s.jsx)(n.code,{children:"Context"})," \u4E2D\u7684 ",(0,s.jsx)(n.code,{children:"read_set_"})," \u4E2D\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"insertion",children:"Insertion"}),"\n",(0,s.jsx)(n.p,{children:"Insert \u4E3B\u8981\u53EF\u4EE5\u5206\u6210\u4E09\u7A2E\u60C5\u6CC1\u4F86\u8A0E\u8AD6 :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5982\u679C\u662F\u7A7A\u7684 B+ tree\uFF0C\u76F4\u63A5\u5EFA\u7ACB root page \u4E26\u63D2\u5165 key"}),"\n",(0,s.jsx)(n.li,{children:"\u5982\u679C\u6700\u5F8C\u7684\u7BC0\u9EDE\u6C92\u6709 overflow\uFF0C\u76F4\u63A5\u63D2\u5165 key"}),"\n",(0,s.jsx)(n.li,{children:"\u5982\u679C\u6700\u5F8C\u7684\u7BC0\u9EDE overflow\uFF0C\u5247\u9700\u8981\u5206\u88C2\u7BC0\u9EDE\u4E26\u5C07\u65B0\u7684 key \u63D2\u5165\u5230 parent page \u4E2D\uFF0C\u9700\u8981\u905E\u8FF4\u7684\u505A\u9019\u4EF6\u4E8B\u76F4\u5230\u6C92\u6709 overflow \u70BA\u6B62\uFF0C\u4E5F\u6709\u53EF\u80FD\u6703\u9700\u8981\u5EFA\u7ACB\u65B0\u7684 root page"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"deletion",children:"Deletion"}),"\n",(0,s.jsx)(n.p,{children:"Delete \u7684\u60C5\u6CC1\u662F\u4E09\u7A2E\u64CD\u4F5C\u88E1\u9762\u6700\u8907\u96DC\u7684\uFF0C\u6211\u662F\u6309\u7167\u4EE5\u4E0B\u7684\u9806\u5E8F\u5BE6\u4F5C\u7684 :"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5148\u522A\u9664 key\uFF0C\u5982\u679C\u6C92\u6709 underflow\uFF0C\u5247\u76F4\u63A5\u7D50\u675F (\u8981\u7279\u5225\u6CE8\u610F\u662F root page \u7684\u60C5\u6CC1\uFF0C\u5982\u679C\u662F root page \u4E26\u4E14\u6C92\u6709 key \u4E86\uFF0C\u5247\u9700\u8981\u5C07\u6574\u500B B+ tree \u6E05\u7A7A)"}),"\n",(0,s.jsx)(n.li,{children:"\u5982\u679C\u6709 underflow\uFF0C\u5247\u9700\u8981\u6AA2\u67E5 sibling page \u662F\u5426\u53EF\u4EE5\u501F key\uFF0C\u5982\u679C\u53EF\u4EE5\u501F key\uFF0C\u5247\u5F9E sibling page \u4E2D\u501F\u4E00\u500B key \u4E26\u66F4\u65B0 parent page \u7684 key\uFF0C\u9019\u7A2E\u65B9\u5F0F\u4E0D\u9700\u8981\u7E7C\u7E8C\u66F4\u65B0\u7236\u7BC0\u9EDE"}),"\n",(0,s.jsx)(n.li,{children:"\u5982\u679C sibling page \u4E0D\u80FD\u501F key\uFF0C\u5247\u9700\u8981 merge sibling page\uFF0C\u4E26\u5C07 parent page \u4E2D\u7684 key \u522A\u9664\uFF0C\u7136\u5F8C\u518D\u6AA2\u67E5 parent page \u662F\u5426 underflow\uFF0C\u5982\u679C parent page underflow\uFF0C\u5247\u9700\u8981\u7E7C\u7E8C\u5F80\u4E0A\u8655\u7406"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"task-3---index-iterator",children:"Task 3 - Index Iterator"}),"\n",(0,s.jsxs)(n.p,{children:["\u9019\u500B\u90E8\u5206\u611F\u89BA\u4E5F\u6C92\u4EC0\u9EBC\u7279\u5225\u7684\uFF0C\u5C31\u662F\u4E00\u76F4\u8B80\u53D6\u4E0B\u4E00\u500B page\uFF0C\u9700\u8981\u81EA\u5DF1\u6C7A\u5B9A\u4E00\u4E0B ",(0,s.jsx)(n.code,{children:"IsEnd()"})," \u60F3\u8981\u5BE6\u4F5C\u6210\u4EC0\u9EBC\u6A23\u5B50\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6211\u81EA\u5DF1\u7684\u505A\u6CD5\u662F\u8868\u793A\u6210 ",(0,s.jsx)(n.code,{children:"read_page->GetNextPageId() == INVALID_PAGE_ID && index_ >= read_page->GetSize()"}),"\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"task-4---concurrency-control",children:"Task 4 - Concurrency Control"}),"\n",(0,s.jsx)(n.p,{children:"Latch crabbing \u7684\u90E8\u5206\u53EF\u4EE5\u53C3\u8003\u4E0A\u8AB2\u8B1B\u7FA9\uFF0C\u57FA\u672C\u4E0A\u5C31\u662F\u6AA2\u67E5\u5B50\u7BC0\u9EDE\u662F\u4E0D\u662F\u5B89\u5168\u7684\uFF0C\u5982\u679C\u662F\u5B89\u5168\u7684\u5C31\u53EF\u4EE5\u653E\u6389\u7236\u7BC0\u9EDE\u7684\u9396\uFF0C\u7136\u5F8C\u7E7C\u7E8C\u5F80\u4E0B\u8D70\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u9019\u88E1\u6211\u53EF\u4EE5\u5206\u4EAB\u4E00\u500B\u932F\u8AA4\u5BE6\u4F5C\uFF0C\u9019\u662F\u6211\u5728\u5BE6\u4F5C insert \u7684\u6642\u5019\u9047\u5230\u7684\u554F\u984C :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"if (IsEmpty()) {\n  WritePageGuard header_guard = bpm_->WritePage(header_page_id_);\n  auto header_page = header_guard.AsMut<BPlusTreeHeaderPage>();\n\n  auto root_page_id = bpm_->NewPage();\n  WritePageGuard root_guard = bpm_->WritePage(root_page_id);\n  auto root_page = root_guard.AsMut<LeafPage>();\n  return root_page->Insert(key, value, comparator_);\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u4E0A\u9762\u9019\u500B\u5728 ",(0,s.jsx)(n.code,{children:"IsEmpty()"})," \u7684\u6642\u5019\u662F\u6703\u53BB\u62FF ",(0,s.jsx)(n.code,{children:"header_guard"})," \u7684\uFF0C\u4F46\u662F\u4ED6\u8DDF\u4E0B\u9762\u7684 ",(0,s.jsx)(n.code,{children:"header_guard"})," \u662F\u4E0D\u9023\u7E8C\u7684\uFF0C\u9019\u4E2D\u9593\u5C31\u6709\u53EF\u80FD\u7522\u751F\u932F\u8AA4\u3002\n\u56E0\u6B64\u8981\u76E1\u91CF\u907F\u514D\u4F7F\u7528 ",(0,s.jsx)(n.code,{children:"IsEmpty()"})," \u4F86\u6AA2\u67E5\u6574\u500B\u6A39\u662F\u5426\u70BA\u7A7A\uFF0C\u6539\u6210\u76F4\u63A5\u5728\u88E1\u9762\u62FF ",(0,s.jsx)(n.code,{children:"header_guard"})," \u5224\u65B7\u624D\u662F\u5C0D\u7684\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u984C\u5916\u8A71\uFF0Ccontention test \u4F3C\u4E4E\u53EA\u91DD\u5C0D ",(0,s.jsx)(n.code,{children:"Insert"})," \u7684\u90E8\u5206\u9032\u884C\u6E2C\u8A66\uFF0C\u56E0\u6B64\u5728 ",(0,s.jsx)(n.code,{children:"Insert"})," \u7684\u6642\u5019\u8981\u7279\u5225\u6CE8\u610F latch crabbing \u7684\u5BE6\u4F5C\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"submit",children:"Submit"}),"\n",(0,s.jsx)(n.p,{children:"\u9019\u500B project \u63D0\u4F9B\u4E86\u7DDA\u4E0A\u7684 B+ tree visualizer\uFF0C\u53EF\u4EE5\u7528\u4F86\u6AA2\u67E5\u81EA\u5DF1\u7684 B+ tree \u662F\u5426\u6B63\u78BA :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"make b_plus_tree_printer -j\n./bin/b_plus_tree_printer\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u4E26\u900F\u904E\u9019\u500B",(0,s.jsx)(n.a,{href:"http://dreampuf.github.io/GraphvizOnline/",children:"\u7DDA\u4E0A B+ tree visualizer"})," \u4F86\u6AA2\u67E5\u81EA\u5DF1\u7684 B+ tree \u662F\u5426\u6B63\u78BA\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"make b_plus_tree_insert_test -j$(nproc) && ./test/b_plus_tree_insert_test\n\nmake b_plus_tree_sequential_scale_test -j$(nproc) && ./test/b_plus_tree_sequential_scale_test\n\nmake b_plus_tree_delete_test -j$(nproc) && ./test/b_plus_tree_delete_test\n\nmake b_plus_tree_contention_test -j$(nproc) && ./test/b_plus_tree_contention_test\n\nmake b_plus_tree_concurrent_test -j$(nproc) && ./test/b_plus_tree_concurrent_test\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"make format && make check-format && make check-lint && make check-clang-tidy-p2\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"make submit-p2\n"})}),"\n",(0,s.jsx)(n.h2,{id:"takeaways",children:"Takeaways"}),"\n",(0,s.jsx)(n.p,{children:"\u9019\u500B project \u5728\u5BEB\u7684\u6642\u5019\u611F\u89BA\u82B1\u4E86\u5F88\u591A\u6642\u9593\uFF0C\u4F46\u771F\u7684\u5230\u8981\u5BEB\u7E3D\u7D50\u7684\u6642\u5019\uFF0C\u537B\u53C8\u767C\u73FE\u597D\u50CF\u90FD\u662F\u4E00\u4E9B\u5C0F\u7D30\u7BC0\u800C\u5DF2\u4E0D\u77E5\u9053\u8981\u5BEB\u5565\u54C8\u54C8\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u9084\u6709\u4E00\u500B\u554F\u984C\u662F\u5728\u65BC contention test \u90A3\u908A\u6211\u5728 gradescope \u4E0A\u9762\u4E00\u76F4\u5230\u4E0D\u4E86 [2.5,3.5] \u7684\u7BC4\u570D (\u5927\u6982\u90FD\u5728 2.3 \u5DE6\u53F3)\uFF0C\u611F\u89BA\u61C9\u8A72\u6709\u751A\u9EBC\u6C92\u6709\u6CE8\u610F\u5230\u7684\u7D30\u7BC0\u4F46\u4E5F\u6709\u9EDE\u61F6\u5F97\u7E7C\u7E8C debug \u4E0B\u53BB\u4E86\uFF0C\u7E3D\u4E4B\u9019\u500B project \u5C31\u662F\u9019\u6A23\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.aneureka.com/posts/cmu-15445-p2-opt",children:"CMU 15-445 2023 P2 \u4F18\u5316\u653B\u7565"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/828933572",children:"CMU Fall 2024 15-445 P1&P2[\u4F18\u5316 P2]"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://juejin.cn/post/7526343800874565670",children:"CMU15445-2024fall-project2\u8E29\u5751\u7ECF\u5386"})}),"\n"]})]})}function p(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},65:function(e,n,r){r.d(n,{Z:()=>l,a:()=>a});var t=r(7294);let s={},i=t.createContext(s);function a(e){let n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);